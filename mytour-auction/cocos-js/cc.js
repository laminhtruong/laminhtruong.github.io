System.register([],(function(t,e){"use strict";return{execute:function(){t({BitMask:ce,CCClass:ei,CacheMode:void 0,DebugMode:void 0,Enum:he,Eventify:x_,GFXAPI:void 0,GFXAddress:void 0,GFXAttributeName:void 0,GFXBlendFactor:void 0,GFXBlendOp:void 0,GFXBufferAccessBit:void 0,GFXBufferFlagBit:void 0,GFXBufferUsageBit:void 0,GFXClearFlag:void 0,GFXColorMask:void 0,GFXCommandBufferType:void 0,GFXComparisonFunc:void 0,GFXCullMode:void 0,GFXDescriptorType:void 0,GFXDynamicStateFlagBit:void 0,GFXFeature:void 0,GFXFilter:void 0,GFXFormat:void 0,GFXFormatSize:Co,GFXFormatSurfaceSize:wo,GFXFormatType:void 0,GFXLoadOp:void 0,GFXMemoryUsageBit:void 0,GFXObjectType:void 0,GFXPipelineBindPoint:void 0,GFXPolygonMode:void 0,GFXPrimitiveMode:void 0,GFXQueueType:void 0,GFXSampleCount:void 0,GFXShadeModel:void 0,GFXShaderStageFlagBit:void 0,GFXStencilFace:void 0,GFXStencilOp:void 0,GFXStoreOp:void 0,GFXSurfaceTransform:void 0,GFXTextureFlagBit:void 0,GFXTextureLayout:void 0,GFXTextureType:void 0,GFXTextureUsageBit:void 0,GFXType:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,Overflow:void 0,SystemEventType:void 0,VerticalTextAlignment:void 0,WorldNode3DToLocalNodeUI:$A,WorldNode3DToWorldNodeUI:tb,absMax:xi,absMaxComponent:bi,approx:li,assert:p,assertID:w,bezier:wM,bezierByTime:NM,ccenum:fe,clamp:ci,clamp01:hi,color:wi,computeRatioByType:zM,deserialize:Cf,earcut:fV,equals:si,error:d,errorID:b,find:lR,fragmentText:tB,getBaselineOffset:function(){return 0},getError:R,getPathFromRoot:function(t,e){for(var i=t,n="";null!==i&&i!==e;)n=i.name+"/"+n,i=i.parent;return n.slice(0,-1)},getWorldTransformUntilRoot:JD,instantiate:Jb,inverseLerp:Ai,isCustomTargetModifier:aN,isDisplayStats:I,isElementModifier:rN,isPropertyModifier:nN,isUnicodeCJK:ZL,isUnicodeSpace:QL,isValid:v_,lerp:ui,log:_,logID:T,markAsWarning:void 0,mat4:qi,murmurhash2_32_gc:qo,nextPow2:Ti,pingPong:Ei,pseudoRandom:vi,pseudoRandomRange:gi,pseudoRandomRangeInt:yi,quat:Gi,randomRange:pi,randomRangeInt:mi,rect:rn,removeProperty:void 0,repeat:Si,replaceProperty:void 0,safeMeasureText:JL,sampleAnimationCurve:FM,setDefaultLogTimes:function(t){t>0&&(ft=t)},setDisplayStats:O,size:en,toDegree:fi,toRadian:_i,tween:Bdt,tweenUtil:Fdt,v2:Zi,v3:Pi,v4:Ji,warn:f,warnID:E});var i="undefined"==typeof window?global:window,n=t("cclegacy",{_global:i});n.internal={},i.CC_BUILD=!0,i.CC_TEST=!1,i.CC_EDITOR=!1,i.CC_PREVIEW=!1,i.CC_DEV=!1,i.CC_DEBUG=!1,i.CC_JSB=!1,i.CC_BYTEDANCE=!1,i.CC_WECHAT=!1,i.CC_ALIPAY=!1,i.CC_XIAOMI=!1,i.CC_BAIDU=!1,i.CC_COCOSPLAY=!1,i.CC_HUAWEI=!1,i.CC_OPPO=!1,i.CC_VIVO=!1,i.CC_MINIGAME=!1,i.CC_RUNTIME_BASED=!1,i.CC_SUPPORT_JIT=!0;var r=t("VERSION","3.0.1");i.CocosEngine=n.ENGINE_VERSION=r,i.cc=n;var a="https://github.com/cocos-creator/engine/blob/3d/EngineErrorMap.md",o=null,s=console.log.bind(console),l=s,c=s,h=function(t,e){if(!t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];console.log("ASSERT: "+u.apply(void 0,[e].concat(n)))}};function u(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return n.js.formatStr.apply(null,[t].concat(i))}function _(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return s.apply(void 0,[t].concat(i))}function f(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return l.apply(void 0,[t].concat(i))}function d(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return c.apply(void 0,[t].concat(i))}function p(t,e){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return h.apply(void 0,[t,e].concat(n))}function m(t){if(s=l=c=h=function(){},t!==x.NONE){if(t>x.ERROR){var e=function(t){if(n.game.canvas){if(!o){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",n.game.canvas.height);var i=e.style;i.zIndex="99999",i.position="absolute",i.top=i.left="0",(o=document.createElement("textarea")).setAttribute("rows","20"),o.setAttribute("cols","30"),o.setAttribute("disabled","true");var r=o.style;r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderTopWidth=r.borderLeftWidth=r.borderRightWidth="0px",r.borderTopStyle=r.borderLeftStyle=r.borderRightStyle="none",r.padding="0px",r.margin="0px",e.appendChild(o),n.game.canvas.parentNode.appendChild(e)}o.value=o.value+t+"\r\n",o.scrollTop=o.scrollHeight}};c=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e("ERROR :  "+u.apply(void 0,[t].concat(n)))},h=function(t,i){if(!t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];e("ASSERT: "+u.apply(void 0,[i].concat(r)))}},t!==x.ERROR_FOR_WEB_PAGE&&(l=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e("WARN :  "+u.apply(void 0,[t].concat(n)))}),t===x.INFO_FOR_WEB_PAGE&&(s=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e(u.apply(void 0,[t].concat(n)))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),c=console.error.bind?console.error.bind(console):function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return console.error.apply(console,[t].concat(i))},h=function(t,e){if(!t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];var a=u.apply(void 0,[e].concat(n));throw new Error(a)}});t!==x.ERROR&&(l=console.warn.bind?console.warn.bind(console):function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return console.warn.apply(console,[t].concat(i))}),t===x.INFO&&(s=console.log.bind?console.log.bind(console):function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return console.log.apply(console,[t].concat(i))})}}function v(t){d(t.stack||t)}function g(t){return function(e){for(var i=t+" "+e+", please go to "+a+"#"+e+" to see details.",n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return 0===r.length?i:i+" Arguments: "+r.join(", ")}}var y=g("Log");function T(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];_(y.apply(void 0,[t].concat(i)))}var S=g("Warning");function E(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];f(S.apply(void 0,[t].concat(i)))}var A=g("Error");function b(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];d(A.apply(void 0,[t].concat(i)))}var x,C=g("Assert");function w(t,e){if(!t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];p(!1,C.apply(void 0,[e].concat(n)))}}function R(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return A.apply(void 0,[t].concat(i))}function I(){return!!n.profiler&&n.profiler.isShowingStats()}function O(t){n.profiler&&(t?n.profiler.showStats():n.profiler.hideStats(),n.game.config.showFPS=!!t)}!function(t){t[t.NONE=0]="NONE",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t[t.INFO_FOR_WEB_PAGE=4]="INFO_FOR_WEB_PAGE",t[t.WARN_FOR_WEB_PAGE=5]="WARN_FOR_WEB_PAGE",t[t.ERROR_FOR_WEB_PAGE=6]="ERROR_FOR_WEB_PAGE"}(x||(x=t("DebugMode",{})));var P=Object.freeze({__proto__:null,log:_,warn:f,error:d,assert:p,_resetDebugSetting:m,_throw:v,logID:T,warnID:E,errorID:b,assertID:w,get DebugMode(){return x},getError:R,isDisplayStats:I,setDisplayStats:O}),M=/(\.[^\.\/\?\\]*)(\?.*)?$/,D=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,N=/[^\.\/]+\/\.\.\//;function L(){for(var t="",e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];for(var r=0,a=i;r<a.length;r++){var o=a[r];t=(t+(""===t?"":"/")+o).replace(/(\/|\\\\)$/,"")}return t}function B(t){var e=M.exec(t);return e?e[1]:""}function F(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function z(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var n=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!n)return t;var r=n[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r}function U(t){var e=D.exec(t);return e?e[2]:""}function k(t,e){e=e||"";var i=t.indexOf("?"),n="";return i>0&&(n=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+n:t.substring(0,i)+e+n}function G(t,e,i){if(0===e.indexOf("."))return k(t,e);var n=t.indexOf("?"),r="",a=i?B(t):"";return n>0&&(r=t.substring(n),t=t.substring(0,n)),n=(n=t.lastIndexOf("/"))<=0?0:n+1,t.substring(0,n)+e+a+r}function H(t){var e=t=String(t);do{e=t,t=t.replace(N,"")}while(e.length!==t.length);return t}function V(t){return t.replace(/[\/\\]$/,"")}function W(){return n.sys.os===n.sys.OS_WINDOWS?"\\":"/"}function j(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function q(t,e,i){return e&&j(t.prototype,e),i&&j(t,i),t}function X(){return(X=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function Y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function K(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Q(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t){if(t){if("string"==typeof t)return Z(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Z(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}function J(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function $(t,e,i,n,r){var a={};return Object.keys(n).forEach((function(t){a[t]=n[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,n){return n(t,e,i)||i}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}t("path",Object.freeze({__proto__:null,join:L,extname:B,mainFileName:F,basename:z,dirname:U,changeExtname:k,changeBasename:G,_normalize:H,stripSep:V,getSeperator:W})),n.log=_,n.warn=f,n.error=d,n.assert=p,n._throw=v,n.logID=T,n.warnID=E,n.errorID=b,n.assertID=w,n.debug=P,n.path={join:L,extname:B,mainFileName:F,basename:z,dirname:U,changeExtname:k,changeBasename:G,_normalize:H,stripSep:V,get sep(){return W()}};var tt=0,et={};function it(t){return(t>0)-(t<0)}function nt(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1}function rt(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function at(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}var ot=new Array(256);!function(t){for(var e=0;e<256;++e){var i=e,n=e,r=7;for(i>>>=1;i;i>>>=1)n<<=1,n|=1&i,--r;t[e]=n<<r&255}}(ot);var st=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-1<<31,sign:it,abs:function(t){var e=t>>31;return(t^e)-e},min:function(t,e){return e^(t^e)&-(t<e)},max:function(t,e){return t^(t^e)&-(t<e)},isPow2:function(t){return!(t&t-1||!t)},log2:nt,log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},popCount:function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},countTrailingZeros:rt,nextPow2:at,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},reverse:function(t){return ot[255&t]<<24|ot[t>>>8&255]<<16|ot[t>>>16&255]<<8|ot[t>>>24&255]},interleave2:function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},deinterleave2:function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},interleave3:function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},deinterleave3:function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},nextCombination:function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>rt(t)+1}});t("bits",st);var lt,ct,ht,ut,_t,ft=10,dt=0,pt=new Map;ht=function(t,e,i,n,r,a,o){var s=pt.get(a);s&&s.logTimes>s.count&&(r("'%s' is deprecated, please use '%s' instead. "+o,t+"."+e,i+"."+n),s.count++)},lt=t("replaceProperty",(function(t,e,i){null!=t&&i.forEach((function(i){var n=dt++;pt.set(n,{id:n,count:0,logTimes:void 0!==i.logTimes?i.logTimes:ft});var r=null!=i.target?i.target:t,a=null!=i.newName?i.newName:i.name,o=null!=i.targetName?i.targetName:e,s=r===t,l=i.suggest?"("+i.suggest+")":"";if(null!=i.customFunction)t[i.name]=function(){var t;return ht(e,i.name,o,a,f,n,l),(t=i.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=i.customSetter||null!=i.customGetter){var c=null!=i.customSetter,h=null!=i.customGetter;c&&h?Object.defineProperty(t,i.name,{get:function(){return ht(e,i.name,o,a,f,n,l),i.customGetter.call(this)},set:function(t){ht(e,i.name,o,a,f,n,l),i.customSetter.call(this,t)},enumerable:!1}):c?Object.defineProperty(t,i.name,{set:function(t){ht(e,i.name,o,a,f,n,l),i.customSetter.call(this,t)},enumerable:!1}):h&&Object.defineProperty(t,i.name,{get:function(){return ht(e,i.name,o,a,f,n,l),i.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,i.name,{get:function(){return ht(e,i.name,o,a,f,n,l),s?this[a]:r[a]},set:function(t){ht(e,i.name,o,a,f,n,l),s?this[a]=t:r[a]=t},enumerable:!1})}))})),_t=function(t,e,i,n,r){var a=pt.get(n);a&&a.logTimes>a.count&&(i("'%s' has been removed. "+r,t+"."+e),a.count++)},ct=t("removeProperty",(function(t,e,i){null!=t&&i.forEach((function(i){var n=dt++;pt.set(n,{id:n,count:0,logTimes:void 0!==i.logTimes?i.logTimes:ft});var r=i.suggest?"("+i.suggest+")":"";Object.defineProperty(t,i.name,{get:function(){return _t(e,i.name,d,n,r)},set:function(){_t(e,i.name,d,n,r)},enumerable:!1})}))})),ut=function(t,e,i,n,r){var a=pt.get(n);a&&a.logTimes>a.count&&(i("'%s' is deprecated. "+r,t+"."+e),a.count++)},t("markAsWarning",(function(t,e,i){if(null!=t){var n=function(e,i,n,r,a,o){if(e.get){var s=e.get;e.get=function(){return ut(i,n,r,a,o),s.call(this)}}if(e.set){var l=e.set;e.set=function(t){ut(i,n,r,a,o),l.call(this,t)}}Object.defineProperty(t,n,e)};i.forEach((function(i){var r=i.name,a=Object.getOwnPropertyDescriptor(t,r);if(a&&a.configurable){var o=dt++;pt.set(o,{id:o,count:0,logTimes:void 0!==i.logTimes?i.logTimes:ft});var s=i.suggest?"("+i.suggest+")":"";if(null!=a.value)if("function"==typeof a.value){var l=a.value;t[r]=function(){return ut(e,r,f,o,s),l.call.apply(l,[this].concat(Array.prototype.slice.call(arguments)))}}else n(a,e,r,f,o,s);else n(a,e,r,f,o,s);Object.defineProperty(t,r,{enumerable:!1})}}))}}));var mt=function(){function t(t){this.i=0,this.array=t}var e=t.prototype;return e.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},e.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},e.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},e.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},e.push=function(t){this.array.push(t)},q(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function vt(t,e){t.splice(e,1)}function gt(t,e){var i=t.length;e<0||e>=i||(t[e]=t[i-1],t.length=i-1)}function yt(t,e){var i=t.indexOf(e);return i>=0&&(vt(t,i),!0)}function Tt(t,e){return t.indexOf(e)>=0}var St=Object.freeze({__proto__:null,removeAt:vt,fastRemoveAt:gt,remove:yt,fastRemove:function(t,e){var i=t.indexOf(e);i>=0&&(t[i]=t[t.length-1],--t.length)},removeIf:function(t,e){var i=t.findIndex(e);if(i>=0){var n=t[i];return vt(t,i),n}},verifyType:function(t,e){if(t&&t.length>0)for(var i,n=Q(t);!(i=n()).done;)if(!(i.value instanceof e))return T(1300),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;i<n;i++)yt(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},contains:Tt,copy:function(t){for(var e=t.length,i=new Array(e),n=0;n<e;n+=1)i[n]=t[n];return i},MutableForwardIterator:mt}),Et=function(){function t(t){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+ ++this.id},t}();Et.global=new Et("global");var At=new Et("TmpCId."),bt="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]");function xt(t){return"number"==typeof t||t instanceof Number}function Ct(t){return"string"==typeof t||t instanceof String}function wt(t){for(var e in t)return!1;return!0}var Rt,It=(Rt={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,e,i,n,r){Rt.value=i,Rt.writable=n,Rt.enumerable=r,Object.defineProperty(t,e,Rt),Rt.value=void 0}),Ot=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(e,i,n,r,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),"boolean"==typeof r&&(a=r,r=void 0),t.get=n,t.set=r,t.enumerable=a,t.configurable=o,Object.defineProperty(e,i,t),t.get=void 0,t.set=void 0}}(),Pt=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(e,i,n,r,a){t.get=n,t.enumerable=r,t.configurable=a,Object.defineProperty(e,i,t),t.get=void 0}}(),Mt=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(e,i,n,r,a){t.set=n,t.enumerable=r,t.configurable=a,Object.defineProperty(e,i,t),t.set=void 0}}();function Dt(t){var e=Object.create(null);return t&&(e["."]=1,e["/"]=1,delete e["."],delete e["/"]),e}function Nt(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var i="";if(t.name&&(i=t.name),t.toString){var n,r=t.toString();(n="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===n.length&&(i=n[1])}return"Object"!==i?i:""}return t&&t.constructor?Nt(t.constructor):""}function Lt(t,e,i,n){var r=/([^.]+)$/,a=r.exec(e)[0],o=r.exec(i)[0];function s(){return this[o]}n?Ot(t,a,s,(function(t){this[o]=t})):Pt(t,a,s)}function Bt(t,e,i,n){for(var r in i)Lt(t,e+"."+r,i[r],n)}var Ft=/(%d)|(%s)/,zt=/%s/;function Ut(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(0===arguments.length)return"";if(0===i.length)return""+t;var r="string"==typeof t&&Ft.test(t);if(r)for(var a,o=Q(i);!(a=o()).done;){var s=a.value,l="number"==typeof s?Ft:zt;if(l.test(t)){var c=""+s;t=t.replace(l,c)}else t+=" "+s}else for(var h,u=Q(i);!(h=u()).done;){var _=h.value;t+=" "+_}return t}function kt(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e}function Gt(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function Ht(t,e,i){var n=Gt(e,t);n&&Object.defineProperty(i,t,n)}function Vt(t){t=t||{};for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var r=0,a=i;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){b(5402,o);continue}for(var s in o)s in t||Ht(s,o,t)}}return t}function Wt(t){t=t||{};for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var r=0,a=i;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){b(5403,o);continue}for(var s in o)Ht(s,o,t)}}return t}function jt(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function qt(t){var e=t.prototype,i=e&&Object.getPrototypeOf(e);return i&&i.constructor}function Xt(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=qt(t)))return!1;if(t===e)return!0}}return!1}function Yt(t){for(var e=0,i=Object.keys(t);e<i.length;e++)delete t[i[e]]}var Kt=Dt(!0),Zt=Dt(!0);function Qt(t,e){return function(i,n){if(n.prototype.hasOwnProperty(t)&&delete e[n.prototype[t]],It(n.prototype,t,i),i){var r=e[i];r&&r!==n?d("A Class already exists with the same "+t+' : "'+i+'".'):e[i]=n}}}var Jt=Qt("__cid__",Kt),$t=Qt("__classname__",Zt);function te(t,e){if($t(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||At.getNewId();i&&Jt(i,e)}}function ee(t,e){var i=Zt[e],n=Kt[e],r=!0;if(i&&i!==t&&(d('"'+e+'" has already been set as name or alias of another class.'),r=!1),n&&n!==t&&(d('"'+e+'" has already been set as id or alias of another class.'),r=!1),r){var a=t[bt];a||(a=[],t[bt]=a),a.push(e),Zt[e]=t,Kt[e]=t}}function ie(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var n=0,r=e;n<r.length;n++){var a=r[n],o=a.prototype,s=o.__cid__;s&&delete Kt[s];var l=o.__classname__;l&&delete Zt[l];var c=o[bt];if(c)for(var h=0;h<c.length;++h){var u=c[h];delete Zt[u],delete Kt[u]}}}function ne(t){return Kt[t]}function re(t){return Zt[t]}function ae(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""}var oe=function(){var t=e.prototype;function e(t,e){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var i=void 0===e?t:e,n=void 0===e?null:t;this.count=0,this._pool=new Array(i),this._cleanup=n}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},t.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},e}(),se=St,le={IDGenerator:Et,Pool:oe,array:St,isNumber:xt,isString:Ct,isEmptyObject:wt,getPropertyDescriptor:Gt,addon:Vt,mixin:Wt,extend:jt,getSuper:qt,isChildClassOf:Xt,clear:Yt,value:It,getset:Ot,get:Pt,set:Mt,unregisterClass:ie,getClassName:Nt,setClassName:te,setClassAlias:ee,getClassByName:re,get _registeredClassNames(){return X({},Zt)},set _registeredClassNames(t){Yt(Zt),Object.assign(Zt,t)},get _registeredClassIds(){return X({},Kt)},set _registeredClassIds(t){Yt(Kt),Object.assign(Kt,t)},_getClassId:ae,_setClassId:Jt,_getClassById:ne,obsolete:Lt,obsoletes:Bt,formatStr:Ut,shiftArguments:kt,createMap:Dt};function ce(t){if("__bitmask__"in t)return t;It(t,"__bitmask__",null,!0);for(var e=-1,i=Object.keys(t),n=0;n<i.length;n++){var r=i[n],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&It(t,o,r)}return t}function he(t){return"__enums__"in t?t:(It(t,"__enums__",null,!0),he.update(t))}function ue(t){t.hasOwnProperty("__enums__")}function _e(t){ue(t);var e=t.__enums__||[];for(var i in e.length=0,t){var n=t[i];Number.isInteger(n)&&e.push({name:i,value:n})}return e.sort((function(t,e){return t.value-e.value})),t.__enums__=e,e}function fe(t){"__enums__"in t||It(t,"__enums__",null,!0)}n.js=le,t("js",Object.freeze({__proto__:null,array:se,js:le,IDGenerator:Et,Pool:oe,isNumber:xt,isString:Ct,isEmptyObject:wt,value:It,getset:Ot,get:Pt,set:Mt,createMap:Dt,getClassName:Nt,obsolete:Lt,obsoletes:Bt,formatStr:Ut,shiftArguments:kt,getPropertyDescriptor:Gt,addon:Vt,mixin:Wt,extend:jt,getSuper:qt,isChildClassOf:Xt,clear:Yt,_idToClass:Kt,_nameToClass:Zt,_setClassId:Jt,setClassName:te,setClassAlias:ee,unregisterClass:ie,_getClassById:ne,getClassByName:re,_getClassId:ae})),ce.isBitMask=function(t){return t&&t.hasOwnProperty("__bitmask__")},ce.getList=function(t){if(t.__bitmask__)return t.__bitmask__;var e=t.__bitmask__=[];for(var i in t){var n=t[i];Number.isInteger(n)&&e.push({name:i,value:n})}return e.sort((function(t,e){return t.value-e.value})),e},n.BitMask=ce,he.update=function(t){for(var e=-1,i=Object.keys(t),n=0;n<i.length;n++){var r=i[n],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&It(t,o,r)}return Array.isArray(t.__enums__)&&_e(t),t},he||(he=t("Enum",{})),he.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},he.getList=function(t){return ue(t),t.__enums__?t.__enums__:_e(t)},n.Enum=he;var de=t("ValueType",function(){function t(){}var e=t.prototype;return e.clone=function(){return b(100,Nt(this)+".clone"),this},e.equals=function(){return!1},e.set=function(){b(100,Nt(this)+".set")},e.toString=function(){return""+{}},t}());te("cc.ValueType",de),n.ValueType=de;var pe=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20});n.macro=pe;for(var me=/^(?:cc|dragonBones|sp|ccsg)\..+/,ve=new Array(123),ge=0;ge<123;++ge)ve[ge]=64;for(var ye=0;ye<64;++ye)ve["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(ye)]=ye;var Te=ve;function Se(t,e,i){function n(t,e,i,n){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[i]=r.get),r.set&&n&&(t[n]=r.set);else{var a=t[i];Ot(t,e,a,t[n])}}for(var r,a=t.prototype,o=0;o<e.length;o++){var s=(r=e[o])[0].toUpperCase()+r.slice(1);n(a,r,"get"+s,"set"+s)}for(r in i){var l=i[r];n(a,r,l[0],l[1])}}function Ee(t,e,i,n){var r=t[e];r?Array.isArray(r)?n?(r.push(r[0]),r[0]=i):r.push(i):t[e]=n?[i,r]:[r,i]:t[e]=i}function Ae(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0;i=i.parentNode}while(null!==i);return!1}function be(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function xe(t,e,i){t&&setTimeout((function(){t(e,i)}),0)}function Ce(t){return!(!t||t.constructor!==Object)&&wt(t)}function we(t,e,i){if(e>i){var n=e;e=i,i=n}return t<e?e:t<i?t:i}function Re(t){return t*pe.RAD}function Ie(t){return t*pe.DEG}function Oe(t,e){var i=e?Object.create(e):{};return It(t,"__attrs__",i),i}function Pe(t){if("function"!=typeof t)return Oe(t,De(t.constructor));for(var e,i=n.Class.getInheritanceChain(t),r=i.length-1;r>=0;r--){var a=i[r];a.hasOwnProperty("__attrs__")&&a.__attrs__||Oe(a,(e=i[r+1])&&e.__attrs__)}return Oe(t,(e=i[0])&&e.__attrs__),t.__attrs__}function Me(t,e){var i=De(t),n=e+"$_$",r={};for(var a in i)a.startsWith(n)&&(r[a.slice(n.length)]=i[a]);return r}function De(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||Pe(t)}function Ne(t,e,i,n){De(t)[e+"$_$"+i]=n}n.misc={BUILTIN_CLASSID_RE:me,BASE64_VALUES:Te,propertyDefine:Se,pushToMap:Ee,contains:Ae,isDomNode:be,callInNextTick:xe,isPlainEmptyObj_DEV:Ce,clampf:we,degreesToRadians:Re,radiansToDegrees:Ie},t("misc",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:me,BASE64_VALUES:Te,propertyDefine:Se,pushToMap:Ee,contains:Ae,isDomNode:be,callInNextTick:xe,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:Ce,clampf:we,degreesToRadians:Re,radiansToDegrees:Ie}));var Le=function(){function t(t,e){this.name=void 0,this.default=void 0,this.name=t,this.default=e}return t.prototype.toString=function(){return this.name},t}(),Be=t("CCInteger",new Le("Integer",0));n.Integer=Be,n.CCInteger=Be;var Fe=t("CCFloat",new Le("Float",0));n.Float=Fe,n.CCFloat=Fe;var ze=t("CCBoolean",new Le("Boolean",!1));n.Boolean=ze,n.CCBoolean=ze;var Ue=t("CCString",new Le("String",""));function ke(t,e){return function(i,n){var r='"'+Nt(i)+"."+n+'"',a=Me(i,n),o=a.type;if(o===Be||o===Fe?o="Number":o!==Ue&&o!==ze||(o=""+o),o===t){if(a.hasOwnProperty("default")){var s=a.default;if(void 0!==s&&!Array.isArray(s)&&!Ce(s)){var l=typeof s,c=t.toLowerCase();if(l===c)if("object"===c){if(!s||s instanceof a.ctor)return;E(3605,r,Nt(a.ctor))}else"Number"!==t&&E(3606,e,r,t);else{if("function"===l)return;t===Ue.default&&null==s?E(3607,r):E(3611,e,r,l)}delete a.type}}}else E(3604,r)}}n.String=Ue,n.CCString=Ue;var Ge=Object.freeze({__proto__:null,DELIMETER:"$_$",createAttrsSingle:Oe,createAttrs:Pe,attr:Me,getClassAttrs:De,setClassAttr:Ne,PrimitiveType:Le,CCInteger:Be,CCFloat:Fe,CCBoolean:ze,CCString:Ue,getTypeChecker_ET:ke,getObjTypeChecker_ET:function(t){return function(e,i){ke("Object","type")(e,i);var r=De(e)[i+"$_$default"],a=n.Class.getDefault(r);if(!Array.isArray(a)&&Xt(t,n.ValueType)){var o=Nt(t),s=Ut('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Nt(e),i,o);r?_(s):E(3612,s,o,Nt(e),i,o)}}}}),He={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function Ve(t,e,i,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,i.call(this,e)};var a={};for(var o in n[r]=a,He){var s=He[o];t.hasOwnProperty(o)&&(a[o]=t[o],s.canUsedInGet||delete t[o])}}}function We(t,e,i,r){if(Array.isArray(e)){if(!(e.length>0))return b(5508,i,r);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=n.String:e===Boolean?t.type=n.Boolean:e===Number&&(t.type=n.Float))}function je(t,e,i){var n=t?{_short:!0}:{_short:!0,default:e};return i&&(n.type=i),n}function qe(t,e){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return je(e,[],t);if("function"==typeof t){var i=t;return je(e,Xt(i,n.ValueType)?new i:null,i)}return je(e,t instanceof Le?t.default:t)}return null}var Xe=[];function Ye(){return Xe[Xe.length-1]}n._RF={push:function(t,e,i,n){void 0===i&&(i=e,e=""),Xe.push({uuid:e,script:i,module:t,exports:t.exports,beh:null,importMeta:n})},pop:function(){var t=Xe.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var n in i)return;e.exports=i=t.cls}},peek:Ye};var Ke={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props;"function"==typeof r&&(r=r());var a=Nt(n);r?ti(n,a,r,n.$super,i.mixins):b(3633,a)}this.datas=null}}};function Ze(t,e,i,n){!function(t,e){!function(t,e){t.indexOf(e)<0&&t.push(e)}(t.__props__,e)}(t,i),ni(t,n,e,i)}function Qe(t,e,i,n){var r=n.get;n.set,r&&(ni(t,n,e,i),Ne(t,i,"serializable",!1))}function Je(t){return"function"==typeof t?t():t}function $e(t,e,i){for(var n in e)t.hasOwnProperty(n)||i&&!i(n)||Object.defineProperty(t,n,Gt(e,n))}function ti(t,e,i,n,r){if(t.__props__=[],n&&n.__props__&&(t.__props__=n.__props__.slice()),r)for(var a=0;a<r.length;++a){var o=r[a];o.__props__&&(t.__props__=t.__props__.concat(o.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(i)for(var s in function(t,e){for(var i in t){var n=t[i],r=qe(n,!1);if(r&&(n=t[i]=r),n){var a=n.notify;a&&Ve(n,i,a,t),"type"in n&&We(n,n.type,e,i)}}}(i,e),i){var l=i[s];l.get||l.set?Qe(t,e,s,l):Ze(t,e,s,l)}var c=De(t);t.__values__=t.__props__.filter((function(t){return!1!==c[t+"$_$serializable"]}))}function ei(t){var e=t.name,i=t.extends,r=t.mixins,a=function(t,e,i,r){var a=n.Component,o=Ye();if(o&&Xt(e,a)){if(Xt(o.cls,a))return b(3615),null;t=t||o.script}var s=function(t,e,i,n){var r=n.ctor,a=[r],o=r;It(o,"__ctors__",a.length>0?a:null,!0);var s=o.prototype;if(e&&(o.$super=e),i){for(var l=i.length-1;l>=0;l--){var c=i[l];$e(s,c.prototype),ei._isCCClass(c)&&$e(De(o),De(c))}s.constructor=o}return te(t,o),o}(t,e,i,r);if(o)if(Xt(e,a)){var l=o.uuid;l&&Jt(l,s),o.cls=s}else Xt(o.cls,a)||(o.cls=s);return s}(e,i,r,t);e||(e=n.js.getClassName(a)),a._sealed=!0,i&&(i._sealed=!1);var o=t.properties;"function"==typeof o||i&&null===i.__props__||r&&r.some((function(t){return null===t.__props__}))?(Ke.push({cls:a,props:o,mixins:r}),a.__props__=a.__values__=null):ti(a,e,o,i,t.mixins);var s=t.editor;return s&&Xt(i,n.Component)&&n.Component._registerEditorProps(a,s),a}ei._isCCClass=function(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__ctors__")},ei.fastDefine=function(t,e,i){te(t,e);for(var n=e.__props__=e.__values__=Object.keys(i),r=De(e),a=0;a<n.length;a++){var o=n[a];r[o+"$_$visible"]=!1,r[o+"$_$default"]=i[o]}},ei.Attr=Ge,ei.attr=Me,ei.getInheritanceChain=function(t){for(var e=[];t=qt(t);)t!==Object&&e.push(t);return e};var ii={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function ni(t,e,i,n){var r=null,a="";function o(){return a=n+"$_$",r=De(t)}"type"in e&&void 0===e.type&&E(3660,n,i);var s=e.type;s&&(ii[s]?(r||o())[a+"type"]=s:"Object"===s||("object"==typeof s?he.isEnum(s)?((r||o())[a+"type"]="Enum",r[a+"enumList"]=he.getList(s)):ce.isBitMask(s)&&((r||o())[a+"type"]="BitMask",r[a+"bitmaskList"]=ce.getList(s)):"function"==typeof s&&((r||o())[a+"type"]="Object",r[a+"ctor"]=s))),"default"in e&&((r||o())[a+"default"]=e.default);var l,c=function(t,i){if(t in e){var n=e[t];typeof n===i&&((r||o())[a+t]=n)}};e.editorOnly&&((r||o())[a+"editorOnly"]=!0),e.__noImplicit?(r||o())[a+"serializable"]=null!==(l=e.serializable)&&void 0!==l&&l:!1===e.serializable&&((r||o())[a+"serializable"]=!1),c("formerlySerializedAs","string");var h=e.range;h&&Array.isArray(h)&&h.length>=2&&((r||o())[a+"min"]=h[0],r[a+"max"]=h[1],h.length>2&&(r[a+"step"]=h[2])),c("min","number"),c("max","number"),c("step","number")}ei.isArray=function(t){return t=Je(t),Array.isArray(t)},ei.getDefault=Je,ei.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},ei.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,ei.getNewValueTypeCode=function(t){for(var e=Nt(t),i=t.constructor,n="new "+e+"(",r=0;r<i.__props__.length;r++)n+=t[i.__props__[r]],r<i.__props__.length-1&&(n+=",");return n+")"},n.Class=ei;var ri=Math.PI/180,ai=180/Math.PI,oi=t("EPSILON",1e-6);function si(t,e){return Math.abs(t-e)<=oi*Math.max(1,Math.abs(t),Math.abs(e))}function li(t,e,i){return i=i||oi,Math.abs(t-e)<=i}function ci(t,e,i){if(e>i){var n=e;e=i,i=n}return t<e?e:t>i?i:t}function hi(t){return t<0?0:t>1?1:t}function ui(t,e,i){return t+(e-t)*i}function _i(t){return t*ri}function fi(t){return t*ai}var di=t("random",Math.random);function pi(t,e){return Math.random()*(e-t)+t}function mi(t,e){return Math.floor(pi(t,e))}function vi(t){return(t=(9301*t+49297)%233280)/233280}function gi(t,e,i){return vi(t)*(i-e)+e}function yi(t,e,i){return Math.floor(gi(t,e,i))}function Ti(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Si(t,e){return t-Math.floor(t/e)*e}function Ei(t,e){return t=Si(t,2*e),e-Math.abs(t-e)}function Ai(t,e,i){return(i-t)/(e-t)}function bi(t){return Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z}function xi(t,e){return Math.abs(t)>Math.abs(e)?t:e}var Ci=t("Color",function(t){function e(e,i,n,r){var a;return(a=t.call(this)||this)._val=0,"string"==typeof e?a.fromHEX(e):void 0!==i?a.set(e,i,n,r):a.set(e),a}Y(e,t),e.clone=function(t){var i=new e;return t._val?i._val=t._val:i._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,i},e.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},e.set=function(t,e,i,n,r){return t.r=e,t.g=i,t.b=n,t.a=r,t},e.fromHEX=function(t,e){return e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0,t.a=parseInt(e.substr(6,2),16)||255,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t},e.add=function(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t},e.subtract=function(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t},e.multiply=function(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t},e.divide=function(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t},e.scale=function(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t},e.lerp=function(t,e,i,n){var r=e.r,a=e.g,o=e.b,s=e.a;return r+=(i.r-r)*n,a+=(i.g-a)*n,o+=(i.b-o)*n,s+=(i.a-s)*n,t._val=Math.floor((s<<24>>>0)+(o<<16)+(a<<8)+r),t},e.toArray=function(t,i,n){void 0===n&&(n=0);var r=i instanceof e||i.a>1?1/255:1;return t[n+0]=i.r*r,t[n+1]=i.g*r,t[n+2]=i.b*r,t[n+3]=i.a*r,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),e.r=255*t[i+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e},e.strictEquals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a},e.equals=function(t,e,i){return void 0===i&&(i=oi),Math.abs(t.r-e.r)<=i*Math.max(1,Math.abs(t.r),Math.abs(e.r))&&Math.abs(t.g-e.g)<=i*Math.max(1,Math.abs(t.g),Math.abs(e.g))&&Math.abs(t.b-e.b)<=i*Math.max(1,Math.abs(t.b),Math.abs(e.b))&&Math.abs(t.a-e.a)<=i*Math.max(1,Math.abs(t.a),Math.abs(e.a))},e.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0},q(e,[{key:"r",get:function(){return 255&this._val},set:function(t){t=~~ci(t,0,255),this._val=(4294967040&this._val|t)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(t){t=~~ci(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(t){t=~~ci(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(t){t=~~ci(t,0,255),this._val=(16777215&this._val|t<<24)>>>0}},{key:"x",get:function(){return this.r*(1/255)},set:function(t){this.r=255*t}},{key:"y",get:function(){return this.g*(1/255)},set:function(t){this.g=255*t}},{key:"z",get:function(){return this.b*(1/255)},set:function(t){this.b=255*t}},{key:"w",get:function(){return this.a*(1/255)},set:function(t){this.a=255*t}}]);var i=e.prototype;return i.clone=function(){var t=new e;return t._val=this._val,t},i.equals=function(t){return t&&this._val===t._val},i.lerp=function(t,e){var i=this.r,n=this.g,r=this.b,a=this.a;return i+=(t.r-i)*e,n+=(t.g-n)*e,r+=(t.b-r)*e,a+=(t.a-a)*e,this._val=Math.floor((a<<24>>>0)+(r<<16)+(n<<8)+i),this},i.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},i.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*(1/255)).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},i.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,i=parseInt(t.substr(2,2),16)||0,n=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||255;return this._val=(r<<24>>>0)+(n<<16)+(i<<8)+(0|e),this},i.toHEX=function(t){void 0===t&&(t="#rrggbb");var e=[(this.r<16?"0":"")+this.r.toString(16),(this.g<16?"0":"")+this.g.toString(16),(this.b<16?"0":"")+this.b.toString(16)];return"#rgb"===t?(e[0]=e[0][0],e[1]=e[1][0],e[2]=e[2][0]):"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+this.a.toString(16)),e.join("")},i.toRGBValue=function(){return 16777215&this._val},i.fromHSV=function(t,e,i){var n=0,r=0,a=0;if(0===e)n=r=a=i;else if(0===i)n=r=a=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t),s=t-o,l=i*(1-e),c=i*(1-e*s),h=i*(1-e*(1-s));switch(o){case 0:n=i,r=h,a=l;break;case 1:n=c,r=i,a=l;break;case 2:n=l,r=i,a=h;break;case 3:n=l,r=c,a=i;break;case 4:n=h,r=l,a=i;break;case 5:n=i,r=l,a=c}}return n*=255,r*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(r<<8)+(0|n),this},i.toHSV=function(){var t=this.r*(1/255),e=this.g*(1/255),i=this.b*(1/255),n={h:0,s:0,v:0},r=Math.max(t,e,i),a=Math.min(t,e,i),o=0;return n.v=r,n.s=r?(r-a)/r:0,n.s?(o=r-a,n.h=t===r?(e-i)/o:e===r?2+(i-t)/o:4+(t-e)/o,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},i.set=function(t,e,i,n){return"object"==typeof t?null!=t._val?this._val=t._val:(e=t.g||0,i=t.b||0,n="number"==typeof t.a?t.a:255,t=t.r||0,this._val=(n<<24>>>0)+(i<<16)+(e<<8)+(0|t)):(t=t||0,e=e||0,i=i||0,n="number"==typeof n?n:255,this._val=(n<<24>>>0)+(i<<16)+(e<<8)+(0|t)),this},i.multiply=function(t){var e=(255&this._val)*t.r>>8,i=(65280&this._val)*t.g>>8,n=(16711680&this._val)*t.b>>8,r=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&r|16711680&n|65280&i|255&e,this},i._set_r_unsafe=function(t){return this._val=(4294967040&this._val|t)>>>0,this},i._set_g_unsafe=function(t){return this._val=(4294902015&this._val|t<<8)>>>0,this},i._set_b_unsafe=function(t){return this._val=(4278255615&this._val|t<<16)>>>0,this},i._set_a_unsafe=function(t){return this._val=(16777215&this._val|t<<24)>>>0,this},e}(de));function wi(t,e,i,n){return new Ci(t,e,i,n)}Ci.WHITE=Object.freeze(new Ci(255,255,255,255)),Ci.GRAY=Object.freeze(new Ci(127,127,127,255)),Ci.BLACK=Object.freeze(new Ci(0,0,0,255)),Ci.TRANSPARENT=Object.freeze(new Ci(0,0,0,0)),Ci.RED=Object.freeze(new Ci(255,0,0,255)),Ci.GREEN=Object.freeze(new Ci(0,255,0,255)),Ci.BLUE=Object.freeze(new Ci(0,0,255,255)),Ci.CYAN=Object.freeze(new Ci(0,255,255,255)),Ci.MAGENTA=Object.freeze(new Ci(255,0,255,255)),Ci.YELLOW=Object.freeze(new Ci(255,255,0,255)),ei.fastDefine("cc.Color",Ci,{r:0,g:0,b:0,a:255}),n.Color=Ci,n.color=wi;var Ri=t("Vec3",function(t){function e(e,i,n){var r;return r=t.call(this)||this,e&&"object"==typeof e?(r.x=e.x,r.y=e.y,r.z=e.z):(r.x=e||0,r.y=i||0,r.z=n||0),r}Y(e,t),e.zero=function(t){return t.x=0,t.y=0,t.z=0,t},e.clone=function(t){return new e(t.x,t.y,t.z)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.set=function(t,e,i,n){return t.x=e,t.y=i,t.z=n,t},e.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t},e.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t},e.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t},e.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},e.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t},e.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t},e.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t},e.distance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return Math.sqrt(i*i+n*n+r*r)},e.squaredDistance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return i*i+n*n+r*r},e.len=function(t){var e=t.x,i=t.y,n=t.z;return Math.sqrt(e*e+i*i+n*n)},e.lengthSqr=function(t){var e=t.x,i=t.y,n=t.z;return e*e+i*i+n*n},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.invert=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},e.invertSafe=function(t,e){var i=e.x,n=e.y,r=e.z;return Math.abs(i)<oi?t.x=0:t.x=1/i,Math.abs(n)<oi?t.y=0:t.y=1/n,Math.abs(r)<oi?t.z=0:t.z=1/r,t},e.normalize=function(t,e){var i=e.x,n=e.y,r=e.z,a=i*i+n*n+r*r;return a>0&&(a=1/Math.sqrt(a),t.x=i*a,t.y=n*a,t.z=r*a),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.cross=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=i.x,s=i.y,l=i.z;return t.x=r*l-a*s,t.y=a*o-n*l,t.z=n*s-r*o,t},e.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t},e.random=function(t,e){e=e||1;var i=2*di()*Math.PI,n=2*di()-1,r=Math.sqrt(1-n*n);return t.x=r*Math.cos(i)*e,t.y=r*Math.sin(i)*e,t.z=n*e,t},e.transformMat4=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=i.m03*n+i.m07*r+i.m11*a+i.m15;return o=o?Math.abs(1/o):1,t.x=(i.m00*n+i.m04*r+i.m08*a+i.m12)*o,t.y=(i.m01*n+i.m05*r+i.m09*a+i.m13)*o,t.z=(i.m02*n+i.m06*r+i.m10*a+i.m14)*o,t},e.transformMat4Normal=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=i.m03*n+i.m07*r+i.m11*a;return o=o?Math.abs(1/o):1,t.x=(i.m00*n+i.m04*r+i.m08*a)*o,t.y=(i.m01*n+i.m05*r+i.m09*a)*o,t.z=(i.m02*n+i.m06*r+i.m10*a)*o,t},e.transformMat3=function(t,e,i){var n=e.x,r=e.y,a=e.z;return t.x=n*i.m00+r*i.m03+a*i.m06,t.y=n*i.m01+r*i.m04+a*i.m07,t.z=n*i.m02+r*i.m05+a*i.m08,t},e.transformAffine=function(t,e,i){var n=e.x,r=e.y,a=e.z;return t.x=i.m00*n+i.m04*r+i.m08*a+i.m12,t.y=i.m01*n+i.m05*r+i.m09*a+i.m13,t.x=i.m02*n+i.m06*r+i.m10*a+i.m14,t},e.transformQuat=function(t,e,i){var n=i.w*e.x+i.y*e.z-i.z*e.y,r=i.w*e.y+i.z*e.x-i.x*e.z,a=i.w*e.z+i.x*e.y-i.y*e.x,o=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=n*i.w+o*-i.x+r*-i.z-a*-i.y,t.y=r*i.w+o*-i.y+a*-i.x-n*-i.z,t.z=a*i.w+o*-i.z+n*-i.y-r*-i.x,t},e.transformRTS=function(t,e,i,n,r){var a=e.x*r.x,o=e.y*r.y,s=e.z*r.z,l=i.w*a+i.y*s-i.z*o,c=i.w*o+i.z*a-i.x*s,h=i.w*s+i.x*o-i.y*a,u=-i.x*a-i.y*o-i.z*s;return t.x=l*i.w+u*-i.x+c*-i.z-h*-i.y+n.x,t.y=c*i.w+u*-i.y+h*-i.x-l*-i.z+n.y,t.z=h*i.w+u*-i.z+l*-i.y-c*-i.x+n.z,t},e.transformInverseRTS=function(t,e,i,n,r){var a=e.x-n.x,o=e.y-n.y,s=e.z-n.z,l=i.w*a-i.y*s+i.z*o,c=i.w*o-i.z*a+i.x*s,h=i.w*s-i.x*o+i.y*a,u=i.x*a+i.y*o+i.z*s;return t.x=(l*i.w+u*i.x+c*i.z-h*i.y)/r.x,t.y=(c*i.w+u*i.y+h*i.x-l*i.z)/r.y,t.z=(h*i.w+u*i.z+l*i.y-c*i.x)/r.z,t},e.rotateX=function(t,e,i,n){var r=e.x-i.x,a=e.y-i.y,o=e.z-i.z,s=Math.cos(n),l=Math.sin(n),c=r,h=a*s-o*l,u=a*l+o*s;return t.x=c+i.x,t.y=h+i.y,t.z=u+i.z,t},e.rotateY=function(t,e,i,n){var r=e.x-i.x,a=e.y-i.y,o=e.z-i.z,s=Math.cos(n),l=Math.sin(n),c=o*l+r*s,h=a,u=o*s-r*l;return t.x=c+i.x,t.y=h+i.y,t.z=u+i.z,t},e.rotateZ=function(t,e,i,n){var r=e.x-i.x,a=e.y-i.y,o=e.z-i.z,s=Math.cos(n),l=Math.sin(n),c=r*s-a*l,h=r*l+a*s,u=o;return t.x=c+i.x,t.y=h+i.y,t.z=u+i.z,t},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},e.equals=function(t,e,i){void 0===i&&(i=oi);var n=t.x,r=t.y,a=t.z,o=e.x,s=e.y,l=e.z;return Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=i*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-l)<=i*Math.max(1,Math.abs(a),Math.abs(l))},e.angle=function(t,i){e.normalize(Ii,t),e.normalize(Oi,i);var n=e.dot(Ii,Oi);return n>1?0:n<-1?Math.PI:Math.acos(n)},e.projectOnPlane=function(t,i,n){return e.subtract(t,i,e.project(t,i,n))},e.project=function(t,i,n){var r=e.lengthSqr(n);return r<1e-6?e.set(t,0,0,0):e.multiplyScalar(t,n,e.dot(i,n)/r)};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.z)},i.set=function(t,e,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0),this},i.equals=function(t,e){return void 0===e&&(e=oi),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))},i.equals3f=function(t,e,i,n){return void 0===n&&(n=oi),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=n*Math.max(1,Math.abs(this.z),Math.abs(i))},i.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},i.strictEquals3f=function(t,e,i){return this.x===t&&this.y===e&&this.z===i},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},i.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this},i.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.add3f=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},i.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.subtract3f=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this},i.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this},i.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.multiply3f=function(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},i.divide3f=function(t,e,i){return this.x/=t,this.y/=e,this.z/=i,this},i.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.clampf=function(t,e){return this.x=ci(this.x,t.x,e.x),this.y=ci(this.y,t.y,e.y),this.z=ci(this.z,t.z,e.z),this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.cross=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,o=t.z;return this.x=i*o-n*a,this.y=n*r-e*o,this.z=e*a-i*r,this},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.normalize=function(){var t=this.x,e=this.y,i=this.z,n=t*t+e*e+i*i;return n>0&&(n=1/Math.sqrt(n),this.x=t*n,this.y=e*n,this.z=i*n),this},i.transformMat4=function(t){var e=this.x,i=this.y,n=this.z,r=t.m03*e+t.m07*i+t.m11*n+t.m15;return r=r?1/r:1,this.x=(t.m00*e+t.m04*i+t.m08*n+t.m12)*r,this.y=(t.m01*e+t.m05*i+t.m09*n+t.m13)*r,this.z=(t.m02*e+t.m06*i+t.m10*n+t.m14)*r,this},e}(de));Ri.UNIT_X=Object.freeze(new Ri(1,0,0)),Ri.UNIT_Y=Object.freeze(new Ri(0,1,0)),Ri.UNIT_Z=Object.freeze(new Ri(0,0,1)),Ri.RIGHT=Object.freeze(new Ri(1,0,0)),Ri.UP=Object.freeze(new Ri(0,1,0)),Ri.FORWARD=Object.freeze(new Ri(0,0,-1)),Ri.ZERO=Object.freeze(new Ri(0,0,0)),Ri.ONE=Object.freeze(new Ri(1,1,1)),Ri.NEG_ONE=Object.freeze(new Ri(-1,-1,-1));var Ii=new Ri,Oi=new Ri;function Pi(t,e,i){return new Ri(t,e,i)}ei.fastDefine("cc.Vec3",Ri,{x:0,y:0,z:0}),n.Vec3=Ri,n.v3=Pi;var Mi=t("Mat3",function(t){function e(e,i,n,r,a,o,s,l,c){var h;return void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=1),h=t.call(this)||this,"object"==typeof e?(h.m00=e.m00,h.m01=e.m01,h.m02=e.m02,h.m03=e.m03,h.m04=e.m04,h.m05=e.m05,h.m06=e.m06,h.m07=e.m07,h.m08=e.m08):(h.m00=e,h.m01=i,h.m02=n,h.m03=r,h.m04=a,h.m05=o,h.m06=s,h.m07=l,h.m08=c),h}Y(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.set=function(t,e,i,n,r,a,o,s,l,c){return t.m00=e,t.m01=i,t.m02=n,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=l,t.m08=c,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.transpose=function(t,e){if(t===e){var i=e.m01,n=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=i,t.m05=e.m07,t.m06=n,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t},e.invert=function(t,e){var i=e.m00,n=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,l=e.m06,c=e.m07,h=e.m08,u=h*o-s*c,_=-h*a+s*l,f=c*a-o*l,d=i*u+n*_+r*f;return 0===d?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t):(d=1/d,t.m00=u*d,t.m01=(-h*n+r*c)*d,t.m02=(s*n-r*o)*d,t.m03=_*d,t.m04=(h*i-r*l)*d,t.m05=(-s*i+r*a)*d,t.m06=f*d,t.m07=(-c*i+n*l)*d,t.m08=(o*i-n*a)*d,t)},e.determinant=function(t){var e=t.m00,i=t.m01,n=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,l=t.m07,c=t.m08;return e*(c*a-o*l)+i*(-c*r+o*s)+n*(l*r-a*s)},e.multiply=function(t,e,i){var n=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,l=e.m05,c=e.m06,h=e.m07,u=e.m08,_=i.m00,f=i.m01,d=i.m02,p=i.m03,m=i.m04,v=i.m05,g=i.m06,y=i.m07,T=i.m08;return t.m00=_*n+f*o+d*c,t.m01=_*r+f*s+d*h,t.m02=_*a+f*l+d*u,t.m03=p*n+m*o+v*c,t.m04=p*r+m*s+v*h,t.m05=p*a+m*l+v*u,t.m06=g*n+y*o+T*c,t.m07=g*r+y*s+T*h,t.m08=g*a+y*l+T*u,t},e.multiplyMat4=function(t,e,i){var n=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,l=e.m05,c=e.m06,h=e.m07,u=e.m08,_=i.m00,f=i.m01,d=i.m02,p=i.m04,m=i.m05,v=i.m06,g=i.m08,y=i.m09,T=i.m10;return t.m00=_*n+f*o+d*c,t.m01=_*r+f*s+d*h,t.m02=_*a+f*l+d*u,t.m03=p*n+m*o+v*c,t.m04=p*r+m*s+v*h,t.m05=p*a+m*l+v*u,t.m06=g*n+y*o+T*c,t.m07=g*r+y*s+T*h,t.m08=g*a+y*l+T*u,t},e.transform=function(t,e,i){var n=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,l=e.m05,c=e.m06,h=e.m07,u=e.m08,_=i.x,f=i.y;return t.m00=n,t.m01=r,t.m02=a,t.m03=o,t.m04=s,t.m05=l,t.m06=_*n+f*o+c,t.m07=_*r+f*s+h,t.m08=_*a+f*l+u,t},e.scale=function(t,e,i){var n=i.x,r=i.y;return t.m00=n*e.m00,t.m01=n*e.m01,t.m02=n*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.rotate=function(t,e,i){var n=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,l=e.m05,c=e.m06,h=e.m07,u=e.m08,_=Math.sin(i),f=Math.cos(i);return t.m00=f*n+_*o,t.m01=f*r+_*s,t.m02=f*a+_*l,t.m03=f*o-_*n,t.m04=f*s-_*r,t.m05=f*l-_*a,t.m06=c,t.m07=h,t.m08=u,t},e.fromMat4=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t},e.fromViewUp=function(t,i,n){return Ri.lengthSqr(i)<oi*oi?(e.identity(t),t):(n=n||Ri.UNIT_Y,Ri.normalize(Di,Ri.cross(Di,n,i)),Ri.lengthSqr(Di)<oi*oi?(e.identity(t),t):(Ri.cross(Ni,i,Di),e.set(t,Di.x,Di.y,Di.z,Ni.x,Ni.y,Ni.z,i.x,i.y,i.z),t))},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t.m00=n,t.m01=i,t.m02=0,t.m03=-i,t.m04=n,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromQuat=function(t,e){var i=e.x,n=e.y,r=e.z,a=e.w,o=i+i,s=n+n,l=r+r,c=i*o,h=n*o,u=n*s,_=r*o,f=r*s,d=r*l,p=a*o,m=a*s,v=a*l;return t.m00=1-u-d,t.m03=h-v,t.m06=_+m,t.m01=h+v,t.m04=1-c-d,t.m07=f-p,t.m02=_-m,t.m05=f+p,t.m08=1-c-u,t},e.inverseTransposeMat4=function(t,e){var i=e.m00,n=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,l=e.m06,c=e.m07,h=e.m08,u=e.m09,_=e.m10,f=e.m11,d=e.m12,p=e.m13,m=e.m14,v=e.m15,g=i*s-n*o,y=i*l-r*o,T=i*c-a*o,S=n*l-r*s,E=n*c-a*s,A=r*c-a*l,b=h*p-u*d,x=h*m-_*d,C=h*v-f*d,w=u*m-_*p,R=u*v-f*p,I=_*v-f*m,O=g*I-y*R+T*w+S*C-E*x+A*b;return O?(O=1/O,t.m00=(s*I-l*R+c*w)*O,t.m01=(l*C-o*I-c*x)*O,t.m02=(o*R-s*C+c*b)*O,t.m03=(r*R-n*I-a*w)*O,t.m04=(i*I-r*C+a*x)*O,t.m05=(n*C-i*R-a*b)*O,t.m06=(p*A-m*E+v*S)*O,t.m07=(m*T-d*A-v*y)*O,t.m08=(d*E-p*T+v*g)*O,t):null},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.m00,t[i+1]=e.m01,t[i+2]=e.m02,t[i+3]=e.m03,t[i+4]=e.m04,t[i+5]=e.m05,t[i+6]=e.m06,t[i+7]=e.m07,t[i+8]=e.m08,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.m00=e[i+0],t.m01=e[i+1],t.m02=e[i+2],t.m03=e[i+3],t.m04=e[i+4],t.m05=e[i+5],t.m06=e[i+6],t.m07=e[i+7],t.m08=e[i+8],t},e.add=function(t,e,i){return t.m00=e.m00+i.m00,t.m01=e.m01+i.m01,t.m02=e.m02+i.m02,t.m03=e.m03+i.m03,t.m04=e.m04+i.m04,t.m05=e.m05+i.m05,t.m06=e.m06+i.m06,t.m07=e.m07+i.m07,t.m08=e.m08+i.m08,t},e.subtract=function(t,e,i){return t.m00=e.m00-i.m00,t.m01=e.m01-i.m01,t.m02=e.m02-i.m02,t.m03=e.m03-i.m03,t.m04=e.m04-i.m04,t.m05=e.m05-i.m05,t.m06=e.m06-i.m06,t.m07=e.m07-i.m07,t.m08=e.m08-i.m08,t},e.multiplyScalar=function(t,e,i){return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*i,t.m05=e.m05*i,t.m06=e.m06*i,t.m07=e.m07*i,t.m08=e.m08*i,t},e.multiplyScalarAndAdd=function(t,e,i,n){return t.m00=i.m00*n+e.m00,t.m01=i.m01*n+e.m01,t.m02=i.m02*n+e.m02,t.m03=i.m03*n+e.m03,t.m04=i.m04*n+e.m04,t.m05=i.m05*n+e.m05,t.m06=i.m06*n+e.m06,t.m07=i.m07*n+e.m07,t.m08=i.m08*n+e.m08,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08},e.equals=function(t,e,i){return void 0===i&&(i=oi),Math.abs(t.m00-e.m00)<=i*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=i*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=i*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=i*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=i*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=i*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=i*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=i*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=i*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))};var i=e.prototype;return i.clone=function(){var t=this;return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},i.set=function(t,e,i,n,r,a,o,s,l){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=1),"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=i,this.m03=n,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=l),this},i.equals=function(t,e){return void 0===e&&(e=oi),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))},i.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08},i.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+",\n"+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+",\n"+t.m08+"\n]"},i.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},i.transpose=function(){var t=this.m01,e=this.m02,i=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=t,this.m05=this.m07,this.m06=e,this.m07=i,this},i.invert=function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,l=this.m08,c=l*r-a*s,h=-l*n+a*o,u=s*n-r*o,_=t*c+e*h+i*u;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=c*_,this.m01=(-l*e+i*s)*_,this.m02=(a*e-i*r)*_,this.m03=h*_,this.m04=(l*t-i*o)*_,this.m05=(-a*t+i*n)*_,this.m06=u*_,this.m07=(-s*t+e*o)*_,this.m08=(r*t-e*n)*_,this)},i.determinant=function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,l=this.m08;return t*(l*r-a*s)+e*(-l*n+a*o)+i*(s*n-r*o)},i.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this},i.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this},i.multiply=function(t){var e=this.m00,i=this.m01,n=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,l=this.m07,c=this.m08,h=t.m00,u=t.m01,_=t.m02,f=t.m03,d=t.m04,p=t.m05,m=t.m06,v=t.m07,g=t.m08;return this.m00=h*e+u*r+_*s,this.m01=h*i+u*a+_*l,this.m02=h*n+u*o+_*c,this.m03=f*e+d*r+p*s,this.m04=f*i+d*a+p*l,this.m05=f*n+d*o+p*c,this.m06=m*e+v*r+g*s,this.m07=m*i+v*a+g*l,this.m08=m*n+v*o+g*c,this},i.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this},i.scale=function(t){var e=t.x,i=t.y;return this.m00=e*this.m00,this.m01=e*this.m01,this.m02=e*this.m02,this.m03=i*this.m03,this.m04=i*this.m04,this.m05=i*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},i.rotate=function(t){var e=this.m00,i=this.m01,n=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,l=this.m07,c=this.m08,h=Math.sin(t),u=Math.cos(t);return this.m00=u*e+h*r,this.m01=u*i+h*a,this.m02=u*n+h*o,this.m03=u*r-h*e,this.m04=u*a-h*i,this.m05=u*o-h*n,this.m06=s,this.m07=l,this.m08=c,this},i.fromQuat=function(t){var e=t.x,i=t.y,n=t.z,r=t.w,a=e+e,o=i+i,s=n+n,l=e*a,c=i*a,h=i*o,u=n*a,_=n*o,f=n*s,d=r*a,p=r*o,m=r*s;return this.m00=1-h-f,this.m03=c-m,this.m06=u+p,this.m01=c+m,this.m04=1-l-f,this.m07=_-d,this.m02=u-p,this.m05=_+d,this.m08=1-l-h,this},e}(de));Mi.IDENTITY=Object.freeze(new Mi);var Di=new Ri,Ni=new Ri;ei.fastDefine("cc.Mat3",Mi,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),n.Mat3=Mi;var Li=t("Quat",function(t){function e(e,i,n,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=i||0,a.z=n||0,a.w=null!=r?r:1),a}Y(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,i,n,r){return t.x=e,t.y=i,t.z=n,t.w=r,t},e.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},e.rotationTo=function(t,i,n){var r=Ri.dot(i,n);return r<-.999999?(Ri.cross(zi,Ri.UNIT_X,i),zi.length()<1e-6&&Ri.cross(zi,Ri.UNIT_Y,i),Ri.normalize(zi,zi),e.fromAxisAngle(t,zi,Math.PI),t):r>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Ri.cross(zi,i,n),t.x=zi.x,t.y=zi.y,t.z=zi.z,t.w=1+r,e.normalize(t,t))},e.getAxisAngle=function(t,e){var i=2*Math.acos(e.w),n=Math.sin(i/2);return 0!==n?(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n):(t.x=1,t.y=0,t.z=0),i},e.multiply=function(t,e,i){var n=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,r=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,a=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,o=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z;return t.x=n,t.y=r,t.z=a,t.w=o,t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},e.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t.w=e.w+i.w*n,t},e.rotateX=function(t,e,i){i*=.5;var n=Math.sin(i),r=Math.cos(i),a=e.x,o=e.y,s=e.z,l=e.w;return t.x=a*r+l*n,t.y=o*r+s*n,t.z=s*r-o*n,t.w=l*r-a*n,t},e.rotateY=function(t,e,i){i*=.5;var n=Math.sin(i),r=Math.cos(i),a=e.x,o=e.y,s=e.z,l=e.w;return t.x=a*r-s*n,t.y=o*r+l*n,t.z=s*r+a*n,t.w=l*r-o*n,t},e.rotateZ=function(t,e,i){i*=.5;var n=Math.sin(i),r=Math.cos(i),a=e.x,o=e.y,s=e.z,l=e.w;return t.x=a*r+o*n,t.y=o*r-a*n,t.z=s*r+l*n,t.w=l*r-s*n,t},e.rotateAround=function(t,i,n,r){return e.invert(Bi,i),Ri.transformQuat(zi,n,Bi),e.fromAxisAngle(Bi,zi,r),e.multiply(t,i,Bi),t},e.rotateAroundLocal=function(t,i,n,r){return e.fromAxisAngle(Bi,n,r),e.multiply(t,i,Bi),t},e.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t.w=e.w+n*(i.w-e.w),t},e.slerp=function(t,e,i,n){var r=0,a=0,o=i.x,s=i.y,l=i.z,c=i.w,h=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;if(h<0&&(h=-h,o=-o,s=-s,l=-l,c=-c),1-h>1e-6){var u=Math.acos(h),_=Math.sin(u);r=Math.sin((1-n)*u)/_,a=Math.sin(n*u)/_}else r=1-n,a=n;return t.x=r*e.x+a*o,t.y=r*e.y+a*s,t.z=r*e.z+a*l,t.w=r*e.w+a*c,t},e.sqlerp=function(t,i,n,r,a,o){return e.slerp(Bi,i,a,o),e.slerp(Fi,n,r,o),e.slerp(t,Bi,Fi,2*o*(1-o)),t},e.invert=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,n=i?1/i:0;return t.x=-e.x*n,t.y=-e.y*n,t.z=-e.z*n,t.w=e.w*n,t},e.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},e.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},e.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},e.normalize=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return i>0&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i),t},e.fromAxes=function(t,i,n,r){return Mi.set(Ui,i.x,i.y,i.z,n.x,n.y,n.z,r.x,r.y,r.z),e.normalize(t,e.fromMat3(t,Ui))},e.fromViewUp=function(t,i,n){return Mi.fromViewUp(Ui,i,n),e.normalize(t,e.fromMat3(t,Ui))},e.fromAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t.x=n*e.x,t.y=n*e.y,t.z=n*e.z,t.w=Math.cos(i),t},e.fromMat3=function(t,e){var i=e.m00,n=e.m03,r=e.m06,a=e.m01,o=e.m04,s=e.m07,l=e.m02,c=e.m05,h=e.m08,u=i+o+h;if(u>0){var _=.5/Math.sqrt(u+1);t.w=.25/_,t.x=(c-s)*_,t.y=(r-l)*_,t.z=(a-n)*_}else if(i>o&&i>h){var f=2*Math.sqrt(1+i-o-h);t.w=(c-s)/f,t.x=.25*f,t.y=(n+a)/f,t.z=(r+l)/f}else if(o>h){var d=2*Math.sqrt(1+o-i-h);t.w=(r-l)/d,t.x=(n+a)/d,t.y=.25*d,t.z=(s+c)/d}else{var p=2*Math.sqrt(1+h-i-o);t.w=(a-n)/p,t.x=(r+l)/p,t.y=(s+c)/p,t.z=.25*p}return t},e.fromEuler=function(t,e,i,n){e*=ki,i*=ki,n*=ki;var r=Math.sin(e),a=Math.cos(e),o=Math.sin(i),s=Math.cos(i),l=Math.sin(n),c=Math.cos(n);return t.x=r*s*c+a*o*l,t.y=a*o*c+r*s*l,t.z=a*s*l-r*o*c,t.w=a*s*c-r*o*l,t},e.fromAngleZ=function(t,e){return e*=ki,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},e.toAxisX=function(t,e){var i=2*e.y,n=2*e.z;return t.x=1-i*e.y-n*e.z,t.y=i*e.x+n*e.w,t.z=n*e.x+i*e.w,t},e.toAxisY=function(t,e){var i=2*e.x,n=2*e.y,r=2*e.z;return t.x=n*e.x-r*e.w,t.y=1-i*e.x-r*e.z,t.z=r*e.y+i*e.w,t},e.toAxisZ=function(t,e){var i=2*e.x,n=2*e.y,r=2*e.z;return t.x=r*e.x-n*e.w,t.y=r*e.y-i*e.w,t.z=1-i*e.x-n*e.y,t},e.toEuler=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=e.w,s=0,l=0,c=0,h=n*r+a*o;if(h>.499999)s=0,l=fi(2*Math.atan2(n,o)),c=90;else if(h<-.499999)s=0,l=-fi(2*Math.atan2(n,o)),c=-90;else{var u=n*n,_=r*r,f=a*a;s=fi(Math.atan2(2*n*o-2*r*a,1-2*u-2*f)),l=fi(Math.atan2(2*r*o-2*n*a,1-2*_-2*f)),c=fi(Math.asin(2*h)),i&&(s=-180*Math.sign(s+1e-6)+s,l=-180*Math.sign(l+1e-6)+l,c=180*Math.sign(c+1e-6)-c)}return t.x=s,t.y=l,t.z=c,t},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,i){return void 0===i&&(i=oi),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.z,this.w)},i.set=function(t,e,i,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=null!=n?n:1),this},i.equals=function(t,e){return void 0===e&&(e=oi),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},i.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.getEulerAngles=function(t){return e.toEuler(t,this)},i.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this.w+=e*(t.w-this.w),this},i.slerp=function(t,i){return e.slerp(this,this,t,i)},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e}(de));Li.IDENTITY=Object.freeze(new Li);var Bi=new Li,Fi=new Li,zi=new Ri,Ui=new Mi,ki=.5*Math.PI/180;function Gi(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),new Li(t,e,i,n)}ei.fastDefine("cc.Quat",Li,{x:0,y:0,z:0,w:1}),n.Quat=Li,n.quat=Gi;var Hi=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]),Vi=t("Mat4",function(t){function e(e,i,n,r,a,o,s,l,c,h,u,_,f,d,p,m){var v;return void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),void 0===h&&(h=0),void 0===u&&(u=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=1),(v=t.call(this)||this).m00=void 0,v.m01=void 0,v.m02=void 0,v.m03=void 0,v.m04=void 0,v.m05=void 0,v.m06=void 0,v.m07=void 0,v.m08=void 0,v.m09=void 0,v.m10=void 0,v.m11=void 0,v.m12=void 0,v.m13=void 0,v.m14=void 0,v.m15=void 0,"object"==typeof e?(v.m00=e.m00,v.m01=e.m01,v.m02=e.m02,v.m03=e.m03,v.m04=e.m04,v.m05=e.m05,v.m06=e.m06,v.m07=e.m07,v.m08=e.m08,v.m09=e.m09,v.m10=e.m10,v.m11=e.m11,v.m12=e.m12,v.m13=e.m13,v.m14=e.m14,v.m15=e.m15):(v.m00=e,v.m01=i,v.m02=n,v.m03=r,v.m04=a,v.m05=o,v.m06=s,v.m07=l,v.m08=c,v.m09=h,v.m10=u,v.m11=_,v.m12=f,v.m13=d,v.m14=p,v.m15=m),v}Y(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.set=function(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d,p,m){return t.m00=e,t.m01=i,t.m02=n,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=l,t.m08=c,t.m09=h,t.m10=u,t.m11=_,t.m12=f,t.m13=d,t.m14=p,t.m15=m,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.transpose=function(t,e){if(t===e){var i=e.m01,n=e.m02,r=e.m03,a=e.m06,o=e.m07,s=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=i,t.m06=e.m09,t.m07=e.m13,t.m08=n,t.m09=a,t.m11=e.m14,t.m12=r,t.m13=o,t.m14=s}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t},e.invert=function(t,e){var i=e.m00,n=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,l=e.m06,c=e.m07,h=e.m08,u=e.m09,_=e.m10,f=e.m11,d=e.m12,p=e.m13,m=e.m14,v=e.m15,g=i*s-n*o,y=i*l-r*o,T=i*c-a*o,S=n*l-r*s,E=n*c-a*s,A=r*c-a*l,b=h*p-u*d,x=h*m-_*d,C=h*v-f*d,w=u*m-_*p,R=u*v-f*p,I=_*v-f*m,O=g*I-y*R+T*w+S*C-E*x+A*b;return 0===O?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t):(O=1/O,t.m00=(s*I-l*R+c*w)*O,t.m01=(r*R-n*I-a*w)*O,t.m02=(p*A-m*E+v*S)*O,t.m03=(_*E-u*A-f*S)*O,t.m04=(l*C-o*I-c*x)*O,t.m05=(i*I-r*C+a*x)*O,t.m06=(m*T-d*A-v*y)*O,t.m07=(h*A-_*T+f*y)*O,t.m08=(o*R-s*C+c*b)*O,t.m09=(n*C-i*R-a*b)*O,t.m10=(d*E-p*T+v*g)*O,t.m11=(u*T-h*E-f*g)*O,t.m12=(s*x-o*w-l*b)*O,t.m13=(i*w-n*x+r*b)*O,t.m14=(p*y-d*S-m*g)*O,t.m15=(h*S-u*y+_*g)*O,t)},e.determinant=function(t){var e=t.m00,i=t.m01,n=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,l=t.m07,c=t.m08,h=t.m09,u=t.m10,_=t.m11,f=t.m12,d=t.m13,p=t.m14,m=t.m15;return(e*o-i*a)*(u*m-_*p)-(e*s-n*a)*(h*m-_*d)+(e*l-r*a)*(h*p-u*d)+(i*s-n*o)*(c*m-_*f)-(i*l-r*o)*(c*p-u*f)+(n*l-r*s)*(c*d-h*f)},e.multiply=function(t,e,i){var n=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,l=e.m05,c=e.m06,h=e.m07,u=e.m08,_=e.m09,f=e.m10,d=e.m11,p=e.m12,m=e.m13,v=e.m14,g=e.m15,y=i.m00,T=i.m01,S=i.m02,E=i.m03;return t.m00=y*n+T*s+S*u+E*p,t.m01=y*r+T*l+S*_+E*m,t.m02=y*a+T*c+S*f+E*v,t.m03=y*o+T*h+S*d+E*g,y=i.m04,T=i.m05,S=i.m06,E=i.m07,t.m04=y*n+T*s+S*u+E*p,t.m05=y*r+T*l+S*_+E*m,t.m06=y*a+T*c+S*f+E*v,t.m07=y*o+T*h+S*d+E*g,y=i.m08,T=i.m09,S=i.m10,E=i.m11,t.m08=y*n+T*s+S*u+E*p,t.m09=y*r+T*l+S*_+E*m,t.m10=y*a+T*c+S*f+E*v,t.m11=y*o+T*h+S*d+E*g,y=i.m12,T=i.m13,S=i.m14,E=i.m15,t.m12=y*n+T*s+S*u+E*p,t.m13=y*r+T*l+S*_+E*m,t.m14=y*a+T*c+S*f+E*v,t.m15=y*o+T*h+S*d+E*g,t},e.transform=function(t,e,i){var n=i.x,r=i.y,a=i.z;if(e===t)t.m12=e.m00*n+e.m04*r+e.m08*a+e.m12,t.m13=e.m01*n+e.m05*r+e.m09*a+e.m13,t.m14=e.m02*n+e.m06*r+e.m10*a+e.m14,t.m15=e.m03*n+e.m07*r+e.m11*a+e.m15;else{var o=e.m00,s=e.m01,l=e.m02,c=e.m03,h=e.m04,u=e.m05,_=e.m06,f=e.m07,d=e.m08,p=e.m09,m=e.m10,v=e.m11;e.m12,e.m13,e.m14,e.m15,t.m00=o,t.m01=s,t.m02=l,t.m03=c,t.m04=h,t.m05=u,t.m06=_,t.m07=f,t.m08=d,t.m09=p,t.m10=m,t.m11=v,t.m12=o*n+h*r+d*a+e.m12,t.m13=s*n+u*r+p*a+e.m13,t.m14=l*n+_*r+m*a+e.m14,t.m15=c*n+f*r+v*a+e.m15}return t},e.translate=function(t,e,i){return console.warn("function changed"),e===t?(t.m12+=i.x,t.m13+=i.y,t.m14+=i.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12+=i.x,t.m13+=i.y,t.m14+=i.z,t.m15=e.m15),t},e.scale=function(t,e,i){var n=i.x,r=i.y,a=i.z;return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*a,t.m09=e.m09*a,t.m10=e.m10*a,t.m11=e.m11*a,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.rotate=function(t,e,i,n){var r=n.x,a=n.y,o=n.z,s=Math.sqrt(r*r+a*a+o*o);if(Math.abs(s)<oi)return null;r*=s=1/s,a*=s,o*=s;var l=Math.sin(i),c=Math.cos(i),h=1-c,u=e.m00,_=e.m01,f=e.m02,d=e.m03,p=e.m04,m=e.m05,v=e.m06,g=e.m07,y=e.m08,T=e.m09,S=e.m10,E=e.m11,A=r*r*h+c,b=a*r*h+o*l,x=o*r*h-a*l,C=r*a*h-o*l,w=a*a*h+c,R=o*a*h+r*l,I=r*o*h+a*l,O=a*o*h-r*l,P=o*o*h+c;return t.m00=u*A+p*b+y*x,t.m01=_*A+m*b+T*x,t.m02=f*A+v*b+S*x,t.m03=d*A+g*b+E*x,t.m04=u*C+p*w+y*R,t.m05=_*C+m*w+T*R,t.m06=f*C+v*w+S*R,t.m07=d*C+g*w+E*R,t.m08=u*I+p*O+y*P,t.m09=_*I+m*O+T*P,t.m10=f*I+v*O+S*P,t.m11=d*I+g*O+E*P,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t},e.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e.m04,o=e.m05,s=e.m06,l=e.m07,c=e.m08,h=e.m09,u=e.m10,_=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=a*r+c*n,t.m05=o*r+h*n,t.m06=s*r+u*n,t.m07=l*r+_*n,t.m08=c*r-a*n,t.m09=h*r-o*n,t.m10=u*r-s*n,t.m11=_*r-l*n,t},e.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e.m00,o=e.m01,s=e.m02,l=e.m03,c=e.m08,h=e.m09,u=e.m10,_=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r-c*n,t.m01=o*r-h*n,t.m02=s*r-u*n,t.m03=l*r-_*n,t.m08=a*n+c*r,t.m09=o*n+h*r,t.m10=s*n+u*r,t.m11=l*n+_*r,t},e.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e.m00,o=e.m01,s=e.m02,l=e.m03,c=e.m04,h=e.m05,u=e.m06,_=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r+c*n,t.m01=o*r+h*n,t.m02=s*r+u*n,t.m03=l*r+_*n,t.m04=c*r-a*n,t.m05=h*r-o*n,t.m06=u*r-s*n,t.m07=_*r-l*n,t},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRotation=function(t,e,i){var n=i.x,r=i.y,a=i.z,o=Math.sqrt(n*n+r*r+a*a);if(Math.abs(o)<oi)return null;n*=o=1/o,r*=o,a*=o;var s=Math.sin(e),l=Math.cos(e),c=1-l;return t.m00=n*n*c+l,t.m01=r*n*c+a*s,t.m02=a*n*c-r*s,t.m03=0,t.m04=n*r*c-a*s,t.m05=r*r*c+l,t.m06=a*r*c+n*s,t.m07=0,t.m08=n*a*c+r*s,t.m09=r*a*c-n*s,t.m10=a*a*c+l,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=n,t.m06=i,t.m07=0,t.m08=0,t.m09=-i,t.m10=n,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t.m00=n,t.m01=0,t.m02=-i,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=i,t.m09=0,t.m10=n,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t.m00=n,t.m01=i,t.m02=0,t.m03=0,t.m04=-i,t.m05=n,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRT=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=e.w,s=n+n,l=r+r,c=a+a,h=n*s,u=n*l,_=n*c,f=r*l,d=r*c,p=a*c,m=o*s,v=o*l,g=o*c;return t.m00=1-(f+p),t.m01=u+g,t.m02=_-v,t.m03=0,t.m04=u-g,t.m05=1-(h+p),t.m06=d+m,t.m07=0,t.m08=_+v,t.m09=d-m,t.m10=1-(h+f),t.m11=0,t.m12=i.x,t.m13=i.y,t.m14=i.z,t.m15=1,t},e.getTranslation=function(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t},e.getScaling=function(t,e){var i=ji.m00=e.m00,n=ji.m01=e.m01,r=ji.m02=e.m02,a=ji.m03=e.m04,o=ji.m04=e.m05,s=ji.m05=e.m06,l=ji.m06=e.m08,c=ji.m07=e.m09,h=ji.m08=e.m10;return t.x=Math.sqrt(i*i+n*n+r*r),t.y=Math.sqrt(a*a+o*o+s*s),t.z=Math.sqrt(l*l+c*c+h*h),Mi.determinant(ji)<0&&(t.x*=-1),t},e.getRotation=function(t,e){var i=e.m00+e.m05+e.m10,n=0;return i>0?(n=2*Math.sqrt(i+1),t.w=.25*n,t.x=(e.m06-e.m09)/n,t.y=(e.m08-e.m02)/n,t.z=(e.m01-e.m04)/n):e.m00>e.m05&&e.m00>e.m10?(n=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/n,t.x=.25*n,t.y=(e.m01+e.m04)/n,t.z=(e.m08+e.m02)/n):e.m05>e.m10?(n=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/n,t.x=(e.m01+e.m04)/n,t.y=.25*n,t.z=(e.m06+e.m09)/n):(n=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/n,t.x=(e.m08+e.m02)/n,t.y=(e.m06+e.m09)/n,t.z=.25*n),t},e.toRTS=function(t,e,i,n){n.x=Ri.set(Wi,t.m00,t.m01,t.m02).length(),ji.m00=t.m00/n.x,ji.m01=t.m01/n.x,ji.m02=t.m02/n.x,n.y=Ri.set(Wi,t.m04,t.m05,t.m06).length(),ji.m03=t.m04/n.y,ji.m04=t.m05/n.y,ji.m05=t.m06/n.y,n.z=Ri.set(Wi,t.m08,t.m09,t.m10).length(),ji.m06=t.m08/n.z,ji.m07=t.m09/n.z,ji.m08=t.m10/n.z,Mi.determinant(ji)<0&&(n.x*=-1,ji.m00*=-1,ji.m01*=-1,ji.m02*=-1),Li.fromMat3(e,ji),Ri.set(i,t.m12,t.m13,t.m14)},e.fromRTS=function(t,e,i,n){var r=e.x,a=e.y,o=e.z,s=e.w,l=r+r,c=a+a,h=o+o,u=r*l,_=r*c,f=r*h,d=a*c,p=a*h,m=o*h,v=s*l,g=s*c,y=s*h,T=n.x,S=n.y,E=n.z;return t.m00=(1-(d+m))*T,t.m01=(_+y)*T,t.m02=(f-g)*T,t.m03=0,t.m04=(_-y)*S,t.m05=(1-(u+m))*S,t.m06=(p+v)*S,t.m07=0,t.m08=(f+g)*E,t.m09=(p-v)*E,t.m10=(1-(u+d))*E,t.m11=0,t.m12=i.x,t.m13=i.y,t.m14=i.z,t.m15=1,t},e.fromRTSOrigin=function(t,e,i,n,r){var a=e.x,o=e.y,s=e.z,l=e.w,c=a+a,h=o+o,u=s+s,_=a*c,f=a*h,d=a*u,p=o*h,m=o*u,v=s*u,g=l*c,y=l*h,T=l*u,S=n.x,E=n.y,A=n.z,b=r.x,x=r.y,C=r.z;return t.m00=(1-(p+v))*S,t.m01=(f+T)*S,t.m02=(d-y)*S,t.m03=0,t.m04=(f-T)*E,t.m05=(1-(_+v))*E,t.m06=(m+g)*E,t.m07=0,t.m08=(d+y)*A,t.m09=(m-g)*A,t.m10=(1-(_+p))*A,t.m11=0,t.m12=i.x+b-(t.m00*b+t.m04*x+t.m08*C),t.m13=i.y+x-(t.m01*b+t.m05*x+t.m09*C),t.m14=i.z+C-(t.m02*b+t.m06*x+t.m10*C),t.m15=1,t},e.fromQuat=function(t,e){var i=e.x,n=e.y,r=e.z,a=e.w,o=i+i,s=n+n,l=r+r,c=i*o,h=n*o,u=n*s,_=r*o,f=r*s,d=r*l,p=a*o,m=a*s,v=a*l;return t.m00=1-u-d,t.m01=h+v,t.m02=_-m,t.m03=0,t.m04=h-v,t.m05=1-c-d,t.m06=f+p,t.m07=0,t.m08=_+m,t.m09=f-p,t.m10=1-c-u,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.frustum=function(t,e,i,n,r,a,o){var s=1/(i-e),l=1/(r-n),c=1/(a-o);return t.m00=2*a*s,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*a*l,t.m06=0,t.m07=0,t.m08=(i+e)*s,t.m09=(r+n)*l,t.m10=(o+a)*c,t.m11=-1,t.m12=0,t.m13=0,t.m14=o*a*2*c,t.m15=0,t},e.perspective=function(t,e,i,n,r,a,o,s,l){void 0===a&&(a=!0),void 0===o&&(o=-1),void 0===s&&(s=1),void 0===l&&(l=0);var c=1/Math.tan(e/2),h=1/(n-r),u=a?c/i:c,_=(a?c:c*i)*s,f=Hi[l];return t.m00=u*f[0],t.m01=u*f[1],t.m02=0,t.m03=0,t.m04=_*f[2],t.m05=_*f[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-o*n)*h,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*n*h*(1-o),t.m15=0,t},e.ortho=function(t,e,i,n,r,a,o,s,l,c){void 0===s&&(s=-1),void 0===l&&(l=1),void 0===c&&(c=0);var h=1/(e-i),u=1/(n-r)*l,_=1/(a-o),f=-2*h,d=-2*u,p=(e+i)*h,m=(r+n)*u,v=Hi[c];return t.m00=f*v[0],t.m01=f*v[1],t.m02=0,t.m03=0,t.m04=d*v[2],t.m05=d*v[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=_*(1-s),t.m11=0,t.m12=p*v[0]+m*v[2],t.m13=p*v[1]+m*v[3],t.m14=(a-s*o)*_,t.m15=1,t},e.lookAt=function(t,e,i,n){var r=e.x,a=e.y,o=e.z,s=n.x,l=n.y,c=n.z,h=r-i.x,u=a-i.y,_=o-i.z,f=1/Math.sqrt(h*h+u*u+_*_),d=l*(_*=f)-c*(u*=f),p=c*(h*=f)-s*_,m=s*u-l*h,v=u*(m*=f=1/Math.sqrt(d*d+p*p+m*m))-_*(p*=f),g=_*(d*=f)-h*m,y=h*p-u*d;return t.m00=d,t.m01=v,t.m02=h,t.m03=0,t.m04=p,t.m05=g,t.m06=u,t.m07=0,t.m08=m,t.m09=y,t.m10=_,t.m11=0,t.m12=-(d*r+p*a+m*o),t.m13=-(v*r+g*a+y*o),t.m14=-(h*r+u*a+_*o),t.m15=1,t},e.inverseTranspose=function(t,e){var i=e.m00,n=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,l=e.m06,c=e.m07,h=e.m08,u=e.m09,_=e.m10,f=e.m11,d=e.m12,p=e.m13,m=e.m14,v=e.m15,g=i*s-n*o,y=i*l-r*o,T=i*c-a*o,S=n*l-r*s,E=n*c-a*s,A=r*c-a*l,b=h*p-u*d,x=h*m-_*d,C=h*v-f*d,w=u*m-_*p,R=u*v-f*p,I=_*v-f*m,O=g*I-y*R+T*w+S*C-E*x+A*b;return O?(O=1/O,t.m00=(s*I-l*R+c*w)*O,t.m01=(l*C-o*I-c*x)*O,t.m02=(o*R-s*C+c*b)*O,t.m03=0,t.m04=(r*R-n*I-a*w)*O,t.m05=(i*I-r*C+a*x)*O,t.m06=(n*C-i*R-a*b)*O,t.m07=0,t.m08=(p*A-m*E+v*S)*O,t.m09=(m*T-d*A-v*y)*O,t.m10=(d*E-p*T+v*g)*O,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.m00,t[i+1]=e.m01,t[i+2]=e.m02,t[i+3]=e.m03,t[i+4]=e.m04,t[i+5]=e.m05,t[i+6]=e.m06,t[i+7]=e.m07,t[i+8]=e.m08,t[i+9]=e.m09,t[i+10]=e.m10,t[i+11]=e.m11,t[i+12]=e.m12,t[i+13]=e.m13,t[i+14]=e.m14,t[i+15]=e.m15,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.m00=e[i+0],t.m01=e[i+1],t.m02=e[i+2],t.m03=e[i+3],t.m04=e[i+4],t.m05=e[i+5],t.m06=e[i+6],t.m07=e[i+7],t.m08=e[i+8],t.m09=e[i+9],t.m10=e[i+10],t.m11=e[i+11],t.m12=e[i+12],t.m13=e[i+13],t.m14=e[i+14],t.m15=e[i+15],t},e.add=function(t,e,i){return t.m00=e.m00+i.m00,t.m01=e.m01+i.m01,t.m02=e.m02+i.m02,t.m03=e.m03+i.m03,t.m04=e.m04+i.m04,t.m05=e.m05+i.m05,t.m06=e.m06+i.m06,t.m07=e.m07+i.m07,t.m08=e.m08+i.m08,t.m09=e.m09+i.m09,t.m10=e.m10+i.m10,t.m11=e.m11+i.m11,t.m12=e.m12+i.m12,t.m13=e.m13+i.m13,t.m14=e.m14+i.m14,t.m15=e.m15+i.m15,t},e.subtract=function(t,e,i){return t.m00=e.m00-i.m00,t.m01=e.m01-i.m01,t.m02=e.m02-i.m02,t.m03=e.m03-i.m03,t.m04=e.m04-i.m04,t.m05=e.m05-i.m05,t.m06=e.m06-i.m06,t.m07=e.m07-i.m07,t.m08=e.m08-i.m08,t.m09=e.m09-i.m09,t.m10=e.m10-i.m10,t.m11=e.m11-i.m11,t.m12=e.m12-i.m12,t.m13=e.m13-i.m13,t.m14=e.m14-i.m14,t.m15=e.m15-i.m15,t},e.multiplyScalar=function(t,e,i){return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*i,t.m05=e.m05*i,t.m06=e.m06*i,t.m07=e.m07*i,t.m08=e.m08*i,t.m09=e.m09*i,t.m10=e.m10*i,t.m11=e.m11*i,t.m12=e.m12*i,t.m13=e.m13*i,t.m14=e.m14*i,t.m15=e.m15*i,t},e.multiplyScalarAndAdd=function(t,e,i,n){return t.m00=e.m00+i.m00*n,t.m01=e.m01+i.m01*n,t.m02=e.m02+i.m02*n,t.m03=e.m03+i.m03*n,t.m04=e.m04+i.m04*n,t.m05=e.m05+i.m05*n,t.m06=e.m06+i.m06*n,t.m07=e.m07+i.m07*n,t.m08=e.m08+i.m08*n,t.m09=e.m09+i.m09*n,t.m10=e.m10+i.m10*n,t.m11=e.m11+i.m11*n,t.m12=e.m12+i.m12*n,t.m13=e.m13+i.m13*n,t.m14=e.m14+i.m14*n,t.m15=e.m15+i.m15*n,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15},e.equals=function(t,e,i){return void 0===i&&(i=oi),Math.abs(t.m00-e.m00)<=i*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=i*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=i*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=i*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=i*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=i*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=i*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=i*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=i*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))&&Math.abs(t.m09-e.m09)<=i*Math.max(1,Math.abs(t.m09),Math.abs(e.m09))&&Math.abs(t.m10-e.m10)<=i*Math.max(1,Math.abs(t.m10),Math.abs(e.m10))&&Math.abs(t.m11-e.m11)<=i*Math.max(1,Math.abs(t.m11),Math.abs(e.m11))&&Math.abs(t.m12-e.m12)<=i*Math.max(1,Math.abs(t.m12),Math.abs(e.m12))&&Math.abs(t.m13-e.m13)<=i*Math.max(1,Math.abs(t.m13),Math.abs(e.m13))&&Math.abs(t.m14-e.m14)<=i*Math.max(1,Math.abs(t.m14),Math.abs(e.m14))&&Math.abs(t.m15-e.m15)<=i*Math.max(1,Math.abs(t.m15),Math.abs(e.m15))};var i=e.prototype;return i.clone=function(){return new e(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},i.set=function(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d,p){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=1),"object"==typeof t?(this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15,this.m00=t.m00):(this.m01=e,this.m02=i,this.m03=n,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=l,this.m09=c,this.m10=h,this.m11=u,this.m12=_,this.m13=f,this.m14=d,this.m15=p,this.m00=t),this},i.equals=function(t,e){return void 0===e&&(e=oi),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))&&Math.abs(this.m09-t.m09)<=e*Math.max(1,Math.abs(this.m09),Math.abs(t.m09))&&Math.abs(this.m10-t.m10)<=e*Math.max(1,Math.abs(this.m10),Math.abs(t.m10))&&Math.abs(this.m11-t.m11)<=e*Math.max(1,Math.abs(this.m11),Math.abs(t.m11))&&Math.abs(this.m12-t.m12)<=e*Math.max(1,Math.abs(this.m12),Math.abs(t.m12))&&Math.abs(this.m13-t.m13)<=e*Math.max(1,Math.abs(this.m13),Math.abs(t.m13))&&Math.abs(this.m14-t.m14)<=e*Math.max(1,Math.abs(this.m14),Math.abs(t.m14))&&Math.abs(this.m15-t.m15)<=e*Math.max(1,Math.abs(this.m15),Math.abs(t.m15))},i.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08&&this.m09===t.m09&&this.m10===t.m10&&this.m11===t.m11&&this.m12===t.m12&&this.m13===t.m13&&this.m14===t.m14&&this.m15===t.m15},i.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},i.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},i.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},i.transpose=function(){var t=this.m01,e=this.m02,i=this.m03,n=this.m06,r=this.m07,a=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=t,this.m06=this.m09,this.m07=this.m13,this.m08=e,this.m09=n,this.m11=this.m14,this.m12=i,this.m13=r,this.m14=a,this},i.invert=function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,l=this.m08,c=this.m09,h=this.m10,u=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15,m=t*a-e*r,v=t*o-i*r,g=t*s-n*r,y=e*o-i*a,T=e*s-n*a,S=i*s-n*o,E=l*f-c*_,A=l*d-h*_,b=l*p-u*_,x=c*d-h*f,C=c*p-u*f,w=h*p-u*d,R=m*w-v*C+g*x+y*b-T*A+S*E;return 0===R?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(R=1/R,this.m00=(a*w-o*C+s*x)*R,this.m01=(i*C-e*w-n*x)*R,this.m02=(f*S-d*T+p*y)*R,this.m03=(h*T-c*S-u*y)*R,this.m04=(o*b-r*w-s*A)*R,this.m05=(t*w-i*b+n*A)*R,this.m06=(d*g-_*S-p*v)*R,this.m07=(l*S-h*g+u*v)*R,this.m08=(r*C-a*b+s*E)*R,this.m09=(e*b-t*C-n*E)*R,this.m10=(_*T-f*g+p*m)*R,this.m11=(c*g-l*T-u*m)*R,this.m12=(a*A-r*x-o*E)*R,this.m13=(t*x-e*A+i*E)*R,this.m14=(f*v-_*y-d*m)*R,this.m15=(l*y-c*v+h*m)*R,this)},i.determinant=function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,l=this.m08,c=this.m09,h=this.m10,u=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15;return(t*a-e*r)*(h*p-u*d)-(t*o-i*r)*(c*p-u*f)+(t*s-n*r)*(c*d-h*f)+(e*o-i*a)*(l*p-u*_)-(e*s-n*a)*(l*d-h*_)+(i*s-n*o)*(l*f-c*_)},i.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this.m09+=t.m09,this.m10+=t.m10,this.m11+=t.m11,this.m12+=t.m12,this.m13+=t.m13,this.m14+=t.m14,this.m15+=t.m15,this},i.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this.m09-=t.m09,this.m10-=t.m10,this.m11-=t.m11,this.m12-=t.m12,this.m13-=t.m13,this.m14-=t.m14,this.m15-=t.m15,this},i.multiply=function(t){var e=this.m00,i=this.m01,n=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,l=this.m07,c=this.m08,h=this.m09,u=this.m10,_=this.m11,f=this.m12,d=this.m13,p=this.m14,m=this.m15,v=t.m00,g=t.m01,y=t.m02,T=t.m03;return this.m00=v*e+g*a+y*c+T*f,this.m01=v*i+g*o+y*h+T*d,this.m02=v*n+g*s+y*u+T*p,this.m03=v*r+g*l+y*_+T*m,v=t.m04,g=t.m05,y=t.m06,T=t.m07,this.m04=v*e+g*a+y*c+T*f,this.m05=v*i+g*o+y*h+T*d,this.m06=v*n+g*s+y*u+T*p,this.m07=v*r+g*l+y*_+T*m,v=t.m08,g=t.m09,y=t.m10,T=t.m11,this.m08=v*e+g*a+y*c+T*f,this.m09=v*i+g*o+y*h+T*d,this.m10=v*n+g*s+y*u+T*p,this.m11=v*r+g*l+y*_+T*m,v=t.m12,g=t.m13,y=t.m14,T=t.m15,this.m12=v*e+g*a+y*c+T*f,this.m13=v*i+g*o+y*h+T*d,this.m14=v*n+g*s+y*u+T*p,this.m15=v*r+g*l+y*_+T*m,this},i.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this.m09*=t,this.m10*=t,this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m15*=t,this},i.translate=function(t){return console.warn("function changed"),this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},i.scale=function(t){var e=t.x,i=t.y,n=t.z;return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=i,this.m05*=i,this.m06*=i,this.m07*=i,this.m08*=n,this.m09*=n,this.m10*=n,this.m11*=n,this},i.rotate=function(t,e){var i=e.x,n=e.y,r=e.z,a=Math.sqrt(i*i+n*n+r*r);if(Math.abs(a)<oi)return null;i*=a=1/a,n*=a,r*=a;var o=Math.sin(t),s=Math.cos(t),l=1-s,c=this.m00,h=this.m01,u=this.m02,_=this.m03,f=this.m04,d=this.m05,p=this.m06,m=this.m07,v=this.m08,g=this.m09,y=this.m10,T=this.m11,S=i*i*l+s,E=n*i*l+r*o,A=r*i*l-n*o,b=i*n*l-r*o,x=n*n*l+s,C=r*n*l+i*o,w=i*r*l+n*o,R=n*r*l-i*o,I=r*r*l+s;return this.m00=c*S+f*E+v*A,this.m01=h*S+d*E+g*A,this.m02=u*S+p*E+y*A,this.m03=_*S+m*E+T*A,this.m04=c*b+f*x+v*C,this.m05=h*b+d*x+g*C,this.m06=u*b+p*x+y*C,this.m07=_*b+m*x+T*C,this.m08=c*w+f*R+v*I,this.m09=h*w+d*R+g*I,this.m10=u*w+p*R+y*I,this.m11=_*w+m*R+T*I,this},i.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},i.getScale=function(t){var e=ji.m00=this.m00,i=ji.m01=this.m01,n=ji.m02=this.m02,r=ji.m03=this.m04,a=ji.m04=this.m05,o=ji.m05=this.m06,s=ji.m06=this.m08,l=ji.m07=this.m09,c=ji.m08=this.m10;return t.x=Math.sqrt(e*e+i*i+n*n),t.y=Math.sqrt(r*r+a*a+o*o),t.z=Math.sqrt(s*s+l*l+c*c),Mi.determinant(ji)<0&&(t.x*=-1),t},i.getRotation=function(t){var e=this.m00+this.m05+this.m10,i=0;return e>0?(i=2*Math.sqrt(e+1),t.w=.25*i,t.x=(this.m06-this.m09)/i,t.y=(this.m08-this.m02)/i,t.z=(this.m01-this.m04)/i):this.m00>this.m05&&this.m00>this.m10?(i=2*Math.sqrt(1+this.m00-this.m05-this.m10),t.w=(this.m06-this.m09)/i,t.x=.25*i,t.y=(this.m01+this.m04)/i,t.z=(this.m08+this.m02)/i):this.m05>this.m10?(i=2*Math.sqrt(1+this.m05-this.m00-this.m10),t.w=(this.m08-this.m02)/i,t.x=(this.m01+this.m04)/i,t.y=.25*i,t.z=(this.m06+this.m09)/i):(i=2*Math.sqrt(1+this.m10-this.m00-this.m05),t.w=(this.m01-this.m04)/i,t.x=(this.m08+this.m02)/i,t.y=(this.m06+this.m09)/i,t.z=.25*i),t},i.fromRTS=function(t,e,i){var n=t.x,r=t.y,a=t.z,o=t.w,s=n+n,l=r+r,c=a+a,h=n*s,u=n*l,_=n*c,f=r*l,d=r*c,p=a*c,m=o*s,v=o*l,g=o*c,y=i.x,T=i.y,S=i.z;return this.m00=(1-(f+p))*y,this.m01=(u+g)*y,this.m02=(_-v)*y,this.m03=0,this.m04=(u-g)*T,this.m05=(1-(h+p))*T,this.m06=(d+m)*T,this.m07=0,this.m08=(_+v)*S,this.m09=(d-m)*S,this.m10=(1-(h+f))*S,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this},i.fromQuat=function(t){var e=t.x,i=t.y,n=t.z,r=t.w,a=e+e,o=i+i,s=n+n,l=e*a,c=i*a,h=i*o,u=n*a,_=n*o,f=n*s,d=r*a,p=r*o,m=r*s;return this.m00=1-h-f,this.m01=c+m,this.m02=u-p,this.m03=0,this.m04=c-m,this.m05=1-l-f,this.m06=_+d,this.m07=0,this.m08=u+p,this.m09=_-d,this.m10=1-l-h,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},e}(de));Vi.IDENTITY=Object.freeze(new Vi);var Wi=new Ri,ji=new Mi;function qi(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d,p){return new Vi(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d,p)}ei.fastDefine("cc.Mat4",Vi,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),n.Mat4=Vi,n.mat4=qi;var Xi=t("Vec2",function(t){function e(e,i){var n;return n=t.call(this)||this,e&&"object"==typeof e?(n.x=e.x,n.y=e.y):(n.x=e||0,n.y=i||0),n}Y(e,t),e.clone=function(t){return new e(t.x,t.y)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t},e.set=function(t,e,i){return t.x=e,t.y=i,t},e.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},e.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},e.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t},e.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},e.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t},e.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},e.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t},e.distance=function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},e.squaredDistance=function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},e.len=function(t){var e=t.x,i=t.y;return Math.sqrt(e*e+i*i)},e.lengthSqr=function(t){var e=t.x,i=t.y;return e*e+i*i},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},e.inverseSafe=function(t,e){var i=e.x,n=e.y;return Math.abs(i)<oi?t.x=0:t.x=1/i,Math.abs(n)<oi?t.y=0:t.y=1/n,t},e.normalize=function(t,e){var i=e.x,n=e.y,r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t.x=i*r,t.y=n*r),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.cross=function(t,e,i){return t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t},e.lerp=function(t,e,i,n){var r=e.x,a=e.y;return t.x=r+n*(i.x-r),t.y=a+n*(i.y-a),t},e.random=function(t,e){e=e||1;var i=2*di()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t},e.transformMat3=function(t,e,i){var n=e.x,r=e.y;return t.x=i.m00*n+i.m03*r+i.m06,t.y=i.m01*n+i.m04*r+i.m07,t},e.transformMat4=function(t,e,i){var n=e.x,r=e.y;return t.x=i.m00*n+i.m04*r+i.m12,t.y=i.m01*n+i.m05*r+i.m13,t},e.str=function(t){return"Vec2("+t.x+", "+t.y+")"},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},e.equals=function(t,e,i){return void 0===i&&(i=oi),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))},e.angle=function(t,i){e.normalize(Yi,t),e.normalize(Ki,i);var n=e.dot(Yi,Ki);return n>1?0:n<-1?Math.PI:Math.acos(n)};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y)},i.set=function(t,e){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},i.equals=function(t,e){return void 0===e&&(e=oi),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))},i.equals2f=function(t,e,i){return void 0===i&&(i=oi),Math.abs(this.x-t)<=i*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=i*Math.max(1,Math.abs(this.y),Math.abs(e))},i.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},i.strictEquals2f=function(t,e){return this.x===t&&this.y===e},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},i.lerp=function(t,e){var i=this.x,n=this.y;return this.x=i+e*(t.x-i),this.y=n+e*(t.y-n),this},i.clampf=function(t,e){return this.x=ci(this.x,t.x,e.x),this.y=ci(this.y,t.y,e.y),this},i.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.add2f=function(t,e){return this.x+=t,this.y+=e,this},i.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.subtract2f=function(t,e){return this.x-=t,this.y-=e,this},i.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=t,this.y*=t,this},i.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this},i.multiply2f=function(t,e){return this.x*=t,this.y*=e,this},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this},i.divide2f=function(t,e){return this.x/=t,this.y/=e,this},i.negative=function(){return this.x=-this.x,this.y=-this.y,this},i.dot=function(t){return this.x*t.x+this.y*t.y},i.cross=function(t){return this.x*t.y-this.y*t.x},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.lengthSqr=function(){return this.x*this.x+this.y*this.y},i.normalize=function(){var t=this.x,e=this.y,i=t*t+e*e;return i>0&&(i=1/Math.sqrt(i),this.x*=i,this.y*=i),this},i.angle=function(t){var e=this.lengthSqr(),i=t.lengthSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t)/Math.sqrt(e*i);return n=ci(n,-1,1),Math.acos(n)},i.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},i.rotate=function(t){var e=this.x,i=this.y,n=Math.sin(t),r=Math.cos(t);return this.x=r*e-n*i,this.y=n*e+r*i,this},i.project=function(t){var e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this},i.transformMat4=function(t){var e=this.x,i=this.y;return this.x=t.m00*e+t.m04*i+t.m12,this.y=t.m01*e+t.m05*i+t.m13,this},e}(de));Xi.ZERO=Object.freeze(new Xi(0,0)),Xi.ONE=Object.freeze(new Xi(1,1)),Xi.NEG_ONE=Object.freeze(new Xi(-1,-1)),Xi.UNIT_X=Object.freeze(new Xi(1,0)),Xi.UNIT_Y=Object.freeze(new Xi(0,1));var Yi=new Xi,Ki=new Xi;function Zi(t,e){return new Xi(t,e)}ei.fastDefine("cc.Vec2",Xi,{x:0,y:0}),n.Vec2=Xi,n.v2=Zi;var Qi=t("Vec4",function(t){function e(e,i,n,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=i||0,a.z=n||0,a.w=r||0),a}Y(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,i,n,r){return t.x=e,t.y=i,t.z=n,t.w=r,t},e.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t},e.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t},e.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t},e.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},e.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t.w=Math.min(e.w,i.w),t},e.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t.w=Math.max(e.w,i.w),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},e.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},e.scaleAndAdd=function(t,e,i,n){return t.x=e.x+i.x*n,t.y=e.y+i.y*n,t.z=e.z+i.z*n,t.w=e.w+i.w*n,t},e.distance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return Math.sqrt(i*i+n*n+r*r+a*a)},e.squaredDistance=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return i*i+n*n+r*r+a*a},e.len=function(t){var e=t.x,i=t.y,n=t.z,r=t.w;return Math.sqrt(e*e+i*i+n*n+r*r)},e.lengthSqr=function(t){var e=t.x,i=t.y,n=t.z,r=t.w;return e*e+i*i+n*n+r*r},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},e.inverseSafe=function(t,e){var i=e.x,n=e.y,r=e.z,a=e.w;return Math.abs(i)<oi?t.x=0:t.x=1/i,Math.abs(n)<oi?t.y=0:t.y=1/n,Math.abs(r)<oi?t.z=0:t.z=1/r,Math.abs(a)<oi?t.w=0:t.w=1/a,t},e.normalize=function(t,e){var i=e.x,n=e.y,r=e.z,a=e.w,o=i*i+n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),t.x=i*o,t.y=n*o,t.z=r*o,t.w=a*o),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,i,n){return t.x=e.x+n*(i.x-e.x),t.y=e.y+n*(i.y-e.y),t.z=e.z+n*(i.z-e.z),t.w=e.w+n*(i.w-e.w),t},e.random=function(t,e){e=e||1;var i=2*di()*Math.PI,n=2*di()-1,r=Math.sqrt(1-n*n);return t.x=r*Math.cos(i)*e,t.y=r*Math.sin(i)*e,t.z=n*e,t.w=0,t},e.transformMat4=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=e.w;return t.x=i.m00*n+i.m04*r+i.m08*a+i.m12*o,t.y=i.m01*n+i.m05*r+i.m09*a+i.m13*o,t.z=i.m02*n+i.m06*r+i.m10*a+i.m14*o,t.w=i.m03*n+i.m07*r+i.m11*a+i.m15*o,t},e.transformAffine=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=e.w;return t.x=i.m00*n+i.m01*r+i.m02*a+i.m03*o,t.y=i.m04*n+i.m05*r+i.m06*a+i.m07*o,t.x=i.m08*n+i.m09*r+i.m10*a+i.m11*o,t.w=e.w,t},e.transformQuat=function(t,e,i){var n=e.x,r=e.y,a=e.z,o=i.x,s=i.y,l=i.z,c=i.w,h=c*n+s*a-l*r,u=c*r+l*n-o*a,_=c*a+o*r-s*n,f=-o*n-s*r-l*a;return t.x=h*c+f*-o+u*-l-_*-s,t.y=u*c+f*-s+_*-o-h*-l,t.z=_*c+f*-l+h*-s-u*-o,t.w=e.w,t},e.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},e.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,i){return void 0===i&&(i=oi),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.z,this.w)},i.set=function(t,e,i,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0),this},i.equals=function(t,e){return void 0===e&&(e=oi),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},i.equals4f=function(t,e,i,n,r){return void 0===r&&(r=oi),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=r*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-n)<=r*Math.max(1,Math.abs(this.w),Math.abs(n))},i.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.strictEquals4f=function(t,e,i,n){return this.x===t&&this.y===e&&this.z===i&&this.w===n},i.lerp=function(t,e){var i=this.x,n=this.y,r=this.z,a=this.w;return this.x=i+e*(t.x-i),this.y=n+e*(t.y-n),this.z=r+e*(t.z-r),this.w=a+e*(t.w-a),this},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},i.clampf=function(t,e){return this.x=ci(this.x,t.x,e.x),this.y=ci(this.y,t.y,e.y),this.z=ci(this.z,t.z,e.z),this.w=ci(this.w,t.w,e.w),this},i.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.add4f=function(t,e,i,n){return this.x+=t,this.y+=e,this.z+=i,this.w+=n,this},i.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.subtract4f=function(t,e,i,n){return this.x-=t,this.y-=e,this.z-=i,this.w-=n,this},i.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.multiply4f=function(t,e,i,n){return this.x*=t,this.y*=e,this.z*=i,this.w*=n,this},i.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},i.divide4f=function(t,e,i,n){return this.x/=t,this.y/=e,this.z/=i,this.w/=n,this},i.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.cross=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,o=t.z;return this.x=i*o-n*a,this.y=n*r-e*o,this.z=e*a-i*r,this},i.length=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return Math.sqrt(t*t+e*e+i*i+n*n)},i.lengthSqr=function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n},i.normalize=function(){var t=this.x,e=this.y,i=this.z,n=this.w,r=t*t+e*e+i*i+n*n;return r>0&&(r=1/Math.sqrt(r),this.x=t*r,this.y=e*r,this.z=i*r,this.w=n*r),this},i.transformMat4=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.x=t.m00*e+t.m04*i+t.m08*n+t.m12*r,this.y=t.m01*e+t.m05*i+t.m09*n+t.m13*r,this.z=t.m02*e+t.m06*i+t.m10*n+t.m14*r,this.w=t.m03*e+t.m07*i+t.m11*n+t.m15*r,this},e}(de));function Ji(t,e,i,n){return new Qi(t,e,i,n)}Qi.ZERO=Object.freeze(new Qi(0,0,0,0)),Qi.ONE=Object.freeze(new Qi(1,1,1,1)),Qi.NEG_ONE=Object.freeze(new Qi(-1,-1,-1,-1)),ei.fastDefine("cc.Vec4",Qi,{x:0,y:0,z:0,w:0}),n.Vec4=Qi,n.v4=Ji,lt(Xi,"Vec2",[{name:"sub",newName:"subtract",target:Xi,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Xi,targetName:"Vec2"},{name:"div",newName:"divide",target:Xi,targetName:"Vec2"},{name:"dist",newName:"distance",target:Xi,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Xi,targetName:"Vec2"},{name:"mag",newName:"len",target:Xi,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Xi,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Xi,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Xi,targetName:"Vec2"}]),lt(Xi.prototype,"Vec2",[{name:"mag",newName:"length",target:Xi.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Xi.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Xi.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Xi.prototype,targetName:"Vec2"}]),lt(Ri,"Vec3",[{name:"sub",newName:"subtract",target:Ri,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Ri,targetName:"Vec3"},{name:"div",newName:"divide",target:Ri,targetName:"Vec3"},{name:"dist",newName:"distance",target:Ri,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Ri,targetName:"Vec3"},{name:"mag",newName:"len",target:Ri,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Ri,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Ri,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Ri,targetName:"Vec3"}]),lt(Ri.prototype,"Vec3",[{name:"mag",newName:"length",target:Ri.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Ri.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Ri.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Ri.prototype,targetName:"Vec3"}]),lt(Qi,"Vec4",[{name:"sub",newName:"subtract",target:Qi,targetName:"Vec4"},{name:"mul",newName:"multiply",target:Qi,targetName:"Vec4"},{name:"div",newName:"divide",target:Qi,targetName:"Vec4"},{name:"dist",newName:"distance",target:Qi,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:Qi,targetName:"Vec4"},{name:"mag",newName:"len",target:Qi,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:Qi,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:Qi,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:Qi,targetName:"Vec4"}]),lt(Qi.prototype,"Vec4",[{name:"mag",newName:"length",target:Qi.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:Qi.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:Qi.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:Qi.prototype,targetName:"Vec4"}]),lt(Li,"Quat",[{name:"mag",newName:"len",target:Li,targetName:"Quat"},{name:"mul",newName:"multiply",target:Li,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Li,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Li,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Li,targetName:"Quat"}]),lt(Li.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Li.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Li.prototype,targetName:"Quat"}]),lt(Ci,"Color",[{name:"sub",newName:"subtract",target:Ci,targetName:"Color"},{name:"mul",newName:"multiply",target:Ci,targetName:"Color"},{name:"div",newName:"divide",target:Ci,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Ci,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e[1].toString(16);return n.Color.fromHEX(e[0],r)}}]),lt(Mi,"Mat3",[{name:"sub",newName:"subtract",target:Mi,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Mi,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Mi,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Mi,targetName:"Mat3"}]),lt(Mi.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Mi.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Mi.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Mi.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Mi.prototype,targetName:"Mat3"}]),lt(Vi,"Mat4",[{name:"sub",newName:"subtract",target:Vi,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Vi,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Vi,targetName:"Mat4"}]),lt(Vi.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Vi.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Vi.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Vi.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Vi.prototype,targetName:"Mat4"}]);var $i=t("AffineTransform",function(){function t(t,e,i,n,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a}return t.identity=function(){return new t},t.clone=function(e){return new t(e.a,e.b,e.c,e.d,e.tx,e.ty)},t.concat=function(t,e,i){var n=e.a,r=e.b,a=e.c,o=e.d,s=e.tx,l=e.ty;t.a=n*i.a+r*i.c,t.b=n*i.b+r*i.d,t.c=a*i.a+o*i.c,t.d=a*i.b+o*i.d,t.tx=s*i.a+l*i.c+i.tx,t.ty=s*i.b+l*i.d+i.ty},t.invert=function(t,e){var i=1/(e.a*e.d-e.b*e.c);t.a=i*e.d,t.b=-i*e.b,t.c=-i*e.c,t.d=i*e.a,t.tx=i*(e.c*e.ty-e.d*e.tx),t.ty=i*(e.b*e.tx-e.a*e.ty)},t.fromMat4=function(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13},t.transformVec2=function(t,e,i,n){var r,a;void 0===n?(n=i,r=e.x,a=e.y):(r=e,a=i),t.x=n.a*r+n.c*a+n.tx,t.y=n.b*r+n.d*a+n.ty},t.transformSize=function(t,e,i){t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height},t.transformRect=function(t,e,i){var n=e.x+e.width,r=e.y+e.height,a=i.a*e.x+i.c*e.y+i.tx,o=i.b*e.x+i.d*e.y+i.ty,s=i.a*n+i.c*e.y+i.tx,l=i.b*n+i.d*e.y+i.ty,c=i.a*e.x+i.c*r+i.tx,h=i.b*e.x+i.d*r+i.ty,u=i.a*n+i.c*r+i.tx,_=i.b*n+i.d*r+i.ty,f=Math.min(a,s,c,u),d=Math.max(a,s,c,u),p=Math.min(o,l,h,_),m=Math.max(o,l,h,_);t.x=f,t.y=p,t.width=d-f,t.height=m-p},t.transformObb=function(t,e,i,n,r,a){var o=a.a*r.x+a.c*r.y+a.tx,s=a.b*r.x+a.d*r.y+a.ty,l=a.a*r.width,c=a.b*r.width,h=a.c*r.height,u=a.d*r.height;e.x=o,e.y=s,i.x=l+o,i.y=c+s,t.x=h+o,t.y=u+s,n.x=l+h+o,n.y=c+u+s},t}());n.AffineTransform=$i;var tn=t("Size",function(t){function e(e,i){var n;return n=t.call(this)||this,e&&"object"==typeof e?(n.width=e.width,n.height=e.height):(n.width=e||0,n.height=i||0),n}Y(e,t),e.lerp=function(t,e,i,n){return t.width=e.width+(i.width-e.width)*n,t.height=e.height+(i.height-e.height)*n,t},q(e,[{key:"x",set:function(t){this.width=t},get:function(){return this.width}},{key:"y",set:function(t){this.height=t},get:function(){return this.height}}]);var i=e.prototype;return i.clone=function(){return new e(this.width,this.height)},i.set=function(t,e){return t&&"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this},i.equals=function(t){return this.width===t.width&&this.height===t.height},i.lerp=function(t,e){return this.width+=(t.width-this.width)*e,this.height+=(t.height-this.height)*e,this},i.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},e}(de));function en(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new tn(t,e)}tn.ZERO=Object.freeze(new tn(0,0)),tn.ONE=Object.freeze(new tn(1,1)),ei.fastDefine("cc.Size",tn,{width:0,height:0}),n.size=en,n.Size=tn;var nn=t("Rect",function(t){function e(e,i,n,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.y=e.y,a.width=e.width,a.height=e.height,a.x=e.x):(a.x=e||0,a.y=i||0,a.width=n||0,a.height=r||0),a}Y(e,t),e.fromMinMax=function(t,e,i){var n=Math.min(e.x,i.x),r=Math.min(e.y,i.y),a=Math.max(e.x,i.x),o=Math.max(e.y,i.y);return t.x=n,t.y=r,t.width=a-n,t.height=o-r,t},e.lerp=function(t,e,i,n){var r=e.x,a=e.y,o=e.width,s=e.height;return t.x=r+(i.x-r)*n,t.y=a+(i.y-a)*n,t.width=o+(i.width-o)*n,t.height=s+(i.height-s)*n,t},e.intersection=function(t,e,i){var n=e.x,r=e.y,a=e.x+e.width,o=e.y+e.height,s=i.x,l=i.y,c=i.x+i.width,h=i.y+i.height;return t.x=Math.max(n,s),t.y=Math.max(r,l),t.width=Math.min(a,c)-t.x,t.height=Math.min(o,h)-t.y,t},e.union=function(t,e,i){var n=e.x,r=e.y,a=e.width,o=e.height,s=i.x,l=i.y,c=i.width,h=i.height;return t.x=Math.min(n,s),t.y=Math.min(r,l),t.width=Math.max(n+a,s+c)-t.x,t.height=Math.max(r+o,l+h)-t.y,t},q(e,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new Xi(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new Xi(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new tn(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",set:function(t){this.width=t},get:function(){return this.width}},{key:"w",set:function(t){this.height=t},get:function(){return this.height}}]);var i=e.prototype;return i.clone=function(){return new e(this.x,this.y,this.width,this.height)},i.set=function(t,e,i,n){return t&&"object"==typeof t?(this.y=t.y,this.width=t.width,this.height=t.height,this.x=t.x):(this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0),this},i.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},i.lerp=function(t,e){var i=this.x,n=this.y,r=this.width,a=this.height;return this.x=i+(t.x-i)*e,this.y=n+(t.y-n)*e,this.width=r+(t.width-r)*e,this.height=a+(t.height-a)*e,this},i.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},i.intersects=function(t){var e=this.x+this.width,i=this.y+this.height,n=t.x+t.width,r=t.y+t.height;return!(e<t.x||n<this.x||i<t.y||r<this.y)},i.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},i.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},i.transformMat4=function(t){var e=this.x,i=this.y,n=e+this.width,r=i+this.height,a=t.m00*e+t.m04*i+t.m12,o=t.m01*e+t.m05*i+t.m13,s=t.m00*n+t.m04*i+t.m12,l=t.m01*n+t.m05*i+t.m13,c=t.m00*e+t.m04*r+t.m12,h=t.m01*e+t.m05*r+t.m13,u=t.m00*n+t.m04*r+t.m12,_=t.m01*n+t.m05*r+t.m13,f=Math.min(a,s,c,u),d=Math.max(a,s,c,u),p=Math.min(o,l,h,_),m=Math.max(o,l,h,_);return this.x=f,this.y=p,this.width=d-f,this.height=m-p,this},i.transformMat4ToPoints=function(t,e,i,n,r){var a=this.x,o=this.y,s=a+this.width,l=o+this.height;e.x=t.m00*a+t.m04*o+t.m12,e.y=t.m01*a+t.m05*o+t.m13,r.x=t.m00*s+t.m04*o+t.m12,r.y=t.m01*s+t.m05*o+t.m13,i.x=t.m00*a+t.m04*l+t.m12,i.y=t.m01*a+t.m05*l+t.m13,n.x=t.m00*s+t.m04*l+t.m12,n.y=t.m01*s+t.m05*l+t.m13},e}(de));function rn(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),new nn(t,e,i,n)}ei.fastDefine("cc.Rect",nn,{x:0,y:0,width:0,height:0}),n.Rect=nn,n.rect=rn;var an=Object.freeze({__proto__:null,bits:st,Vec2:Xi,v2:Zi,Vec3:Ri,v3:Pi,Vec4:Qi,v4:Ji,Quat:Li,quat:Gi,Mat3:Mi,Mat4:Vi,mat4:qi,AffineTransform:$i,Size:tn,size:en,Rect:nn,rect:rn,Color:Ci,color:wi,EPSILON:oi,equals:si,approx:li,clamp:ci,clamp01:hi,lerp:ui,toRadian:_i,toDegree:fi,random:di,randomRange:pi,randomRangeInt:mi,pseudoRandom:vi,pseudoRandomRange:gi,pseudoRandomRangeInt:yi,nextPow2:Ti,repeat:Si,pingPong:Ei,inverseLerp:Ai,absMaxComponent:bi,absMax:xi});t("math",an);var on,sn,ln,cn,hn,un,_n,fn,dn,pn,mn,vn,gn,yn,Tn,Sn,En,An,bn,xn,Cn,wn,Rn,In,On=function(){function t(t,e,i){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=i*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}(),Pn=function(){},Mn=function(){function t(){}var e=t.prototype;return e.alloc=function(t,e){return new ArrayBuffer(e)},e.free=function(){},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(In||(In={}));var Dn,Nn=function(){function t(t,e,i,n){void 0===n&&(n=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=i.COUNT,this._entryBits=n,this._dataType=e,this._stride=4*this._elementCount,this._entriesPerChunk=1<<n,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new On(t,n,this._stride);var r=In.NEVER,a=!1,o=!1;for(var s in e){if(a=this._hasFloat32,(o=this._hasUint32)&&a)break;r=e[s],a||r!==In.FLOAT32?o||r!==In.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freelists.length;t++){var e=this._freelists[t];if(e.length){var i=e[e.length-1];return e.length--,(t<<this._entryBits)+i+this._poolFlag}}for(var n=this._nativePool.allocateNewChunk(),r=[],a=[],o=[],s=this._hasFloat32,l=this._hasUint32,c=0;c<this._entriesPerChunk;c++)s&&r.push(new Float32Array(n,this._stride*c,this._elementCount)),l&&a.push(new Uint32Array(n,this._stride*c,this._elementCount)),c&&o.push(c);return this._arrayBuffers.push(n),l&&this._uint32BufferViews.push(a),s&&this._float32BufferViews.push(r),this._freelists.push(o),(t<<this._entryBits)+this._poolFlag},e.get=function(t,e){var i=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;return(this._dataType[e]===In.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][n][e]},e.set=function(t,e,i){var n=(this._chunkMask&t)>>this._entryBits,r=this._entryMask&t;(this._dataType[e]===In.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][r][e]=i},e.setVec2=function(){},e.setVec3=function(){},e.setVec4=function(){},e.setMat4=function(){},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][i].fill(0),this._freelists[e].push(i)},t}(),Ln=function(){function t(t,e,i){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=e,i&&(this._dtor=i),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new Pn(t,this._array)}var e=t.prototype;return e.alloc=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=this._freelist,r=-1;if(n.length)r=n[n.length-1],n.length--,this._array[r]=this._ctor(arguments,this._array[r]);else{r=this._array.length;var a=this._ctor(arguments);if(!a)return 0;this._array.push(a)}return r+this._poolFlag},e.get=function(t){var e=this._indexMask&t;return this._array[e]},e.free=function(t){var e=this._indexMask&t;this._dtor&&(this._array[e]=this._dtor(this._array[e])),this._freelist.push(e)},t}(),Bn=function(){function t(t){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new Mn(t)}var e=t.prototype;return e.alloc=function(t){var e=this._nextBufferIdx++,i=this._nativeBufferAllocator.alloc(e,t);return this._buffers.set(e,i),e|this._poolFlag},e.free=function(t){var e=this._bufferIdxMask&t;this._buffers.get(e)&&(this._nativeBufferAllocator.free(e),this._buffers.delete(e))},e.getBuffer=function(t){var e=this._bufferIdxMask&t;return this._buffers.get(e)||null},t}(),Fn=function(t){function e(e,i,n,r){var a;return(a=t.call(this,e)||this)._viewCtor=void 0,a._size=void 0,a._step=void 0,a._viewCtor=i,a._size=n*i.BYTES_PER_ELEMENT,a._step=r||n,a}Y(e,t);var i=e.prototype;return i.alloc=function(){var t=this._nextBufferIdx++,e=this._nativeBufferAllocator.alloc(t,this._size);return this._buffers.set(t,new this._viewCtor(e)),t|this._poolFlag},i.getBuffer=function(){return null},i.assign=function(t,e,i){var n=this._bufferIdxMask&t,r=this._buffers.get(n);if(r){var a=e+1;if(a>=r.length){for(var o=r.length;a>=o;)o+=this._step;o*=this._viewCtor.BYTES_PER_ELEMENT;var s=new this._viewCtor(this._nativeBufferAllocator.alloc(n,o));s.set(r),r=s,this._buffers.set(n,r)}r[a]=i;var l=r[0];r[0]=a>l?a:l}},i.erase=function(t,e){var i=this._bufferIdxMask&t,n=this._buffers.get(i);if(n&&!(e>=n[0])){for(var r=e+1;r<n[0];++r)n[r]=n[r+1];--n[0]}},i.push=function(t,e){var i=this._bufferIdxMask&t,n=this._buffers.get(i);n&&this.assign(t,n[0],e)},i.pop=function(t){var e=this._bufferIdxMask&t,i=this._buffers.get(e);i&&0!==i[0]&&--i[0]},i.clear=function(t){var e=this._bufferIdxMask&t,i=this._buffers.get(e);i&&(i[0]=0)},i.get=function(t,e){var i=this._bufferIdxMask&t,n=this._buffers.get(i);return!n||e>=n[0]?0:n[e+1]},i.length=function(t){var e=this._bufferIdxMask&t,i=this._buffers.get(e);return i?i[0]:0},e}(Bn);function zn(t,e,i,n){void 0===n&&(n=!0);for(var r=e.length(t),a=0;a<r;a++){var o=e.get(t,a);o&&i.free(o)}n?e.free(t):e.clear(t)}!function(t){t[t.ATTRIBUTE=0]="ATTRIBUTE",t[t.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",t[t.SHADER=2]="SHADER",t[t.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",t[t.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",t[t.FRAMEBUFFER=5]="FRAMEBUFFER",t[t.PASS=100]="PASS",t[t.SUB_MODEL=101]="SUB_MODEL",t[t.MODEL=102]="MODEL",t[t.SCENE=103]="SCENE",t[t.CAMERA=104]="CAMERA",t[t.NODE=105]="NODE",t[t.ROOT=106]="ROOT",t[t.AABB=107]="AABB",t[t.RENDER_WINDOW=108]="RENDER_WINDOW",t[t.FRUSTUM=109]="FRUSTUM",t[t.AMBIENT=110]="AMBIENT",t[t.FOG=111]="FOG",t[t.SKYBOX=112]="SKYBOX",t[t.SHADOW=113]="SHADOW",t[t.LIGHT=114]="LIGHT",t[t.SPHERE=115]="SPHERE",t[t.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",t[t.FLAT_BUFFER=117]="FLAT_BUFFER",t[t.SUB_MESH=118]="SUB_MESH",t[t.RASTERIZER_STATE=119]="RASTERIZER_STATE",t[t.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",t[t.BLEND_TARGET=121]="BLEND_TARGET",t[t.BLEND_STATE=122]="BLEND_STATE",t[t.BATCH_2D=123]="BATCH_2D",t[t.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",t[t.MODEL_ARRAY=201]="MODEL_ARRAY",t[t.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",t[t.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",t[t.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",t[t.LIGHT_ARRAY=205]="LIGHT_ARRAY",t[t.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",t[t.BATCH_ARRAY_2D=207]="BATCH_ARRAY_2D",t[t.RAW_BUFFER=300]="RAW_BUFFER",t[t.RAW_OBJECT=400]="RAW_OBJECT"}(Dn||(Dn={}));var Un,kn=new Ln(Dn.SHADER,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createShader(t[1])}),(function(t){return t&&t.destroy(),t})),Gn=new Ln(Dn.DESCRIPTOR_SETS,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createDescriptorSet(t[1])}),(function(t){return t&&t.destroy(),t})),Hn=new Ln(Dn.INPUT_ASSEMBLER,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createInputAssembler(t[1])}),(function(t){return t&&t.destroy(),t})),Vn=new Ln(Dn.PIPELINE_LAYOUT,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createPipelineLayout(t[1])}),(function(t){return t&&t.destroy(),t})),Wn=new Ln(Dn.FRAMEBUFFER,(function(t,e){return e?(e.initialize(t[1]),e):t[0].createFramebuffer(t[1])}),(function(t){return t&&t.destroy(),t})),jn=new Fn(Dn.SUB_MODEL_ARRAY,Uint32Array,8,4),qn=new Fn(Dn.MODEL_ARRAY,Uint32Array,32,16),Xn=new Fn(Dn.ATTRIBUTE_ARRAY,Uint32Array,8,4),Yn=new Fn(Dn.FLAT_BUFFER_ARRAY,Uint32Array,8,4),Kn=new Fn(Dn.LIGHT_ARRAY,Uint32Array,8,4),Zn=new Fn(Dn.BLEND_TARGET_ARRAY,Uint32Array,8,4),Qn=new Fn(Dn.BATCH_ARRAY_2D,Uint32Array,32,16),Jn=new Bn(Dn.RAW_BUFFER),$n=new Ln(Dn.RAW_OBJECT,(function(t){return t[0]||{}}),(function(){}));!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.BATCHING_SCHEME=3]="BATCHING_SCHEME",t[t.PRIMITIVE=4]="PRIMITIVE",t[t.DYNAMIC_STATES=5]="DYNAMIC_STATES",t[t.HASH=6]="HASH",t[t.RASTERIZER_STATE=7]="RASTERIZER_STATE",t[t.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",t[t.BLEND_STATE=9]="BLEND_STATE",t[t.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",t[t.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",t[t.COUNT=12]="COUNT"}(Un||(Un={}));var tr,er=((on={})[Un.PRIORITY]=In.UINT32,on[Un.STAGE]=In.UINT32,on[Un.PHASE]=In.UINT32,on[Un.BATCHING_SCHEME]=In.UINT32,on[Un.PRIMITIVE]=In.UINT32,on[Un.DYNAMIC_STATES]=In.UINT32,on[Un.HASH]=In.UINT32,on[Un.RASTERIZER_STATE]=In.UINT32,on[Un.DEPTH_STENCIL_STATE]=In.UINT32,on[Un.BLEND_STATE]=In.UINT32,on[Un.DESCRIPTOR_SET]=In.UINT32,on[Un.PIPELINE_LAYOUT]=In.UINT32,on[Un.COUNT]=In.NEVER,on),ir=new Nn(Dn.PASS,er,Un);!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.PASS_COUNT=1]="PASS_COUNT",t[t.PASS_0=2]="PASS_0",t[t.PASS_1=3]="PASS_1",t[t.PASS_2=4]="PASS_2",t[t.PASS_3=5]="PASS_3",t[t.SHADER_0=6]="SHADER_0",t[t.SHADER_1=7]="SHADER_1",t[t.SHADER_2=8]="SHADER_2",t[t.SHADER_3=9]="SHADER_3",t[t.PLANAR_SHADER=10]="PLANAR_SHADER",t[t.PLANAR_INSTANCE_SHADER=11]="PLANAR_INSTANCE_SHADER",t[t.DESCRIPTOR_SET=12]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=13]="INPUT_ASSEMBLER",t[t.SUB_MESH=14]="SUB_MESH",t[t.COUNT=15]="COUNT"}(tr||(tr={}));var nr,rr=((sn={})[tr.PRIORITY]=In.UINT32,sn[tr.PASS_COUNT]=In.UINT32,sn[tr.PASS_0]=In.UINT32,sn[tr.PASS_1]=In.UINT32,sn[tr.PASS_2]=In.UINT32,sn[tr.PASS_3]=In.UINT32,sn[tr.SHADER_0]=In.UINT32,sn[tr.SHADER_1]=In.UINT32,sn[tr.SHADER_2]=In.UINT32,sn[tr.SHADER_3]=In.UINT32,sn[tr.PLANAR_SHADER]=In.UINT32,sn[tr.PLANAR_INSTANCE_SHADER]=In.UINT32,sn[tr.DESCRIPTOR_SET]=In.UINT32,sn[tr.INPUT_ASSEMBLER]=In.UINT32,sn[tr.SUB_MESH]=In.UINT32,sn[tr.COUNT]=In.NEVER,sn),ar=new Nn(Dn.SUB_MODEL,rr,tr);!function(t){t[t.ENABLED=0]="ENABLED",t[t.VIS_FLAGS=1]="VIS_FLAGS",t[t.CAST_SHADOW=2]="CAST_SHADOW",t[t.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",t[t.WORLD_BOUNDS=4]="WORLD_BOUNDS",t[t.NODE=5]="NODE",t[t.TRANSFORM=6]="TRANSFORM",t[t.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",t[t.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",t[t.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",t[t.COUNT=10]="COUNT"}(nr||(nr={}));var or,sr=((ln={})[nr.ENABLED]=In.UINT32,ln[nr.VIS_FLAGS]=In.UINT32,ln[nr.CAST_SHADOW]=In.UINT32,ln[nr.RECEIVE_SHADOW]=In.UINT32,ln[nr.WORLD_BOUNDS]=In.UINT32,ln[nr.NODE]=In.UINT32,ln[nr.TRANSFORM]=In.UINT32,ln[nr.SUB_MODEL_ARRAY]=In.UINT32,ln[nr.INSTANCED_BUFFER]=In.UINT32,ln[nr.INSTANCED_ATTR_ARRAY]=In.UINT32,ln[nr.COUNT]=In.NEVER,ln),lr=new Nn(Dn.MODEL,sr,nr);!function(t){t[t.VIS_FLAGS=0]="VIS_FLAGS",t[t.PASS_COUNT=1]="PASS_COUNT",t[t.PASS_0=2]="PASS_0",t[t.PASS_1=3]="PASS_1",t[t.PASS_2=4]="PASS_2",t[t.PASS_3=5]="PASS_3",t[t.SHADER_0=6]="SHADER_0",t[t.SHADER_1=7]="SHADER_1",t[t.SHADER_2=8]="SHADER_2",t[t.SHADER_3=9]="SHADER_3",t[t.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",t[t.COUNT=12]="COUNT"}(or||(or={}));var cr,hr=((cn={})[or.VIS_FLAGS]=In.UINT32,cn[or.PASS_COUNT]=In.UINT32,cn[or.PASS_0]=In.UINT32,cn[or.PASS_1]=In.UINT32,cn[or.PASS_2]=In.UINT32,cn[or.PASS_3]=In.UINT32,cn[or.SHADER_0]=In.UINT32,cn[or.SHADER_1]=In.UINT32,cn[or.SHADER_2]=In.UINT32,cn[or.SHADER_3]=In.UINT32,cn[or.DESCRIPTOR_SET]=In.UINT32,cn[or.INPUT_ASSEMBLER]=In.UINT32,cn[or.COUNT]=In.NEVER,cn),ur=new Nn(Dn.BATCH_2D,hr,or);!function(t){t[t.CENTER=0]="CENTER",t[t.HALF_EXTENSION=3]="HALF_EXTENSION",t[t.COUNT=6]="COUNT"}(cr||(cr={}));var _r,fr=((hn={})[cr.CENTER]=In.FLOAT32,hn[cr.HALF_EXTENSION]=In.FLOAT32,hn[cr.COUNT]=In.NEVER,hn),dr=new Nn(Dn.AABB,fr,cr);!function(t){t[t.MAIN_LIGHT=0]="MAIN_LIGHT",t[t.MODEL_ARRAY=1]="MODEL_ARRAY",t[t.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",t[t.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",t[t.BATCH_ARRAY_2D=4]="BATCH_ARRAY_2D",t[t.COUNT=5]="COUNT"}(_r||(_r={}));var pr,mr=((un={})[_r.MAIN_LIGHT]=In.UINT32,un[_r.MODEL_ARRAY]=In.UINT32,un[_r.SPHERE_LIGHT_ARRAY]=In.UINT32,un[_r.SPOT_LIGHT_ARRAY]=In.UINT32,un[_r.BATCH_ARRAY_2D]=In.UINT32,un[_r.COUNT]=In.NEVER,un),vr=new Nn(Dn.SCENE,mr,_r);!function(t){t[t.WIDTH=0]="WIDTH",t[t.HEIGHT=1]="HEIGHT",t[t.EXPOSURE=2]="EXPOSURE",t[t.CLEAR_FLAG=3]="CLEAR_FLAG",t[t.CLEAR_DEPTH=4]="CLEAR_DEPTH",t[t.CLEAR_STENCIL=5]="CLEAR_STENCIL",t[t.VISIBILITY=6]="VISIBILITY",t[t.NODE=7]="NODE",t[t.SCENE=8]="SCENE",t[t.FRUSTUM=9]="FRUSTUM",t[t.WINDOW=10]="WINDOW",t[t.FORWARD=11]="FORWARD",t[t.POSITION=14]="POSITION",t[t.VIEW_PORT=17]="VIEW_PORT",t[t.CLEAR_COLOR=21]="CLEAR_COLOR",t[t.MAT_VIEW=25]="MAT_VIEW",t[t.MAT_VIEW_PROJ=41]="MAT_VIEW_PROJ",t[t.MAT_VIEW_PROJ_INV=57]="MAT_VIEW_PROJ_INV",t[t.MAT_PROJ=73]="MAT_PROJ",t[t.MAT_PROJ_INV=89]="MAT_PROJ_INV",t[t.COUNT=105]="COUNT"}(pr||(pr={}));var gr,yr=((_n={})[pr.WIDTH]=In.UINT32,_n[pr.HEIGHT]=In.UINT32,_n[pr.EXPOSURE]=In.FLOAT32,_n[pr.CLEAR_FLAG]=In.UINT32,_n[pr.CLEAR_DEPTH]=In.FLOAT32,_n[pr.CLEAR_STENCIL]=In.UINT32,_n[pr.VISIBILITY]=In.UINT32,_n[pr.NODE]=In.UINT32,_n[pr.SCENE]=In.UINT32,_n[pr.FRUSTUM]=In.UINT32,_n[pr.WINDOW]=In.UINT32,_n[pr.FORWARD]=In.FLOAT32,_n[pr.POSITION]=In.FLOAT32,_n[pr.VIEW_PORT]=In.FLOAT32,_n[pr.CLEAR_COLOR]=In.FLOAT32,_n[pr.MAT_VIEW]=In.FLOAT32,_n[pr.MAT_VIEW_PROJ]=In.FLOAT32,_n[pr.MAT_VIEW_PROJ_INV]=In.FLOAT32,_n[pr.MAT_PROJ]=In.FLOAT32,_n[pr.MAT_PROJ_INV]=In.FLOAT32,_n[pr.COUNT]=In.NEVER,_n),Tr=new Nn(Dn.CAMERA,yr,pr);!function(t){t[t.FLAGS_CHANGED=0]="FLAGS_CHANGED",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.COUNT=28]="COUNT"}(gr||(gr={}));var Sr=((fn={})[gr.FLAGS_CHANGED]=In.UINT32,fn[gr.LAYER]=In.UINT32,fn[gr.WORLD_SCALE]=In.FLOAT32,fn[gr.WORLD_POSITION]=In.FLOAT32,fn[gr.WORLD_ROTATION]=In.FLOAT32,fn[gr.WORLD_MATRIX]=In.FLOAT32,fn[gr.COUNT]=In.NEVER,fn);delete gr[gr.COUNT],gr[gr.COUNT=gr.LAYER+1]="COUNT";var Er,Ar=new Nn(Dn.NODE,Sr,gr);!function(t){t[t.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",t[t.FRAME_TIME=1]="FRAME_TIME",t[t.COUNT=2]="COUNT"}(Er||(Er={}));var br,xr=((dn={})[Er.CUMULATIVE_TIME]=In.FLOAT32,dn[Er.FRAME_TIME]=In.FLOAT32,dn[Er.COUNT]=In.NEVER,dn),Cr=new Nn(Dn.ROOT,xr,Er,1);!function(t){t[t.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",t[t.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",t[t.FRAMEBUFFER=2]="FRAMEBUFFER",t[t.COUNT=3]="COUNT"}(br||(br={}));var wr,Rr=((pn={})[br.HAS_ON_SCREEN_ATTACHMENTS]=In.UINT32,pn[br.HAS_OFF_SCREEN_ATTACHMENTS]=In.UINT32,pn[br.FRAMEBUFFER]=In.UINT32,pn[br.COUNT]=In.NEVER,pn),Ir=new Nn(Dn.RENDER_WINDOW,Rr,br,2);!function(t){t[t.VERTICES=0]="VERTICES",t[t.PLANES=24]="PLANES",t[t.COUNT=48]="COUNT"}(wr||(wr={}));var Or,Pr=((mn={})[wr.VERTICES]=In.FLOAT32,mn[wr.PLANES]=In.FLOAT32,mn[wr.COUNT]=In.NEVER,mn),Mr=new Nn(Dn.FRUSTUM,Pr,wr);!function(t){t[t.ENABLE=0]="ENABLE",t[t.ILLUM=1]="ILLUM",t[t.SKY_COLOR=2]="SKY_COLOR",t[t.GROUND_ALBEDO=6]="GROUND_ALBEDO",t[t.COUNT=10]="COUNT"}(Or||(Or={}));var Dr=((vn={})[Or.ENABLE]=In.UINT32,vn[Or.ILLUM]=In.FLOAT32,vn[Or.SKY_COLOR]=In.FLOAT32,vn[Or.GROUND_ALBEDO]=In.FLOAT32,vn[Or.COUNT]=In.NEVER,vn);delete Or[Or.COUNT],Or[Or.COUNT=Or.ILLUM+1]="COUNT";var Nr,Lr=new Nn(Dn.AMBIENT,Dr,Or,1);!function(t){t[t.ENABLE=0]="ENABLE",t[t.IS_RGBE=1]="IS_RGBE",t[t.USE_IBL=2]="USE_IBL",t[t.MODEL=3]="MODEL",t[t.COUNT=4]="COUNT"}(Nr||(Nr={}));var Br,Fr=((gn={})[Nr.ENABLE]=In.UINT32,gn[Nr.IS_RGBE]=In.UINT32,gn[Nr.USE_IBL]=In.UINT32,gn[Nr.MODEL]=In.UINT32,gn[Nr.COUNT]=In.NEVER,gn),zr=new Nn(Dn.SKYBOX,Fr,Nr,1);!function(t){t[t.ENABLE=0]="ENABLE",t[t.TYPE=1]="TYPE",t[t.DENSITY=2]="DENSITY",t[t.START=3]="START",t[t.END=4]="END",t[t.ATTEN=5]="ATTEN",t[t.TOP=6]="TOP",t[t.RANGE=7]="RANGE",t[t.COLOR=8]="COLOR",t[t.COUNT=12]="COUNT"}(Br||(Br={}));var Ur=((yn={})[Br.ENABLE]=In.UINT32,yn[Br.TYPE]=In.UINT32,yn[Br.DENSITY]=In.FLOAT32,yn[Br.START]=In.FLOAT32,yn[Br.END]=In.FLOAT32,yn[Br.ATTEN]=In.FLOAT32,yn[Br.TOP]=In.FLOAT32,yn[Br.RANGE]=In.FLOAT32,yn[Br.COLOR]=In.FLOAT32,yn[Br.COUNT]=In.NEVER,yn);delete Br[Br.COUNT],Br[Br.COUNT=Br.RANGE+1]="COUNT";var kr,Gr=new Nn(Dn.FOG,Ur,Br);!function(t){t[t.ENABLE=0]="ENABLE",t[t.DIRTY=1]="DIRTY",t[t.TYPE=2]="TYPE",t[t.DISTANCE=3]="DISTANCE",t[t.INSTANCE_PASS=4]="INSTANCE_PASS",t[t.PLANAR_PASS=5]="PLANAR_PASS",t[t.NEAR=6]="NEAR",t[t.FAR=7]="FAR",t[t.ASPECT=8]="ASPECT",t[t.PCF_TYPE=9]="PCF_TYPE",t[t.SHADOW_MAP_DIRTY=10]="SHADOW_MAP_DIRTY",t[t.BIAS=11]="BIAS",t[t.ORTHO_SIZE=12]="ORTHO_SIZE",t[t.AUTO_ADAPT=13]="AUTO_ADAPT",t[t.COLOR=14]="COLOR",t[t.SIZE=18]="SIZE",t[t.NORMAL=20]="NORMAL",t[t.MAT_LIGHT=23]="MAT_LIGHT",t[t.COUNT=39]="COUNT"}(kr||(kr={}));var Hr=((Tn={})[kr.ENABLE]=In.UINT32,Tn[kr.DIRTY]=In.UINT32,Tn[kr.TYPE]=In.UINT32,Tn[kr.DISTANCE]=In.FLOAT32,Tn[kr.INSTANCE_PASS]=In.UINT32,Tn[kr.PLANAR_PASS]=In.UINT32,Tn[kr.NEAR]=In.FLOAT32,Tn[kr.FAR]=In.FLOAT32,Tn[kr.ASPECT]=In.FLOAT32,Tn[kr.PCF_TYPE]=In.UINT32,Tn[kr.SHADOW_MAP_DIRTY]=In.UINT32,Tn[kr.BIAS]=In.FLOAT32,Tn[kr.ORTHO_SIZE]=In.FLOAT32,Tn[kr.AUTO_ADAPT]=In.UINT32,Tn[kr.COLOR]=In.FLOAT32,Tn[kr.SIZE]=In.FLOAT32,Tn[kr.NORMAL]=In.FLOAT32,Tn[kr.MAT_LIGHT]=In.FLOAT32,Tn[kr.COUNT]=In.NEVER,Tn);delete kr[kr.COUNT],kr[kr.COUNT=kr.AUTO_ADAPT+1]="COUNT";var Vr,Wr=new Nn(Dn.SHADOW,Hr,kr,1);!function(t){t[t.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",t[t.ILLUMINANCE=1]="ILLUMINANCE",t[t.NODE=2]="NODE",t[t.RANGE=3]="RANGE",t[t.TYPE=4]="TYPE",t[t.AABB=5]="AABB",t[t.FRUSTUM=6]="FRUSTUM",t[t.SIZE=7]="SIZE",t[t.SPOT_ANGLE=8]="SPOT_ANGLE",t[t.ASPECT=9]="ASPECT",t[t.DIRECTION=10]="DIRECTION",t[t.COLOR=13]="COLOR",t[t.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",t[t.POSITION=19]="POSITION",t[t.COUNT=22]="COUNT"}(Vr||(Vr={}));var jr,qr=((Sn={})[Vr.USE_COLOR_TEMPERATURE]=In.UINT32,Sn[Vr.ILLUMINANCE]=In.FLOAT32,Sn[Vr.NODE]=In.UINT32,Sn[Vr.RANGE]=In.FLOAT32,Sn[Vr.TYPE]=In.UINT32,Sn[Vr.AABB]=In.UINT32,Sn[Vr.FRUSTUM]=In.UINT32,Sn[Vr.SIZE]=In.FLOAT32,Sn[Vr.SPOT_ANGLE]=In.FLOAT32,Sn[Vr.ASPECT]=In.FLOAT32,Sn[Vr.DIRECTION]=In.FLOAT32,Sn[Vr.COLOR]=In.FLOAT32,Sn[Vr.COLOR_TEMPERATURE_RGB]=In.FLOAT32,Sn[Vr.POSITION]=In.FLOAT32,Sn[Vr.COUNT]=In.NEVER,Sn),Xr=new Nn(Dn.LIGHT,qr,Vr,3);!function(t){t[t.RADIUS=0]="RADIUS",t[t.CENTER=1]="CENTER",t[t.COUNT=4]="COUNT"}(jr||(jr={}));var Yr=((En={})[jr.RADIUS]=In.FLOAT32,En[jr.CENTER]=In.FLOAT32,En[jr.COUNT]=In.NEVER,En);delete jr[jr.COUNT],jr[jr.COUNT=jr.RADIUS+1]="COUNT";var Kr,Zr=new Nn(Dn.SPHERE,Yr,jr,3);!function(t){t[t.STRIDE=0]="STRIDE",t[t.AMOUNT=1]="AMOUNT",t[t.BUFFER=2]="BUFFER",t[t.COUNT=3]="COUNT"}(Kr||(Kr={}));var Qr,Jr=((An={})[Kr.STRIDE]=In.UINT32,An[Kr.AMOUNT]=In.UINT32,An[Kr.BUFFER]=In.UINT32,An[Kr.COUNT]=In.NEVER,An),$r=new Nn(Dn.FLAT_BUFFER,Jr,Kr,3);!function(t){t[t.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",t[t.COUNT=1]="COUNT"}(Qr||(Qr={}));var ta,ea=((bn={})[Qr.FLAT_BUFFER_ARRAY]=In.UINT32,bn[Qr.COUNT]=In.NEVER,bn),ia=new Nn(Dn.SUB_MESH,ea,Qr,3);!function(t){t[t.IS_DISCARD=0]="IS_DISCARD",t[t.POLYGO_MODEL=1]="POLYGO_MODEL",t[t.SHADE_MODEL=2]="SHADE_MODEL",t[t.CULL_MODE=3]="CULL_MODE",t[t.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",t[t.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",t[t.DEPTH_BIAS=6]="DEPTH_BIAS",t[t.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",t[t.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",t[t.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",t[t.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",t[t.LINE_WIDTH=11]="LINE_WIDTH",t[t.COUNT=12]="COUNT"}(ta||(ta={}));var na,ra=((xn={})[ta.IS_DISCARD]=In.UINT32,xn[ta.POLYGO_MODEL]=In.UINT32,xn[ta.SHADE_MODEL]=In.UINT32,xn[ta.CULL_MODE]=In.UINT32,xn[ta.IS_FRONT_FACE_CCW]=In.UINT32,xn[ta.DEPTH_BIAS_ENABLED]=In.UINT32,xn[ta.DEPTH_BIAS]=In.FLOAT32,xn[ta.DEPTH_BIAS_CLAMP]=In.FLOAT32,xn[ta.DEPTH_BIAS_SLOP]=In.FLOAT32,xn[ta.IS_DEPTH_CLIP]=In.UINT32,xn[ta.IS_MULTI_SAMPLE]=In.UINT32,xn[ta.LINE_WIDTH]=In.FLOAT32,xn[ta.COUNT]=In.NEVER,xn),aa=new Nn(Dn.RASTERIZER_STATE,ra,ta,9);!function(t){t[t.DEPTH_TEST=0]="DEPTH_TEST",t[t.DEPTH_WRITE=1]="DEPTH_WRITE",t[t.DEPTH_FUNC=2]="DEPTH_FUNC",t[t.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",t[t.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",t[t.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",t[t.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",t[t.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",t[t.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",t[t.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",t[t.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",t[t.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",t[t.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",t[t.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",t[t.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",t[t.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",t[t.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",t[t.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",t[t.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",t[t.COUNT=19]="COUNT"}(na||(na={}));var oa,sa=((Cn={})[na.DEPTH_TEST]=In.UINT32,Cn[na.DEPTH_WRITE]=In.UINT32,Cn[na.DEPTH_FUNC]=In.UINT32,Cn[na.STENCIL_TEST_FRONT]=In.UINT32,Cn[na.STENCIL_FUNC_FRONT]=In.UINT32,Cn[na.STENCIL_READ_MASK_FRONT]=In.UINT32,Cn[na.STENCIL_WRITE_MASK_FRONT]=In.UINT32,Cn[na.STENCIL_FAIL_OP_FRONT]=In.UINT32,Cn[na.STENCIL_Z_FAIL_OP_FRONT]=In.UINT32,Cn[na.STENCIL_PASS_OP_FRONT]=In.UINT32,Cn[na.STENCIL_REF_FRONT]=In.UINT32,Cn[na.STENCIL_TEST_BACK]=In.UINT32,Cn[na.STENCIL_FUNC_BACK]=In.UINT32,Cn[na.STENCIL_READ_MADK_BACK]=In.UINT32,Cn[na.STENCIL_WRITE_MASK_BACK]=In.UINT32,Cn[na.STENCIL_FAIL_OP_BACK]=In.UINT32,Cn[na.STENCIL_Z_FAIL_OP_BACK]=In.UINT32,Cn[na.STENCIL_PASS_OP_BACK]=In.UINT32,Cn[na.STENCIL_REF_BACK]=In.UINT32,Cn[na.COUNT]=In.NEVER,Cn),la=new Nn(Dn.DEPTH_STENCIL_STATE,sa,na,9);!function(t){t[t.BLEND=0]="BLEND",t[t.BLEND_SRC=1]="BLEND_SRC",t[t.BLEND_DST=2]="BLEND_DST",t[t.BLEND_EQ=3]="BLEND_EQ",t[t.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",t[t.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",t[t.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",t[t.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",t[t.COUNT=8]="COUNT"}(oa||(oa={})),(wn={})[oa.BLEND]=In.UINT32,wn[oa.BLEND_SRC]=In.UINT32,wn[oa.BLEND_DST]=In.UINT32,wn[oa.BLEND_EQ]=In.UINT32,wn[oa.BLEND_SRC_ALPHA]=In.UINT32,wn[oa.BLEND_DST_ALPHA]=In.UINT32,wn[oa.BLEND_ALPHA_EQ]=In.UINT32,wn[oa.BLEND_COLOR_MASK]=In.UINT32,wn[oa.COUNT]=In.NEVER;var ca,ha=new Nn(Dn.BLEND_TARGET,sa,oa,9);!function(t){t[t.IS_A2C=0]="IS_A2C",t[t.IS_INDEPEND=1]="IS_INDEPEND",t[t.BLEND_COLOR=2]="BLEND_COLOR",t[t.BLEND_TARGET=6]="BLEND_TARGET",t[t.COUNT=7]="COUNT"}(ca||(ca={}));var ua=((Rn={})[ca.IS_A2C]=In.UINT32,Rn[ca.IS_INDEPEND]=In.UINT32,Rn[ca.BLEND_COLOR]=In.FLOAT32,Rn[ca.BLEND_TARGET]=In.UINT32,Rn[ca.COUNT]=In.NEVER,Rn),_a=new Nn(Dn.BLEND_STATE,ua,ca,9),fa=function(){function t(){this._skyColor=new Ci(51,128,204,1),this._groundAlbedo=new Ci(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=0,this._handle=Lr.alloc()}q(t,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",set:function(t){Lr.set(this._handle,Or.ENABLE,t?1:0)},get:function(){return Lr.get(this._handle,Or.ENABLE)}},{key:"skyColor",get:function(){return this._skyColor},set:function(t){this._skyColor.set(t),Ci.toArray(this._colorArray,this._skyColor),Lr.setVec4(this._handle,Or.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return Lr.get(this._handle,Or.ILLUM)},set:function(t){Lr.set(this._handle,Or.ILLUM,t)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(t){this._groundAlbedo.set(t),Ri.toArray(this._albedoArray,this._groundAlbedo),Lr.setVec4(this._handle,Or.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){this._skyColor.set(t.skyColor),this._groundAlbedo.set(t.groundAlbedo),Ci.toArray(this._colorArray,this._skyColor),Ri.toArray(this._albedoArray,this._groundAlbedo),Lr.setVec4(this._handle,Or.SKY_COLOR,this._skyColor),Lr.setVec4(this._handle,Or.GROUND_ALBEDO,this._groundAlbedo),Lr.set(this._handle,Or.ILLUM,t.skyIllum)},e.destroy=function(){this._handle&&(Lr.free(this._handle),this._handle=0)},t}();fa.SUN_ILLUM=65e3,fa.SKY_ILLUM=2e4,n.Ambient=fa;var da=new Ri,pa=new Ri,ma=new Ri,va=new Ri,ga=new Ri,ya=new Ri,Ta=new Array(3),Sa=new Array(3);function Ea(t,e){return Ri.dot(e.n,t)-e.d}function Aa(t,e,i){return Ri.copy(t,e),Ri.subtract(ga,i.center,i.halfExtents),Ri.add(ya,i.center,i.halfExtents),t.x=t.x<ga.x?ga.x:t.x,t.y=t.y<ga.y?ga.y:t.y,t.z=t.z<ga.z?ga.z:t.z,t.x=t.x>ya.x?ya.x:t.x,t.y=t.y>ya.y?ya.y:t.y,t.z=t.z>ya.z?ya.z:t.z,t}function ba(t,e,i){Ri.set(da,i.orientation.m00,i.orientation.m01,i.orientation.m02),Ri.set(pa,i.orientation.m03,i.orientation.m04,i.orientation.m05),Ri.set(ma,i.orientation.m06,i.orientation.m07,i.orientation.m08),Ta[0]=da,Ta[1]=pa,Ta[2]=ma,Sa[0]=i.halfExtents.x,Sa[1]=i.halfExtents.y,Sa[2]=i.halfExtents.z,Ri.subtract(va,e,i.center),Ri.set(t,i.center.x,i.center.y,i.center.z);for(var n=0;n<3;n++){var r=Ri.dot(va,Ta[n]);r>Sa[n]&&(r=Sa[n]),r<-Sa[n]&&(r=-Sa[n]),t.x+=r*Ta[n].x,t.y+=r*Ta[n].y,t.z+=r*Ta[n].z}return t}var xa=Object.freeze({__proto__:null,point_plane:Ea,pt_point_plane:function(t,e,i){var n=Ea(e,i);return Ri.subtract(t,e,Ri.multiplyScalar(t,i.n,n))},pt_point_aabb:Aa,pt_point_obb:ba,pt_point_line:function(t,e,i,n){Ri.subtract(da,i,n);var r=da,a=Ri.lengthSqr(r);if(0==a)Ri.copy(t,i);else{Ri.subtract(da,e,i);var o=Ri.dot(da,r)/a;o<0?Ri.copy(t,i):o>1?Ri.copy(t,n):Ri.scaleAndAdd(t,i,r,o)}}}),Ca={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},wa=function(){function t(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=Ca.SHAPE_LINE,this.s=new Ri(t,e,i),this.e=new Ri(n,r,a)}return t.create=function(e,i,n,r,a,o){return new t(e,i,n,r,a,o)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return Ri.copy(t.s,e.s),Ri.copy(t.e,e.e),t},t.fromPoints=function(t,e,i){return Ri.copy(t.s,e),Ri.copy(t.e,i),t},t.set=function(t,e,i,n,r,a,o){return t.s.x=e,t.s.y=i,t.s.z=n,t.e.x=r,t.e.y=a,t.e.z=o,t},t.len=function(t){return Ri.distance(t.s,t.e)},q(t,[{key:"type",get:function(){return this._type}}]),t.prototype.length=function(){return Ri.distance(this.s,this.e)},t}(),Ra=function(){function t(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=Ca.SHAPE_RAY,this.o=new Ri(t,e,i),this.d=new Ri(n,r,a)}return t.create=function(e,i,n,r,a,o){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),new t(e,i,n,r,a,o)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return Ri.copy(t.o,e.o),Ri.copy(t.d,e.d),t},t.fromPoints=function(t,e,i){return Ri.copy(t.o,e),Ri.normalize(t.d,Ri.subtract(t.d,i,e)),t},t.set=function(t,e,i,n,r,a,o){return t.o.x=e,t.o.y=i,t.o.z=n,t.d.x=r,t.d.y=a,t.d.z=o,t},q(t,[{key:"type",get:function(){return this._type}}]),t.prototype.computeHit=function(t,e){Ri.normalize(t,this.d),Ri.scaleAndAdd(t,this.o,t,e)},t}(),Ia=new Ri,Oa=new Ri,Pa=new Ri,Ma=new Ri;function Da(t){return Math.max(Math.max(t.x,t.y),t.z)}var Na,La=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this._center=new Ri(0,0,0),this._poolHandle=0,this._type=void 0,this._type=Ca.SHAPE_SPHERE,this._center=new Ri(t,e,i),this._poolHandle=Zr.alloc(),Zr.setVec3(this._poolHandle,jr.CENTER,this._center),Zr.set(this._poolHandle,jr.RADIUS,n)}t.create=function(e,i,n,r){return new t(e,i,n,r)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return Ri.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,i){return Ri.multiplyScalar(t.center,Ri.add(Ia,e,i),.5),t.radius=.5*Ri.subtract(Ia,i,e).length(),t},t.set=function(t,e,i,n,r){return t.center.x=e,t.center.y=i,t.center.z=n,t.radius=r,t},t.mergePoint=function(t,e,i){if(e.radius<0)return t.center.set(i),t.radius=0,t;Ri.subtract(Oa,i,e.center);var n=Oa.length();if(n>e.radius){var r=.5*(n-e.radius);t.radius+=r,Ri.multiplyScalar(Oa,Oa,r/n),Ri.add(t.center,t.center,Oa)}return t},t.mergeAABB=function(e,i,n){return n.getBoundary(Pa,Ma),t.mergePoint(e,i,Pa),t.mergePoint(e,i,Ma),e},q(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t,Zr.setVec3(this._poolHandle,jr.CENTER,this._center)}},{key:"radius",get:function(){return Zr.get(this._poolHandle,jr.RADIUS)},set:function(t){Zr.set(this._poolHandle,jr.RADIUS,t)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.destroy=function(){this._poolHandle&&(Zr.free(this._poolHandle),this._poolHandle=0)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){Ri.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Ri.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,i,n,r){Ri.transformMat4(r.center,this.center,t),r.radius=this.radius*Da(n)},e.translateAndRotate=function(t,e,i){Ri.transformMat4(i.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*Da(t)},t}(),Ba=function(){function t(t,e,i,n,r,a,o,s,l){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=1),void 0===l&&(l=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=Ca.SHAPE_TRIANGLE,this.a=new Ri(t,e,i),this.b=new Ri(n,r,a),this.c=new Ri(o,s,l)}return t.create=function(e,i,n,r,a,o,s,l,c){return void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=1),new t(e,i,n,r,a,o,s,l,c)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return Ri.copy(t.a,e.a),Ri.copy(t.b,e.b),Ri.copy(t.c,e.c),t},t.fromPoints=function(t,e,i,n){return Ri.copy(t.a,e),Ri.copy(t.b,i),Ri.copy(t.c,n),t},t.set=function(t,e,i,n,r,a,o,s,l,c){return t.a.x=e,t.a.y=i,t.a.z=n,t.b.x=r,t.b.y=a,t.b.z=o,t.c.x=s,t.c.y=l,t.c.z=c,t},q(t,[{key:"type",get:function(){return this._type}}]),t}(),Fa=t("GFX_MAX_ATTACHMENTS",4);!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BUFFER=1]="BUFFER",t[t.TEXTURE=2]="TEXTURE",t[t.RENDER_PASS=3]="RENDER_PASS",t[t.FRAMEBUFFER=4]="FRAMEBUFFER",t[t.SAMPLER=5]="SAMPLER",t[t.SHADER=6]="SHADER",t[t.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",t[t.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",t[t.PIPELINE_STATE=9]="PIPELINE_STATE",t[t.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",t[t.COMMAND_BUFFER=12]="COMMAND_BUFFER",t[t.FENCE=13]="FENCE",t[t.QUEUE=14]="QUEUE",t[t.WINDOW=15]="WINDOW"}(Na||(Na=t("GFXObjectType",{})));var za,Ua,ka,Ga,Ha,Va,Wa,ja,qa,Xa,Ya,Ka,Za,Qa,Ja,$a,to,eo,io,no,ro,ao,oo,so,lo,co,ho,uo,_o,fo,po,mo,vo,go,yo,To,So,Eo=t("GFXObject",function(){function t(t){this._gfxType=Na.UNKNOWN,this._gfxType=t}return q(t,[{key:"gfxType",get:function(){return this._gfxType}}]),t}());!function(t){t.ATTR_POSITION="a_position",t.ATTR_NORMAL="a_normal",t.ATTR_TANGENT="a_tangent",t.ATTR_BITANGENT="a_bitangent",t.ATTR_WEIGHTS="a_weights",t.ATTR_JOINTS="a_joints",t.ATTR_COLOR="a_color",t.ATTR_COLOR1="a_color1",t.ATTR_COLOR2="a_color2",t.ATTR_TEX_COORD="a_texCoord",t.ATTR_TEX_COORD1="a_texCoord1",t.ATTR_TEX_COORD2="a_texCoord2",t.ATTR_TEX_COORD3="a_texCoord3",t.ATTR_TEX_COORD4="a_texCoord4",t.ATTR_TEX_COORD5="a_texCoord5",t.ATTR_TEX_COORD6="a_texCoord6",t.ATTR_TEX_COORD7="a_texCoord7",t.ATTR_TEX_COORD8="a_texCoord8",t.ATTR_BATCH_ID="a_batch_id",t.ATTR_BATCH_UV="a_batch_uv"}(za||(za=t("GFXAttributeName",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BOOL=1]="BOOL",t[t.BOOL2=2]="BOOL2",t[t.BOOL3=3]="BOOL3",t[t.BOOL4=4]="BOOL4",t[t.INT=5]="INT",t[t.INT2=6]="INT2",t[t.INT3=7]="INT3",t[t.INT4=8]="INT4",t[t.UINT=9]="UINT",t[t.UINT2=10]="UINT2",t[t.UINT3=11]="UINT3",t[t.UINT4=12]="UINT4",t[t.FLOAT=13]="FLOAT",t[t.FLOAT2=14]="FLOAT2",t[t.FLOAT3=15]="FLOAT3",t[t.FLOAT4=16]="FLOAT4",t[t.MAT2=17]="MAT2",t[t.MAT2X3=18]="MAT2X3",t[t.MAT2X4=19]="MAT2X4",t[t.MAT3X2=20]="MAT3X2",t[t.MAT3=21]="MAT3",t[t.MAT3X4=22]="MAT3X4",t[t.MAT4X2=23]="MAT4X2",t[t.MAT4X3=24]="MAT4X3",t[t.MAT4=25]="MAT4",t[t.SAMPLER1D=26]="SAMPLER1D",t[t.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",t[t.SAMPLER2D=28]="SAMPLER2D",t[t.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",t[t.SAMPLER3D=30]="SAMPLER3D",t[t.SAMPLER_CUBE=31]="SAMPLER_CUBE",t[t.COUNT=32]="COUNT"}(Ua||(Ua=t("GFXType",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A8=1]="A8",t[t.L8=2]="L8",t[t.LA8=3]="LA8",t[t.R8=4]="R8",t[t.R8SN=5]="R8SN",t[t.R8UI=6]="R8UI",t[t.R8I=7]="R8I",t[t.R16F=8]="R16F",t[t.R16UI=9]="R16UI",t[t.R16I=10]="R16I",t[t.R32F=11]="R32F",t[t.R32UI=12]="R32UI",t[t.R32I=13]="R32I",t[t.RG8=14]="RG8",t[t.RG8SN=15]="RG8SN",t[t.RG8UI=16]="RG8UI",t[t.RG8I=17]="RG8I",t[t.RG16F=18]="RG16F",t[t.RG16UI=19]="RG16UI",t[t.RG16I=20]="RG16I",t[t.RG32F=21]="RG32F",t[t.RG32UI=22]="RG32UI",t[t.RG32I=23]="RG32I",t[t.RGB8=24]="RGB8",t[t.SRGB8=25]="SRGB8",t[t.RGB8SN=26]="RGB8SN",t[t.RGB8UI=27]="RGB8UI",t[t.RGB8I=28]="RGB8I",t[t.RGB16F=29]="RGB16F",t[t.RGB16UI=30]="RGB16UI",t[t.RGB16I=31]="RGB16I",t[t.RGB32F=32]="RGB32F",t[t.RGB32UI=33]="RGB32UI",t[t.RGB32I=34]="RGB32I",t[t.RGBA8=35]="RGBA8",t[t.BGRA8=36]="BGRA8",t[t.SRGB8_A8=37]="SRGB8_A8",t[t.RGBA8SN=38]="RGBA8SN",t[t.RGBA8UI=39]="RGBA8UI",t[t.RGBA8I=40]="RGBA8I",t[t.RGBA16F=41]="RGBA16F",t[t.RGBA16UI=42]="RGBA16UI",t[t.RGBA16I=43]="RGBA16I",t[t.RGBA32F=44]="RGBA32F",t[t.RGBA32UI=45]="RGBA32UI",t[t.RGBA32I=46]="RGBA32I",t[t.R5G6B5=47]="R5G6B5",t[t.R11G11B10F=48]="R11G11B10F",t[t.RGB5A1=49]="RGB5A1",t[t.RGBA4=50]="RGBA4",t[t.RGB10A2=51]="RGB10A2",t[t.RGB10A2UI=52]="RGB10A2UI",t[t.RGB9E5=53]="RGB9E5",t[t.D16=54]="D16",t[t.D16S8=55]="D16S8",t[t.D24=56]="D24",t[t.D24S8=57]="D24S8",t[t.D32F=58]="D32F",t[t.D32F_S8=59]="D32F_S8",t[t.BC1=60]="BC1",t[t.BC1_ALPHA=61]="BC1_ALPHA",t[t.BC1_SRGB=62]="BC1_SRGB",t[t.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",t[t.BC2=64]="BC2",t[t.BC2_SRGB=65]="BC2_SRGB",t[t.BC3=66]="BC3",t[t.BC3_SRGB=67]="BC3_SRGB",t[t.BC4=68]="BC4",t[t.BC4_SNORM=69]="BC4_SNORM",t[t.BC5=70]="BC5",t[t.BC5_SNORM=71]="BC5_SNORM",t[t.BC6H_UF16=72]="BC6H_UF16",t[t.BC6H_SF16=73]="BC6H_SF16",t[t.BC7=74]="BC7",t[t.BC7_SRGB=75]="BC7_SRGB",t[t.ETC_RGB8=76]="ETC_RGB8",t[t.ETC2_RGB8=77]="ETC2_RGB8",t[t.ETC2_SRGB8=78]="ETC2_SRGB8",t[t.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",t[t.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",t[t.ETC2_RGBA8=81]="ETC2_RGBA8",t[t.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",t[t.EAC_R11=83]="EAC_R11",t[t.EAC_R11SN=84]="EAC_R11SN",t[t.EAC_RG11=85]="EAC_RG11",t[t.EAC_RG11SN=86]="EAC_RG11SN",t[t.PVRTC_RGB2=87]="PVRTC_RGB2",t[t.PVRTC_RGBA2=88]="PVRTC_RGBA2",t[t.PVRTC_RGB4=89]="PVRTC_RGB4",t[t.PVRTC_RGBA4=90]="PVRTC_RGBA4",t[t.PVRTC2_2BPP=91]="PVRTC2_2BPP",t[t.PVRTC2_4BPP=92]="PVRTC2_4BPP",t[t.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",t[t.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",t[t.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",t[t.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",t[t.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",t[t.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",t[t.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",t[t.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",t[t.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",t[t.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",t[t.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",t[t.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",t[t.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",t[t.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",t[t.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",t[t.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",t[t.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",t[t.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",t[t.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",t[t.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",t[t.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",t[t.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",t[t.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",t[t.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",t[t.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",t[t.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",t[t.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",t[t.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12"}(ka||(ka=t("GFXFormat",{}))),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.INDEX=4]="INDEX",t[t.VERTEX=8]="VERTEX",t[t.UNIFORM=16]="UNIFORM",t[t.STORAGE=32]="STORAGE",t[t.INDIRECT=64]="INDIRECT"}(Ga||(Ga=t("GFXBufferUsageBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.DEVICE=1]="DEVICE",t[t.HOST=2]="HOST"}(Ha||(Ha=t("GFXMemoryUsageBit",{}))),function(t){t[t.NONE=0]="NONE"}(Va||(Va=t("GFXBufferFlagBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"}(Wa||(Wa=t("GFXBufferAccessBit",{}))),function(t){t[t.POINT_LIST=0]="POINT_LIST",t[t.LINE_LIST=1]="LINE_LIST",t[t.LINE_STRIP=2]="LINE_STRIP",t[t.LINE_LOOP=3]="LINE_LOOP",t[t.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",t[t.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",t[t.ISO_LINE_LIST=6]="ISO_LINE_LIST",t[t.TRIANGLE_LIST=7]="TRIANGLE_LIST",t[t.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=9]="TRIANGLE_FAN",t[t.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",t[t.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",t[t.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",t[t.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(ja||(ja=t("GFXPrimitiveMode",{}))),function(t){t[t.FILL=0]="FILL",t[t.POINT=1]="POINT",t[t.LINE=2]="LINE"}(qa||(qa=t("GFXPolygonMode",{}))),function(t){t[t.GOURAND=0]="GOURAND",t[t.FLAT=1]="FLAT"}(Xa||(Xa=t("GFXShadeModel",{}))),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK"}(Ya||(Ya=t("GFXCullMode",{}))),function(t){t[t.NEVER=0]="NEVER",t[t.LESS=1]="LESS",t[t.EQUAL=2]="EQUAL",t[t.LESS_EQUAL=3]="LESS_EQUAL",t[t.GREATER=4]="GREATER",t[t.NOT_EQUAL=5]="NOT_EQUAL",t[t.GREATER_EQUAL=6]="GREATER_EQUAL",t[t.ALWAYS=7]="ALWAYS"}(Ka||(Ka=t("GFXComparisonFunc",{}))),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=1]="KEEP",t[t.REPLACE=2]="REPLACE",t[t.INCR=3]="INCR",t[t.DECR=4]="DECR",t[t.INVERT=5]="INVERT",t[t.INCR_WRAP=6]="INCR_WRAP",t[t.DECR_WRAP=7]="DECR_WRAP"}(Za||(Za=t("GFXStencilOp",{}))),function(t){t[t.ADD=0]="ADD",t[t.SUB=1]="SUB",t[t.REV_SUB=2]="REV_SUB",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(Qa||(Qa=t("GFXBlendOp",{}))),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=2]="SRC_ALPHA",t[t.DST_ALPHA=3]="DST_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",t[t.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",t[t.SRC_COLOR=6]="SRC_COLOR",t[t.DST_COLOR=7]="DST_COLOR",t[t.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",t[t.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=11]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(Ja||(Ja=t("GFXBlendFactor",{}))),function(t){t[t.NONE=0]="NONE",t[t.R=1]="R",t[t.G=2]="G",t[t.B=4]="B",t[t.A=8]="A",t[t.ALL=15]="ALL"}($a||($a=t("GFXColorMask",{}))),function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.LINEAR=2]="LINEAR",t[t.ANISOTROPIC=3]="ANISOTROPIC"}(to||(to=t("GFXFilter",{}))),function(t){t[t.WRAP=0]="WRAP",t[t.MIRROR=1]="MIRROR",t[t.CLAMP=2]="CLAMP",t[t.BORDER=3]="BORDER"}(eo||(eo=t("GFXAddress",{}))),function(t){t[t.TEX1D=0]="TEX1D",t[t.TEX2D=1]="TEX2D",t[t.TEX3D=2]="TEX3D",t[t.CUBE=3]="CUBE",t[t.TEX1D_ARRAY=4]="TEX1D_ARRAY",t[t.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(io||(io=t("GFXTextureType",{}))),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",t[t.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",t[t.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(no||(no=t("GFXTextureUsageBit",{}))),function(t){t[t.X1=0]="X1",t[t.X2=1]="X2",t[t.X4=2]="X4",t[t.X8=3]="X8",t[t.X16=4]="X16",t[t.X32=5]="X32",t[t.X64=6]="X64"}(ro||(ro=t("GFXSampleCount",{}))),function(t){t[t.NONE=0]="NONE",t[t.GEN_MIPMAP=1]="GEN_MIPMAP",t[t.CUBEMAP=2]="CUBEMAP",t[t.BAKUP_BUFFER=4]="BAKUP_BUFFER",t[t.IMMUTABLE=8]="IMMUTABLE"}(ao||(ao=t("GFXTextureFlagBit",{}))),function(t){t[t.NONE=0]="NONE",t[t.VERTEX=1]="VERTEX",t[t.CONTROL=2]="CONTROL",t[t.EVALUATION=4]="EVALUATION",t[t.GEOMETRY=8]="GEOMETRY",t[t.FRAGMENT=16]="FRAGMENT",t[t.COMPUTE=32]="COMPUTE",t[t.ALL=63]="ALL"}(oo||(oo=t("GFXShaderStageFlagBit",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",t[t.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",t[t.STORAGE_BUFFER=4]="STORAGE_BUFFER",t[t.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",t[t.SAMPLER=16]="SAMPLER"}(so||(so=t("GFXDescriptorType",{}))),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"}(lo||(lo=t("GFXCommandBufferType",{}))),function(t){t[t.LOAD=0]="LOAD",t[t.CLEAR=1]="CLEAR",t[t.DISCARD=2]="DISCARD"}(co||(co=t("GFXLoadOp",{}))),function(t){t[t.STORE=0]="STORE",t[t.DISCARD=1]="DISCARD"}(ho||(ho=t("GFXStoreOp",{}))),function(t){t[t.UNDEFINED=0]="UNDEFINED",t[t.GENERAL=1]="GENERAL",t[t.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",t[t.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",t[t.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",t[t.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",t[t.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",t[t.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",t[t.PREINITIALIZED=8]="PREINITIALIZED",t[t.PRESENT_SRC=9]="PRESENT_SRC"}(uo||(uo=t("GFXTextureLayout",{}))),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.RAY_TRACING=2]="RAY_TRACING"}(_o||(_o=t("GFXPipelineBindPoint",{}))),function(t){t[t.NONE=0]="NONE",t[t.VIEWPORT=1]="VIEWPORT",t[t.SCISSOR=2]="SCISSOR",t[t.LINE_WIDTH=4]="LINE_WIDTH",t[t.DEPTH_BIAS=8]="DEPTH_BIAS",t[t.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",t[t.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",t[t.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(fo||(fo=t("GFXDynamicStateFlagBit",{}))),function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK",t[t.ALL=2]="ALL"}(po||(po=t("GFXStencilFace",{}))),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.TRANSFER=2]="TRANSFER"}(mo||(mo=t("GFXQueueType",{}))),function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.DEPTH_STENCIL=6]="DEPTH_STENCIL",t[t.ALL=7]="ALL"}(vo||(vo=t("GFXClearFlag",{}))),function(t){t[t.NONE=0]="NONE",t[t.UNORM=1]="UNORM",t[t.SNORM=2]="SNORM",t[t.UINT=3]="UINT",t[t.INT=4]="INT",t[t.UFLOAT=5]="UFLOAT",t[t.FLOAT=6]="FLOAT"}(go||(go=t("GFXFormatType",{}))),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.GLES2=1]="GLES2",t[t.GLES3=2]="GLES3",t[t.METAL=3]="METAL",t[t.VULKAN=4]="VULKAN",t[t.WEBGL=5]="WEBGL",t[t.WEBGL2=6]="WEBGL2",t[t.WEBGPU=7]="WEBGPU"}(yo||(yo=t("GFXAPI",{}))),function(t){t[t.IDENTITY=0]="IDENTITY",t[t.ROTATE_90=1]="ROTATE_90",t[t.ROTATE_180=2]="ROTATE_180",t[t.ROTATE_270=3]="ROTATE_270"}(To||(To=t("GFXSurfaceTransform",{}))),function(t){t[t.COLOR_FLOAT=0]="COLOR_FLOAT",t[t.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",t[t.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",t[t.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",t[t.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",t[t.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",t[t.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",t[t.FORMAT_D16=7]="FORMAT_D16",t[t.FORMAT_D16S8=8]="FORMAT_D16S8",t[t.FORMAT_D24=9]="FORMAT_D24",t[t.FORMAT_D24S8=10]="FORMAT_D24S8",t[t.FORMAT_D32F=11]="FORMAT_D32F",t[t.FORMAT_D32FS8=12]="FORMAT_D32FS8",t[t.FORMAT_ETC1=13]="FORMAT_ETC1",t[t.FORMAT_ETC2=14]="FORMAT_ETC2",t[t.FORMAT_DXT=15]="FORMAT_DXT",t[t.FORMAT_PVRTC=16]="FORMAT_PVRTC",t[t.FORMAT_ASTC=17]="FORMAT_ASTC",t[t.FORMAT_RGB8=18]="FORMAT_RGB8",t[t.MSAA=19]="MSAA",t[t.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",t[t.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",t[t.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",t[t.BLEND_MINMAX=23]="BLEND_MINMAX",t[t.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",t[t.LINE_WIDTH=25]="LINE_WIDTH",t[t.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",t[t.COUNT=28]="COUNT"}(So||(So=t("GFXFeature",{})));var Ao=t("GFXFormatInfo",(function(t,e,i,n,r,a,o,s){this.name=t,this.size=e,this.count=i,this.type=n,this.hasAlpha=r,this.hasDepth=a,this.hasStencil=o,this.isCompressed=s})),bo=t("GFXMemoryStatus",(function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.bufferSize=t,this.textureSize=e})),xo=t("GFXFormatInfos",Object.freeze([new Ao("UNKNOWN",0,0,go.NONE,!1,!1,!1,!1),new Ao("A8",1,1,go.UNORM,!0,!1,!1,!1),new Ao("L8",1,1,go.UNORM,!1,!1,!1,!1),new Ao("LA8",1,2,go.UNORM,!0,!1,!1,!1),new Ao("R8",1,1,go.UNORM,!1,!1,!1,!1),new Ao("R8SN",1,1,go.SNORM,!1,!1,!1,!1),new Ao("R8UI",1,1,go.UINT,!1,!1,!1,!1),new Ao("R8I",1,1,go.INT,!1,!1,!1,!1),new Ao("R16F",2,1,go.FLOAT,!1,!1,!1,!1),new Ao("R16UI",2,1,go.UINT,!1,!1,!1,!1),new Ao("R16I",2,1,go.INT,!1,!1,!1,!1),new Ao("R32F",4,1,go.FLOAT,!1,!1,!1,!1),new Ao("R32UI",4,1,go.UINT,!1,!1,!1,!1),new Ao("R32I",4,1,go.INT,!1,!1,!1,!1),new Ao("RG8",2,2,go.UNORM,!1,!1,!1,!1),new Ao("RG8SN",2,2,go.SNORM,!1,!1,!1,!1),new Ao("RG8UI",2,2,go.UINT,!1,!1,!1,!1),new Ao("RG8I",2,2,go.INT,!1,!1,!1,!1),new Ao("RG16F",4,2,go.FLOAT,!1,!1,!1,!1),new Ao("RG16UI",4,2,go.UINT,!1,!1,!1,!1),new Ao("RG16I",4,2,go.INT,!1,!1,!1,!1),new Ao("RG32F",8,2,go.FLOAT,!1,!1,!1,!1),new Ao("RG32UI",8,2,go.UINT,!1,!1,!1,!1),new Ao("RG32I",8,2,go.INT,!1,!1,!1,!1),new Ao("RGB8",3,3,go.UNORM,!1,!1,!1,!1),new Ao("SRGB8",3,3,go.UNORM,!1,!1,!1,!1),new Ao("RGB8SN",3,3,go.SNORM,!1,!1,!1,!1),new Ao("RGB8UI",3,3,go.UINT,!1,!1,!1,!1),new Ao("RGB8I",3,3,go.INT,!1,!1,!1,!1),new Ao("RGB16F",6,3,go.FLOAT,!1,!1,!1,!1),new Ao("RGB16UI",6,3,go.UINT,!1,!1,!1,!1),new Ao("RGB16I",6,3,go.INT,!1,!1,!1,!1),new Ao("RGB32F",12,3,go.FLOAT,!1,!1,!1,!1),new Ao("RGB32UI",12,3,go.UINT,!1,!1,!1,!1),new Ao("RGB32I",12,3,go.INT,!1,!1,!1,!1),new Ao("RGBA8",4,4,go.UNORM,!0,!1,!1,!1),new Ao("BGRA8",4,4,go.UNORM,!0,!1,!1,!1),new Ao("SRGB8_A8",4,4,go.UNORM,!0,!1,!1,!1),new Ao("RGBA8SN",4,4,go.SNORM,!0,!1,!1,!1),new Ao("RGBA8UI",4,4,go.UINT,!0,!1,!1,!1),new Ao("RGBA8I",4,4,go.INT,!0,!1,!1,!1),new Ao("RGBA16F",8,4,go.FLOAT,!0,!1,!1,!1),new Ao("RGBA16UI",8,4,go.UINT,!0,!1,!1,!1),new Ao("RGBA16I",8,4,go.INT,!0,!1,!1,!1),new Ao("RGBA32F",16,4,go.FLOAT,!0,!1,!1,!1),new Ao("RGBA32UI",16,4,go.UINT,!0,!1,!1,!1),new Ao("RGBA32I",16,4,go.INT,!0,!1,!1,!1),new Ao("R5G6B5",2,3,go.UNORM,!1,!1,!1,!1),new Ao("R11G11B10F",4,3,go.FLOAT,!1,!1,!1,!1),new Ao("RGB5A1",2,4,go.UNORM,!0,!1,!1,!1),new Ao("RGBA4",2,4,go.UNORM,!0,!1,!1,!1),new Ao("RGB10A2",2,4,go.UNORM,!0,!1,!1,!1),new Ao("RGB10A2UI",2,4,go.UINT,!0,!1,!1,!1),new Ao("RGB9E5",2,4,go.FLOAT,!0,!1,!1,!1),new Ao("D16",2,1,go.UINT,!1,!0,!1,!1),new Ao("D16S8",3,2,go.UINT,!1,!0,!0,!1),new Ao("D24",3,1,go.UINT,!1,!0,!1,!1),new Ao("D24S8",4,2,go.UINT,!1,!0,!0,!1),new Ao("D32F",4,1,go.FLOAT,!1,!0,!1,!1),new Ao("D32FS8",5,2,go.FLOAT,!1,!0,!0,!1),new Ao("BC1",1,3,go.UNORM,!1,!1,!1,!0),new Ao("BC1_ALPHA",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC1_SRGB",1,3,go.UNORM,!1,!1,!1,!0),new Ao("BC1_SRGB_ALPHA",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC2",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC2_SRGB",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC3",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC3_SRGB",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC4",1,1,go.UNORM,!1,!1,!1,!0),new Ao("BC4_SNORM",1,1,go.SNORM,!1,!1,!1,!0),new Ao("BC5",1,2,go.UNORM,!1,!1,!1,!0),new Ao("BC5_SNORM",1,2,go.SNORM,!1,!1,!1,!0),new Ao("BC6H_UF16",1,3,go.UFLOAT,!1,!1,!1,!0),new Ao("BC6H_SF16",1,3,go.FLOAT,!1,!1,!1,!0),new Ao("BC7",1,4,go.UNORM,!0,!1,!1,!0),new Ao("BC7_SRGB",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ETC_RGB8",1,3,go.UNORM,!1,!1,!1,!0),new Ao("ETC2_RGB8",1,3,go.UNORM,!1,!1,!1,!0),new Ao("ETC2_SRGB8",1,3,go.UNORM,!1,!1,!1,!0),new Ao("ETC2_RGB8_A1",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ETC2_SRGB8_A1",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ETC2_RGBA8",2,4,go.UNORM,!0,!1,!1,!0),new Ao("ETC2_SRGB8_A8",2,4,go.UNORM,!0,!1,!1,!0),new Ao("EAC_R11",1,1,go.UNORM,!1,!1,!1,!0),new Ao("EAC_R11SN",1,1,go.SNORM,!1,!1,!1,!0),new Ao("EAC_RG11",2,2,go.UNORM,!1,!1,!1,!0),new Ao("EAC_RG11SN",2,2,go.SNORM,!1,!1,!1,!0),new Ao("PVRTC_RGB2",2,3,go.UNORM,!1,!1,!1,!0),new Ao("PVRTC_RGBA2",2,4,go.UNORM,!0,!1,!1,!0),new Ao("PVRTC_RGB4",2,3,go.UNORM,!1,!1,!1,!0),new Ao("PVRTC_RGBA4",2,4,go.UNORM,!0,!1,!1,!0),new Ao("PVRTC2_2BPP",2,4,go.UNORM,!0,!1,!1,!0),new Ao("PVRTC2_4BPP",2,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_4x4",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_5x4",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_5x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_6x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_6x6",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_8x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_8x6",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_8x8",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_10x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_10x6",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_10x8",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_10x10",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_12x10",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_RGBA_12x12",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_4x4",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_5x4",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_5x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_6x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_6x6",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_8x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_8x6",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_8x8",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_10x5",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_10x6",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_10x8",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_10x10",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_12x10",1,4,go.UNORM,!0,!1,!1,!0),new Ao("ASTC_SRGBA_12x12",1,4,go.UNORM,!0,!1,!1,!0)]));function Co(t,e,i,n){if(!xo[t].isCompressed)return e*i*n*xo[t].size;switch(t){case ka.BC1:case ka.BC1_ALPHA:case ka.BC1_SRGB:case ka.BC1_SRGB_ALPHA:return Math.ceil(e/4)*Math.ceil(i/4)*8*n;case ka.BC2:case ka.BC2_SRGB:case ka.BC3:case ka.BC3_SRGB:case ka.BC4:case ka.BC4_SNORM:case ka.BC6H_SF16:case ka.BC6H_UF16:case ka.BC7:case ka.BC7_SRGB:return Math.ceil(e/4)*Math.ceil(i/4)*16*n;case ka.BC5:case ka.BC5_SNORM:return Math.ceil(e/4)*Math.ceil(i/4)*32*n;case ka.ETC_RGB8:case ka.ETC2_RGB8:case ka.ETC2_SRGB8:case ka.ETC2_RGB8_A1:case ka.EAC_R11:case ka.EAC_R11SN:return Math.ceil(e/4)*Math.ceil(i/4)*8*n;case ka.ETC2_RGBA8:case ka.ETC2_SRGB8_A1:case ka.EAC_RG11:case ka.EAC_RG11SN:return Math.ceil(e/4)*Math.ceil(i/4)*16*n;case ka.PVRTC_RGB2:case ka.PVRTC_RGBA2:case ka.PVRTC2_2BPP:return Math.ceil(Math.max(e,16)*Math.max(i,8)/4)*n;case ka.PVRTC_RGB4:case ka.PVRTC_RGBA4:case ka.PVRTC2_4BPP:return Math.ceil(Math.max(e,8)*Math.max(i,8)/2)*n;case ka.ASTC_RGBA_4x4:case ka.ASTC_SRGBA_4x4:return Math.ceil(e/4)*Math.ceil(i/4)*16*n;case ka.ASTC_RGBA_5x4:case ka.ASTC_SRGBA_5x4:return Math.ceil(e/5)*Math.ceil(i/4)*16*n;case ka.ASTC_RGBA_5x5:case ka.ASTC_SRGBA_5x5:return Math.ceil(e/5)*Math.ceil(i/5)*16*n;case ka.ASTC_RGBA_6x5:case ka.ASTC_SRGBA_6x5:return Math.ceil(e/6)*Math.ceil(i/5)*16*n;case ka.ASTC_RGBA_6x6:case ka.ASTC_SRGBA_6x6:return Math.ceil(e/6)*Math.ceil(i/6)*16*n;case ka.ASTC_RGBA_8x5:case ka.ASTC_SRGBA_8x5:return Math.ceil(e/8)*Math.ceil(i/5)*16*n;case ka.ASTC_RGBA_8x6:case ka.ASTC_SRGBA_8x6:return Math.ceil(e/8)*Math.ceil(i/6)*16*n;case ka.ASTC_RGBA_8x8:case ka.ASTC_SRGBA_8x8:return Math.ceil(e/8)*Math.ceil(i/8)*16*n;case ka.ASTC_RGBA_10x5:case ka.ASTC_SRGBA_10x5:return Math.ceil(e/10)*Math.ceil(i/5)*16*n;case ka.ASTC_RGBA_10x6:case ka.ASTC_SRGBA_10x6:return Math.ceil(e/10)*Math.ceil(i/6)*16*n;case ka.ASTC_RGBA_10x8:case ka.ASTC_SRGBA_10x8:return Math.ceil(e/10)*Math.ceil(i/8)*16*n;case ka.ASTC_RGBA_10x10:case ka.ASTC_SRGBA_10x10:return Math.ceil(e/10)*Math.ceil(i/10)*16*n;case ka.ASTC_RGBA_12x10:case ka.ASTC_SRGBA_12x10:return Math.ceil(e/12)*Math.ceil(i/10)*16*n;case ka.ASTC_RGBA_12x12:case ka.ASTC_SRGBA_12x12:return Math.ceil(e/12)*Math.ceil(i/12)*16*n;default:return 0}}function wo(t,e,i,n,r){for(var a=0,o=0;o<r;++o)a+=Co(t,e,i,n),e=Math.max(e>>1,1),i=Math.max(i>>1,1);return a}var Ro=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function Io(t){return Ro[t]||0}function Oo(t){var e=t.size/t.count;switch(t.type){case go.UNORM:case go.UINT:switch(e){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case go.SNORM:case go.INT:switch(e){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case go.FLOAT:return Float32Array}return Float32Array}var Po=t("GFXDrawInfo",(function(t,e,i,n,r,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),this.vertexCount=t,this.firstVertex=e,this.indexCount=i,this.firstIndex=n,this.vertexOffset=r,this.instanceCount=a,this.firstInstance=o})),Mo=t("GFX_DRAW_INFO_SIZE",28),Do=t("GFXIndirectBuffer",(function(t){void 0===t&&(t=[]),this.drawInfos=t})),No=t("GFXBufferInfo",(function(t,e,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=Va.NONE),this.usage=t,this.memUsage=e,this.size=i,this.stride=n,this.flags=r})),Lo=t("GFXBufferViewInfo",(function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.buffer=t,this.offset=e,this.range=i})),Bo=t("GFXBuffer",function(t){function e(e){var i;return(i=t.call(this,Na.BUFFER)||this)._device=void 0,i._usage=Ga.NONE,i._memUsage=Ha.NONE,i._size=0,i._stride=1,i._count=0,i._flags=Va.NONE,i._indirectBuffer=null,i._isBufferView=!1,i._device=e,i}return Y(e,t),q(e,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),e}(Eo)),Fo=t("GFXCommandBufferInfo",(function(t,e){void 0===e&&(e=lo.PRIMARY),this.queue=t,this.type=e})),zo=t("GFXCommandBuffer",function(t){function e(e){var i;return(i=t.call(this,Na.COMMAND_BUFFER)||this)._device=void 0,i._queue=null,i._type=lo.PRIMARY,i._numDrawCalls=0,i._numInstances=0,i._numTris=0,i._device=e,i}return Y(e,t),q(e,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),e}(Eo));fe(ka);var Uo=t("GFXBindingMappingInfo",(function(t,e,i){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=0),this.bufferOffsets=t,this.samplerOffsets=e,this.flexibleSet=i})),ko=t("GFXDeviceInfo",(function(t,e,i,n,r,a,o){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=new Uo),this.canvasElm=t,this.isAntialias=e,this.isPremultipliedAlpha=i,this.devicePixelRatio=n,this.nativeWidth=r,this.nativeHeight=a,this.bindingMappingInfo=o})),Go=t("GFXDevice",function(){function t(){this._canvas=null,this._canvas2D=null,this._gfxAPI=yo.UNKNOWN,this._transform=To.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(So.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._maxVertexAttributes=0,this._maxVertexUniformVectors=0,this._maxFragmentUniformVectors=0,this._maxTextureUnits=0,this._maxVertexTextureUnits=0,this._maxUniformBufferBindings=0,this._maxUniformBlockSize=0,this._maxTextureSize=0,this._maxCubeMapTextureSize=0,this._uboOffsetAlignment=1,this._depthBits=0,this._stencilBits=0,this._colorFmt=ka.UNKNOWN,this._depthStencilFmt=ka.UNKNOWN,this._macros=new Map,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new bo,this._clipSpaceMinZ=-1,this._screenSpaceSignY=1,this._UVSpaceSignY=-1}return t.prototype.hasFeature=function(t){return this._features[t]},q(t,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"maxVertexAttributes",get:function(){return this._maxVertexAttributes}},{key:"maxVertexUniformVectors",get:function(){return this._maxVertexUniformVectors}},{key:"maxFragmentUniformVectors",get:function(){return this._maxFragmentUniformVectors}},{key:"maxTextureUnits",get:function(){return this._maxTextureUnits}},{key:"maxVertexTextureUnits",get:function(){return this._maxVertexTextureUnits}},{key:"maxUniformBufferBindings",get:function(){return this._maxUniformBufferBindings}},{key:"maxUniformBlockSize",get:function(){return this._maxUniformBlockSize}},{key:"maxTextureSize",get:function(){return this._maxTextureSize}},{key:"maxCubeMapTextureSize",get:function(){return this._maxCubeMapTextureSize}},{key:"uboOffsetAlignment",get:function(){return this._uboOffsetAlignment}},{key:"depthBits",get:function(){return this._depthBits}},{key:"stencilBits",get:function(){return this._stencilBits}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"macros",get:function(){return this._macros}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"clipSpaceMinZ",get:function(){return this._clipSpaceMinZ}},{key:"screenSpaceSignY",get:function(){return this._screenSpaceSignY}},{key:"UVSpaceSignY",get:function(){return this._UVSpaceSignY}},{key:"surfaceTransform",get:function(){return this._transform}}]),t}()),Ho=t("GFXFramebufferInfo",(function(t,e,i,n,r){void 0===e&&(e=[]),void 0===i&&(i=null),void 0===n&&(n=[]),void 0===r&&(r=0),this.renderPass=t,this.colorTextures=e,this.depthStencilTexture=i,this.colorMipmapLevels=n,this.depStencilMipmapLevel=r})),Vo=t("GFXFramebuffer",function(t){function e(e){var i;return(i=t.call(this,Na.FRAMEBUFFER)||this)._device=void 0,i._renderPass=null,i._colorTextures=[],i._depthStencilTexture=null,i._device=e,i}return Y(e,t),q(e,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),e}(Eo)),Wo=String.prototype.charCodeAt;function jo(t){return this[t]}function qo(t,e){for(var i=t.length,n=e^i,r=0,a="string"==typeof t?Wo:jo;i>=4;){var o=255&a.call(t,r)|(255&a.call(t,++r))<<8|(255&a.call(t,++r))<<16|(255&a.call(t,++r))<<24;o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),i-=4,++r}switch(i){case 3:n^=(255&a.call(t,r+2))<<16;case 2:n^=(255&a.call(t,r+1))<<8;case 1:n=1540483477*(65535&(n^=255&a.call(t,r)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}var Xo=t("GFXAttribute",(function(t,e,i,n,r,a){void 0===t&&(t=""),void 0===e&&(e=ka.UNKNOWN),void 0===i&&(i=!1),void 0===n&&(n=0),void 0===r&&(r=!1),void 0===a&&(a=0),this.name=t,this.format=e,this.isNormalized=i,this.stream=n,this.isInstanced=r,this.location=a})),Yo=t("GFXInputAssemblerInfo",(function(t,e,i,n){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===n&&(n=null),this.attributes=t,this.vertexBuffers=e,this.indexBuffer=i,this.indirectBuffer=n})),Ko=t("GFXInputAssembler",function(t){function e(e){var i;return(i=t.call(this,Na.INPUT_ASSEMBLER)||this)._device=void 0,i._attributes=[],i._vertexBuffers=[],i._indexBuffer=null,i._vertexCount=0,i._firstVertex=0,i._indexCount=0,i._firstIndex=0,i._vertexOffset=0,i._instanceCount=0,i._firstInstance=0,i._attributesHash=0,i._indirectBuffer=null,i._device=e,i}Y(e,t),q(e,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(t){this._vertexCount=t}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(t){this._firstVertex=t}},{key:"indexCount",get:function(){return this._indexCount},set:function(t){this._indexCount=t}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(t){this._firstIndex=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(t){this._instanceCount=t}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(t){this._firstInstance=t}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]);var i=e.prototype;return i.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this._vertexBuffers.length?this._vertexBuffers[t]:null},i.computeAttributesHash=function(){for(var t="attrs",e=0;e<this.attributes.length;++e){var i=this.attributes[e];t+=","+i.name+","+i.format+","+i.isNormalized+","+i.stream+","+i.isInstanced}return qo(t,666)},e}(Eo)),Zo=t("GFXRect",(function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=1),this.x=t,this.y=e,this.width=i,this.height=n})),Qo=t("GFXViewport",(function(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),this.left=t,this.top=e,this.width=i,this.height=n,this.minDepth=r,this.maxDepth=a})),Jo=t("GFXColor",(function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=i,this.w=n})),$o=t("GFXOffset",(function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i})),ts=t("GFXExtent",(function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),this.width=t,this.height=e,this.depth=i})),es=t("GFXTextureSubres",(function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),this.mipLevel=t,this.baseArrayLayer=e,this.layerCount=i})),is=t("GFXTextureCopy",(function(t,e,i,n,r){void 0===t&&(t=new es),void 0===e&&(e=new $o),void 0===i&&(i=new es),void 0===n&&(n=new $o),void 0===r&&(r=new ts),this.srcSubres=t,this.srcOffset=e,this.dstSubres=i,this.dstOffset=n,this.extent=r})),ns=t("GFXBufferTextureCopy",(function(t,e,i,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=new $o),void 0===n&&(n=new ts),void 0===r&&(r=new es),this.buffStride=t,this.buffTexHeight=e,this.texOffset=i,this.texExtent=n,this.texSubres=r})),rs=t("GFXRasterizerState",function(){function t(t,e,i,n,r,a,o,s,l,c,h,u){void 0===t&&(t=!1),void 0===e&&(e=qa.FILL),void 0===i&&(i=Xa.GOURAND),void 0===n&&(n=Ya.BACK),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=!0),void 0===h&&(h=!1),void 0===u&&(u=1),this.isDiscard=t,this.polygonMode=e,this.shadeModel=i,this.cullMode=n,this.isFrontFaceCCW=r,this.depthBiasEnabled=a,this.depthBias=o,this.depthBiasClamp=s,this.depthBiasSlop=l,this.isDepthClip=c,this.isMultisample=h,this.lineWidth=u}var e=t.prototype;return e.reset=function(){this.isDiscard=!1,this.polygonMode=qa.FILL,this.shadeModel=Xa.GOURAND,this.cullMode=Ya.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},q(t,[{key:"handle",get:function(){return 0}}]),t}()),as=t("GFXDepthStencilState",function(){function t(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d,p,m,v,g){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=Ka.LESS),void 0===n&&(n=!1),void 0===r&&(r=Ka.ALWAYS),void 0===a&&(a=65535),void 0===o&&(o=65535),void 0===s&&(s=Za.KEEP),void 0===l&&(l=Za.KEEP),void 0===c&&(c=Za.KEEP),void 0===h&&(h=1),void 0===u&&(u=!1),void 0===_&&(_=Ka.ALWAYS),void 0===f&&(f=65535),void 0===d&&(d=65535),void 0===p&&(p=Za.KEEP),void 0===m&&(m=Za.KEEP),void 0===v&&(v=Za.KEEP),void 0===g&&(g=1),this.depthTest=t,this.depthWrite=e,this.depthFunc=i,this.stencilTestFront=n,this.stencilFuncFront=r,this.stencilReadMaskFront=a,this.stencilWriteMaskFront=o,this.stencilFailOpFront=s,this.stencilZFailOpFront=l,this.stencilPassOpFront=c,this.stencilRefFront=h,this.stencilTestBack=u,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=d,this.stencilFailOpBack=p,this.stencilZFailOpBack=m,this.stencilPassOpBack=v,this.stencilRefBack=g}var e=t.prototype;return e.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Ka.LESS,this.stencilTestFront=!1,this.stencilFuncFront=Ka.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=Za.KEEP,this.stencilZFailOpFront=Za.KEEP,this.stencilPassOpFront=Za.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=Ka.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=Za.KEEP,this.stencilZFailOpBack=Za.KEEP,this.stencilPassOpBack=Za.KEEP,this.stencilRefBack=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},q(t,[{key:"handle",get:function(){return 0}}]),t}()),os=t("GFXBlendTarget",function(){function t(t,e,i,n,r,a,o,s){void 0===t&&(t=!1),void 0===e&&(e=Ja.ONE),void 0===i&&(i=Ja.ZERO),void 0===n&&(n=Qa.ADD),void 0===r&&(r=Ja.ONE),void 0===a&&(a=Ja.ZERO),void 0===o&&(o=Qa.ADD),void 0===s&&(s=$a.ALL),this.blend=t,this.blendSrc=e,this.blendDst=i,this.blendEq=n,this.blendSrcAlpha=r,this.blendDstAlpha=a,this.blendAlphaEq=o,this.blendColorMask=s}var e=t.prototype;return e.reset=function(){this.blend=!1,this.blendSrc=Ja.ONE,this.blendDst=Ja.ZERO,this.blendEq=Qa.ADD,this.blendSrcAlpha=Ja.ONE,this.blendDstAlpha=Ja.ZERO,this.blendAlphaEq=Qa.ADD,this.blendColorMask=$a.ALL},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},q(t,[{key:"handle",get:function(){return 0}}]),t}()),ss=t("GFXBlendState",function(){function t(t,e,i,n){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=new Jo),void 0===n&&(n=[new os]),this.isA2C=t,this.isIndepend=e,this.blendColor=i,this.targets=n}var e=t.prototype;return e.setTarget=function(t,e){var i=this.targets[t];i||(i=this.targets[t]=new os),Object.assign(i,e)},e.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},e.destroy=function(){},q(t,[{key:"handle",get:function(){return 0}}]),t}()),ls=t("GFXInputState",(function(t){void 0===t&&(t=[]),this.attributes=t})),cs=t("GFXPipelineStateInfo",(function(t,e,i,n,r,a,o,s,l){void 0===s&&(s=ja.TRIANGLE_LIST),void 0===l&&(l=fo.NONE),this.shader=t,this.pipelineLayout=e,this.renderPass=i,this.inputState=n,this.rasterizerState=r,this.depthStencilState=a,this.blendState=o,this.primitive=s,this.dynamicStates=l})),hs=t("GFXPipelineState",function(t){function e(e){var i;return(i=t.call(this,Na.PIPELINE_STATE)||this)._device=void 0,i._shader=null,i._pipelineLayout=null,i._primitive=ja.TRIANGLE_LIST,i._is=null,i._rs=new rs,i._dss=new as,i._bs=new ss,i._dynamicStates=fo.NONE,i._renderPass=null,i._device=e,i}return Y(e,t),q(e,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),e}(Eo)),us=t("GFXQueueInfo",(function(t){void 0===t&&(t=mo.GRAPHICS),this.type=t})),_s=t("GFXQueue",function(t){function e(e){var i;return(i=t.call(this,Na.QUEUE)||this)._device=void 0,i._type=mo.GRAPHICS,i._isAsync=!1,i._device=e,i}return Y(e,t),q(e,[{key:"type",get:function(){return this._type}}]),e.prototype.isAsync=function(){return this._isAsync},e}(Eo)),fs=t("GFXColorAttachment",(function(t,e,i,n,r,a){void 0===t&&(t=ka.UNKNOWN),void 0===e&&(e=1),void 0===i&&(i=co.CLEAR),void 0===n&&(n=ho.STORE),void 0===r&&(r=uo.UNDEFINED),void 0===a&&(a=uo.PRESENT_SRC),this.format=t,this.sampleCount=e,this.loadOp=i,this.storeOp=n,this.beginLayout=r,this.endLayout=a})),ds=t("GFXDepthStencilAttachment",(function(t,e,i,n,r,a,o,s){void 0===t&&(t=ka.UNKNOWN),void 0===e&&(e=1),void 0===i&&(i=co.CLEAR),void 0===n&&(n=ho.STORE),void 0===r&&(r=co.CLEAR),void 0===a&&(a=ho.STORE),void 0===o&&(o=uo.UNDEFINED),void 0===s&&(s=uo.DEPTH_STENCIL_ATTACHMENT_OPTIMAL),this.format=t,this.sampleCount=e,this.depthLoadOp=i,this.depthStoreOp=n,this.stencilLoadOp=r,this.stencilStoreOp=a,this.beginLayout=o,this.endLayout=s})),ps=t("GFXSubPassInfo",(function(t,e,i,n,r,a){void 0===t&&(t=_o.GRAPHICS),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===r&&(r=-1),void 0===a&&(a=[]),this.bindPoint=t,this.inputs=e,this.colors=i,this.resolves=n,this.depthStencil=r,this.preserves=a})),ms=t("GFXRenderPassInfo",(function(t,e,i){void 0===t&&(t=[]),void 0===e&&(e=null),void 0===i&&(i=[]),this.colorAttachments=t,this.depthStencilAttachment=e,this.subPasses=i})),vs=t("GFXRenderPass",function(t){function e(e){var i;return(i=t.call(this,Na.RENDER_PASS)||this)._device=void 0,i._colorInfos=[],i._depthStencilInfo=null,i._subPasses=[],i._hash=0,i._device=e,i}return Y(e,t),q(e,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subPasses}},{key:"hash",get:function(){return this._hash}}]),e.prototype.computeHash=function(){var t="";if(this._subPasses.length)for(var e=0;e<this._subPasses.length;++e){var i=this._subPasses[e];if(i.inputs.length){t+="ia";for(var n=0;n<i.inputs.length;++n){var r=this._colorInfos[i.inputs[n]];t+=","+r.format+","+r.sampleCount}}if(i.colors.length){t+="ca";for(var a=0;a<i.inputs.length;++a){var o=this._colorInfos[i.inputs[a]];t+=","+o.format+","+o.sampleCount}}if(i.depthStencil>=0){var s=this._colorInfos[i.depthStencil];t+="ds,"+s.format+","+s.sampleCount}}else{t+="ca";for(var l=0;l<this._colorInfos.length;++l){var c=this._colorInfos[l];t+=","+c.format+","+c.sampleCount}var h=this._depthStencilInfo;h&&(t+="ds,"+h.format+","+h.sampleCount)}return qo(t,666)},e}(Eo)),gs=t("GFXSamplerInfo",(function(t,e,i,n,r,a,o,s,l,c,h,u){void 0===t&&(t=to.LINEAR),void 0===e&&(e=to.LINEAR),void 0===i&&(i=to.NONE),void 0===n&&(n=eo.WRAP),void 0===r&&(r=eo.WRAP),void 0===a&&(a=eo.WRAP),void 0===o&&(o=16),void 0===s&&(s=Ka.NEVER),void 0===l&&(l=new Jo),void 0===c&&(c=0),void 0===h&&(h=0),void 0===u&&(u=0),this.minFilter=t,this.magFilter=e,this.mipFilter=i,this.addressU=n,this.addressV=r,this.addressW=a,this.maxAnisotropy=o,this.cmpFunc=s,this.borderColor=l,this.minLOD=c,this.maxLOD=h,this.mipLODBias=u})),ys=t("GFXSampler",function(t){function e(e){var i;return(i=t.call(this,Na.SAMPLER)||this)._device=void 0,i._minFilter=to.LINEAR,i._magFilter=to.LINEAR,i._mipFilter=to.NONE,i._addressU=eo.WRAP,i._addressV=eo.WRAP,i._addressW=eo.WRAP,i._maxAnisotropy=16,i._cmpFunc=Ka.NEVER,i._borderColor=new Jo,i._minLOD=0,i._maxLOD=0,i._mipLODBias=0,i._device=e,i}return Y(e,t),q(e,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"minLOD",get:function(){return this._minLOD}},{key:"maxLOD",get:function(){return this._maxLOD}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),e}(Eo)),Ts=t("GFXShaderStage",(function(t,e){void 0===t&&(t=oo.NONE),void 0===e&&(e=""),this.stage=t,this.source=e})),Ss=t("GFXUniform",(function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=Ua.UNKNOWN),void 0===i&&(i=1),this.name=t,this.type=e,this.count=i})),Es=t("GFXUniformBlock",(function(t,e,i,n,r){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===i&&(i=""),void 0===n&&(n=[]),void 0===r&&(r=1),this.set=t,this.binding=e,this.name=i,this.members=n,this.count=r})),As=t("GFXUniformSampler",(function(t,e,i,n,r){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===i&&(i=""),void 0===n&&(n=Ua.UNKNOWN),void 0===r&&(r=1),this.set=t,this.binding=e,this.name=i,this.type=n,this.count=r})),bs=t("GFXShaderInfo",(function(t,e,i,n,r){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===r&&(r=[]),this.name=t,this.stages=e,this.attributes=i,this.blocks=n,this.samplers=r})),xs=t("GFXShader",function(t){function e(i){var n;return(n=t.call(this,Na.SHADER)||this)._device=void 0,n._id=void 0,n._name="",n._stages=[],n._attributes=[],n._blocks=[],n._samplers=[],n._device=i,n._id=e._shaderIdGen++,n}return Y(e,t),q(e,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),e}(Eo));xs._shaderIdGen=0;var Cs=t("GFXTextureInfo",(function(t,e,i,n,r,a,o,s,l,c){void 0===e&&(e=no.NONE),void 0===i&&(i=ka.UNKNOWN),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=ao.NONE),void 0===o&&(o=1),void 0===s&&(s=1),void 0===l&&(l=ro.X1),void 0===c&&(c=1),this.type=t,this.usage=e,this.format=i,this.width=n,this.height=r,this.flags=a,this.layerCount=o,this.levelCount=s,this.samples=l,this.depth=c})),ws=t("GFXTextureViewInfo",(function(t,e,i,n,r,a,o){void 0===e&&(e=io.TEX2D),void 0===i&&(i=ka.UNKNOWN),void 0===n&&(n=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=1),this.texture=t,this.type=e,this.format=i,this.baseLevel=n,this.levelCount=r,this.baseLayer=a,this.layerCount=o}));function Rs(t){return t>0&&0==(t&t-1)}var Is=t("GFXTexture",function(t){function e(e){var i;return(i=t.call(this,Na.TEXTURE)||this)._device=void 0,i._type=io.TEX2D,i._usage=no.NONE,i._format=ka.UNKNOWN,i._width=0,i._height=0,i._depth=1,i._layerCount=1,i._levelCount=1,i._samples=ro.X1,i._flags=ao.NONE,i._isPowerOf2=!1,i._size=0,i._buffer=null,i._device=e,i}return Y(e,t),q(e,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer}}]),e}(Eo)),Os={Device:Go,Buffer:Bo,Texture:Is,Sampler:ys,Shader:xs,InputAssembler:Ko,RenderPass:vs,Framebuffer:Vo,PipelineState:hs,CommandBuffer:zo,Queue:_s,FormatSize:Co,FormatSurfaceSize:wo,GetTypeSize:Io,getTypedArrayConstructor:Oo,MAX_ATTACHMENTS:Fa,ObjectType:Na,Obj:Eo,AttributeName:za,Type:Ua,Format:ka,BufferUsageBit:Ga,MemoryUsageBit:Ha,BufferFlagBit:Va,BufferAccessBit:Wa,PrimitiveMode:ja,PolygonMode:qa,ShadeModel:Xa,CullMode:Ya,ComparisonFunc:Ka,StencilOp:Za,BlendOp:Qa,BlendFactor:Ja,ColorMask:$a,Filter:to,Address:eo,TextureType:io,TextureUsageBit:no,SampleCount:ro,TextureFlagBit:ao,ShaderStageFlagBit:oo,DescriptorType:so,CommandBufferType:lo,LoadOp:co,StoreOp:ho,TextureLayout:uo,PipelineBindPoint:_o,DynamicStateFlagBit:fo,StencilFace:po,QueueType:mo,Rect:Zo,Viewport:Qo,Color:Jo,ClearFlag:vo,Offset:$o,Extent:ts,TextureSubres:es,TextureCopy:is,BufferTextureCopy:ns,FormatType:go,FormatInfo:Ao,MemoryStatus:bo,FormatInfos:xo},Ps=t("GFX_DESCRIPTOR_BUFFER_TYPE",so.UNIFORM_BUFFER|so.DYNAMIC_UNIFORM_BUFFER|so.STORAGE_BUFFER|so.DYNAMIC_STORAGE_BUFFER),Ms=t("GFX_DESCRIPTOR_SAMPLER_TYPE",so.SAMPLER),Ds=t("GFXDescriptorSetInfo",(function(t){this.layout=t})),Ns=t("GFXDescriptorSet",function(t){function e(e){var i;return(i=t.call(this,Na.DESCRIPTOR_SET)||this)._device=void 0,i._layout=null,i._buffers=[],i._textures=[],i._samplers=[],i._isDirty=!1,i._device=e,i}Y(e,t),q(e,[{key:"layout",get:function(){return this._layout}}]);var i=e.prototype;return i.bindBuffer=function(t,e,i){void 0===i&&(i=0);var n=this._layout.bindingIndices[t],r=this._layout.bindings[n];if(r)if(r.descriptorType&Ps){var a=this._layout.descriptorIndices[t];this._buffers[a+i]!==e&&(this._buffers[a+i]=e,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.UNIFORM_BUFFER.")},i.bindSampler=function(t,e,i){void 0===i&&(i=0);var n=this._layout.bindingIndices[t],r=this._layout.bindings[n];if(r)if(r.descriptorType&Ms){var a=this._layout.descriptorIndices[t];this._samplers[a+i]!==e&&(this._samplers[a+i]=e,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},i.bindTexture=function(t,e,i){void 0===i&&(i=0);var n=this._layout.bindingIndices[t],r=this._layout.bindings[n];if(r)if(r.descriptorType&Ms){var a=this._layout.descriptorIndices[t];this._textures[a+i]!==e&&(this._textures[a+i]=e,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},i.getBuffer=function(t,e){void 0===e&&(e=0);var i=this._layout.descriptorIndices[t];return this._buffers[i+e]},i.getSampler=function(t,e){void 0===e&&(e=0);var i=this._layout.descriptorIndices[t];return this._samplers[i+e]},i.getTexture=function(t,e){void 0===e&&(e=0);var i=this._layout.descriptorIndices[t];return this._textures[i+e]},e}(Eo)),Ls=t("GFXDescriptorSetLayoutBinding",(function(t,e,i,n,r){void 0===t&&(t=-1),void 0===e&&(e=so.UNKNOWN),void 0===i&&(i=0),void 0===n&&(n=oo.NONE),void 0===r&&(r=[]),this.binding=t,this.descriptorType=e,this.count=i,this.stageFlags=n,this.immutableSamplers=r})),Bs=t("GFXDescriptorSetLayoutInfo",(function(t){void 0===t&&(t=[]),this.bindings=t})),Fs=t("GFX_DESCRIPTOR_DYNAMIC_TYPE",so.DYNAMIC_STORAGE_BUFFER|so.DYNAMIC_UNIFORM_BUFFER),zs=t("GFXDescriptorSetLayout",function(t){function e(e){var i;return(i=t.call(this,Na.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,i._bindings=[],i._bindingIndices=[],i._descriptorIndices=[],i._device=e,i}return Y(e,t),q(e,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),e}(Eo)),Us=t("GFXPipelineLayoutInfo",(function(t){void 0===t&&(t=[]),this.setLayouts=t})),ks=t("GFXPipelineLayout",function(t){function e(e){var i;return(i=t.call(this,Na.PIPELINE_LAYOUT)||this)._device=void 0,i._setLayouts=[],i._device=e,i}return Y(e,t),q(e,[{key:"setLayouts",get:function(){return this._setLayouts}}]),e}(Eo)),Gs=t("GFXFenceInfo",(function(){})),Hs=t("GFXFence",function(t){function e(e){var i;return(i=t.call(this,Na.FENCE)||this)._device=void 0,i._device=e,i}return Y(e,t),e}(Eo));lt(n,"cc",[{name:"GFXDynamicState",newName:"DynamicStateFlagBit"},{name:"GFXBindingType",newName:"DescriptorType"},{name:"GFXBindingLayout",newName:"DescriptorSet"}]),ct(zo.prototype,"CommandBuffer.prototype",[{name:"bindBindingLayout",suggest:"Use `bindDescriptorSet` instead"}]);var Vs,Ws={MAX_ATTACHMENTS:"GFX_MAX_ATTACHMENTS",Obj:"GFXObject",getTypedArrayConstructor:""};for(var js in Os){var qs=Ws[js];""!==qs&&(void 0===qs&&(qs="GFX"+js),lt(n,"cc",[{name:qs,newName:js,target:n.gfx,targetName:"cc.gfx"}]))}n.gfx=Os,t("gfx",Object.freeze({__proto__:null,DESCRIPTOR_BUFFER_TYPE:Ps,DESCRIPTOR_SAMPLER_TYPE:Ms,DescriptorSetInfo:Ds,DescriptorSet:Ns,DrawInfo:Po,DRAW_INFO_SIZE:Mo,IndirectBuffer:Do,BufferInfo:No,BufferViewInfo:Lo,Buffer:Bo,CommandBufferInfo:Fo,CommandBuffer:zo,MAX_ATTACHMENTS:Fa,get ObjectType(){return Na},Obj:Eo,get AttributeName(){return za},get Type(){return Ua},get Format(){return ka},get BufferUsageBit(){return Ga},get MemoryUsageBit(){return Ha},get BufferFlagBit(){return Va},get BufferAccessBit(){return Wa},get PrimitiveMode(){return ja},get PolygonMode(){return qa},get ShadeModel(){return Xa},get CullMode(){return Ya},get ComparisonFunc(){return Ka},get StencilOp(){return Za},get BlendOp(){return Qa},get BlendFactor(){return Ja},get ColorMask(){return $a},get Filter(){return to},get Address(){return eo},get TextureType(){return io},get TextureUsageBit(){return no},get SampleCount(){return ro},get TextureFlagBit(){return ao},get ShaderStageFlagBit(){return oo},get DescriptorType(){return so},get CommandBufferType(){return lo},get LoadOp(){return co},get StoreOp(){return ho},get TextureLayout(){return uo},get PipelineBindPoint(){return _o},get DynamicStateFlagBit(){return fo},get StencilFace(){return po},get QueueType(){return mo},get ClearFlag(){return vo},get FormatType(){return go},get API(){return yo},get SurfaceTransform(){return To},get Feature(){return So},FormatInfo:Ao,MemoryStatus:bo,FormatInfos:xo,FormatSize:Co,FormatSurfaceSize:wo,GetTypeSize:Io,getTypedArrayConstructor:Oo,Rect:Zo,Viewport:Qo,Color:Jo,Offset:$o,Extent:ts,TextureSubres:es,TextureCopy:is,BufferTextureCopy:ns,BindingMappingInfo:Uo,DeviceInfo:ko,Device:Go,FramebufferInfo:Ho,Framebuffer:Vo,Attribute:Xo,InputAssemblerInfo:Yo,InputAssembler:Ko,DescriptorSetLayoutBinding:Ls,DescriptorSetLayoutInfo:Bs,DESCRIPTOR_DYNAMIC_TYPE:Fs,DescriptorSetLayout:zs,PipelineLayoutInfo:Us,PipelineLayout:ks,RasterizerState:rs,DepthStencilState:as,BlendTarget:os,BlendState:ss,InputState:ls,PipelineStateInfo:cs,PipelineState:hs,FenceInfo:Gs,Fence:Hs,QueueInfo:us,Queue:_s,ColorAttachment:fs,DepthStencilAttachment:ds,SubPassInfo:ps,RenderPassInfo:ms,RenderPass:vs,SamplerInfo:gs,Sampler:ys,ShaderStage:Ts,Uniform:Ss,UniformBlock:Es,UniformSampler:As,ShaderInfo:bs,Shader:xs,TextureInfo:Cs,TextureViewInfo:ws,IsPowerOf2:Rs,Texture:Is})),function(t){t[t.ALL=0]="ALL",t[t.CLOSEST=1]="CLOSEST",t[t.ANY=2]="ANY"}(Vs||(Vs={}));var Xs,Ys,Ks,Zs,Qs,Js,$s,tl,el=(Xs=new Ri(0,0,0),function(t,e){var i=Ri.dot(t.d,e.n);if(Math.abs(i)<Number.EPSILON)return 0;Ri.multiplyScalar(Xs,e.n,e.d);var n=Ri.dot(Ri.subtract(Xs,Xs,t.o),e.n)/i;return n<0?0:n}),il=(Ys=new Ri(0,0,0),Ks=new Ri(0,0,0),Zs=new Ri(0,0,0),Qs=new Ri(0,0,0),Js=new Ri(0,0,0),function(t,e,i){Ri.subtract(Ys,e.b,e.a),Ri.subtract(Ks,e.c,e.a),Ri.cross(Zs,t.d,Ks);var n=Ri.dot(Ys,Zs);if(n<Number.EPSILON&&(!i||n>-Number.EPSILON))return 0;var r=1/n;Ri.subtract(Qs,t.o,e.a);var a=Ri.dot(Qs,Zs)*r;if(a<0||a>1)return 0;Ri.cross(Js,Qs,Ys);var o=Ri.dot(t.d,Js)*r;if(o<0||a+o>1)return 0;var s=Ri.dot(Ks,Js)*r;return s<0?0:s}),nl=function(){var t=new Ri(0,0,0);return function(e,i){var n=i.radius,r=i.center,a=e.o,o=e.d,s=n*n;Ri.subtract(t,r,a);var l=t.lengthSqr(),c=Ri.dot(t,o),h=s-(l-c*c);if(h<0)return 0;var u=Math.sqrt(h),_=l<s?c+u:c-u;return _<0?0:_}}(),rl=($s=new Ri,tl=new Ri,function(t,e){return Ri.subtract($s,e.center,e.halfExtents),Ri.add(tl,e.center,e.halfExtents),al(t,$s,tl)});function al(t,e,i){var n=t.o,r=t.d,a=1/r.x,o=1/r.y,s=1/r.z,l=(e.x-n.x)*a,c=(i.x-n.x)*a,h=(e.y-n.y)*o,u=(i.y-n.y)*o,_=(e.z-n.z)*s,f=(i.z-n.z)*s,d=Math.max(Math.max(Math.min(l,c),Math.min(h,u)),Math.min(_,f)),p=Math.min(Math.min(Math.max(l,c),Math.max(h,u)),Math.max(_,f));return p<0||d>p?0:d>0?d:p}var ol,sl,ll,cl,hl=function(){var t=new Ri,e=new Ri,i=new Ri,n=new Ri,r=new Ri,a=new Ri,o=new Ri,s=new Array(3),l=new Array(3),c=new Array(3),h=new Array(6);return function(u,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,t=_.center,e=u.o,i=u.d,Ri.set(n,_.orientation.m00,_.orientation.m01,_.orientation.m02),Ri.set(r,_.orientation.m03,_.orientation.m04,_.orientation.m05),Ri.set(a,_.orientation.m06,_.orientation.m07,_.orientation.m08),Ri.subtract(o,t,e),l[0]=Ri.dot(n,i),l[1]=Ri.dot(r,i),l[2]=Ri.dot(a,i),c[0]=Ri.dot(n,o),c[1]=Ri.dot(r,o),c[2]=Ri.dot(a,o);for(var f=0;f<3;++f){if(0===l[f]){if(-c[f]-s[f]>0||-c[f]+s[f]<0)return 0;l[f]=1e-7}h[2*f+0]=(c[f]+s[f])/l[f],h[2*f+1]=(c[f]-s[f])/l[f]}var d=Math.max(Math.max(Math.min(h[0],h[1]),Math.min(h[2],h[3])),Math.min(h[4],h[5])),p=Math.min(Math.min(Math.max(h[0],h[1]),Math.max(h[2],h[3])),Math.max(h[4],h[5]));return p<0||d>p?0:d>0?d:p}}(),ul=function(){var t=new Ri,e=new Ri,i=new Ri,n=new Ri,r=new Ri,a=new Ri,o=new Ri,s=new La;return function(l,c){var h=c.radius*c.radius,u=Ri.normalize(t,l.d),_=c.ellipseCenter0,f=c.ellipseCenter1,d=Ri.subtract(e,f,_);if(d.equals(Ri.ZERO))return s.radius=c.radius,s.center.set(c.ellipseCenter0),Kl.raySphere(l,s);var p=l.o,m=Ri.subtract(i,p,_),v=Ri.cross(n,u,d),g=v.lengthSqr();if(0===g){s.radius=c.radius;var y=Ri.subtract(r,f,p);return m.lengthSqr()<y.lengthSqr()?s.center.set(c.ellipseCenter0):s.center.set(c.ellipseCenter1),Kl.raySphere(l,s)}var T=Ri.cross(r,m,d),S=d.lengthSqr(),E=2*Ri.dot(v,T),A=E*E-4*g*(T.lengthSqr()-h*S);if(A<0)return 0;var b=(-E-Math.sqrt(A))/(2*g);if(b<0){s.radius=c.radius;var x=Ri.subtract(a,f,p);return m.lengthSqr()<x.lengthSqr()?s.center.set(c.ellipseCenter0):s.center.set(c.ellipseCenter1),Kl.raySphere(l,s)}var C=Ri.scaleAndAdd(a,l.o,u,b),w=Ri.subtract(o,C,_),R=Ri.dot(w,d)/S;return R>=0&&R<=1?b:R<0?(s.radius=c.radius,s.center.set(c.ellipseCenter0),Kl.raySphere(l,s)):R>1?(s.radius=c.radius,s.center.set(c.ellipseCenter1),Kl.raySphere(l,s)):0}}(),_l=(ol=Ba.create(),sl={distance:1/0,doubleSided:!1,mode:Vs.ANY},ll=0,cl=function(t,e,i,n,r,a){t===Vs.CLOSEST?(ll>e||0===ll)&&(ll=e,a&&(0===a.length?a.push({distance:e,vertexIndex0:i/3,vertexIndex1:n/3,vertexIndex2:r/3}):(a[0].distance=e,a[0].vertexIndex0=i/3,a[0].vertexIndex1=n/3,a[0].vertexIndex2=r/3))):(ll=e,a&&a.push({distance:e,vertexIndex0:i/3,vertexIndex1:n/3,vertexIndex2:r/3}))},function(t,e,i){if(ll=0,0===e.geometricInfo.positions.length)return ll;var n=void 0===i?sl:i;if(al(t,e.geometricInfo.boundingBox.min,e.geometricInfo.boundingBox.max)){var r=e.primitiveMode,a=e.geometricInfo;!function(t,e,i,n,r){if(i===ja.TRIANGLE_LIST)for(var a=e.length,o=0;o<a;o+=3){var s=3*e[o],l=3*e[o+1],c=3*e[o+2];Ri.set(ol.a,t[s],t[s+1],t[s+2]),Ri.set(ol.b,t[l],t[l+1],t[l+2]),Ri.set(ol.c,t[c],t[c+1],t[c+2]);var h=Kl.rayTriangle(n,ol,r.doubleSided);if(!(0===h||h>r.distance)&&(cl(r.mode,h,s,l,c,r.result),r.mode===Vs.ANY))return h}else if(i===ja.TRIANGLE_STRIP)for(var u=e.length-2,_=0,f=0;f<u;f+=1){var d=3*e[f-_],p=3*e[f+_+1],m=3*e[f+2];Ri.set(ol.a,t[d],t[d+1],t[d+2]),Ri.set(ol.b,t[p],t[p+1],t[p+2]),Ri.set(ol.c,t[m],t[m+1],t[m+2]),_=~_;var v=Kl.rayTriangle(n,ol,r.doubleSided);if(!(0===v||v>r.distance)&&(cl(r.mode,v,d,p,m,r.result),r.mode===Vs.ANY))return v}else if(i===ja.TRIANGLE_FAN){var g=e.length-1,y=3*e[0];Ri.set(ol.a,t[y],t[y+1],t[y+2]);for(var T=1;T<g;T+=1){var S=3*e[T],E=3*e[T+1];Ri.set(ol.b,t[S],t[S+1],t[S+2]),Ri.set(ol.c,t[E],t[E+1],t[E+2]);var A=Kl.rayTriangle(n,ol,r.doubleSided);if(!(0===A||A>r.distance)&&(cl(r.mode,A,y,S,E,r.result),r.mode===Vs.ANY))return A}}}(a.positions,a.indices,r,t,n)}return ll}),fl=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:Vs.ANY};return function(i,n,r){t=0;var a=void 0===r?e:r,o=n.renderingSubMeshes.length,s=n.struct.minPosition,l=n.struct.maxPosition;if(s&&l&&!al(i,s,l))return t;for(var c=0;c<o;c++){var h=n.renderingSubMeshes[c],u=_l(i,h,a);if(u)if(a.mode===Vs.CLOSEST)(0===t||t>u)&&(t=u,a.subIndices&&(a.subIndices[0]=c));else if(t=u,a.subIndices&&a.subIndices.push(c),a.mode===Vs.ANY)return u}return t&&a.mode===Vs.CLOSEST&&(a.result&&(a.result[0].distance=t,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),t}}(),dl=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:Vs.ANY},i=new Ra,n=new Vi;return function(r,a,o){t=0;var s=void 0===o?e:o,l=a.worldBounds;if(l&&!rl(r,l))return t;Ra.copy(i,r),a.node&&(Vi.invert(n,a.node.getWorldMatrix(n)),Ri.transformMat4(i.o,r.o,n),Ri.transformMat4Normal(i.d,r.d,n));for(var c=a.subModels,h=0;h<c.length;h++){var u=c[h].subMesh,_=_l(i,u,s);if(_)if(s.mode===Vs.CLOSEST)(0===t||t>_)&&(t=_,s.subIndices&&(s.subIndices[0]=h));else if(t=_,s.subIndices&&s.subIndices.push(h),s.mode===Vs.ANY)return _}return t&&s.mode===Vs.CLOSEST&&(s.result&&(s.result[0].distance=t,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),t}}(),pl=function(){var t=new Ri(0,0,0);return function(e,i){Ri.subtract(t,e.e,e.s);var n=(i.d-Ri.dot(e.s,i.n))/Ri.dot(t,i.n);return n<0||n>1?0:n}}(),ml=function(){var t=new Ri(0,0,0),e=new Ri(0,0,0),i=new Ri(0,0,0),n=new Ri(0,0,0),r=new Ri(0,0,0),a=new Ri(0,0,0);return function(o,s,l){Ri.subtract(t,s.b,s.a),Ri.subtract(e,s.c,s.a),Ri.subtract(i,o.s,o.e),Ri.cross(r,t,e);var c=Ri.dot(i,r);if(c<=0)return 0;Ri.subtract(n,o.s,s.a);var h=Ri.dot(n,r);if(h<0||h>c)return 0;Ri.cross(a,i,n);var u=Ri.dot(e,a);if(u<0||u>c)return 0;var _=-Ri.dot(t,a);if(_<0||u+_>c)return 0;if(l){var f=1/c,d=1-(u*=f)-(_*=f);Ri.set(l,s.a.x*d+s.b.x*u+s.c.x*_,s.a.y*d+s.b.y*u+s.c.y*_,s.a.z*d+s.b.z*u+s.c.z*_)}return 1}}(),vl=new Ra;function gl(t,e){vl.o.set(t.s),Ri.subtract(vl.d,t.e,t.s),vl.d.normalize();var i=rl(vl,e);return i<=t.length()?i:0}function yl(t,e){vl.o.set(t.s),Ri.subtract(vl.d,t.e,t.s),vl.d.normalize();var i=hl(vl,e);return i<=t.length()?i:0}function Tl(t,e){vl.o.set(t.s),Ri.subtract(vl.d,t.e,t.s),vl.d.normalize();var i=nl(vl,e);return i<=t.length()?i:0}var Sl,El,Al,bl,xl=(Sl=new Ri,El=new Ri,Al=new Ri,bl=new Ri,function(t,e){return Ri.subtract(Sl,t.center,t.halfExtents),Ri.add(El,t.center,t.halfExtents),Ri.subtract(Al,e.center,e.halfExtents),Ri.add(bl,e.center,e.halfExtents),Sl.x<=bl.x&&El.x>=Al.x&&Sl.y<=bl.y&&El.y>=Al.y&&Sl.z<=bl.z&&El.z>=Al.z});function Cl(t,e,i,n,r,a){Ri.set(a[0],t.x+i.x*e.x+n.x*e.y+r.x*e.z,t.y+i.y*e.x+n.y*e.y+r.y*e.z,t.z+i.z*e.x+n.z*e.y+r.z*e.z),Ri.set(a[1],t.x-i.x*e.x+n.x*e.y+r.x*e.z,t.y-i.y*e.x+n.y*e.y+r.y*e.z,t.z-i.z*e.x+n.z*e.y+r.z*e.z),Ri.set(a[2],t.x+i.x*e.x-n.x*e.y+r.x*e.z,t.y+i.y*e.x-n.y*e.y+r.y*e.z,t.z+i.z*e.x-n.z*e.y+r.z*e.z),Ri.set(a[3],t.x+i.x*e.x+n.x*e.y-r.x*e.z,t.y+i.y*e.x+n.y*e.y-r.y*e.z,t.z+i.z*e.x+n.z*e.y-r.z*e.z),Ri.set(a[4],t.x-i.x*e.x-n.x*e.y-r.x*e.z,t.y-i.y*e.x-n.y*e.y-r.y*e.z,t.z-i.z*e.x-n.z*e.y-r.z*e.z),Ri.set(a[5],t.x+i.x*e.x-n.x*e.y-r.x*e.z,t.y+i.y*e.x-n.y*e.y-r.y*e.z,t.z+i.z*e.x-n.z*e.y-r.z*e.z),Ri.set(a[6],t.x-i.x*e.x+n.x*e.y-r.x*e.z,t.y-i.y*e.x+n.y*e.y-r.y*e.z,t.z-i.z*e.x+n.z*e.y-r.z*e.z),Ri.set(a[7],t.x-i.x*e.x-n.x*e.y+r.x*e.z,t.y-i.y*e.x-n.y*e.y+r.y*e.z,t.z-i.z*e.x-n.z*e.y+r.z*e.z)}function wl(t,e){for(var i=Ri.dot(e,t[0]),n=i,r=1;r<8;++r){var a=Ri.dot(e,t[r]);i=a<i?a:i,n=a>n?a:n}return[i,n]}var Rl,Il,Ol,Pl=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Ri(0,0,0);for(var i=new Array(8),n=new Array(8),r=0;r<8;r++)i[r]=new Ri(0,0,0),n[r]=new Ri(0,0,0);var a=new Ri,o=new Ri;return function(e,r){Ri.set(t[0],1,0,0),Ri.set(t[1],0,1,0),Ri.set(t[2],0,0,1),Ri.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Ri.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Ri.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Ri.cross(t[6+3*s],t[s],t[0]),Ri.cross(t[7+3*s],t[s],t[1]),Ri.cross(t[7+3*s],t[s],t[2]);Ri.subtract(a,e.center,e.halfExtents),Ri.add(o,e.center,e.halfExtents),function(t,e,i){Ri.set(i[0],t.x,e.y,e.z),Ri.set(i[1],t.x,e.y,t.z),Ri.set(i[2],t.x,t.y,e.z),Ri.set(i[3],t.x,t.y,t.z),Ri.set(i[4],e.x,e.y,e.z),Ri.set(i[5],e.x,e.y,t.z),Ri.set(i[6],e.x,t.y,e.z),Ri.set(i[7],e.x,t.y,t.z)}(a,o,i),Cl(r.center,r.halfExtents,t[3],t[4],t[5],n);for(var l=0;l<15;++l){var c=wl(i,t[l]),h=wl(n,t[l]);if(h[0]>c[1]||c[0]>h[1])return 0}return 1}}(),Ml=function(t,e){var i=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),n=Ri.dot(e.n,t.center);return n+i<e.d?-1:n-i>e.d?0:1},Dl=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Ml(t,e.planes[i]))return 0;return 1},Nl=function(){for(var t=new Array(8),e=0,i=0,n=0;n<t.length;n++)t[n]=new Ri(0,0,0);return function(n,r){for(var a=0,o=!1,s=0;s<r.planes.length;s++){if(-1===(a=Ml(n,r.planes[s])))return 0;1===a&&(o=!0)}if(!o)return 1;for(var l=0;l<r.vertices.length;l++)Ri.subtract(t[l],r.vertices[l],n.center);e=0,i=0;for(var c=0;c<r.vertices.length;c++)t[c].x>n.halfExtents.x?e++:t[c].x<-n.halfExtents.x&&i++;if(e===r.vertices.length||i===r.vertices.length)return 0;e=0,i=0;for(var h=0;h<r.vertices.length;h++)t[h].y>n.halfExtents.y?e++:t[h].y<-n.halfExtents.y&&i++;if(e===r.vertices.length||i===r.vertices.length)return 0;e=0,i=0;for(var u=0;u<r.vertices.length;u++)t[u].z>n.halfExtents.z?e++:t[u].z<-n.halfExtents.z&&i++;return e===r.vertices.length||i===r.vertices.length?0:1}}(),Ll=(Rl=new Ri(0,0,0),Il=new Mi,function(t,e){return Ri.subtract(Rl,e,t.center),Ri.transformMat3(Rl,Rl,Mi.transpose(Il,t.orientation)),i=Rl,n=t.halfExtents,Math.abs(i.x)<n.x&&Math.abs(i.y)<n.y&&Math.abs(i.z)<n.z;var i,n}),Bl=(Ol=function(t,e,i,n){return Math.abs(t.x*e+t.y*i+t.z*n)},function(t,e){var i=t.halfExtents.x*Ol(e.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*Ol(e.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*Ol(e.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),n=Ri.dot(e.n,t.center);return n+i<e.d?-1:n-i>e.d?0:1}),Fl=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Bl(t,e.planes[i]))return 0;return 1},zl=function(){for(var t=new Array(8),e=0,i=0,n=0,r=0;r<t.length;r++)t[r]=new Ri(0,0,0);var a=function(t,e,i,n){return t.x*e+t.y*i+t.z*n};return function(r,o){for(var s=0,l=!1,c=0;c<o.planes.length;c++){if(-1===(s=Bl(r,o.planes[c])))return 0;1===s&&(l=!0)}if(!l)return 1;for(var h=0;h<o.vertices.length;h++)Ri.subtract(t[h],o.vertices[h],r.center);i=0,n=0;for(var u=0;u<o.vertices.length;u++)(e=a(t[u],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?i++:e<-r.halfExtents.x&&n++;if(i===o.vertices.length||n===o.vertices.length)return 0;i=0,n=0;for(var _=0;_<o.vertices.length;_++)(e=a(t[_],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?i++:e<-r.halfExtents.y&&n++;if(i===o.vertices.length||n===o.vertices.length)return 0;i=0,n=0;for(var f=0;f<o.vertices.length;f++)(e=a(t[f],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?i++:e<-r.halfExtents.z&&n++;return i===o.vertices.length||n===o.vertices.length?0:1}}(),Ul=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Ri(0,0,0);for(var i=new Array(8),n=new Array(8),r=0;r<8;r++)i[r]=new Ri(0,0,0),n[r]=new Ri(0,0,0);return function(e,r){Ri.set(t[0],e.orientation.m00,e.orientation.m01,e.orientation.m02),Ri.set(t[1],e.orientation.m03,e.orientation.m04,e.orientation.m05),Ri.set(t[2],e.orientation.m06,e.orientation.m07,e.orientation.m08),Ri.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Ri.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Ri.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var a=0;a<3;++a)Ri.cross(t[6+3*a],t[a],t[0]),Ri.cross(t[7+3*a],t[a],t[1]),Ri.cross(t[7+3*a],t[a],t[2]);Cl(e.center,e.halfExtents,t[0],t[1],t[2],i),Cl(r.center,r.halfExtents,t[3],t[4],t[5],n);for(var o=0;o<15;++o){var s=wl(i,t[o]),l=wl(n,t[o]);if(l[0]>s[1]||s[0]>l[1])return 0}return 1}}(),kl=function(){for(var t=new La,e=new Ri,i=new Ri,n=new Ri,r=new Array(8),a=0;a<8;a++)r[a]=new Ri;for(var o=new Array(8),s=0;s<8;s++)o[s]=new Ri;return function(a,s){if(0===Ri.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return t.radius=s.radius,t.center.set(s.ellipseCenter0),Kl.sphereOBB(t,a);e.x=a.orientation.m00,e.y=a.orientation.m01,e.z=a.orientation.m02,i.x=a.orientation.m03,i.y=a.orientation.m04,i.z=a.orientation.m05,n.x=a.orientation.m06,n.y=a.orientation.m07,n.z=a.orientation.m08,Cl(a.center,a.halfExtents,e,i,n,r);var l=o,c=Ri.copy(l[0],e),h=Ri.copy(l[1],i),u=Ri.copy(l[2],n);Ri.subtract(l[3],s.center,a.center).normalize();var _=Ri.subtract(l[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),Ri.cross(l[5],c,_),Ri.cross(l[6],h,_),Ri.cross(l[7],u,_);for(var f=0;f<8;++f){var d=wl(r,l[f]),p=Ri.dot(l[f],s.ellipseCenter0),m=Ri.dot(l[f],s.ellipseCenter1),v=Math.max(p,m),g=Math.min(p,m)-s.radius,y=v+s.radius;if(g>d[1]||d[0]>y)return 0}return 1}}(),Gl=function(t,e){var i=Ri.dot(e.n,t.center),n=t.radius*e.n.length();return i+n<e.d?-1:i-n>e.d?0:1},Hl=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===Gl(t,e.planes[i]))return 0;return 1},Vl=function(){var t=new Ri(0,0,0),e=[1,-1,1,-1,1,-1];return function(i,n){for(var r=0;r<6;r++){var a=n.planes[r],o=i.radius,s=i.center,l=a.n,c=a.d,h=Ri.dot(l,s);if(h+o<c)return 0;if(!(h-o>c)){Ri.add(t,s,Ri.multiplyScalar(t,l,o));for(var u=0;u<6;u++)if(u!==r&&u!==r+e[r]){var _=n.planes[u];if(Ri.dot(_.n,t)<_.d)return 0}}}return 1}}(),Wl=function(t,e){var i=t.radius+e.radius;return Ri.squaredDistance(t.center,e.center)<i*i},jl=function(){var t=new Ri;return function(e,i){return Aa(t,e.center,i),Ri.squaredDistance(e.center,t)<e.radius*e.radius}}(),ql=function(){var t=new Ri;return function(e,i){return ba(t,e.center,i),Ri.squaredDistance(e.center,t)<e.radius*e.radius}}(),Xl=function(){var t=new Ri,e=new Ri;return function(i,n){var r=i.radius+n.radius,a=r*r,o=Ri.squaredDistance(n.ellipseCenter0,n.ellipseCenter1);if(0===o)return Ri.squaredDistance(i.center,n.center)<a;Ri.subtract(t,i.center,n.ellipseCenter0),Ri.subtract(e,n.ellipseCenter1,n.ellipseCenter0);var s=Ri.dot(t,e)/o;return s<0?Ri.squaredDistance(i.center,n.ellipseCenter0)<a:s>1?Ri.squaredDistance(i.center,n.ellipseCenter1)<a:(Ri.scaleAndAdd(t,n.ellipseCenter0,e,s),Ri.squaredDistance(i.center,t)<a)}}(),Yl=function(){var t=new Ri,e=new Ri,i=new Ri,n=new Ri,r=new Ri,a=new Ri;return function(o,s){var l,c,h,u,_=Ri.subtract(t,o.ellipseCenter1,o.ellipseCenter0),f=Ri.subtract(e,s.ellipseCenter1,s.ellipseCenter0),d=Ri.subtract(i,o.ellipseCenter0,s.ellipseCenter0),p=Ri.dot(_,_),m=Ri.dot(_,f),v=Ri.dot(f,f),g=Ri.dot(_,d),y=Ri.dot(f,d),T=p*v-m*m,S=T,E=T;T<oi?(c=0,S=1,u=y,E=v):(u=p*y-m*g,(c=m*y-v*g)<0?(c=0,u=y,E=v):c>S&&(c=S,u=y+m,E=v)),u<0?(u=0,-g<0?c=0:-g>p?c=S:(c=-g,S=p)):u>E&&(u=E,-g+m<0?c=0:-g+m>p?c=S:(c=-g+m,S=p)),l=Math.abs(c)<oi?0:c/S,h=Math.abs(u)<oi?0:u/E;var A=n;A.set(d),A.add(Ri.multiplyScalar(r,_,l)),A.subtract(Ri.multiplyScalar(a,f,h));var b=o.radius+s.radius;return A.lengthSqr()<b*b}}(),Kl={raySphere:nl,rayAABB:rl,rayOBB:hl,rayPlane:el,rayTriangle:il,rayCapsule:ul,raySubMesh:_l,rayMesh:fl,rayModel:dl,lineSphere:Tl,lineAABB:gl,lineOBB:yl,linePlane:pl,lineTriangle:ml,sphereWithSphere:Wl,sphereAABB:jl,sphereOBB:ql,spherePlane:Gl,sphereFrustum:Hl,sphereFrustumAccurate:Vl,sphereCapsule:Xl,aabbWithAABB:xl,aabbWithOBB:Pl,aabbPlane:Ml,aabbFrustum:Dl,aabbFrustumAccurate:Nl,obbWithOBB:Ul,obbPlane:Bl,obbFrustum:Fl,obbFrustumAccurate:zl,obbPoint:Ll,obbCapsule:kl,capsuleWithCapsule:Yl,resolve:function(t,e,i){void 0===i&&(i=null);var n=t._type,r=e._type,a=this[n|r];return n<r?a(t,e,i):a(e,t,i)}};Kl[Ca.SHAPE_RAY|Ca.SHAPE_SPHERE]=nl,Kl[Ca.SHAPE_RAY|Ca.SHAPE_AABB]=rl,Kl[Ca.SHAPE_RAY|Ca.SHAPE_OBB]=hl,Kl[Ca.SHAPE_RAY|Ca.SHAPE_PLANE]=el,Kl[Ca.SHAPE_RAY|Ca.SHAPE_TRIANGLE]=il,Kl[Ca.SHAPE_RAY|Ca.SHAPE_CAPSULE]=ul,Kl[Ca.SHAPE_LINE|Ca.SHAPE_SPHERE]=Tl,Kl[Ca.SHAPE_LINE|Ca.SHAPE_AABB]=gl,Kl[Ca.SHAPE_LINE|Ca.SHAPE_OBB]=yl,Kl[Ca.SHAPE_LINE|Ca.SHAPE_PLANE]=pl,Kl[Ca.SHAPE_LINE|Ca.SHAPE_TRIANGLE]=ml,Kl[Ca.SHAPE_SPHERE]=Wl,Kl[Ca.SHAPE_SPHERE|Ca.SHAPE_AABB]=jl,Kl[Ca.SHAPE_SPHERE|Ca.SHAPE_OBB]=ql,Kl[Ca.SHAPE_SPHERE|Ca.SHAPE_PLANE]=Gl,Kl[Ca.SHAPE_SPHERE|Ca.SHAPE_FRUSTUM]=Hl,Kl[Ca.SHAPE_SPHERE|Ca.SHAPE_FRUSTUM_ACCURATE]=Vl,Kl[Ca.SHAPE_SPHERE|Ca.SHAPE_CAPSULE]=Xl,Kl[Ca.SHAPE_AABB]=xl,Kl[Ca.SHAPE_AABB|Ca.SHAPE_OBB]=Pl,Kl[Ca.SHAPE_AABB|Ca.SHAPE_PLANE]=Ml,Kl[Ca.SHAPE_AABB|Ca.SHAPE_FRUSTUM]=Dl,Kl[Ca.SHAPE_AABB|Ca.SHAPE_FRUSTUM_ACCURATE]=Nl,Kl[Ca.SHAPE_OBB]=Ul,Kl[Ca.SHAPE_OBB|Ca.SHAPE_PLANE]=Bl,Kl[Ca.SHAPE_OBB|Ca.SHAPE_FRUSTUM]=Fl,Kl[Ca.SHAPE_OBB|Ca.SHAPE_FRUSTUM_ACCURATE]=zl,Kl[Ca.SHAPE_OBB|Ca.SHAPE_CAPSULE]=kl,Kl[Ca.SHAPE_CAPSULE]=Yl,lt(wa.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),ct(Kl,"intersect",[{name:"line_quad"}]);var Zl=new Ri(0,0,0),Ql=new Ri(0,0,0),Jl=n.mat4(),$l=n.v4(),tc=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=Ca.SHAPE_PLANE,this.n=new Ri(t,e,i),this.d=n}return t.create=function(e,i,n,r){return new t(e,i,n,r)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return Ri.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,i,n){return Ri.subtract(Zl,i,e),Ri.subtract(Ql,n,e),Ri.normalize(t.n,Ri.cross(t.n,Zl,Ql)),t.d=Ri.dot(t.n,e),t},t.set=function(t,e,i,n,r){return t.n.x=e,t.n.y=i,t.n.z=n,t.d=r,t},t.fromNormalAndPoint=function(t,e,i){return Ri.copy(t.n,e),t.d=Ri.dot(e,i),t},t.normalize=function(t,e){var i=e.n.length();return Ri.normalize(t.n,e.n),i>0&&(t.d=e.d/i),t},q(t,[{key:"type",get:function(){return this._type}},{key:"x",set:function(t){this.n.x=t},get:function(){return this.n.x}},{key:"y",set:function(t){this.n.y=t},get:function(){return this.n.y}},{key:"z",set:function(t){this.n.z=t},get:function(){return this.n.z}},{key:"w",set:function(t){this.d=t},get:function(){return this.d}}]),t.prototype.transform=function(t){Vi.invert(Jl,t),Vi.transpose(Jl,Jl),Qi.set($l,this.n.x,this.n.y,this.n.z,this.d),Qi.transformMat4($l,$l,Jl),Ri.set(this.n,$l.x,$l.y,$l.z),this.d=$l.w},t}(),ec=new Ri,ic=new Ri,nc=new Ri,rc=new Ri,ac=new Mi,oc=function(t,e,i){ac.m00=Math.abs(i.m00),ac.m01=Math.abs(i.m01),ac.m02=Math.abs(i.m02),ac.m03=Math.abs(i.m04),ac.m04=Math.abs(i.m05),ac.m05=Math.abs(i.m06),ac.m06=Math.abs(i.m08),ac.m07=Math.abs(i.m09),ac.m08=Math.abs(i.m10),Ri.transformMat3(t,e,ac)},sc=function(){function t(t,e,i,n,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=Ca.SHAPE_AABB,this.center=new Ri(t,e,i),this.halfExtents=new Ri(n,r,a)}t.create=function(e,i,n,r,a,o){return new t(e,i,n,r,a,o)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return Ri.copy(t.center,e.center),Ri.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,i){return Ri.add(ec,i,e),Ri.subtract(ic,i,e),Ri.multiplyScalar(t.center,ec,.5),Ri.multiplyScalar(t.halfExtents,ic,.5),t},t.set=function(t,e,i,n,r,a,o){return Ri.set(t.center,e,i,n),Ri.set(t.halfExtents,r,a,o),t},t.merge=function(e,i,n){return Ri.subtract(ec,i.center,i.halfExtents),Ri.subtract(ic,n.center,n.halfExtents),Ri.add(nc,i.center,i.halfExtents),Ri.add(rc,n.center,n.halfExtents),Ri.max(rc,nc,rc),Ri.min(nc,ec,ic),t.fromPoints(e,nc,rc)},t.toBoundingSphere=function(t,e){e.getBoundary(ec,ic),t.center.set(ec),t.radius=0,Ri.subtract(nc,ic,t.center);var i=nc.length(),n=.5*i;return t.radius+=n,Ri.multiplyScalar(nc,nc,n/i),Ri.add(t.center,t.center,nc),t},t.transform=function(t,e,i){return Ri.transformMat4(t.center,e.center,i),oc(t.halfExtents,e.halfExtents,i),t},q(t,[{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.getBoundary=function(t,e){Ri.subtract(t,this.center,this.halfExtents),Ri.add(e,this.center,this.halfExtents)},e.transform=function(t,e,i,n,r){Ri.transformMat4(r.center,this.center,t),oc(r.halfExtents,this.halfExtents,t)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},t}(),lc=new Ri,cc=new Ri,hc=new Mi,uc=function(){function t(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=Ca.SHAPE_OBB,this.center=new Ri(t,e,i),this.halfExtents=new Ri(n,r,a),this.orientation=new Mi(o,s,l,c,h,u,_,f,d)}t.create=function(e,i,n,r,a,o,s,l,c,h,u,_,f,d,p){return new t(e,i,n,r,a,o,s,l,c,h,u,_,f,d,p)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)},t.copy=function(t,e){return Ri.copy(t.center,e.center),Ri.copy(t.halfExtents,e.halfExtents),Mi.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,i){return Ri.multiplyScalar(t.center,Ri.add(lc,e,i),.5),Ri.multiplyScalar(t.halfExtents,Ri.subtract(cc,i,e),.5),Mi.identity(t.orientation),t},t.set=function(t,e,i,n,r,a,o,s,l,c,h,u,_,f,d,p){return Ri.set(t.center,e,i,n),Ri.set(t.halfExtents,r,a,o),Mi.set(t.orientation,s,l,c,h,u,_,f,d,p),t},q(t,[{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.getBoundary=function(t,e){!function(t,e,i){hc.m00=Math.abs(i.m00),hc.m01=Math.abs(i.m01),hc.m02=Math.abs(i.m02),hc.m03=Math.abs(i.m03),hc.m04=Math.abs(i.m04),hc.m05=Math.abs(i.m05),hc.m06=Math.abs(i.m06),hc.m07=Math.abs(i.m07),hc.m08=Math.abs(i.m08),Ri.transformMat3(t,e,hc)}(lc,this.halfExtents,this.orientation),Ri.subtract(t,this.center,lc),Ri.add(e,this.center,lc)},e.transform=function(t,e,i,n,r){Ri.transformMat4(r.center,this.center,t),Mi.fromQuat(r.orientation,i),Ri.multiply(r.halfExtents,this.halfExtents,n)},e.translateAndRotate=function(t,e,i){Ri.transformMat4(i.center,this.center,t),Mi.fromQuat(i.orientation,e)},e.setScale=function(t,e){Ri.multiply(e.halfExtents,this.halfExtents,t)},t}(),_c=function(){function t(t,e,i){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=Ca.SHAPE_CAPSULE,this.radius=t,this.halfHeight=e,this.axis=i,this.center=new Ri,this.rotation=new Li,this.ellipseCenter0=new Ri(0,e,0),this.ellipseCenter1=new Ri(0,-e,0),this.updateCache()}q(t,[{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.transform=function(t,e,i,n,r){var a=n,o=bi(a);r.radius=this.radius*Math.abs(o);var s=(this.halfHeight+this.radius)*Math.abs(a.y)-r.radius;s<0&&(s=0),r.halfHeight=s,Ri.transformMat4(r.center,this.center,t),Li.multiply(r.rotation,this.rotation,i),r.updateCache()},e.updateCache=function(){this.updateLocalCenter(),Ri.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Ri.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},e.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},t}(),fc=new Array(8);fc[0]=new Ri(1,1,1),fc[1]=new Ri(-1,1,1),fc[2]=new Ri(-1,-1,1),fc[3]=new Ri(1,-1,1),fc[4]=new Ri(1,1,-1),fc[5]=new Ri(-1,1,-1),fc[6]=new Ri(-1,-1,-1),fc[7]=new Ri(1,-1,-1);var dc,pc,mc=function(){function t(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=Ca.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=tc.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new Ri}t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e._type;for(var i=0;i<6;++i)tc.copy(t.planes[i],e.planes[i]);for(var n=0;n<8;++n)Ri.copy(t.vertices[n],e.vertices[n]);return t},q(t,[{key:"accurate",set:function(t){this._type=t?Ca.SHAPE_FRUSTUM_ACCURATE:Ca.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]);var e=t.prototype;return e.update=function(t,e){if(Ri.set(this.planes[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),this.planes[0].d=-(t.m15+t.m12),Ri.set(this.planes[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),this.planes[1].d=-(t.m15-t.m12),Ri.set(this.planes[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),this.planes[2].d=-(t.m15+t.m13),Ri.set(this.planes[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),this.planes[3].d=-(t.m15-t.m13),Ri.set(this.planes[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),this.planes[4].d=-(t.m15+t.m14),Ri.set(this.planes[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),this.planes[5].d=-(t.m15-t.m14),this._type===Ca.SHAPE_FRUSTUM_ACCURATE){for(var i=0;i<6;i++){var n=this.planes[i],r=1/n.n.length();Ri.multiplyScalar(n.n,n.n,r),n.d*=r}for(var a=0;a<8;a++)Ri.transformMat4(this.vertices[a],fc[a],e)}},e.transform=function(t){if(this._type===Ca.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)Ri.transformMat4(this.vertices[e],this.vertices[e],t);tc.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),tc.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),tc.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),tc.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),tc.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),tc.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},t}();function vc(t,e){if(e&&0!==t){for(var i=e.vertices,n=wr.VERTICES,r=0;r<8;++r)Mr.setVec3(t,n,i[r]),n+=3;for(var a=e.planes,o=wr.PLANES,s=0;s<6;s++,o+=4)Mr.setVec4(t,o,a[s])}}mc.createOrtho=function(){var t=new Ri;return function(e,i,n,r,a,o){var s=i/2,l=n/2;Ri.set(t,s,l,r),Ri.transformMat4(e.vertices[0],t,o),Ri.set(t,-s,l,r),Ri.transformMat4(e.vertices[1],t,o),Ri.set(t,-s,-l,r),Ri.transformMat4(e.vertices[2],t,o),Ri.set(t,s,-l,r),Ri.transformMat4(e.vertices[3],t,o),Ri.set(t,s,l,a),Ri.transformMat4(e.vertices[4],t,o),Ri.set(t,-s,l,a),Ri.transformMat4(e.vertices[5],t,o),Ri.set(t,-s,-l,a),Ri.transformMat4(e.vertices[6],t,o),Ri.set(t,s,-l,a),Ri.transformMat4(e.vertices[7],t,o),tc.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),tc.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),tc.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),tc.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),tc.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),tc.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}}(),function(t){t[t.Default=0]="Default",t[t.Normal=1]="Normal",t[t.Loop=2]="Loop",t[t.ShouldWrap=4]="ShouldWrap",t[t.Clamp=8]="Clamp",t[t.PingPong=22]="PingPong",t[t.Reverse=36]="Reverse"}(dc||(dc={})),function(t){t[t.Default=dc.Default]="Default",t[t.Normal=dc.Normal]="Normal",t[t.Reverse=dc.Reverse]="Reverse",t[t.Loop=dc.Loop]="Loop",t[t.LoopReverse=dc.Loop|dc.Reverse]="LoopReverse",t[t.PingPong=dc.PingPong]="PingPong",t[t.PingPongReverse=dc.PingPong|dc.Reverse]="PingPongReverse"}(pc||(pc={})),fe(pc);var gc=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}(),yc=he({Default:dc.Default,Normal:dc.Normal,Clamp:dc.Clamp,Loop:dc.Loop,PingPong:dc.PingPong}),Tc=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};ei.fastDefine("cc.Keyframe",Tc,{time:0,value:0,inTangent:0,outTangent:0});var Sc=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return e=t-this.time,i=this.coefficient,e*(e*(e*i[0]+i[1])+i[2])+i[3];var e,i},t}(),Ec=function(){function t(e){void 0===e&&(e=null),this.keyFrames=void 0,this.preWrapMode=yc.Loop,this.postWrapMode=yc.Clamp,this.cachedKey=void 0,this.keyFrames=e||[].concat(t.defaultKF),this.cachedKey=new Sc}var e=t.prototype;return e.addKey=function(t){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(t)},e.evaluate_slow=function(t){var e=t,i=t<0?this.preWrapMode:this.postWrapMode,n=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(i){case yc.Loop:e=Si(t-n,r-n)+n;break;case yc.PingPong:e=Ei(t-n,r-n)+n;break;case yc.Default:case yc.Normal:case yc.Clamp:default:e=ci(t,n,r)}var a=0;if(e>this.keyFrames[0].time)if(e>=this.keyFrames[this.keyFrames.length-1].time)a=this.keyFrames.length-2;else for(var o=0;o<this.keyFrames.length-1;o++)if(e>=this.keyFrames[0].time&&e<=this.keyFrames[o+1].time){a=o;break}var s=this.keyFrames[a],l=this.keyFrames[a+1],c=Ai(s.time,l.time,e),h=l.time-s.time,u=s.outTangent*h,_=l.inTangent*h,f=c*c,d=f*c,p=d-2*f+c,m=d-f,v=-2*d+3*f;return(2*d-3*f+1)*s.value+p*u+m*_+v*l.value},e.evaluate=function(t){var e=t,i=t<0?this.preWrapMode:this.postWrapMode,n=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(i){case yc.Loop:e=Si(t-n,r-n)+n;break;case yc.PingPong:e=Ei(t-n,r-n)+n;break;case yc.Default:case yc.Normal:case yc.Clamp:default:e=ci(t,n,r)}if(e>=this.cachedKey.time&&e<this.cachedKey.endTime)return this.cachedKey.evaluate(e);var a=this.findIndex(this.cachedKey,e),o=Math.min(a+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,a,o),this.cachedKey.evaluate(e)},e.calcOptimizedKey=function(t,e,i){var n=this.keyFrames[e],r=this.keyFrames[i];t.index=e,t.time=n.time,t.endTime=r.time;var a=r.time-n.time,o=r.value-n.value,s=1/(a*a),l=n.outTangent*a,c=r.inTangent*a;t.coefficient[0]=(l+c-o-o)*s/a,t.coefficient[1]=(o+o+o-l-l-c)*s,t.coefficient[2]=n.outTangent,t.coefficient[3]=n.value},e.findIndex=function(t,e){var i=t.index;if(-1!==i)if(e>this.keyFrames[i].time)for(var n=0;n<3;n++){var r=i+n;if(r+1<this.keyFrames.length&&this.keyFrames[r+1].time>e)return r}else for(var a=0;a<3;a++){var o=i-a;if(o>=0&&this.keyFrames[o-1].time<=e)return o-1}for(var s,l=0,c=this.keyFrames.length;c-l>1;)s=Math.floor((l+c)/2),this.keyFrames[s].time>=e?c=s:l=s;return l},t}();function Ac(t,e){console.warn(t+" is deprecated, please use "+e+" instead.")}Ec.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],ei.fastDefine("cc.AnimationCurve",Ec,{preWrapMode:yc.Default,postWrapMode:yc.Default,keyFrames:[]}),lt(Kl,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var bc=function(t){function e(){var e;return e=t.call(this)||this,Ac("line","Line"),e}return Y(e,t),e}(wa),xc=function(t){function e(){var e;return e=t.call(this)||this,Ac("plane","Plane"),e}return Y(e,t),e}(tc),Cc=function(t){function e(){var e;return e=t.call(this)||this,Ac("ray","Ray"),e}return Y(e,t),e}(Ra),wc=function(t){function e(){var e;return e=t.call(this)||this,Ac("triangle","Triangle"),e}return Y(e,t),e}(Ba),Rc=function(t){function e(){var e;return e=t.call(this)||this,Ac("sphere","Sphere"),e}return Y(e,t),e}(La),Ic=function(t){function e(){var e;return e=t.call(this)||this,Ac("aabb","AABB"),e}return Y(e,t),e}(sc),Oc=function(t){function e(){var e;return e=t.call(this)||this,Ac("obb","OBB"),e}return Y(e,t),e}(uc),Pc=function(t){function e(){var e;return e=t.call(this)||this,Ac("capsule","Capsule"),e}return Y(e,t),e}(_c),Mc=function(t){function e(){var e;return e=t.call(this)||this,Ac("frustum","Frustum"),e}return Y(e,t),e}(mc),Dc=Object.freeze({__proto__:null,distance:xa,enums:Ca,intersect:Kl,Line:wa,Plane:tc,Ray:Ra,Triangle:Ba,Sphere:La,AABB:sc,OBB:uc,Capsule:_c,Frustum:mc,Keyframe:Tc,AnimationCurve:Ec,get ERaycastMode(){return Vs},line:bc,plane:xc,ray:Cc,triangle:wc,sphere:Rc,aabb:Ic,obb:Oc,capsule:Pc,frustum:Mc});t("geometry",Dc);var Nc,Lc,Bc={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Fc=t("Layers",function(){function t(){}return t.makeMaskInclude=function(t){for(var e,i=0,n=Q(t);!(e=n()).done;)i|=e.value;return i},t.makeMaskExclude=function(e){return~t.makeMaskInclude(e)},t.addLayer=function(e,i){void 0!==i?i>19||i<0?console.warn("maximum layers reached."):(t.Enum[e]=1<<i,t.Enum[i]=e,t.BitMask[e]=1<<i,t.BitMask[i]=e):console.warn("bitNum can't be undefined")},t.deleteLayer=function(e){e>19||e<0?console.warn("do not change buildin layers."):(delete t.Enum[t.Enum[e]],delete t.Enum[e],delete t.BitMask[t.BitMask[e]],delete t.BitMask[e])},t}());Fc.Enum=he(Bc),Fc.BitMask=ce(X({},Bc)),n.Layers=Fc,function(t){t[t.DEFAULT=100]="DEFAULT",t[t.UI=200]="UI"}(Nc||(Nc={})),n.RenderPassStage=Nc,function(t){t[t.MIN=0]="MIN",t[t.MAX=255]="MAX",t[t.DEFAULT=128]="DEFAULT"}(Lc||(Lc={}));var zc,Uc={bindings:[],layouts:{}},kc={bindings:[],layouts:{}};!function(t){t[t.UBO_GLOBAL=0]="UBO_GLOBAL",t[t.UBO_CAMERA=1]="UBO_CAMERA",t[t.UBO_SHADOW=2]="UBO_SHADOW",t[t.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",t[t.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",t[t.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",t[t.COUNT=6]="COUNT"}(zc||(zc={}));var Gc,Hc=zc.SAMPLER_SHADOWMAP,Vc=zc.COUNT-Hc;!function(t){t[t.UBO_LOCAL=0]="UBO_LOCAL",t[t.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",t[t.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",t[t.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",t[t.UBO_MORPH=4]="UBO_MORPH",t[t.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",t[t.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",t[t.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",t[t.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",t[t.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",t[t.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",t[t.COUNT=11]="COUNT"}(Gc||(Gc={}));var Wc,jc=Gc.SAMPLER_JOINTS,qc=Gc.COUNT-jc;!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MATERIAL=1]="MATERIAL",t[t.LOCAL=2]="LOCAL"}(Wc||(Wc={}));var Xc=new Uo;Xc.bufferOffsets=[0,Hc+jc,Hc],Xc.samplerOffsets=[-Hc,Vc+qc,Vc-jc],Xc.flexibleSet=1;var Yc=function(){};Yc.SIZE=4*(Yc.COUNT=4+(Yc.SCREEN_SIZE_OFFSET=4+(Yc.NATIVE_SIZE_OFFSET=4+(Yc.TIME_OFFSET=0)))),Yc.NAME="CCGlobal",Yc.BINDING=zc.UBO_GLOBAL,Yc.DESCRIPTOR=new Ls(Yc.BINDING,so.UNIFORM_BUFFER,1,oo.ALL),Yc.LAYOUT=new Es(Wc.GLOBAL,Yc.BINDING,Yc.NAME,[new Ss("cc_time",Ua.FLOAT4,1),new Ss("cc_screenSize",Ua.FLOAT4,1),new Ss("cc_nativeSize",Ua.FLOAT4,1)],1),Uc.layouts[Yc.NAME]=Yc.LAYOUT,Uc.bindings[Yc.BINDING]=Yc.DESCRIPTOR;var Kc=function(){};Kc.SIZE=4*(Kc.COUNT=4+(Kc.GLOBAL_FOG_ADD_OFFSET=4+(Kc.GLOBAL_FOG_BASE_OFFSET=4+(Kc.GLOBAL_FOG_COLOR_OFFSET=4+(Kc.AMBIENT_GROUND_OFFSET=4+(Kc.AMBIENT_SKY_OFFSET=4+(Kc.MAIN_LIT_COLOR_OFFSET=4+(Kc.MAIN_LIT_DIR_OFFSET=4+(Kc.EXPOSURE_OFFSET=4+(Kc.SCREEN_SCALE_OFFSET=4+(Kc.CAMERA_POS_OFFSET=16+(Kc.MAT_VIEW_PROJ_INV_OFFSET=16+(Kc.MAT_VIEW_PROJ_OFFSET=16+(Kc.MAT_PROJ_INV_OFFSET=16+(Kc.MAT_PROJ_OFFSET=16+(Kc.MAT_VIEW_INV_OFFSET=16+(Kc.MAT_VIEW_OFFSET=0))))))))))))))))),Kc.NAME="CCCamera",Kc.BINDING=zc.UBO_CAMERA,Kc.DESCRIPTOR=new Ls(Kc.BINDING,so.UNIFORM_BUFFER,1,oo.ALL),Kc.LAYOUT=new Es(Wc.GLOBAL,Kc.BINDING,Kc.NAME,[new Ss("cc_matView",Ua.MAT4,1),new Ss("cc_matViewInv",Ua.MAT4,1),new Ss("cc_matProj",Ua.MAT4,1),new Ss("cc_matProjInv",Ua.MAT4,1),new Ss("cc_matViewProj",Ua.MAT4,1),new Ss("cc_matViewProjInv",Ua.MAT4,1),new Ss("cc_cameraPos",Ua.FLOAT4,1),new Ss("cc_screenScale",Ua.FLOAT4,1),new Ss("cc_exposure",Ua.FLOAT4,1),new Ss("cc_mainLitDir",Ua.FLOAT4,1),new Ss("cc_mainLitColor",Ua.FLOAT4,1),new Ss("cc_ambientSky",Ua.FLOAT4,1),new Ss("cc_ambientGround",Ua.FLOAT4,1),new Ss("cc_fogColor",Ua.FLOAT4,1),new Ss("cc_fogBase",Ua.FLOAT4,1),new Ss("cc_fogAdd",Ua.FLOAT4,1)],1),Uc.layouts[Kc.NAME]=Kc.LAYOUT,Uc.bindings[Kc.BINDING]=Kc.DESCRIPTOR;var Zc=function(){};Zc.SIZE=4*(Zc.COUNT=4+(Zc.SHADOW_INFO_OFFSET=4+(Zc.SHADOW_COLOR_OFFSET=16+(Zc.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(Zc.MAT_LIGHT_PLANE_PROJ_OFFSET=0))))),Zc.NAME="CCShadow",Zc.BINDING=zc.UBO_SHADOW,Zc.DESCRIPTOR=new Ls(Zc.BINDING,so.UNIFORM_BUFFER,1,oo.ALL),Zc.LAYOUT=new Es(Wc.GLOBAL,Zc.BINDING,Zc.NAME,[new Ss("cc_matLightPlaneProj",Ua.MAT4,1),new Ss("cc_matLightViewProj",Ua.MAT4,1),new Ss("cc_shadowColor",Ua.FLOAT4,1),new Ss("cc_shadowInfo",Ua.FLOAT4,1)],1),Uc.layouts[Zc.NAME]=Zc.LAYOUT,Uc.bindings[Zc.BINDING]=Zc.DESCRIPTOR;var Qc=zc.SAMPLER_SHADOWMAP,Jc=new Ls(Qc,so.SAMPLER,1,oo.FRAGMENT),$c=new As(Wc.GLOBAL,Qc,"cc_shadowMap",Ua.SAMPLER2D,1);Uc.layouts.cc_shadowMap=$c,Uc.bindings[Qc]=Jc;var th=zc.SAMPLER_ENVIRONMENT,eh=new Ls(th,so.SAMPLER,1,oo.FRAGMENT),ih=new As(Wc.GLOBAL,th,"cc_environment",Ua.SAMPLER_CUBE,1);Uc.layouts.cc_environment=ih,Uc.bindings[th]=eh;var nh=zc.SAMPLER_SPOT_LIGHTING_MAP,rh=new Ls(nh,so.SAMPLER,1,oo.FRAGMENT),ah=new As(Wc.GLOBAL,nh,"cc_spotLightingMap",Ua.SAMPLER2D,1);Uc.layouts.cc_spotLightingMap=ah,Uc.bindings[nh]=rh;var oh=function(){};oh.SIZE=4*(oh.COUNT=4+(oh.LIGHTINGMAP_UVPARAM=16+(oh.MAT_WORLD_IT_OFFSET=16+(oh.MAT_WORLD_OFFSET=0)))),oh.NAME="CCLocal",oh.BINDING=Gc.UBO_LOCAL,oh.DESCRIPTOR=new Ls(oh.BINDING,so.UNIFORM_BUFFER,1,oo.VERTEX),oh.LAYOUT=new Es(Wc.LOCAL,oh.BINDING,oh.NAME,[new Ss("cc_matWorld",Ua.MAT4,1),new Ss("cc_matWorldIT",Ua.MAT4,1),new Ss("cc_lightingMapUVParam",Ua.FLOAT4,1)],1),kc.layouts[oh.NAME]=oh.LAYOUT,kc.bindings[oh.BINDING]=oh.DESCRIPTOR;var sh=function(){};sh.BATCHING_COUNT=10,sh.MAT_WORLDS_OFFSET=0,sh.SIZE=4*(sh.COUNT=16*sh.BATCHING_COUNT),sh.NAME="CCLocalBatched",sh.BINDING=Gc.UBO_LOCAL,sh.DESCRIPTOR=new Ls(sh.BINDING,so.UNIFORM_BUFFER,1,oo.VERTEX),sh.LAYOUT=new Es(Wc.LOCAL,sh.BINDING,sh.NAME,[new Ss("cc_matWorlds",Ua.MAT4,sh.BATCHING_COUNT)],1),kc.layouts[sh.NAME]=sh.LAYOUT,kc.bindings[sh.BINDING]=sh.DESCRIPTOR;var lh=function(){};lh.LIGHTS_PER_PASS=1,lh.SIZE=4*(lh.COUNT=(lh.LIGHT_DIR_OFFSET=(lh.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(lh.LIGHT_COLOR_OFFSET=(lh.LIGHT_POS_OFFSET=0)+4*lh.LIGHTS_PER_PASS)+4*lh.LIGHTS_PER_PASS)+4*lh.LIGHTS_PER_PASS)+4*lh.LIGHTS_PER_PASS),lh.NAME="CCForwardLight",lh.BINDING=Gc.UBO_FORWARD_LIGHTS,lh.DESCRIPTOR=new Ls(lh.BINDING,so.DYNAMIC_UNIFORM_BUFFER,1,oo.FRAGMENT),lh.LAYOUT=new Es(Wc.LOCAL,lh.BINDING,lh.NAME,[new Ss("cc_lightPos",Ua.FLOAT4,lh.LIGHTS_PER_PASS),new Ss("cc_lightColor",Ua.FLOAT4,lh.LIGHTS_PER_PASS),new Ss("cc_lightSizeRangeAngle",Ua.FLOAT4,lh.LIGHTS_PER_PASS),new Ss("cc_lightDir",Ua.FLOAT4,lh.LIGHTS_PER_PASS)],1),kc.layouts[lh.NAME]=lh.LAYOUT,kc.bindings[lh.BINDING]=lh.DESCRIPTOR;var ch=function(){};ch.SIZE=4*(ch.COUNT=4+(ch.JOINTS_TEXTURE_INFO_OFFSET=0)),ch.NAME="CCSkinningTexture",ch.BINDING=Gc.UBO_SKINNING_TEXTURE,ch.DESCRIPTOR=new Ls(ch.BINDING,so.UNIFORM_BUFFER,1,oo.VERTEX),ch.LAYOUT=new Es(Wc.LOCAL,ch.BINDING,ch.NAME,[new Ss("cc_jointTextureInfo",Ua.FLOAT4,1)],1),kc.layouts[ch.NAME]=ch.LAYOUT,kc.bindings[ch.BINDING]=ch.DESCRIPTOR;var hh=function(){};hh.SIZE=4*(hh.COUNT=4+(hh.JOINTS_ANIM_INFO_OFFSET=0)),hh.NAME="CCSkinningAnimation",hh.BINDING=Gc.UBO_SKINNING_ANIMATION,hh.DESCRIPTOR=new Ls(hh.BINDING,so.UNIFORM_BUFFER,1,oo.VERTEX),hh.LAYOUT=new Es(Wc.LOCAL,hh.BINDING,hh.NAME,[new Ss("cc_jointAnimInfo",Ua.FLOAT4,1)],1),kc.layouts[hh.NAME]=hh.LAYOUT,kc.bindings[hh.BINDING]=hh.DESCRIPTOR;var uh=function(){};uh.SIZE=4*(uh.COUNT=360+(uh.JOINTS_OFFSET=0)),uh.NAME="CCSkinning",uh.BINDING=Gc.UBO_SKINNING_TEXTURE,uh.DESCRIPTOR=new Ls(uh.BINDING,so.UNIFORM_BUFFER,1,oo.VERTEX),uh.LAYOUT=new Es(Wc.LOCAL,uh.BINDING,uh.NAME,[new Ss("cc_joints",Ua.FLOAT4,90)],1),kc.layouts[uh.NAME]=uh.LAYOUT,kc.bindings[uh.BINDING]=uh.DESCRIPTOR;var _h=function(){};_h.MAX_MORPH_TARGET_COUNT=60,_h.OFFSET_OF_WEIGHTS=0,_h.OFFSET_OF_VERTICES_COUNT=4+(_h.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=4+(_h.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*_h.MAX_MORPH_TARGET_COUNT)),_h.COUNT_BASE_4_BYTES=4*Math.ceil(_h.MAX_MORPH_TARGET_COUNT/4)+4,_h.SIZE=4*_h.COUNT_BASE_4_BYTES,_h.NAME="CCMorph",_h.BINDING=Gc.UBO_MORPH,_h.DESCRIPTOR=new Ls(_h.BINDING,so.UNIFORM_BUFFER,1,oo.VERTEX),_h.LAYOUT=new Es(Wc.LOCAL,_h.BINDING,_h.NAME,[new Ss("cc_displacementWeights",Ua.FLOAT4,_h.MAX_MORPH_TARGET_COUNT/4),new Ss("cc_displacementTextureInfo",Ua.FLOAT4,1)],1),kc.layouts[_h.NAME]=_h.LAYOUT,kc.bindings[_h.BINDING]=_h.DESCRIPTOR;var fh=Gc.SAMPLER_JOINTS,dh=new Ls(fh,so.SAMPLER,1,oo.VERTEX),ph=new As(Wc.LOCAL,fh,"cc_jointTexture",Ua.SAMPLER2D,1);kc.layouts.cc_jointTexture=ph,kc.bindings[fh]=dh;var mh=Gc.SAMPLER_MORPH_POSITION,vh=new Ls(mh,so.SAMPLER,1,oo.VERTEX),gh=new As(Wc.LOCAL,mh,"cc_PositionDisplacements",Ua.SAMPLER2D,1);kc.layouts.cc_PositionDisplacements=gh,kc.bindings[mh]=vh;var yh=Gc.SAMPLER_MORPH_NORMAL,Th=new Ls(yh,so.SAMPLER,1,oo.VERTEX),Sh=new As(Wc.LOCAL,yh,"cc_NormalDisplacements",Ua.SAMPLER2D,1);kc.layouts.cc_NormalDisplacements=Sh,kc.bindings[yh]=Th;var Eh=Gc.SAMPLER_MORPH_TANGENT,Ah=new Ls(Eh,so.SAMPLER,1,oo.VERTEX),bh=new As(Wc.LOCAL,Eh,"cc_TangentDisplacements",Ua.SAMPLER2D,1);kc.layouts.cc_TangentDisplacements=bh,kc.bindings[Eh]=Ah;var xh=Gc.SAMPLER_LIGHTMAP,Ch=new Ls(xh,so.SAMPLER,1,oo.FRAGMENT),wh=new As(Wc.LOCAL,xh,"cc_lightingMap",Ua.SAMPLER2D,1);kc.layouts.cc_lightingMap=wh,kc.bindings[xh]=Ch;var Rh=Gc.SAMPLER_SPRITE,Ih=new Ls(Rh,so.SAMPLER,1,oo.FRAGMENT),Oh=new As(Wc.LOCAL,Rh,"cc_spriteTexture",Ua.SAMPLER2D,1);kc.layouts.cc_spriteTexture=Oh,kc.bindings[Rh]=Ih;var Ph,Mh,Dh,Nh,Lh,Bh=Fc.makeMaskExclude([Fc.BitMask.UI_2D,Fc.BitMask.GIZMOS,Fc.BitMask.EDITOR,Fc.BitMask.SCENE_GIZMO,Fc.BitMask.PROFILER]),Fh=Fc.makeMaskExclude([Fc.BitMask.UI_2D,Fc.BitMask.PROFILER]),zh=Fc.Enum.ALL;t("pipeline",Object.freeze({__proto__:null,PIPELINE_FLOW_FORWARD:"ForwardFlow",PIPELINE_FLOW_SHADOW:"ShadowFlow",PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return Nc},get RenderPriority(){return Lc},globalDescriptorSetLayout:Uc,localDescriptorSetLayout:kc,get PipelineGlobalBindings(){return zc},get ModelLocalBindings(){return Gc},get SetIndex(){return Wc},bindingMappingInfo:Xc,UBOGlobal:Yc,UBOCamera:Kc,UBOShadow:Zc,UNIFORM_SHADOWMAP_BINDING:Qc,UNIFORM_ENVIRONMENT_BINDING:th,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:nh,UBOLocal:oh,INST_MAT_WORLD:"a_matWorld0",UBOLocalBatched:sh,UBOForwardLight:lh,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:ch,UBOSkinningAnimation:hh,INST_JOINT_ANIM_INFO:"a_jointAnimInfo",UBOSkinning:uh,UBOMorph:_h,UNIFORM_JOINT_TEXTURE_BINDING:fh,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:mh,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:yh,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Eh,UNIFORM_LIGHTMAP_TEXTURE_BINDING:xh,UNIFORM_SPRITE_TEXTURE_BINDING:Rh,CAMERA_DEFAULT_MASK:Bh,CAMERA_EDITOR_MASK:Fh,MODEL_ALWAYS_MASK:zh})),function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(Ph||(Ph={})),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(Mh||(Mh={})),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(Dh||(Dh={})),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(Nh||(Nh={})),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(Lh||(Lh={}));var Uh,kh,Gh=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],Hh=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],Vh=[100,200,400,800],Wh=new Ri,jh=new Ri,qh=new Vi,Xh=vo.STENCIL<<1,Yh=[],Kh=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=Ph.VERTICAL,this._fov=_i(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new Jo(.2,.2,.2,1),this._viewport=new nn(0,0,1,1),this._curTransform=To.IDENTITY,this._isProjDirty=!0,this._matView=new Vi,this._matViewInv=null,this._matProj=new Vi,this._matProjInv=new Vi,this._matViewProj=new Vi,this._matViewProjInv=new Vi,this._frustum=new mc,this._forward=new Ri,this._position=new Ri,this._priority=0,this._aperture=Dh.F16_0,this._apertureValue=void 0,this._shutter=Lh.D125,this._shutterValue=0,this._iso=Nh.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=0,this._frustumHandle=0,this._window=null,this._device=t,this._apertureValue=Gh[this._aperture],this._shutterValue=Hh[this._shutter],this._isoValue=Vh[this._iso],this._aspect=this.screenScale=1,!Yh.length){var e=t.screenSpaceSignY;Yh[To.IDENTITY]=new Vi(1,0,0,0,0,e),Yh[To.ROTATE_90]=new Vi(0,1,0,0,-e,0),Yh[To.ROTATE_180]=new Vi(-1,0,0,0,0,-e),Yh[To.ROTATE_270]=new Vi(0,-1,0,0,e,0)}}var e=t.prototype;return e.initialize=function(t){this._name=t.name,this._node=t.node,this._proj=t.projection,this._priority=t.priority||0,this._aspect=this.screenScale=1;var e=this._poolHandle=Tr.alloc();Tr.set(e,pr.WIDTH,1),Tr.set(e,pr.HEIGHT,1),Tr.set(e,pr.CLEAR_FLAG,vo.NONE),Tr.set(e,pr.CLEAR_DEPTH,1),Tr.set(e,pr.NODE,this._node.handle),Tr.set(e,pr.VISIBILITY,Bh),this._scene&&Tr.set(e,pr.SCENE,this._scene.handle),this.updateExposure(),this.changeTargetWindow(t.window),console.log("Created Camera: "+this._name+" "+Tr.get(e,pr.WIDTH)+"x"+Tr.get(e,pr.HEIGHT))},e.destroy=function(){this._window&&this._window.detachCamera(this),this._name=null,this._poolHandle&&(Tr.free(this._poolHandle),this._poolHandle=0,this._frustumHandle&&(Mr.free(this._frustumHandle),this._frustumHandle=0))},e.attachToScene=function(t){this._scene=t,this._enabled=!0,Tr.set(this._poolHandle,pr.SCENE,t.handle)},e.detachFromScene=function(){this._scene=null,this._enabled=!1,Tr.set(this._poolHandle,pr.SCENE,0)},e.resize=function(t,e){var i=this._poolHandle;Tr.set(i,pr.WIDTH,t),Tr.set(i,pr.HEIGHT,e),this._aspect=t*this._viewport.width/(e*this._viewport.height),this._isProjDirty=!0},e.setFixedSize=function(t,e){var i=this._poolHandle;Tr.set(i,pr.WIDTH,t),Tr.set(i,pr.HEIGHT,e),this._aspect=t*this._viewport.width/(e*this._viewport.height),this.isWindowSize=!1},e.update=function(t){if(void 0===t&&(t=!1),this._node){var e=!1;(this._node.hasChangedFlags||t)&&(Vi.invert(this._matView,this._node.worldMatrix),Tr.setMat4(this._poolHandle,pr.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),Tr.setVec3(this._poolHandle,pr.POSITION,this._position),Tr.setVec3(this._poolHandle,pr.FORWARD,this._forward),e=!0);var i=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==i){this._curTransform=i;var n=this._device.screenSpaceSignY;if(this._window&&this._window.hasOffScreenAttachments&&(n*=this._device.UVSpaceSignY,i=To.IDENTITY),this._proj===Mh.PERSPECTIVE)Vi.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===Ph.VERTICAL,this._device.clipSpaceMinZ,n,i);else{var r=this._orthoHeight*this._aspect,a=this._orthoHeight;Vi.ortho(this._matProj,-r,r,-a,a,this._nearClip,this._farClip,this._device.clipSpaceMinZ,n,i)}Vi.invert(this._matProjInv,this._matProj),Tr.setMat4(this._poolHandle,pr.MAT_PROJ,this._matProj),Tr.setMat4(this._poolHandle,pr.MAT_PROJ_INV,this._matProjInv),e=!0,this._isProjDirty=!1}e&&(Vi.multiply(this._matViewProj,this._matProj,this._matView),Vi.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),Tr.setMat4(this._poolHandle,pr.MAT_VIEW_PROJ,this._matViewProj),Tr.setMat4(this._poolHandle,pr.MAT_VIEW_PROJ_INV,this._matViewProjInv),vc(this._frustumHandle,this._frustum))}},e.changeTargetWindow=function(t){void 0===t&&(t=null),this._window&&this._window.detachCamera(this);var e=t||n.director.root.mainWindow;e&&(e.attachCamera(this),this.resize(e.width,e.height),this._window=e,Tr.set(this._poolHandle,pr.WINDOW,e.handle))},e.detachCamera=function(){this._window&&this._window.detachCamera(this)},e.screenPointToRay=function(t,e,i){if(!this._node)return null;var n=this._poolHandle,r=Tr.get(n,pr.WIDTH),a=Tr.get(n,pr.HEIGHT),o=this._viewport.x*r,s=this._viewport.y*a,l=this._viewport.width*r,c=this._viewport.height*a,h=this._proj===Mh.PERSPECTIVE,u=this._device.screenSpaceSignY,_=Hi[this._curTransform];Ri.set(Wh,(e-o)/l*2-1,(i-s)/c*2-1,h?1:-1);var f=Wh.x,d=Wh.y;return Wh.x=f*_[0]+d*_[2]*u,Wh.y=f*_[1]+d*_[3]*u,Ri.transformMat4(h?Wh:t.o,Wh,this._matViewProjInv),h?(this._node.getWorldPosition(jh),Ra.fromPoints(t,jh,Wh)):Ri.transformQuat(t.d,Ri.FORWARD,this._node.worldRotation),t},e.screenToWorld=function(t,e){var i=this._poolHandle,n=Tr.get(i,pr.WIDTH),r=Tr.get(i,pr.HEIGHT),a=this._viewport.x*n,o=this._viewport.y*r,s=this._viewport.width*n,l=this._viewport.height*r,c=this._device.screenSpaceSignY,h=Hi[this._curTransform];if(this._proj===Mh.PERSPECTIVE){Ri.set(t,(e.x-a)/s*2-1,(e.y-o)/l*2-1,1);var u=t.x,_=t.y;t.x=u*h[0]+_*h[2]*c,t.y=u*h[1]+_*h[3]*c,Ri.transformMat4(t,t,this._matViewProjInv),this._node&&this._node.getWorldPosition(Wh),Ri.lerp(t,Wh,t,ui(this._nearClip/this._farClip,1,e.z))}else{Ri.set(t,(e.x-a)/s*2-1,(e.y-o)/l*2-1,2*e.z-1);var f=t.x,d=t.y;t.x=f*h[0]+d*h[2]*c,t.y=f*h[1]+d*h[3]*c,Ri.transformMat4(t,t,this._matViewProjInv)}return t},e.worldToScreen=function(t,e){var i=this._poolHandle,n=Tr.get(i,pr.WIDTH),r=Tr.get(i,pr.HEIGHT),a=this._viewport.x*n,o=this._viewport.y*r,s=this._viewport.width*n,l=this._viewport.height*r,c=this._device.screenSpaceSignY,h=Hi[this._curTransform];Ri.transformMat4(t,e,this._matViewProj);var u=t.x,_=t.y;return t.x=u*h[0]+_*h[2]*c,t.y=u*h[1]+_*h[3]*c,t.x=a+.5*(t.x+1)*s,t.y=o+.5*(t.y+1)*l,t.z=.5*t.z+.5,t},e.worldMatrixToScreen=function(t,e,i,n){Vi.multiply(t,this._matViewProj,e),Vi.multiply(t,Yh[this._curTransform],t);var r=i/2,a=n/2;return Vi.identity(qh),Vi.transform(qh,qh,Ri.set(Wh,r,a,0)),Vi.scale(qh,qh,Ri.set(Wh,r,a,1)),Vi.multiply(t,qh,t),t},e.updateExposure=function(){var t=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);Tr.set(this._poolHandle,pr.EXPOSURE,.833333/Math.pow(2,t))},q(t,[{key:"node",set:function(t){this._node=t},get:function(){return this._node}},{key:"enabled",set:function(t){this._enabled=t},get:function(){return this._enabled}},{key:"orthoHeight",set:function(t){this._orthoHeight=t,this._isProjDirty=!0},get:function(){return this._orthoHeight}},{key:"projectionType",set:function(t){this._proj=t,this._isProjDirty=!0},get:function(){return this._proj}},{key:"fovAxis",set:function(t){this._fovAxis=t,this._isProjDirty=!0},get:function(){return this._fovAxis}},{key:"fov",set:function(t){this._fov=t,this._isProjDirty=!0},get:function(){return this._fov}},{key:"nearClip",set:function(t){this._nearClip=t,this._isProjDirty=!0},get:function(){return this._nearClip}},{key:"farClip",set:function(t){this._farClip=t,this._isProjDirty=!0},get:function(){return this._farClip}},{key:"clearColor",set:function(t){this._clearColor.x=t.x,this._clearColor.y=t.y,this._clearColor.z=t.z,this._clearColor.w=t.w,Tr.setVec4(this._poolHandle,pr.CLEAR_COLOR,t)},get:function(){return this._clearColor}},{key:"viewport",get:function(){return this._viewport},set:function(t){var e=t.x,i=t.width,n=t.height,r=this._device.screenSpaceSignY<0?1-t.y-n:t.y;switch(this._device.surfaceTransform){case To.ROTATE_90:this._viewport.x=1-r-n,this._viewport.y=e,this._viewport.width=n,this._viewport.height=i;break;case To.ROTATE_180:this._viewport.x=1-e-i,this._viewport.y=1-r-n,this._viewport.width=i,this._viewport.height=n;break;case To.ROTATE_270:this._viewport.x=r,this._viewport.y=1-e-i,this._viewport.width=n,this._viewport.height=i;break;case To.IDENTITY:this._viewport.x=e,this._viewport.y=r,this._viewport.width=i,this._viewport.height=n}Tr.setVec4(this._poolHandle,pr.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return Tr.get(this._poolHandle,pr.WIDTH)}},{key:"height",get:function(){return Tr.get(this._poolHandle,pr.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",set:function(t){this._matView=t,Tr.setMat4(this._poolHandle,pr.MAT_VIEW,this._matView)},get:function(){return this._matView}},{key:"matViewInv",set:function(t){this._matViewInv=t},get:function(){return this._matViewInv||this._node.worldMatrix}},{key:"matProj",set:function(t){this._matProj=t,Tr.setMat4(this._poolHandle,pr.MAT_PROJ,this._matProj)},get:function(){return this._matProj}},{key:"matProjInv",set:function(t){this._matProjInv=t,Tr.setMat4(this._poolHandle,pr.MAT_PROJ_INV,this._matProjInv)},get:function(){return this._matProjInv}},{key:"matViewProj",set:function(t){this._matViewProj=t,Tr.setMat4(this._poolHandle,pr.MAT_VIEW_PROJ,this._matViewProj)},get:function(){return this._matViewProj}},{key:"matViewProjInv",set:function(t){this._matViewProjInv=t,Tr.setMat4(this._poolHandle,pr.MAT_VIEW_PROJ_INV,this._matViewProjInv)},get:function(){return this._matViewProjInv}},{key:"frustum",set:function(t){this._frustum=t,vc(this._frustumHandle,t)},get:function(){return this._frustum}},{key:"window",set:function(t){this._window=t,t&&Tr.set(this._poolHandle,pr.WINDOW,t.handle)},get:function(){return this._window}},{key:"forward",set:function(t){this._forward=t,Tr.setVec3(this._poolHandle,pr.FORWARD,this._forward)},get:function(){return this._forward}},{key:"position",set:function(t){this._position=t,Tr.setVec3(this._poolHandle,pr.POSITION,this._position)},get:function(){return this._position}},{key:"visibility",set:function(t){Tr.set(this._poolHandle,pr.VISIBILITY,t)},get:function(){return Tr.get(this._poolHandle,pr.VISIBILITY)}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"aperture",set:function(t){this._aperture=t,this._apertureValue=Gh[this._aperture],this.updateExposure()},get:function(){return this._aperture}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",set:function(t){this._shutter=t,this._shutterValue=Hh[this._shutter],this.updateExposure()},get:function(){return this._shutter}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",set:function(t){this._iso=t,this._isoValue=Vh[this._iso],this.updateExposure()},get:function(){return this._iso}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",set:function(t){this._ec=t},get:function(){return this._ec}},{key:"exposure",get:function(){return Tr.get(this._poolHandle,pr.EXPOSURE)}},{key:"clearFlag",get:function(){return Tr.get(this._poolHandle,pr.CLEAR_FLAG)},set:function(t){Tr.set(this._poolHandle,pr.CLEAR_FLAG,t)}},{key:"clearDepth",get:function(){return Tr.get(this._poolHandle,pr.CLEAR_DEPTH)},set:function(t){Tr.set(this._poolHandle,pr.CLEAR_DEPTH,t)}},{key:"clearStencil",get:function(){return Tr.get(this._poolHandle,pr.CLEAR_STENCIL)},set:function(t){Tr.set(this._poolHandle,pr.CLEAR_STENCIL,t)}},{key:"handle",get:function(){return this._poolHandle}}]),t}();!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(Uh||(Uh={})),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(kh||(kh={})),n.internal.TransformBit=kh;var Zh=function(){function t(t){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=0,this._modelArrayHandle=0,this._batchArrayHandle=0,this._sphereLightsHandle=0,this._spotLightsHandle=0,this._root=t,this._createHandles()}t.registerCreateFunc=function(e){e._createSceneFun=function(e){return new t(e)}},q(t,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"handle",get:function(){return this._scenePoolHandle}},{key:"batches",get:function(){return this._batches}}]);var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._createHandles(),!0},e.update=function(t){var e=this._mainLight;e&&e.update();for(var i=this._sphereLights,n=0;n<i.length;n++)i[n].update();for(var r=this._spotLights,a=0;a<r.length;a++)r[a].update();for(var o=this._models,s=0;s<o.length;s++){var l=o[s];l.enabled&&(l.updateTransform(t),l.updateUBOs(t))}},e.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(qn.free(this._modelArrayHandle),this._modelArrayHandle=0),this._scenePoolHandle&&(vr.free(this._scenePoolHandle),this._scenePoolHandle=0),this._sphereLightsHandle&&(Kn.free(this._sphereLightsHandle),this._sphereLightsHandle=0),this._spotLightsHandle&&(Kn.free(this._spotLightsHandle),this._spotLightsHandle=0),this._batchArrayHandle&&(Qn.free(this._batchArrayHandle),this._batchArrayHandle=0)},e.addCamera=function(t){t.attachToScene(this),this._cameras.push(t)},e.removeCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return this._cameras.splice(e,1),void t.detachFromScene()},e.removeCameras=function(){for(var t,e=Q(this._cameras);!(t=e()).done;)t.value.detachFromScene();this._cameras.splice(0)},e.setMainLight=function(t){this._mainLight=t,vr.set(this._scenePoolHandle,_r.MAIN_LIGHT,t.handle)},e.unsetMainLight=function(t){if(this._mainLight===t){var e=this._directionalLights;e.length?(this._mainLight=e[e.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=kh.ROTATION)):this._mainLight=null}},e.addDirectionalLight=function(t){t.attachToScene(this),this._directionalLights.push(t)},e.removeDirectionalLight=function(t){for(var e=0;e<this._directionalLights.length;++e)if(this._directionalLights[e]===t)return t.detachFromScene(),void this._directionalLights.splice(e,1)},e.addSphereLight=function(t){t.attachToScene(this),this._sphereLights.push(t),Kn.push(this._sphereLightsHandle,t.handle)},e.removeSphereLight=function(t){for(var e=0;e<this._sphereLights.length;++e)if(this._sphereLights[e]===t)return t.detachFromScene(),this._sphereLights.splice(e,1),void Kn.erase(this._sphereLightsHandle,e)},e.addSpotLight=function(t){t.attachToScene(this),this._spotLights.push(t),Kn.push(this._spotLightsHandle,t.handle)},e.removeSpotLight=function(t){for(var e=0;e<this._spotLights.length;++e)if(this._spotLights[e]===t)return t.detachFromScene(),this._spotLights.splice(e,1),void Kn.erase(this._spotLightsHandle,e)},e.removeSphereLights=function(){for(var t=0;t<this._sphereLights.length;++t)this._sphereLights[t].detachFromScene();this._sphereLights.length=0,Kn.clear(this._sphereLightsHandle)},e.removeSpotLights=function(){for(var t=0;t<this._spotLights.length;++t)this._spotLights[t].detachFromScene();this._spotLights=[],Kn.clear(this._spotLightsHandle)},e.addModel=function(t){t.attachToScene(this),this._models.push(t),qn.push(this._modelArrayHandle,t.handle)},e.removeModel=function(t){for(var e=0;e<this._models.length;++e)if(this._models[e]===t)return t.detachFromScene(),this._models.splice(e,1),void qn.erase(this._modelArrayHandle,e)},e.removeModels=function(){for(var t,e=Q(this._models);!(t=e()).done;){var i=t.value;i.detachFromScene(),i.destroy()}this._models.length=0,qn.clear(this._modelArrayHandle)},e.addBatch=function(t){this._batches.push(t),Qn.push(this._batchArrayHandle,t.handle)},e.removeBatch=function(t){for(var e=0;e<this._batches.length;++e)if(this._batches[e]===t)return this._batches.splice(e,1),void Qn.erase(this._batchArrayHandle,e)},e.removeBatches=function(){this._batches.length=0,Qn.clear(this._batchArrayHandle)},e.onGlobalPipelineStateChanged=function(){for(var t,e=Q(this._models);!(t=e()).done;)t.value.onGlobalPipelineStateChanged()},e.generateModelId=function(){return this._modelId++},e._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=qn.alloc(),this._scenePoolHandle=vr.alloc(),vr.set(this._scenePoolHandle,_r.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=Kn.alloc(),vr.set(this._scenePoolHandle,_r.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=Kn.alloc(),vr.set(this._scenePoolHandle,_r.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle)),this._batchArrayHandle||(this._batchArrayHandle=Qn.alloc(),vr.set(this._scenePoolHandle,_r.BATCH_ARRAY_2D,this._batchArrayHandle))},t}(),Qh=function(){},Jh=function(){return Qh},$h=tu((function(){}));function tu(t){return function(e){return"function"==typeof e?t(e):function(i){return t(i,e)}}}function eu(t){return function(e){return function(i){!function(t,e,i){var n=iu(t);if(n){var r=nu(n,"proto");nu(r,"editor")[e]=i}}(i,t,e)}}}function iu(t){return nu(t,"__ccclassCache__")}function nu(t,e){return t[e]||(t[e]={})}var ru=tu((function(t,e){var i=le.getSuper(t);i===Object&&(i=null);var n={name:e,extends:i,ctor:t},r=t.__ccclassCache__;if(r){var a=r.proto;a&&le.mixin(n,a),t.__ccclassCache__=void 0}return ei(n)})),au=eu("requireComponent"),ou=eu("executionOrder"),su=$h;function lu(t,e,i){var n=null;function r(t,e,i){var r=iu(t.constructor);if(r){var a=nu(r,"proto"),o=nu(a,"properties");!function(t,e,i,n,r,a){var o,s=r&&(r.get||r.set);n&&(o=qe(n,s));var l=e[i],c=le.mixin(l||{},o||n||{});if(s)r.get&&(c.get=r.get),r.set&&(c.set=r.set);else if(r)r.initializer&&(c.default=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer));else{var h=a.default||(a.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(t));h.hasOwnProperty(i)&&(c.default=h[i])}e[i]=c}(t.constructor,o,e,n,i,r)}}return void 0===t?lu({type:void 0}):void 0===e?(n=t,r):void r(t,e,i)}var cu=function(t,e,i){return lu(_u({}))(t,e,i)};function hu(t){return lu(_u({formerlySerializedAs:t}))}var uu=function(t,e,i){return lu({editorOnly:!0})(t,e,i)};function _u(t){return t.__noImplicit=!0,"serializable"in t||(t.serializable=!0),t}var fu=$h,du=Jh,pu=$h,mu=Jh,vu=Jh,gu=Jh,yu=Qh,Tu=Jh,Su=Jh,Eu=Jh,Au=Jh,bu=Jh,xu=Jh,Cu=Jh,wu=Qh,Ru=Jh,Iu=Jh,Ou=Qh,Pu=Qh,Mu=Qh,Du=Fu(Be),Nu=Fu(Fe),Lu=Fu(ze),Bu=Fu(Ue);function Fu(t){return lu({type:t})}var zu=function(t,e,i){return lu({__noImplicit:!0,override:!0})(t,e,i)},Uu=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=le.createMap(!0),this._count=0)}var e=t.prototype;return e.add=function(t,e){return t in this._map||this._count++,this._map[t]=e},e.get=function(t){return this._map[t]},e.has=function(t){return t in this._map},e.remove=function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},e.clear=function(){0!==this._count&&(this._map=le.createMap(!0),this._count=0)},e.forEach=function(t){for(var e in this._map)t(this._map[e],e)},e.find=function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},e.destroy=function(){this._map=null},q(t,[{key:"count",get:function(){return this._count}}]),t}(),ku=function(){function t(e,i){this.id=t._pipelineId++,this.name="",this.pipes=[],this.name=e;for(var n=0,r=i.length;n<r;n++)this.pipes.push(i[n])}var e=t.prototype;return e.insert=function(t,e){return e>this.pipes.length?(E(4921),this):(this.pipes.splice(e,0,t),this)},e.append=function(t){return this.pipes.push(t),this},e.remove=function(t){return this.pipes.splice(t,1),this},e.sync=function(t){var e=this.pipes;if(0===e.length)return null;t.isFinish=!1;for(var i=0,n=e.length;i<n;){var r=(0,e[i])(t);if(r)return t.isFinish=!0,r;++i!==n&&(t.input=t.output,t.output=null)}return t.isFinish=!0,t.output},e.async=function(t){0!==this.pipes.length&&(t.isFinish=!1,this._flow(0,t))},e._flow=function(t,e){var i=this;(0,this.pipes[t])(e,(function(n){n?(e.isFinish=!0,e.dispatch("complete",n)):++t<i.pipes.length?(e.input=e.output,e.output=null,i._flow(t,e)):(e.isFinish=!0,e.dispatch("complete",n,e.output))}))},t}();ku._pipelineId=0;var Gu,Hu=new Uu,Vu=new Uu,Wu=new Uu,ju=new Uu,qu=new ku("normal load",[]),Xu=new ku("fetch",[]),Yu=new ku("transform url",[]);!function(t){t.UUID="uuid",t.PATH="path",t.DIR="dir",t.URL="url",t.SCENE="scene"}(Gu||(Gu={}));var Ku,Zu={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(t){t.RESOURCES="resources",t.MAIN="main",t.START_SCENE="start-scene"}(Ku||(Ku={}));var Qu=function(){function t(e){this.id=t._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}t.create=function(e){var i;return 0!==t._deadPool.length?(i=t._deadPool.pop()).set(e):i=new t(e),i};var e=t.prototype;return e.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},e.dispatch=function(t,e,i,n,r){switch(t){case"complete":this.onComplete&&this.onComplete(e,i);break;case"progress":this.onProgress&&this.onProgress(e,i,n,r);break;case"error":this.onError&&this.onError(e,i,n,r);break;default:var a="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[a]&&this[a](e,i,n,r)}},e.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t._deadPool.push(this))},t}();Qu.MAX_DEAD_NUM=500,Qu._taskId=0,Qu._deadPool=[];var Ju="0123456789abcdef".split(""),$u=["","","",""],t_=$u.concat($u,"-",$u,"-",$u,"-",$u,"-",$u,$u,$u),e_=t_.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);function i_(t){var e=t.split("@")[0];if(22!==e.length)return t;t_[0]=t[0],t_[1]=t[1];for(var i=2,n=2;i<22;i+=2){var r=Te[t.charCodeAt(i)],a=Te[t.charCodeAt(i+1)];t_[e_[n++]]=Ju[r>>2],t_[e_[n++]]=Ju[(3&r)<<2|a>>4],t_[e_[n++]]=Ju[15&a]}return t.replace(e,t_.join(""))}var n_=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function r_(t){var e=n_.exec(t);return e?e[1]:""}function a_(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.ext=e.nativeExt;var i=ju.find((function(e){return!!e.getAssetInfo(t)}));return i&&(e.bundle=i.name),l_(t,e)}function o_(t){return t&&(t instanceof n.SceneAsset||t instanceof n.Scene)}function s_(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function l_(t,e){var i=Qu.create({input:t,options:e}),n=[];try{for(var r,a=Q(Yu.sync(i));!(r=a()).done;){var o=r.value,s=o.url;o.recycle(),n.push(s)}}catch(t){for(var l,c=Q(i.output);!(l=c()).done;)l.value.recycle();d(t.message,t.stack)}return i.recycle(),n.length>1?n:n[0]}var c_=Object.freeze({__proto__:null,getUuidFromURL:r_,getUrlWithUuid:a_,isScene:o_,normalize:s_,transform:l_,decodeUuid:i_}),h_=t("Event",function(){function t(t,e){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!e}var e=t.prototype;return e.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},e.reuse=function(t,e){this.type=t,this.bubbles=e||!1},e.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},e.getCurrentTarget=function(){return this.currentTarget},e.getType=function(){return this.type},t}());h_.NO_TYPE="no_type",h_.TOUCH="touch",h_.MOUSE="mouse",h_.KEYBOARD="keyboard",h_.ACCELERATION="acceleration",h_.NONE=0,h_.CAPTURING_PHASE=1,h_.AT_TARGET=2,h_.BUBBLING_PHASE=3,n.Event=h_;var u_=t("Pool",function(){function t(t,e){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=t,this._elementsPerBatch=Math.max(e,1),this._nextAvail=this._elementsPerBatch-1;for(var i=0;i<this._elementsPerBatch;++i)this._freepool.push(t())}var e=t.prototype;return e.alloc=function(){if(this._nextAvail<0){for(var t=this._elementsPerBatch,e=0;e<t;e++)this._freepool.push(this._ctor());this._nextAvail=t-1}var i=this._freepool[this._nextAvail--];return this._freepool.length--,i},e.free=function(t){this._freepool.push(t),this._nextAvail++},e.freeArray=function(t){Array.prototype.push.apply(this._freepool,t),this._nextAvail+=t.length},e.destroy=function(t){if(t)for(var e=0;e<=this._nextAvail;e++)t(this._freepool[e]);this._freepool.length=0,this._nextAvail=-1},t}()),__=t("RecyclePool",function(){function t(t,e){this._fn=void 0,this._count=0,this._data=void 0,this._fn=t,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}var e=t.prototype;return e.reset=function(){this._count=0},e.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},e.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},e.removeAt=function(t){if(!(t>=this._count)){var e=this._count-1,i=this._data[t];this._data[t]=this._data[e],this._data[e]=i,this._count-=1}},q(t,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),t}()),f_=t("CachedArray",function(){function t(t,e){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(t),this.length=0,this._compareFn=void 0!==e?e:function(t,e){return t-e}}var e=t.prototype;return e.push=function(t){this.array[this.length++]=t},e.pop=function(){return this.array[--this.length]},e.get=function(t){return this.array[t]},e.clear=function(){this.length=0},e.destroy=function(){this.length=0,this.array.length=0},e.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},e.concat=function(t){for(var e=0;e<t.length;++e)this.array[this.length++]=t[e]},e.fastRemove=function(t){if(!(t>=this.length||t<0)){var e=--this.length;this.array[t]=this.array[e]}},e.indexOf=function(t){return this.array.indexOf(t)},t}());t("memop",Object.freeze({__proto__:null,Pool:u_,RecyclePool:__,CachedArray:f_}));var d_=[],p_=t("CCObject",function(){function t(t){void 0===t&&(t=""),this._objFlags=void 0,this._name=void 0,this._name=t,this._objFlags=0}t._deferredDestroy=function(){for(var t=d_.length,e=0;e<t;++e){var i=d_[e];1&i._objFlags||i._destroyImmediate()}t===d_.length?d_.length=0:d_.splice(0,t)};var e=t.prototype;return e.destroy=function(){return 1&this._objFlags?(E(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,d_.push(this),0))},e._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var i,r=t instanceof n._BaseNode||t instanceof n.Component,a=r?"_id":null,o={};for(i in t)if(t.hasOwnProperty(i)){if(i===a)continue;switch(typeof t[i]){case"string":o[i]="";break;case"object":case"function":o[i]=null}}if(ei._isCCClass(e))for(var s=n.Class.Attr.getClassAttrs(e),l=e.__props__,c=0;c<l.length;c++){var h=(i=l[c])+n.Class.Attr.DELIMETER+"default";if(h in s){if(r&&"_id"===i)continue;switch(typeof s[h]){case"string":o[i]="";break;case"object":case"function":o[i]=null;break;case"undefined":o[i]=void 0}}}var u="";for(i in o){var _;_=ei.IDENTIFIER_RE.test(i)?"o."+i+"=":"o["+ei.escapeForJS(i)+"]=";var f=o[i];""===f&&(f='""'),u+=_+f+";\n"}return Function("o",u)}(this,t),It(t,"__destruct__",e,!0)),e(this)},e._destroyImmediate=function(){1&this._objFlags?b(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},q(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}()),m_=p_.prototype;function v_(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t}m_._deserialize=null,m_._onPreDestroy=null,ei.fastDefine("cc.Object",p_,{_name:"",_objFlags:0}),It(p_,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),n.isValid=v_,n.Object=p_;var g_=se.fastRemoveAt;function y_(){}var T_=function(){function t(){this.callback=y_,this.target=void 0,this.once=!1}var e=t.prototype;return e.set=function(t,e,i){this.callback=t||y_,this.target=e,this.once=!!i},e.reset=function(){this.target=void 0,this.callback=y_,this.once=!1},e.check=function(){return!(this.target instanceof p_&&!v_(this.target,!0))},t}(),S_=new u_((function(){return new T_}),32),E_=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var e=t.prototype;return e.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.callback===t&&(i.reset(),S_.free(i),g_(this.callbackInfos,e),--e)}},e.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.target===t&&(i.reset(),S_.free(i),g_(this.callbackInfos,e),--e)}},e.cancel=function(t){var e=this.callbackInfos[t];e&&(e.reset(),this.isInvoking?this.callbackInfos[t]=null:g_(this.callbackInfos,t),S_.free(e)),this.containCanceled=!0},e.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(e.reset(),S_.free(e),this.callbackInfos[t]=null)}this.containCanceled=!0},e.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||g_(this.callbackInfos,t);this.containCanceled=!1},e.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),A_=new u_((function(){return new E_}),16),b_=function(){function t(){this._callbackTable=Dt(!0)}var e=t.prototype;return e.on=function(t,e,i,n){if(!this.hasEventListener(t,e,i)){var r=this._callbackTable[t];r||(r=this._callbackTable[t]=A_.alloc());var a=S_.alloc();a.set(e,i,n),r.callbackInfos.push(a)}return e},e.hasEventListener=function(t,e,i){var n=this._callbackTable&&this._callbackTable[t];if(!n)return!1;var r=n.callbackInfos;if(!e){if(n.isInvoking){for(var a=0;a<r.length;++a)if(r[a])return!0;return!1}return r.length>0}for(var o=0;o<r.length;++o){var s=r[o];if(s&&s.check()&&s.callback===e&&s.target===i)return!0}return!1},e.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable&&this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),A_.free(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var n=this._callbackTable[i];if(n.isInvoking)for(var r=n.callbackInfos,a=0;a<r.length;++a){var o=r[a];o&&o.target===t&&n.cancel(a)}else n.removeByTarget(t)}},e.off=function(t,e,i){var n=this._callbackTable&&this._callbackTable[t];if(n){var r=n.callbackInfos;if(e)for(var a=0;a<r.length;++a){var o=r[a];if(o&&o.callback===e&&o.target===i){n.cancel(a);break}}else this.removeAll(t)}},e.emit=function(t,e,i,n,r,a){var o=this._callbackTable&&this._callbackTable[t];if(o){var s=!o.isInvoking;o.isInvoking=!0;for(var l=o.callbackInfos,c=0,h=l.length;c<h;++c){var u=l[c];if(u){var _=u.callback,f=u.target;u.once&&this.off(t,_,f),u.check()?f?_.call(f,e,i,n,r,a):_(e,i,n,r,a):this.off(t,_,f)}}s&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}},e.clear=function(){for(var t in this._callbackTable){var e=this._callbackTable[t];e&&(e.clear(),A_.free(e),delete this._callbackTable[t])}},t}();function x_(t){for(var e=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._callbackTable=Dt(!0),e}Y(e,t);var i=e.prototype;return i.once=function(t,e,i){return this.on(t,e,i,!0)},i.targetOff=function(t){this.removeAll(t)},e}(t),i=b_.prototype,n=Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i)),r=0;r<n.length;++r){var a=n[r];if(!(a in e.prototype)){var o=Object.getOwnPropertyDescriptor(i,a);o&&Object.defineProperty(e.prototype,a,o)}}return e}var C_,w_,R_,I_,O_,P_=t("EventTarget",x_((function(){})));n.EventTarget=P_;var M_=t("Asset",ru("cc.Asset")((O_=I_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).loaded=!0,J(e,"_native",R_,K(e)),e._nativeUrl="",e.__onLoadedInvoked__=!1,e.__nativeDepend__=null,e.__asyncLoadAssets__=!1,e.__depends__=null,e._file=null,e._ref=0,Object.defineProperty(K(e),"_uuid",{value:"",writable:!0}),e}Y(e,t),e.deserialize=function(t){return n.deserialize(t)},q(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=a_(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=a_(this._uuid,{__nativeName__:t,nativeExt:B(t),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(t){this._file=t}}]);var i=e.prototype;return i.toString=function(){return this.nativeUrl},i.serialize=function(){},i._setRawAsset=function(t,e){void 0===e&&(e=!0),this._native=!1!==e?t||"":"/"+t},i.addRef=function(){return this._ref++,this},i.decRef=function(t){return void 0===t&&(t=!0),this._ref>0&&this._ref--,t&&n.assetManager._releaseManager.tryRelease(this),this},i.onLoaded=function(){},q(e,[{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}(x_(p_)),I_.preventDeferredLoadDependents=!1,I_.preventPreloadNativeObject=!1,R_=$((w_=O_).prototype,"_native",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$(w_.prototype,"_nativeAsset",[lu],Object.getOwnPropertyDescriptor(w_.prototype,"_nativeAsset"),w_.prototype),C_=w_))||C_);M_.prototype.createNode=null,n.Asset=M_;var D_,N_,L_,B_,F_,z_,U_,k_=1024;function G_(t){return n.sys.capabilities.imageBitmap&&t instanceof ImageBitmap}!function(t){t[t.RGB565=ka.R5G6B5]="RGB565",t[t.RGB5A1=ka.RGB5A1]="RGB5A1",t[t.RGBA4444=ka.RGBA4]="RGBA4444",t[t.RGB888=ka.RGB8]="RGB888",t[t.RGB32F=ka.RGB32F]="RGB32F",t[t.RGBA8888=ka.RGBA8]="RGBA8888",t[t.RGBA32F=ka.RGBA32F]="RGBA32F",t[t.A8=ka.A8]="A8",t[t.I8=ka.L8]="I8",t[t.AI8=ka.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=ka.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=ka.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=k_++]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=ka.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=ka.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=k_++]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=ka.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=k_++]="RGBA_ETC1",t[t.RGB_ETC2=ka.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=ka.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=ka.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=ka.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=ka.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=ka.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=ka.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=ka.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=ka.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=ka.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=ka.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=ka.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=ka.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=ka.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=ka.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=ka.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(D_||(D_={})),function(t){t[t.REPEAT=eo.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=eo.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=eo.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=eo.BORDER]="CLAMP_TO_BORDER"}(N_||(N_={})),function(t){t[t.NONE=to.NONE]="NONE",t[t.LINEAR=to.LINEAR]="LINEAR",t[t.NEAREST=to.POINT]="NEAREST"}(L_||(L_={}));var H_,V_=t("ImageAsset",ru("cc.ImageAsset")((U_=z_=function(t){function e(e){var i;return(i=t.call(this)||this)._nativeData=void 0,i._tex=void 0,i._exportedExts=void 0,i._format=D_.RGBA8888,i._width=0,i._height=0,i.loaded=!1,i._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&i.reset(e),i}Y(e,t),q(e,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||G_(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return this._nativeData&&((t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||G_(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=D_.RGB_ETC1&&this._format<=D_.RGBA_ASTC_12x12||this._format>=D_.RGB_A_PVRTC_2BPPV1&&this._format<=D_.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",set:function(t){this._tex=t},get:function(){if(!this._tex){var t=new n.Texture2D;t.name=this.nativeUrl,t.image=this,this._tex=t}return this._tex}}]);var i=e.prototype;return i.reset=function(t){var e=this;G_(t)?(this._nativeData=t,this._onDataComplete()):t instanceof HTMLElement?(this._nativeData=t,t.complete||t instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,t.addEventListener("load",(function(){e._onDataComplete()})),t.addEventListener("error",(function(t){E(3119,t.message)})))):(this._nativeData=t,this._format=t.format,this._onDataComplete())},i.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):G_(this.data)&&this.data.close&&this.data.close(),t.prototype.destroy.call(this)},i._serialize=function(){},i._deserialize=function(t){var i="";"string"==typeof t?i=t:(this._width=t.w,this._height=t.h,i=t.fmt);for(var r,a=n.director.root?n.director.root.device:null,o=i.split("_"),s="",l=Number.MAX_VALUE,c=this._format,h="",u=n.macro.SUPPORT_TEXTURE_FORMATS,_=Q(o);!(r=_()).done;){var f=r.value.split("@"),d=parseInt(f[0],void 0),p=e.extnames[d]||f[0],m=u.indexOf(p);if(-1!==m&&m<l){var v=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==p||a&&a.hasFeature(So.FORMAT_ASTC)))continue;if(!(".pvr"!==p||a&&a.hasFeature(So.FORMAT_PVRTC)))continue;if(!(v!==D_.RGB_ETC1&&v!==D_.RGBA_ETC1||a&&a.hasFeature(So.FORMAT_ETC1)))continue;if(!(v!==D_.RGB_ETC2&&v!==D_.RGBA_ETC2||a&&a.hasFeature(So.FORMAT_ETC2)))continue;if(".webp"===p&&!n.sys.capabilities.webp)continue;l=m,h=p,c=v}else s||(s=p)}h?(this._setRawAsset(h),this._format=c):s?(this._setRawAsset(s),E(3120,s,s)):E(3121)},i._onDataComplete=function(){this.loaded=!0,this.emit("load")},e}(M_),z_.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],$((F_=U_).prototype,"_nativeAsset",[zu],Object.getOwnPropertyDescriptor(F_.prototype,"_nativeAsset"),F_.prototype),B_=F_))||B_);n.ImageAsset=V_,function(t){t[t.minFilter=0]="minFilter",t[t.magFilter=1]="magFilter",t[t.mipFilter=2]="mipFilter",t[t.addressU=3]="addressU",t[t.addressV=4]="addressV",t[t.addressW=5]="addressW",t[t.maxAnisotropy=6]="maxAnisotropy",t[t.cmpFunc=7]="cmpFunc",t[t.minLOD=8]="minLOD",t[t.maxLOD=9]="maxLOD",t[t.mipLODBias=10]="mipLODBias",t[t.total=11]="total"}(H_||(H_={}));var W_=[to.LINEAR,to.LINEAR,to.NONE,eo.WRAP,eo.WRAP,eo.WRAP,8,Ka.NEVER,0,0,0],j_=Y_(W_),q_=new Jo,X_=new gs;function Y_(t){for(var e=0,i=0,n=0;n<W_.length;n++)switch(e=t[n]||W_[n],n){case H_.minFilter:i|=e;break;case H_.magFilter:i|=e<<2;break;case H_.mipFilter:i|=e<<4;break;case H_.addressU:i|=e<<6;break;case H_.addressV:i|=e<<8;break;case H_.addressW:i|=e<<10;break;case H_.maxAnisotropy:i|=e<<12;break;case H_.cmpFunc:i|=e<<16;break;case H_.minLOD:i|=e<<20;break;case H_.maxLOD:i|=e<<24;break;case H_.mipLODBias:i|=e<<28}return i}var K_,Z_,Q_,J_,$_,tf,ef,nf,rf,af,of,sf,lf=new(function(){function t(){this._cache={}}return t.prototype.getSampler=function(t,e){return e||(e=j_),this._cache[e]||(X_.minFilter=3&e,X_.magFilter=e>>2&3,X_.mipFilter=e>>4&3,X_.addressU=e>>6&3,X_.addressV=e>>8&3,X_.addressW=e>>10&3,X_.maxAnisotropy=e>>12&15,X_.cmpFunc=e>>16&15,X_.minLOD=e>>20&15,X_.maxLOD=e>>24&15,X_.mipLODBias=e>>28&15,X_.borderColor=q_,this._cache[e]=t.createSampler(X_))},t}());n.samplerLib=lf;var cf=new Et("Tex"),hf=ru("cc.TextureBase")((sf=of=function(t){function e(){var e;return J(e=t.call(this)||this,"_format",Q_,K(e)),J(e,"_minFilter",J_,K(e)),J(e,"_magFilter",$_,K(e)),J(e,"_mipFilter",tf,K(e)),J(e,"_wrapS",ef,K(e)),J(e,"_wrapT",nf,K(e)),J(e,"_wrapR",rf,K(e)),J(e,"_anisotropy",af,K(e)),e._width=1,e._height=1,e._id=void 0,e._samplerInfo=[],e._samplerHash=0,e._gfxSampler=null,e._gfxDevice=null,e._textureHash=0,e._id=cf.getNewId(),e.loaded=!1,e._gfxDevice=e._getGFXDevice(),e._textureHash=qo(e._id,666),e}Y(e,t),q(e,[{key:"isCompressed",get:function(){return this._format>=D_.RGB_ETC1&&this._format<=D_.RGBA_ASTC_12x12||this._format>=D_.RGB_A_PVRTC_2BPPV1&&this._format<=D_.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var i=e.prototype;return i.getId=function(){return this._id},i.getPixelFormat=function(){return this._format},i.getAnisotropy=function(){return this._anisotropy},i.setWrapMode=function(t,e,i){this._wrapS=t,this._samplerInfo[H_.addressU]=t,this._wrapT=e,this._samplerInfo[H_.addressV]=e,void 0!==i&&(this._wrapR=i,this._samplerInfo[H_.addressW]=i),this._samplerHash=Y_(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=lf.getSampler(this._gfxDevice,this._samplerHash))},i.setFilters=function(t,e){this._minFilter=t,this._samplerInfo[H_.minFilter]=t,this._magFilter=e,this._samplerInfo[H_.magFilter]=e,this._samplerHash=Y_(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=lf.getSampler(this._gfxDevice,this._samplerHash))},i.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo[H_.mipFilter]=t,this._samplerInfo[H_.maxLOD]=t===L_.NONE?0:15,this._samplerHash=Y_(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=lf.getSampler(this._gfxDevice,this._samplerHash))},i.setAnisotropy=function(t){this._anisotropy=t,this._samplerInfo[H_.maxAnisotropy]=t,this._samplerHash=Y_(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=lf.getSampler(this._gfxDevice,this._samplerHash))},i.destroy=function(){var e=t.prototype.destroy.call(this);return e&&n.director.root&&n.director.root.batcher2D&&n.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),e},i.getHash=function(){return this._textureHash},i.getGFXTexture=function(){return null},i.getSamplerHash=function(){return this._samplerHash},i.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=lf.getSampler(this._gfxDevice,this._samplerHash):b(9302)),this._gfxSampler},i._serialize=function(){return""},i._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},i._getGFXDevice=function(){return n.director.root?n.director.root.device:null},i._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},i._setGFXFormat=function(t){this._format=void 0===t?D_.RGBA8888:t},i._getGFXPixelFormat=function(t){return t===D_.RGBA_ETC1?t=D_.RGB_ETC1:t===D_.RGB_A_PVRTC_4BPPV1?t=D_.RGB_PVRTC_4BPPV1:t===D_.RGB_A_PVRTC_2BPPV1&&(t=D_.RGB_PVRTC_2BPPV1),t},e}(M_),of.PixelFormat=D_,of.WrapMode=N_,of.Filter=L_,Q_=$((Z_=sf).prototype,"_format",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return D_.RGBA8888}}),J_=$(Z_.prototype,"_minFilter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L_.LINEAR}}),$_=$(Z_.prototype,"_magFilter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L_.LINEAR}}),tf=$(Z_.prototype,"_mipFilter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L_.NONE}}),ef=$(Z_.prototype,"_wrapS",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N_.REPEAT}}),nf=$(Z_.prototype,"_wrapT",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N_.REPEAT}}),rf=$(Z_.prototype,"_wrapR",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N_.REPEAT}}),af=$(Z_.prototype,"_anisotropy",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),K_=Z_))||K_;n.TextureBase=hf;var uf=[Xi,Ri,Qi,Li,Ci,tn,nn,Vi];function _f(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var ff=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},_f,_f,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){Vi.fromArray(t,e,1)}],df=t("Details",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var e=t.prototype;return e.init=function(t){this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]},e.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},e.push=function(t,e,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(i)},t}());function pf(t,e){for(var i=t[4][e[0]],n=i[0],r=new(0,n[0]),a=n[1],o=n[2],s=i[i.length-1],l=1;l<s;++l)r[a[i[l]]]=e[l];for(;l<e.length;++l){var c=a[i[l]],h=n[i[l]+o];(0,Sf[h])(t,r,c,e[l])}return r}function mf(t,e,i){var n=new e;return n._deserialize?n._deserialize(i,t[0]):b(5303,Nt(e)),n}function vf(t,e,i,n){n>=0?e[i]=t[5][n]:t[7][3*~n]=e}function gf(t){return function(e,i,n,r){i[n]=r;for(var a=0;a<r.length;++a)t(e,r,a,r[a])}}function yf(t,e,i,n){e[i]=null,t[8][n]=e}function Tf(t,e,i,n){e[i]=pf(t,n)}df.pool=new oe((function(t){t.reset()}),5),df.pool.get=function(){return this._get()||new df};var Sf=new Array(13);function Ef(t,e){return t||Cf.reportMissingClass(e),Object}function Af(t,e,i,n,r,a){var o=t(e);if(!o){if(r)return void(i[n]=function(e,i,n){return function(){var r=t(n)||Ef(a,n);return e[i]=r,new r}}(i,n,e));o=Ef(a,e)}i[n]=o}function bf(t,e,i){for(var n=i||ne,r=t[3],a=0;a<r.length;++a){var o=r[a];"string"!=typeof o?Af(n,o[0],o,0,e,i):Af(n,o,r,a,e,i)}}function xf(t){var e=t[4];if(e)for(var i=t[3],n=0;n<e.length;++n){var r=e[n];r[0]=i[r[0]]}}function Cf(t,e,i){"string"==typeof t&&(t=JSON.parse(t));var r,a=!e;(e=e||df.pool.get()).init(t),i=i||{};var o=t[0],s=!1;if("object"==typeof o&&(s=o.preprocessed,o=o.version),o<1)throw new Error(R(5304,o));i._version=o,i.result=e,t[0]=i,s||(bf(t,!1,i.classFinder),xf(t)),n.game._isCloning=!0;var l=t[5],c=function(t){var e=t[5],i=t[6],n=0===i?0:i.length,r=e[e.length-1],a=e.length-n;"number"!=typeof r?r=0:(r<0&&(r=~r),--a);for(var o=0;o<a;++o)e[o]=pf(t,e[o]);for(var s=t[3],l=0;l<n;++l,++o){var c=i[l],h=e[o];if(c>=0){var u=s[c];e[o]=mf(t,u,h)}else(0,Sf[c=~c])(t,e,o,h)}return r}(t);return n.game._isCloning=!1,t[7]&&function(t,e,i){for(var n=t.length-1,r=0,a=3*t[n];r<a;r+=3){var o=t[r],s=e[t[r+2]],l=t[r+1];l>=0?o[i[l]]=s:o[~l]=s}for(;r<n;r+=3){var c=e[t[r]],h=e[t[r+2]],u=t[r+1];u>=0?c[i[u]]=h:c[~u]=h}}(t[7],l,t[2]),function(t){for(var e=t[5],i=t[2],n=t[1],r=t[8],a=t[9],o=t[10],s=0;s<r.length;++s){var l=r[s];"number"==typeof l&&(r[s]=e[l]);var c=a[s];"number"==typeof c&&(c=c>=0?i[c]:~c,a[s]=c);var h=o[s];"number"==typeof h&&(o[s]=n[h])}}(t),r=l[c],a&&df.pool.put(e),r}Sf[0]=function(t,e,i,n){e[i]=n},Sf[1]=vf,Sf[2]=gf(vf),Sf[3]=gf(yf),Sf[4]=Tf,Sf[5]=function(t,e,i,n){ff[n[0]](e[i],n)},Sf[6]=yf,Sf[7]=function(t,e,i,n){e[i].set(n)},Sf[8]=function(t,e,i,n){var r=new uf[n[0]];ff[n[0]](r,n),e[i]=r},Sf[9]=gf(Tf),Sf[10]=function(t,e,i,n){var r=t[3][n[0]];e[i]=mf(t,r,n[1])},Sf[11]=function(t,e,i,n){var r=n[0];e[i]=r;for(var a=1;a<n.length;a+=3){var o=n[a],s=n[a+1],l=n[a+2];(0,Sf[s])(t,r,o,l)}},Sf[12]=function(t,e,i,n){var r=n[0];e[i]=r;for(var a=0;a<r.length;++a){var o=r[a],s=n[a+1];0!==s&&(0,Sf[s])(t,r,a,o)}},Cf.Details=df,Cf.reportMissingClass=function(t){E(5302,t)};var wf,Rf,If,Of=function(t){this.preprocessed=!0,this.version=t};function Pf(t,e,i){return[1,0,0,[t],0,i?[e,-1]:[e],[0],0,[],[],[]]}n.deserialize=Cf;var Mf=t("Script",ru("cc.Script")(wf=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(M_))||wf);n._Script=Mf;var Df=t("JavaScript",ru("cc.JavaScript")(Rf=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(Mf))||Rf);n._JavaScript=Df;var Nf,Lf,Bf,Ff,zf,Uf,kf,Gf,Hf,Vf,Wf,jf=t("TypeScript",ru("cc.TypeScript")(If=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(Mf))||If);n._TypeScript=jf;var qf,Xf,Yf,Kf,Zf=new Et("Comp"),Qf=p_.Flags.IsOnLoadCalled,Jf=t("Component",(Nf=ru("cc.Component"),Lf=Su(),Bf=Fu(Mf),Ff=Eu(),Nf((Wf=Vf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"node",kf,K(e)),J(e,"_enabled",Gf,K(e)),J(e,"__prefab",Hf,K(e)),e._sceneGetter=null,e._id=Zf.getNewId(),e}Y(e,t);var i=e.prototype;return i._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},i.addComponent=function(t){return this.node.addComponent(t)},i.getComponent=function(t){return this.node.getComponent(t)},i.getComponents=function(t){return this.node.getComponents(t)},i.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},i.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},i.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&n.director._compScheduler.disableComp(this),!0)},i._onPreDestroy=function(){this.unscheduleAllCallbacks(),n.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},i._instantiate=function(t){return t||(t=n.instantiate._clone(this,this)),t.node=null,t},i.schedule=function(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=n.macro.REPEAT_FOREVER),void 0===r&&(r=0),w(t,1619),w((e=e||0)>=0,1620),i=Number.isNaN(i)?n.macro.REPEAT_FOREVER:i,r=r||0;var a=n.director.getScheduler(),o=a.isTargetPaused(this);a.schedule(t,this,e,i,r,o)},i.scheduleOnce=function(t,e){void 0===e&&(e=0),this.schedule(t,0,0,e)},i.unschedule=function(t){t&&n.director.getScheduler().unschedule(t,this)},i.unscheduleAllCallbacks=function(){n.director.getScheduler().unscheduleAllForTarget(this)},q(e,[{key:"name",get:function(){if(this._name)return this._name;var t=Nt(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var e=n.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&Qf}}]),e}(p_),Vf.system=null,$((Uf=Wf).prototype,"__scriptAsset",[Lf,Bf,Ff,Mu],Object.getOwnPropertyDescriptor(Uf.prototype,"__scriptAsset"),Uf.prototype),kf=$(Uf.prototype,"node",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gf=$(Uf.prototype,"_enabled",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Hf=$(Uf.prototype,"__prefab",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zf=Uf))||zf)),$f=Jf.prototype;$f.update=null,$f.lateUpdate=null,$f.__preload=null,$f.onLoad=null,$f.start=null,$f.onEnable=null,$f.onDisable=null,$f.onDestroy=null,$f.onFocusInEditor=null,$f.onLostFocusInEditor=null,$f.resetInEditor=null,$f._getLocalBounds=null,$f.onRestore=null,Jf._requireComponent=null,Jf._executionOrder=0,It(Jf,"_registerEditorProps",(function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i);var n=e.executionOrder;n&&"number"==typeof n&&(t._executionOrder=n)})),n.Component=Jf;var td=t("MissingScript",ru("cc.MissingScript")(qf=mu()((Kf=function(t){function e(){var e;return J(e=t.call(this)||this,"_$erialized",Yf,K(e)),e}return Y(e,t),e.safeFindClass=function(t){var e=ne(t);if(e)return e;n.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){E(4600,this.node.name)},e}(Jf),Yf=$((Xf=Kf).prototype,"_$erialized",[cu,uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qf=Xf))||qf)||qf);function ed(t,e){var i;i=td.safeFindClass;var n,r=df.pool.get();try{n=Cf(t,r,{classFinder:i,customEnv:e})}catch(t){throw d(t),df.pool.put(r),t}n._uuid=e.__uuid__||"";for(var a=r.uuidList,o=r.uuidObjList,s=r.uuidPropList,l=[],c=0;c<a.length;c++){var h=a[c];l[c]={uuid:i_(h),owner:o[c],prop:s[c]}}return n.__depends__=l,n._native&&(n.__nativeDepend__=!0),df.pool.put(r),n}n._MissingScript=td;var id,nd=new(function(){function t(){this._depends=new Uu}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?X({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),i=[];return this._descend(t,e,i),i},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var i,n,r=null;if(Array.isArray(e)||e.__type__){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(n=(i=e[5])[i.length-1])&&n<0)try{var a=ed(e,{__uuid__:t});(r=this._parseDepsFromAsset(a)).nativeDep&&(r.nativeDep.uuid=t),Wu.add(t+"@import",a)}catch(e){Vu.remove(t+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:t.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:t.constructor.preventDeferredLoadDependents},i=t.__depends__,n=0,r=i.length;n<r;n++)e.deps.push(i[n].uuid);return t.__nativeDepend__&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=null;return(e=function(t){var e=t[1];return t[10].map((function(t){return e[t]}))}(t)).forEach((function(t,i){return e[i]=i_(t)})),e},e._descend=function(t,e,i){for(var n=this.getDeps(t),r=0;r<n.length;r++){var a=n[r];e[a]||(e[a]=!0,i.push(a),this._descend(a,e,i))}},t}()),rd=[new ns];function ad(t){return t&&0==(t&t-1)}var od,sd,ld,cd,hd,ud,_d=ru("cc.SimpleTexture")(id=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gfxTexture=null,e._mipmapLevel=1,e._textureWidth=0,e._textureHeight=0,e}Y(e,t);var i=e.prototype;return i.getGFXTexture=function(){return this._gfxTexture},i.destroy=function(){return this._tryDestroyTexture(),t.prototype.destroy.call(this)},i.updateImage=function(){this.updateMipmaps(0)},i.updateMipmaps=function(){},i.uploadData=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var n=this._getGFXDevice();if(n){var r=rd[0];r.texExtent.width=this._textureWidth>>e,r.texExtent.height=this._textureHeight>>e,r.texSubres.mipLevel=e,r.texSubres.baseArrayLayer=i,ArrayBuffer.isView(t)?n.copyBuffersToTexture([t],this._gfxTexture,rd):n.copyTexImagesToTexture([t],this._gfxTexture,rd)}}},i._assignImage=function(t,e,i){var r=this,a=function(){var n=t.data;if(n&&(r.uploadData(n,e,i),r._checkTextureLoaded(),pe.CLEANUP_IMAGE_CACHE)){var a=nd.getDeps(r._uuid),o=a.indexOf(t._uuid);-1!==o&&(gt(a,o),t.decRef())}};if(t.loaded)a();else{if(t.once("load",(function(){a()})),!this.isCompressed){var o=n.builtinResMgr.get("black-texture").image;this.uploadData(o.data,e,i)}n.assetManager.postLoadNative(t)}},i._checkTextureLoaded=function(){this._textureReady()},i._textureReady=function(){this.loaded=!0,this.emit("load")},i._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},i._getGfxTextureCreateInfo=function(){return null},i._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&this._createTexture(t)}},i._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=ao.NONE;this._mipFilter!==L_.NONE&&function(t,e,i){return!(t.gfxAPI===yo.WEBGL)||ad(e)&&ad(i)}(t,this._width,this._height)&&(this._mipmapLevel=function(t,e){for(var i=Math.max(t,e),n=0;i;)i>>=1,n++;return n}(this._width,this._height),e=ao.GEN_MIPMAP);var i=this._getGfxTextureCreateInfo({usage:no.SAMPLED|no.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e|ao.IMMUTABLE});if(i){var n=t.createTexture(i);this._textureWidth=i.width,this._textureHeight=i.height,this._gfxTexture=n}}},i._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},q(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(hf))||id;n.SimpleTexture=_d;var fd,dd,pd,md,vd,gd,yd=t("Texture2D",(od=ru("cc.Texture2D"),sd=Fu([V_]),od((ud=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_mipmaps",hd,K(e)),e}Y(e,t);var i=e.prototype;return i.initialize=function(){this.mipmaps=this._mipmaps},i.onLoaded=function(){this.initialize()},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format),this._setMipmapLevel(t.mipmapLevel||1),this._tryReset()},i.create=function(t,e,i,n){void 0===i&&(i=D_.RGBA8888),void 0===n&&(n=1),this.reset({width:t,height:e,format:i,mipmapLevel:n})},i.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},i.updateMipmaps=function(t,e){if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var i=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),n=0;n<i;++n){var r=t+n;this._assignImage(this._mipmaps[r],r)}},i.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},i.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},i.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},i.releaseTexture=function(){this.destroy()},i._serialize=function(){},i._deserialize=function(e,i){var n=e;t.prototype._deserialize.call(this,n.base,i),this._mipmaps=new Array(n.mipmaps.length);for(var r=0;r<n.mipmaps.length;++r)if(this._mipmaps[r]=new V_,n.mipmaps[r]){var a=n.mipmaps[r];i.result.push(this._mipmaps,""+r,a),this._mipmaps[r]._texture=this}},i._getGfxTextureCreateInfo=function(t){var e=new Cs(io.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t)},i._checkTextureLoaded=function(){for(var e=!0,i=0;i<this._mipmaps.length;++i)if(!this._mipmaps[i].loaded){e=!1;break}e&&t.prototype._textureReady.call(this)},q(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var i=this._mipmaps[0];this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(t,i){e._assignImage(t,i)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(_d),hd=$((cd=ud).prototype,"_mipmaps",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ld=cd))||ld));n.Texture2D=yd,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(gd||(gd={}));var Td=t("TextureCube",ru("cc.TextureCube")((vd=md=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_mipmaps",pd,K(e)),e}Y(e,t),e.fromTexture2DArray=function(t,i){for(var n=[],r=t.length/6,a=0;a<r;a++){var o=6*a;n.push({front:t[o+gd.front].image,back:t[o+gd.back].image,left:t[o+gd.left].image,right:t[o+gd.right].image,top:t[o+gd.top].image,bottom:t[o+gd.bottom].image})}return(i=i||new e).mipmaps=n,i};var i=e.prototype;return i.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format),this._setMipmapLevel(t.mipmapLevel||1),this._tryReset()},i.updateMipmaps=function(t,e){var i=this;if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var n=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),r=function(e){var n=t+e;Sd(i._mipmaps[n],(function(t,e){i._assignImage(t,n,e)}))},a=0;a<n;++a)r(a)},i.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},i.releaseTexture=function(){this.mipmaps=[]},i._serialize=function(){},i._deserialize=function(e,i){var n=e;t.prototype._deserialize.call(this,n.base,i),this._mipmaps=new Array(n.mipmaps.length);for(var r=0;r<n.mipmaps.length;++r){this._mipmaps[r]={front:new V_,back:new V_,left:new V_,right:new V_,top:new V_,bottom:new V_};var a=n.mipmaps[r];i.result.push(this._mipmaps[r],"front",a.front),i.result.push(this._mipmaps[r],"back",a.back),i.result.push(this._mipmaps[r],"left",a.left),i.result.push(this._mipmaps[r],"right",a.right),i.result.push(this._mipmaps[r],"top",a.top),i.result.push(this._mipmaps[r],"bottom",a.bottom)}},i._getGfxTextureCreateInfo=function(t){var e=new Cs(io.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e.flags|=ao.CUBEMAP,e},q(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var i=this._mipmaps[0].front;this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(t,i){Sd(t,(function(t,n){e._assignImage(t,i,n)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(_d),md.FaceIndex=gd,pd=$((dd=vd).prototype,"_mipmaps",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fd=dd))||fd);function Sd(t,e){e(t.front,gd.front),e(t.back,gd.back),e(t.left,gd.left),e(t.right,gd.right),e(t.top,gd.top),e(t.bottom,gd.bottom)}n.TextureCube=Td;var Ed,Ad,bd,xd=t("effects",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2143664850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:1062464958,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3946667351,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:3696836305,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:4115155772,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:66662317,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:4078504952,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:[]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:["TWO_COLORED"],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:3990469549,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs:vert|standard-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs:vert|standard-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs:vert|standard-fs:frag",hash:624422912,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3020491,builtins:{globals:{blocks:[{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs:vert|terrain-fs:frag",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs:vert|terrain-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs:vert|terrain-fs:frag",hash:2164259680,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplers:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3874167763,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3822871803,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:2901856202,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2319917655,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:2029303284,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:2106901053,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[{name:"splashFrag",defines:[],binding:0,stageFlags:16,members:[{name:"u_precent",type:13,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]);!function(t){t[t.UBO=0]="UBO",t[t.SAMPLER=1]="SAMPLER"}(bd||(bd={}));var Cd=function(t,e,i,n,r){return void 0===r&&(r=0),t<<28&4026531840|n<<22&264241152|e<<20&3145728|i<<14&1032192|16383&r},wd=function(t){return(4026531840&t)>>>28},Rd=function(t){return(264241152&t)>>>22},Id=function(t){return(1032192&t)>>>14},Od=function(t){return 16383&t},Pd=function(t,e){return-264241153&t|e<<22&264241152},Md=((Ed={})[Ua.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Ed[Ua.INT]=function(t,e,i){return void 0===i&&(i=0),t[i]},Ed[Ua.INT2]=function(t,e,i){return void 0===i&&(i=0),Xi.fromArray(e,t,i)},Ed[Ua.INT3]=function(t,e,i){return void 0===i&&(i=0),Ri.fromArray(e,t,i)},Ed[Ua.INT4]=function(t,e,i){return void 0===i&&(i=0),Qi.fromArray(e,t,i)},Ed[Ua.FLOAT]=function(t,e,i){return void 0===i&&(i=0),t[i]},Ed[Ua.FLOAT2]=function(t,e,i){return void 0===i&&(i=0),Xi.fromArray(e,t,i)},Ed[Ua.FLOAT3]=function(t,e,i){return void 0===i&&(i=0),Ri.fromArray(e,t,i)},Ed[Ua.FLOAT4]=function(t,e,i){return void 0===i&&(i=0),Qi.fromArray(e,t,i)},Ed[Ua.MAT3]=function(t,e,i){return void 0===i&&(i=0),Mi.fromArray(e,t,i)},Ed[Ua.MAT4]=function(t,e,i){return void 0===i&&(i=0),Vi.fromArray(e,t,i)},Ed),Dd=((Ad={})[Ua.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Ad[Ua.INT]=function(t,e,i){return void 0===i&&(i=0),t[i]=e},Ad[Ua.INT2]=function(t,e,i){return void 0===i&&(i=0),Xi.toArray(t,e,i)},Ad[Ua.INT3]=function(t,e,i){return void 0===i&&(i=0),Ri.toArray(t,e,i)},Ad[Ua.INT4]=function(t,e,i){return void 0===i&&(i=0),Qi.toArray(t,e,i)},Ad[Ua.FLOAT]=function(t,e,i){return void 0===i&&(i=0),t[i]=e},Ad[Ua.FLOAT2]=function(t,e,i){return void 0===i&&(i=0),Xi.toArray(t,e,i)},Ad[Ua.FLOAT3]=function(t,e,i){return void 0===i&&(i=0),Ri.toArray(t,e,i)},Ad[Ua.FLOAT4]=function(t,e,i){return void 0===i&&(i=0),Qi.toArray(t,e,i)},Ad[Ua.MAT3]=function(t,e,i){return void 0===i&&(i=0),Mi.toArray(t,e,i)},Ad[Ua.MAT4]=function(t,e,i){return void 0===i&&(i=0),Vi.toArray(t,e,i)},Ad),Nd=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Ld(t){switch(t){case Ua.BOOL:case Ua.INT:case Ua.UINT:case Ua.FLOAT:return Nd[0];case Ua.BOOL2:case Ua.INT2:case Ua.UINT2:case Ua.FLOAT2:return Nd[1];case Ua.BOOL4:case Ua.INT4:case Ua.UINT4:case Ua.FLOAT4:return Nd[2];case Ua.MAT4:return Nd[3];case Ua.SAMPLER2D:return"default-texture";case Ua.SAMPLER_CUBE:return"default-cube-texture"}return Nd[0]}function Bd(t,e){for(var i=Object.entries(e),n=!1,r=0;r<i.length;r++)t[i[r][0]]!==i[r][1]&&(t[i[r][0]]=i[r][1],n=!0);return n}var Fd=new Bs;function zd(t){return Math.ceil(Math.log2(Math.max(t,2)))}function Ud(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return console.warn("unknown define type '"+t.type+"'"),"-1"}}function kd(t,e,i,n,r){for(var a=t.builtins[n],o=[],s=function(t){var e=a.blocks[t],n=i.layouts[e.name],s=n&&i.bindings.find((function(t){return t.binding===n.binding}));if(!(n&&s&&s.descriptorType&Ps))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";o.push(n),r&&!r.includes(s)&&r.push(s)},l=0;l<a.blocks.length;l++)s(l);Array.prototype.unshift.apply(e.gfxBlocks,o);for(var c=[],h=function(t){var e=a.samplers[t],n=i.layouts[e.name],o=n&&i.bindings.find((function(t){return t.binding===n.binding}));if(!(n&&o&&o.descriptorType&Ms))return console.warn("builtin sampler '"+e.name+"' not available!"),"continue";c.push(n),r&&!r.includes(o)&&r.push(o)},u=0;u<a.samplers.length;u++)h(u);Array.prototype.unshift.apply(e.gfxSamplers,c),r&&r.sort((function(t,e){return t.binding-e.binding}))}function Gd(t){return t.members.reduce((function(t,e){return t+Io(e.type)*e.count}),0)}function Hd(t,e){for(var i=0;i<t.length;i++){var n=t[i];if("!"===n[0]){if(e[n.slice(1)])return!1}else if(!e[n])return!1}return!0}function Vd(t){switch(t.gfxAPI){case yo.GLES2:case yo.WEBGL:return"glsl1";case yo.GLES3:case yo.WEBGL2:return"glsl3";default:return"glsl4"}}var Wd=new(function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=0;e<t.shaders.length;e++)this.define(t.shaders[e]).effectName=t.name},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;for(var i=X({},t),n=0,r=function(t){var e=i.defines[t],r=1;if("number"===e.type){var a=e.range;r=zd(a[1]-a[0]+1),e._map=function(t){return t-a[0]}}else"string"===e.type?(r=zd(e.options.length),e._map=function(t){return Math.max(0,e.options.findIndex((function(e){return e===t})))}):"boolean"===e.type&&(e._map=function(t){return t?1:0});e._offset=n,n+=r},a=0;a<i.defines.length;a++)r(a);if(n>31&&(i.uber=!0),this._templates[t.name]=i,!this._templateInfos[i.hash]){var o={};o.samplerStartBinding=i.blocks.length,o.gfxBlocks=[],o.gfxSamplers=[],o.bindings=[],o.blockSizes=[];for(var s=0;s<i.blocks.length;s++){var l=i.blocks[s];o.blockSizes.push(Gd(l)),o.bindings.push(new Ls(l.binding,l.descriptorType||so.UNIFORM_BUFFER,1,l.stageFlags)),o.gfxBlocks.push(new Es(Wc.MATERIAL,l.binding,l.name,l.members.map((function(t){return new Ss(t.name,t.type,t.count)})),1))}for(var c=0;c<i.samplers.length;c++){var h=i.samplers[c];o.bindings.push(new Ls(h.binding,h.descriptorType||so.SAMPLER,h.count,h.stageFlags)),o.gfxSamplers.push(new As(Wc.MATERIAL,h.binding,h.name,h.type,h.count))}o.gfxAttributes=[];for(var u=0;u<i.attributes.length;u++){var _=i.attributes[u];o.gfxAttributes.push(new Xo(_.name,_.format,_.isNormalized,0,_.isInstanced,_.location))}kd(i,o,kc,"locals"),o.gfxStages=[],o.gfxStages.push(new Ts(oo.VERTEX,"")),o.gfxStages.push(new Ts(oo.FRAGMENT,"")),o.handleMap=function(t){for(var e={},i=0;i<t.blocks.length;i++)for(var n=t.blocks[i],r=n.members,a=0,o=0;o<r.length;o++){var s=r[o];e[s.name]=Cd(bd.UBO,Wc.MATERIAL,n.binding,s.type,a),a+=(Io(s.type)>>2)*s.count}for(var l=0;l<t.samplers.length;l++){var c=t.samplers[l];e[c.name]=Cd(bd.SAMPLER,Wc.MATERIAL,c.binding,c.type)}return e}(i),o.hPipelineLayout=0,o.setLayouts=[],this._templateInfos[i.hash]=o}return i},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,i){void 0===i&&(i=!1);var n=this._templates[e],r=this._templateInfos[n.hash];return r.setLayouts.length||(Fd.bindings=r.bindings,r.setLayouts[Wc.MATERIAL]=t.createDescriptorSetLayout(Fd),Fd.bindings=kc.bindings,r.setLayouts[Wc.LOCAL]=t.createDescriptorSetLayout(Fd)),r.setLayouts[i?Wc.LOCAL:Wc.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){var i=this._templates[t],n=i.defines;if(i.uber){for(var r="",a=0;a<n.length;a++){var o=n[a],s=e[o.name];if(s&&o._map){var l=o._map(s);r+=""+o._offset+l+"|"}}return""+r+i.hash}for(var c=0,h=0;h<n.length;h++){var u=n[h],_=e[u.name];_&&u._map&&(c|=u._map(_)<<u._offset)}return c.toString(16)+"|"+i.hash},e.destroyShaderByDefines=function(t){var e=this,i=Object.keys(t);if(i.length)for(var n=i.map((function(e){var i=t[e];return"boolean"==typeof i&&(i=i?"1":"0"),new RegExp(""+e+i)})),r=Object.keys(this._cache).filter((function(t){return n.every((function(i){return i.test(kn.get(e._cache[t]).name)}))})),a=0;a<r.length;a++){var o=r[a],s=kn.get(this._cache[o]);console.log("destroyed shader "+s.name),s.destroy(),delete this._cache[o]}},e.getGFXShader=function(t,e,i,n,r){Object.assign(i,n.macros),r||(r=this.getKey(e,i));var a=this._cache[r];if(a)return a;var o=this._templates[e],s=this._templateInfos[o.hash];s.hPipelineLayout||(this.getDescriptorSetLayout(t,e),kd(o,s,Uc,"globals"),s.setLayouts[Wc.GLOBAL]=n.descriptorSetLayout,s.hPipelineLayout=Vn.alloc(t,new Us(s.setLayouts)));var l=function(t,e){for(var i=[],n=0;n<e.length;n++){var r=e[n],a=r.name,o=t[a],s=Ud(r,o),l=!o||"0"===o;i.push({name:a,value:s,isDefault:l})}return i}(i,o.defines),c=l.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),"")+"\n",h=o.glsl3,u=Vd(t);u?h=o[u]:console.error("Invalid GFX API!"),s.gfxStages[0].source=c+h.vert,s.gfxStages[1].source=c+h.frag;var _=function(t,e,i){for(var n=[],r=t.attributes,a=e.gfxAttributes,o=0;o<r.length;o++)Hd(r[o].defines,i)&&n.push(a[o]);return n}(o,s,i),f=function(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}(e,l),d=new bs(f,s.gfxStages,_,s.gfxBlocks,s.gfxSamplers);return this._cache[r]=kn.alloc(t,d)},t}());n.programLib=Wd;var jd,qd,Xd,Yd={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    #ifdef GL_OES_standard_derivatives\n      float aa = fwidth(v_dist);\n    #else\n      float aa = 0.05;\n    #endif\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord;\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  uniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  uniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  uniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  uniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  uniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  uniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture2D(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  varying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  varying vec2 uv;\n  varying vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    varying vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  uniform vec4 tintColor;\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\n  attribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\n  attribute vec4 a_color2;\n  varying vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\n  varying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture2D(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture2D(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\n  varying vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if USE_VERTEX_COLOR\n  attribute vec4 a_color;\n  varying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_fog_factor;\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\nvarying float v_fog_factor;\n#if USE_VERTEX_COLOR\n  varying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture2D(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture2D(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture2D(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture2D(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec2 luv;\nvarying mediump vec3 diffuse;\nvarying mediump float v_fog_factor;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec2 luv;\nvarying mediump float v_fog_factor;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture2D(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture2D(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n    baseColor += texture2D(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture2D(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture2D(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n      baseNormal += texture2D(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture2D(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  attribute lowp vec4 a_color;\n  varying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform vec4 tilingOffset;\n#endif\nvarying float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\n  varying lowp vec4 v_color;\n#endif\nvarying float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture2D(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform highp mat4 cc_matLightPlaneProj;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nuniform float u_precent;\nvec4 frag () {\n  vec4 color = texture2D(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\n  vec4 cc_size_rotation;\n};\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    float aa = fwidth(v_dist);\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\n  vec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\n  vec4 u_worldRot;\n  vec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord;\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  layout(std140) uniform ColorConstant {\n    int u_color_mode;\n  };\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  layout(std140) uniform RotationConstant {\n    int u_rotation_mode;\n  };\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  layout(std140) uniform SizeConstant {\n    int u_size_mode;\n  };\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  layout(std140) uniform ForceConstant {\n    int u_force_mode;\n    int u_force_space;\n  };\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  layout(std140) uniform VelocityConstant {\n    int u_velocity_mode;\n    int u_velocity_space;\n  };\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  layout(std140) uniform AnimationConstant {\n    vec4 u_anim_info;\n  };\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  out vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  in vec2 uv;\n  in vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    in vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  layout(std140) uniform FragConstants {\n    vec4 tintColor;\n  };\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\n  in vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\n  in vec4 a_color2;\n  out vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 v_light;\n#if TWO_COLORED\n  in vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 color;\n#if USE_TEXTURE\n  in vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if USE_VERTEX_COLOR\n  in vec4 a_color;\n  out vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_fog_factor;\n#if USE_NORMAL_MAP\n  out vec3 v_tangent;\n  out vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  out vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  in vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\nin float v_fog_factor;\n#if USE_VERTEX_COLOR\n  in vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  in vec3 v_tangent;\n  in vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_uv;\nin vec2 v_uv1;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\n  out mediump vec3 v_tangent;\n  out mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec2 luv;\nout mediump vec3 diffuse;\nout mediump float v_fog_factor;\nlayout(std140) uniform TexCoords {\n  vec4 UVScale;\n  vec4 lightMapUVParam;\n};\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\n  in mediump vec3 v_tangent;\n  in mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec2 luv;\nin mediump float v_fog_factor;\nlayout(std140) uniform PbrParams {\n  vec4 metallic;\n  vec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n    baseColor += texture(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n      baseNormal += texture(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  in lowp vec4 a_color;\n  out lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  out vec2 v_uv;\n  layout(std140) uniform TexCoords {\n    vec4 tilingOffset;\n  };\n#endif\nout float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  in vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\n  vec4 mainColor;\n  vec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\n  in lowp vec4 v_color;\n#endif\nin float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\n  vec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\n  vec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nlayout(std140) uniform splashFrag {\n  float u_precent;\n};\nvec4 frag () {\n  vec4 color = texture(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},Kd=function(){function t(){this._device=null,this._resources={}}var e=t.prototype;return e.initBuiltinRes=function(t){var e=this;this._device=t;var i=this._resources,r=document.createElement("canvas"),a=r.getContext("2d"),o=new V_(r),s=r.width=r.height=2;a.fillStyle="#000",a.fillRect(0,0,s,s);var l=new yd;l._uuid="black-texture",l.image=o,i[l._uuid]=l,a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,s,s);for(var c=new Uint8Array(16),h=0;h<c.length;++h)c[h]=0;var u=new yd;u._uuid="empty-texture",u.image=o,u.uploadData(c),i[u._uuid]=u;var _=new Td;_._uuid="black-cube-texture",_.setMipFilter(Td.Filter.NEAREST),_.image={front:new V_(r),back:new V_(r),left:new V_(r),right:new V_(r),top:new V_(r),bottom:new V_(r)},i[_._uuid]=_,a.fillStyle="#777",a.fillRect(0,0,s,s);var f=new yd;f._uuid="grey-texture",f.image=o,i[f._uuid]=f,a.fillStyle="#fff",a.fillRect(0,0,s,s);var d=new yd;d._uuid="white-texture",d.image=o,i[d._uuid]=d;var p=new Td;p._uuid="white-cube-texture",p.setMipFilter(Td.Filter.NEAREST),p.image={front:new V_(r),back:new V_(r),left:new V_(r),right:new V_(r),top:new V_(r),bottom:new V_(r)},i[p._uuid]=p,a.fillStyle="#7f7fff",a.fillRect(0,0,s,s);var m=new yd;m._uuid="normal-texture",m.image=o,i[m._uuid]=m,r.width=r.height=16,a.fillStyle="#ddd",a.fillRect(0,0,16,16),a.fillStyle="#555",a.fillRect(0,0,8,8),a.fillStyle="#555",a.fillRect(8,8,8,8);var v=new yd;v._uuid="default-texture",v.image=o,i[v._uuid]=v;var g=new Td;if(g.setMipFilter(Td.Filter.NEAREST),g._uuid="default-cube-texture",g.image={front:new V_(r),back:new V_(r),left:new V_(r),right:new V_(r),top:new V_(r),bottom:new V_(r)},i[g._uuid]=g,n.SpriteFrame){var y=new n.SpriteFrame,T=o._texture;y.texture=T,y._uuid="default-spriteframe",i[y._uuid]=y}var S=Vd(t);if(!S)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var E=Yd[S];return E?Promise.resolve().then((function(){xd.forEach((function(t,e){var i=Object.assign(new n.EffectAsset,t);i.shaders.forEach((function(t,i){var n=E[e][i];n&&(t[S]=n)})),i.hideInEditor=!0,i.onLoaded()})),e._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+S+" but shaders of that version are not assembled in this build."))},e.get=function(t){return this._resources[t]},e._initMaterials=function(){var t=this._resources,e=[],i=new n.Material;i._uuid="standard-material",i.initialize({effectName:"standard"}),t[i._uuid]=i,e.push(i);var r=new n.Material;r._uuid="missing-effect-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",n.color("#ffff00")),t[r._uuid]=r,e.push(r);var a=new n.Material;a._uuid="missing-material",a.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),a.setProperty("mainColor",n.color("#ff00ff")),t[a._uuid]=a,e.push(a);var o=new n.Material;o._uuid="default-clear-stencil",o.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),t[o._uuid]=o,e.push(o);var s=new n.Material;s._uuid="ui-base-material",s.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),t[s._uuid]=s,e.push(s);var l=new n.Material;l._uuid="ui-sprite-material",l.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[l._uuid]=l,e.push(l);var c=new n.Material;c._uuid="ui-alpha-test-material",c.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[c._uuid]=c,e.push(c);var h=new n.Material;h._uuid="ui-sprite-gray-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),t[h._uuid]=h,e.push(h);var u=new n.Material;u._uuid="ui-sprite-alpha-sep-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),t[u._uuid]=u,e.push(u);var _=new n.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),t[_._uuid]=_,e.push(_);var f=new n.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),t[f._uuid]=f,e.push(f);var d=new n.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),t[d._uuid]=d,e.push(d);var p=new n.Material;p._uuid="default-particle-gpu-material",p.initialize({effectName:"particle-gpu"}),t[p._uuid]=p,e.push(p);var m=new n.Material;m._uuid="default-trail-material",m.initialize({effectName:"particle-trail"}),t[m._uuid]=m,e.push(m);var v=new n.Material;v._uuid="default-billboard-material",v.initialize({effectName:"billboard"}),t[v._uuid]=v,e.push(v);var g=new n.Material;g._uuid="default-spine-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),t[g._uuid]=g,e.push(g),n.game.on(n.Game.EVENT_RENDERER_INITED,(function(){for(var t=0;t<e.length;++t)for(var i=e[t],n=0;n<i.passes.length;++n)i.passes[n].tryCompile()}))},t}(),Zd=t("builtinResMgr",n.builtinResMgr=new Kd),Qd=t("getPhaseID",(jd=new Map,qd=0,function(t){return"number"==typeof t?t:(jd.has(t)||(jd.set(t,1<<qd),qd++),jd.get(t))})),Jd=new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE),$d=new Lo(null),tp=new Ds(null);!function(t){t[t.INSTANCING=1]="INSTANCING",t[t.VB_MERGING=2]="VB_MERGING"}(Xd||(Xd={}));var ep=function(){function t(t){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=0,this._handle=0,this._bs=new ss,this._dss=new as,this._rs=new rs,this._root=t,this._device=t.device}t.fillPipelineInfo=function(t,e){var i=t.handle;void 0!==e.priority&&ir.set(i,Un.PRIORITY,e.priority),void 0!==e.primitive&&ir.set(i,Un.PRIMITIVE,e.primitive),void 0!==e.stage&&ir.set(i,Un.STAGE,e.stage),void 0!==e.dynamicStates&&ir.set(i,Un.DYNAMIC_STATES,e.dynamicStates),void 0!==e.phase&&ir.set(i,Un.PHASE,Qd(e.phase));var n=t._bs;if(e.blendState){var r=e.blendState,a=r.targets;a&&a.forEach((function(t,e){n.setTarget(e,t)})),void 0!==r.isA2C&&(n.isA2C=r.isA2C),void 0!==r.isIndepend&&(n.isIndepend=r.isIndepend),void 0!==r.blendColor&&(n.blendColor=r.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t,e){var i,n=t.handle,r=e+","+ir.get(n,Un.PRIMITIVE)+","+ir.get(n,Un.DYNAMIC_STATES);return r+=function(t){for(var e,i=",bs,"+t.isA2C,n=Q(t.targets);!(e=n()).done;){var r=e.value;i+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,i+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return i}(t._bs),r+=function(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}(t._dss),qo(r+=",rs,"+(i=t._rs).cullMode+","+i.depthBias+","+i.isFrontFaceCCW,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=Ua.UNKNOWN);var n=this._propertyHandleMap[t];return n?(i?n=Pd(n,i):e&&(n=Pd(n,Rd(n)-e)),n+e):0},e.getBinding=function(e){var i=this.getHandle(e);return i?t.getBindingFromHandle(i):-1},e.setUniform=function(e,i){var n=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._blocks[n];Dd[r](o,i,a),this._rootBufferDirty=!0},e.getUniform=function(e,i){var n=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._blocks[n];return Md[r](o,i,a)},e.setUniformArray=function(e,i){for(var n=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=Io(r)>>2,o=this._blocks[n],s=t.getOffsetFromHandle(e),l=0;l<i.length;l++,s+=a)null!==i[l]&&Dd[r](o,i[l],s);this._rootBufferDirty=!0},e.bindTexture=function(t,e,i){this._descriptorSet.bindTexture(t,e,i||0)},e.bindSampler=function(t,e,i){this._descriptorSet.bindSampler(t,e,i||0)},e.setDynamicState=function(t,e){var i=this._dynamics[t];i&&i.value===e||(i.value=e,i.dirty=!0)},e.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},e.update=function(){this._rootBufferDirty&&this._rootBuffer&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBlock=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(Gn.free(ir.get(this._handle,Un.DESCRIPTOR_SET)),ir.free(this._handle),this._handle=0)},e.resetUniform=function(e){var i=this.getHandle(e);if(i){var n=t.getTypeFromHandle(i),r=t.getBindingFromHandle(i),a=t.getOffsetFromHandle(i),o=this._blocks[r],s=this._properties[e],l=s&&s.value||Ld(n);Dd[n](o,l,a),this._rootBufferDirty=!0}},e.resetTexture=function(e,i){var n=this.getHandle(e);if(n){var r=t.getTypeFromHandle(n),a=t.getBindingFromHandle(n),o=this._properties[e],s=o&&o.value,l=s?s+"-texture":Ld(r),c=Zd.get(l),h=c&&c.getGFXTexture(),u=o&&void 0!==o.samplerHash?o.samplerHash:c&&c.getSamplerHash(),_=lf.getSampler(this._device,u);this._descriptorSet.bindSampler(a,_,i),this._descriptorSet.bindTexture(a,h,i)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],i=this._blocks[e.binding],n=0,r=0;r<e.members.length;r++){for(var a=e.members[r],o=this._properties[a.name],s=o&&o.value||Ld(a.type),l=(Io(a.type)>>2)*a.count,c=0;c+s.length<=l;c+=s.length)i.set(s,n+c);n+=l}this._rootBufferDirty=!0},e.resetTextures=function(){for(var t=0;t<this._shaderInfo.samplers.length;t++)for(var e=this._shaderInfo.samplers[t],i=0;i<e.count;i++)this.resetTexture(e.name,i)},e.tryCompile=function(){var e=this._root.pipeline;return!!e&&(this._syncBatchingScheme(),this._hShaderDefault=Wd.getGFXShader(this._device,this._programName,this._defines,e),this._hShaderDefault?(ir.set(this._handle,Un.PIPELINE_LAYOUT,Wd.getTemplateInfo(this._programName).hPipelineLayout),ir.set(this._handle,Un.HASH,t.getPassHash(this,this._hShaderDefault)),!0):(console.warn("create shader "+this._programName+" failed"),!1))},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),0;if(!t)return this._hShaderDefault;for(var e=this._root.pipeline,i=0;i<t.length;i++){var n=t[i];this._defines[n.name]=n.value}for(var r=Wd.getGFXShader(this._device,this._programName,this._defines,e),a=0;a<t.length;a++){var o=t[a];delete this._defines[o.name]}return r},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._doInit=function(e,i){void 0===i&&(i=!1);var n=this._handle=ir.alloc();ir.set(n,Un.PRIORITY,Lc.DEFAULT),ir.set(n,Un.STAGE,Nc.DEFAULT),ir.set(n,Un.PHASE,Qd("default")),ir.set(n,Un.PRIMITIVE,ja.TRIANGLE_LIST),ir.set(n,Un.RASTERIZER_STATE,this._rs.handle),ir.set(n,Un.DEPTH_STENCIL_STATE,this._dss.handle),ir.set(n,Un.BLEND_STATE,this._bs.handle),this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=i?X({},e.defines):e.defines,this._shaderInfo=Wd.getTemplate(e.program),this._properties=e.properties||this._properties;var r=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),tp.layout=Wd.getDescriptorSetLayout(this._device,e.program);var a=Gn.alloc(this._device,tp);ir.set(this._handle,Un.DESCRIPTOR_SET,a),this._descriptorSet=Gn.get(a);for(var o=this._shaderInfo.blocks,s=Wd.getTemplateInfo(e.program),l=s.blockSizes,c=s.handleMap,h=r.uboOffsetAlignment,u=[],_=0,f=0,d=0;d<o.length;d++){var p=l[d];u.push(f),f+=Math.ceil(p/h)*h,_=p}var m=u[u.length-1]+_;m&&(Jd.size=16*Math.ceil(m/16),this._rootBuffer=r.createBuffer(Jd),this._rootBlock=new ArrayBuffer(m));for(var v=0,g=0;v<o.length;v++){var y=o[v].binding,T=l[v];$d.buffer=this._rootBuffer,$d.offset=u[g++],$d.range=16*Math.ceil(T/16);var S=this._buffers[y]=r.createBuffer($d);this._blocks[y]=new Float32Array(this._rootBlock,$d.offset,T/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(y,S)}var E=this._propertyHandleMap=c,A={};for(var b in this._properties){var x=this._properties[b];x.handleInfo&&(A[b]=this.getHandle.apply(this,x.handleInfo))}Object.assign(E,A)},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(So.INSTANCED_ARRAYS)?ir.set(this._handle,Un.BATCHING_SCHEME,Xd.INSTANCING):(this._defines.USE_INSTANCING=!1,ir.set(this._handle,Un.BATCHING_SCHEME,0)):this._defines.USE_BATCHING?ir.set(this._handle,Un.BATCHING_SCHEME,Xd.VB_MERGING):ir.set(this._handle,Un.BATCHING_SCHEME,0)},e._destroyHandle=function(){this._handle&&(ir.free(this._handle),this._handle=0)},e._initPassFromTarget=function(t,e,i,n){ir.set(this.handle,Un.PRIORITY,t.priority),ir.set(this.handle,Un.STAGE,t.stage),ir.set(this.handle,Un.PHASE,t.phase),ir.set(this.handle,Un.BATCHING_SCHEME,t.batchingScheme),ir.set(this.handle,Un.PRIMITIVE,t.primitive),ir.set(this.handle,Un.DYNAMIC_STATES,t.dynamicStates),this._descriptorSet=t.descriptorSet,ir.set(this.handle,Un.DESCRIPTOR_SET,ir.get(t.handle,Un.DESCRIPTOR_SET)),this._bs=i,ir.set(this.handle,Un.BLEND_STATE,i.handle),this._rs=t.rasterizerState,ir.set(this.handle,Un.RASTERIZER_STATE,ir.get(t.handle,Un.RASTERIZER_STATE)),this._dss=e,ir.set(this.handle,Un.DEPTH_STENCIL_STATE,e.handle),this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._dynamics=t._dynamics,this._hShaderDefault=t._hShaderDefault,ir.set(this._handle,Un.PIPELINE_LAYOUT,Wd.getTemplateInfo(this._programName).hPipelineLayout);var r=ir.get(t.handle,Un.HASH);ir.set(this._handle,Un.HASH,r^n)},q(t,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Wd.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return ir.get(this._handle,Un.PRIORITY)}},{key:"primitive",get:function(){return ir.get(this._handle,Un.PRIMITIVE)}},{key:"stage",get:function(){return ir.get(this._handle,Un.STAGE)}},{key:"phase",get:function(){return ir.get(this._handle,Un.PHASE)}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return ir.get(this._handle,Un.DYNAMIC_STATES)}},{key:"batchingScheme",get:function(){return ir.get(this._handle,Un.BATCHING_SCHEME)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return ir.get(this._handle,Un.HASH)}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}}]),t}();ep.PropertyType=bd,ep.getPropertyTypeFromHandle=wd,ep.getTypeFromHandle=Rd,ep.getBindingFromHandle=Id,ep.getOffsetFromHandle=Od,ct(Zh.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),ct(Zh.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var ip={};ct(ip,"CameraVisFlags",[{name:"GENERAL"}]),lt(ip,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Fc.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Fc.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Fc.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Fc.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Fc.BitMask,targetName:"UI_2D"}]),n.CameraVisFlags=ip;var np,rp={};function ap(t,e){e<1e3?e=1e3:e>15e3&&(e=15e3);var i=e*e,n=(.860117757+.000154118254*e+1.28641212e-7*i)/(1+.000842420235*e+7.08145163e-7*i),r=(.317398726+422806245e-13*e+4.20481691e-8*i)/(1-289741816e-13*e+1.61456053e-7*i),a=2*n-8*r+4,o=3*n/a,s=2*r/a,l=1/s*o,c=1/s*(1-o-s);t.x=3.2404542*l-1.5371385+-.4985314*c,t.y=-.969266*l+1.8760108+.041556*c,t.z=.0556434*l-.2040259+1.0572252*c}ct(rp,"VisibilityFlags",[{name:"GENERAL"}]),lt(rp,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Fc.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Fc.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Fc.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Fc.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Fc.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Fc.Enum,targetName:"UI_2D"}]),n.VisibilityFlags=rp,lt(ep.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),ct(Kh.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]),function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.UNKNOWN=3]="UNKNOWN"}(np||(np={}));var op=function(t){return 4*Math.PI*Math.PI*t*t},sp=function(){function t(){this._baked=!1,this._color=new Ri(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Ri(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=0}var e=t.prototype;return e.initialize=function(){this._handle=Xr.alloc(),Xr.setVec3(this._handle,Vr.COLOR,this._color),Xr.setVec3(this._handle,Vr.COLOR_TEMPERATURE_RGB,this._colorTempRGB),Xr.set(this._handle,Vr.TYPE,np.UNKNOWN)},e.attachToScene=function(t){this._scene=t},e.detachFromScene=function(){this._scene=null},e.destroy=function(){this._name=null,this._node=null,this._handle&&(Xr.free(this._handle),this._handle=0)},e.update=function(){},q(t,[{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"color",set:function(t){this._color.set(t),Xr.setVec3(this._handle,Vr.COLOR,t)},get:function(){return this._color}},{key:"useColorTemperature",set:function(t){Xr.set(this._handle,Vr.USE_COLOR_TEMPERATURE,t?1:0)},get:function(){return 1===Xr.get(this._handle,Vr.USE_COLOR_TEMPERATURE)}},{key:"colorTemperature",set:function(t){this._colorTemp=t,ap(this._colorTempRGB,this._colorTemp),Xr.setVec3(this._handle,Vr.COLOR_TEMPERATURE_RGB,this._colorTempRGB)},get:function(){return this._colorTemp}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=kh.ROTATION,Xr.set(this._handle,Vr.NODE,this._node.handle))},get:function(){return this._node}},{key:"type",get:function(){return Xr.get(this._handle,Vr.TYPE)}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),t}(),lp=new Ri(0,0,-1),cp=new Ri,hp=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new Ri(1,-1,-1),e}Y(e,t),q(e,[{key:"direction",set:function(t){Ri.normalize(this._dir,t),Xr.setVec3(this._handle,Vr.DIRECTION,this._dir)},get:function(){return this._dir}},{key:"illuminance",set:function(t){Xr.set(this._handle,Vr.ILLUMINANCE,t)},get:function(){return Xr.get(this._handle,Vr.ILLUMINANCE)}}]);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),Xr.set(this._handle,Vr.ILLUMINANCE,fa.SUN_ILLUM),Xr.setVec3(this._handle,Vr.DIRECTION,this._dir),Xr.set(this._handle,Vr.TYPE,np.DIRECTIONAL)},i.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Ri.transformQuat(cp,lp,this._node.worldRotation))},e}(sp),up=new Ds(null),_p=function(){function t(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=0,this._priority=Lc.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.initialize=function(t,e,i){void 0===i&&(i=null),this._device=n.director.root.device,this._subMesh=t,this._patches=i,this._passes=e,this._handle=ar.alloc(),this._flushPassInfo(),e[0].batchingScheme===Xd.VB_MERGING&&this._subMesh.genFlatBuffers(),up.layout=e[0].localSetLayout;var r=Gn.alloc(this._device,up),a=Hn.alloc(this._device,t.iaInfo);ar.set(this._handle,tr.PRIORITY,Lc.DEFAULT),ar.set(this._handle,tr.INPUT_ASSEMBLER,a),ar.set(this._handle,tr.DESCRIPTOR_SET,r),ar.set(this._handle,tr.SUB_MESH,t.handle),this._inputAssembler=Hn.get(a),this._descriptorSet=Gn.get(r)},e.initPlanarShadowShader=function(){var t=n.director.root.pipeline.shadows.getPlanarShader(this._patches);ar.set(this._handle,tr.PLANAR_SHADER,t)},e.initPlanarShadowInstanceShader=function(){var t=n.director.root.pipeline.shadows.getPlanarInstanceShader(this._patches);ar.set(this._handle,tr.PLANAR_INSTANCE_SHADER,t)},e.destroy=function(){Gn.free(ar.get(this._handle,tr.DESCRIPTOR_SET)),Hn.free(ar.get(this._handle,tr.INPUT_ASSEMBLER)),ar.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=Lc.DEFAULT,this._handle=0,this._patches=null,this._subMesh=null,this._passes=null},e.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update()},e.onPipelineStateChanged=function(){var t=this._passes;if(t){for(var e=0;e<t.length;e++){var i=t[e];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},e.onMacroPatchesStateChanged=function(t){this._patches=t;var e=this._passes;if(e){for(var i=0;i<e.length;i++){var n=e[i];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},e._flushPassInfo=function(){var t=this._passes;if(t){ar.set(this._handle,tr.PASS_COUNT,t.length);for(var e=tr.PASS_0,i=tr.SHADER_0,n=0;n<t.length;n++,e++,i++)ar.set(this._handle,e,t[n].handle),ar.set(this._handle,i,t[n].getShaderVariant(this._patches))}},q(t,[{key:"passes",set:function(t){if(this._passes=t,this._flushPassInfo(),this._descriptorSet){Gn.free(ar.get(this._handle,tr.DESCRIPTOR_SET)),up.layout=t[0].localSetLayout;var e=Gn.alloc(this._device,up);ar.set(this._handle,tr.DESCRIPTOR_SET,e),this._descriptorSet=Gn.get(e)}},get:function(){return this._passes}},{key:"subMesh",set:function(t){this._subMesh=t,this._inputAssembler.destroy(),this._inputAssembler.initialize(t.iaInfo),this._passes[0].batchingScheme===Xd.VB_MERGING&&this._subMesh.genFlatBuffers(),ar.set(this._handle,tr.SUB_MESH,t.handle)},get:function(){return this._subMesh}},{key:"priority",set:function(t){this._priority=t,ar.set(this._handle,tr.PRIORITY,t)},get:function(){return this._priority}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarShaderHandle",get:function(){return ar.get(this._handle,tr.PLANAR_SHADER)}},{key:"planarInstanceShaderHandle",get:function(){return ar.get(this._handle,tr.PLANAR_INSTANCE_SHADER)}}]),t}(),fp=t("InstancedBuffer",function(){function t(t){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=t.device,this.pass=t}t.get=function(e,i){void 0===i&&(i=0);var n=t._buffers;n.has(e)||n.set(e,{});var r=n.get(e);return r[i]||(r[i]=new t(e))};var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.instances.length;++t){var e=this.instances[t];e.vb.destroy(),e.ia.destroy()}this.instances.length=0},e.merge=function(t,e,i,n){void 0===n&&(n=null);var r=e.buffer.length;if(r){var a=t.inputAssembler,o=t.descriptorSet.getTexture(xh),s=n;s||(s=ar.get(t.handle,tr.SHADER_0+i));for(var l=ar.get(t.handle,tr.DESCRIPTOR_SET),c=0;c<this.instances.length;++c){var h=this.instances[c];if(!(h.ia.indexBuffer!==a.indexBuffer||h.count>=1024)&&h.lightingMap===o){if(h.stride!==r)return;if(h.count>=h.capacity){h.capacity<<=1;var u=h.stride*h.capacity,_=h.data;h.data=new Uint8Array(u),h.data.set(_),h.vb.resize(u)}return h.hShader!==s&&(h.hShader=s),h.hDescriptorSet!==l&&(h.hDescriptorSet=l),h.data.set(e.buffer,h.stride*h.count++),void(this.hasPendingModels=!0)}}for(var f=this._device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,32*r,r)),d=new Uint8Array(32*r),p=a.vertexBuffers.slice(),m=a.attributes.slice(),v=a.indexBuffer,g=0;g<e.attributes.length;g++){var y=e.attributes[g],T=new Xo(y.name,y.format,y.isNormalized,p.length,!0);m.push(T)}d.set(e.buffer),p.push(f);var S=new Yo(m,p,v),E=this._device.createInputAssembler(S);this.instances.push({count:1,capacity:32,vb:f,data:d,ia:E,stride:r,hShader:s,hDescriptorSet:l,lightingMap:o}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var i=this.instances[e];i.count&&(i.ia.instanceCount=i.count,t.updateBuffer(i.vb,i.data))}},e.clear=function(){for(var t=0;t<this.instances.length;++t)this.instances[t].count=0;this.hasPendingModels=!1},t}());fp._buffers=new Map;var dp,pp=new Ln(Dn.ATTRIBUTE,(function(t,e){return e||new Xo})),mp=new Vi,vp=new u_((function(){return new _p}),32),gp=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SKINNING=1]="SKINNING",t[t.BAKED_SKINNING=2]="BAKED_SKINNING",t[t.BATCH_2D=3]="BATCH_2D",t[t.PARTICLE_BATCH=4]="PARTICLE_BATCH",t[t.LINE=5]="LINE"}(dp||(dp={}));var yp,Tp,Sp,Ep,Ap,bp,xp,Cp,wp,Rp,Ip,Op,Pp,Mp,Dp,Np,Lp,Bp,Fp=Y_([to.LINEAR,to.LINEAR,to.NONE,eo.CLAMP,eo.CLAMP,eo.CLAMP]),zp=Y_([to.LINEAR,to.LINEAR,to.LINEAR,eo.CLAMP,eo.CLAMP,eo.CLAMP]),Up=function(){function t(){this.type=dp.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=0,this._hWorldBounds=0,this._localData=new Float32Array(oh.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new Qi,this._device=n.director.root.device}q(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!lr.get(this._handle,nr.RECEIVE_SHADOW)},set:function(t){lr.set(this._handle,nr.RECEIVE_SHADOW,t?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!lr.get(this._handle,nr.CAST_SHADOW)},set:function(t){lr.set(this._handle,nr.CAST_SHADOW,t?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,lr.set(this._handle,nr.NODE,t.handle)}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t,lr.set(this._handle,nr.TRANSFORM,t.handle)}},{key:"visFlags",get:function(){return lr.get(this._handle,nr.VIS_FLAGS)},set:function(t){lr.set(this._handle,nr.VIS_FLAGS,t)}},{key:"enabled",get:function(){return!!lr.get(this._handle,nr.ENABLED)},set:function(t){lr.set(this._handle,nr.ENABLED,t?1:0)}}]);var e=t.prototype;return e.initialize=function(){if(!this._inited){this._handle=lr.alloc();var t=jn.alloc(),e=Xn.alloc();lr.set(this._handle,nr.INSTANCED_ATTR_ARRAY,e),lr.set(this._handle,nr.SUB_MODEL_ARRAY,t),lr.set(this._handle,nr.VIS_FLAGS,Fc.Enum.NONE),lr.set(this._handle,nr.ENABLED,1),lr.set(this._handle,nr.RECEIVE_SHADOW,1),lr.set(this._handle,nr.CAST_SHADOW,0),this._inited=!0}},e.destroy=function(){for(var t=this._subModels,e=0;e<t.length;e++){var i=this._subModels[e];i.destroy(),vp.free(i)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var n=lr.get(this._handle,nr.SUB_MODEL_ARRAY);n&&jn.free(n);var r=lr.get(this._handle,nr.INSTANCED_BUFFER);r&&Jn.free(r);var a=lr.get(this._handle,nr.INSTANCED_ATTR_ARRAY);a&&zn(a,Xn,pp),lr.free(this._handle),this._handle=0}this._hWorldBounds&&(dr.free(this._hWorldBounds),this._hWorldBounds=0)},e.attachToScene=function(t){this.scene=t},e.detachFromScene=function(){this.scene=null},e.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._transformUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&(this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e),dr.setVec3(this._hWorldBounds,cr.CENTER,e.center),dr.setVec3(this._hWorldBounds,cr.HALF_EXTENSION,e.halfExtents))}},e.updateWorldBound=function(){var t=this.transform;if(null!==t){t.updateWorldTransform(),this._transformUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&(this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e),dr.setVec3(this._hWorldBounds,cr.CENTER,e.center),dr.setVec3(this._hWorldBounds,cr.HALF_EXTENSION,e.halfExtents))}},e.updateUBOs=function(t){for(var e=this._subModels,i=0;i<e.length;i++)e[i].update();if(this._updateStamp=t,this._transformUpdated){this._transformUpdated=!1;var n=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var a=this.instancedAttributes.views;!function(t,e,i,n){e[0]=t.m00,e[1]=t.m01,e[2]=t.m02,e[3]=t.m12,i[0]=t.m04,i[1]=t.m05,i[2]=t.m06,i[3]=t.m13,n[0]=t.m08,n[1]=t.m09,n[2]=t.m10,n[3]=t.m14}(n,a[r],a[r+1],a[r+2])}else this._localBuffer&&(Vi.toArray(this._localData,n,oh.MAT_WORLD_OFFSET),Vi.inverseTranspose(mp,n),Vi.toArray(this._localData,mp,oh.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},e.createBoundingShape=function(t,e){t&&e&&(this._modelBounds=sc.fromPoints(sc.create(),t,e),this._worldBounds=sc.clone(this._modelBounds),0===this._hWorldBounds&&(this._hWorldBounds=dr.alloc(),lr.set(this._handle,nr.WORLD_BOUNDS,this._hWorldBounds)),dr.setVec3(this._hWorldBounds,cr.CENTER,this._worldBounds.center),dr.setVec3(this._hWorldBounds,cr.HALF_EXTENSION,this._worldBounds.halfExtents))},e.initSubModel=function(t,e,i){this.initialize();var n=!1;if(null==this._subModels[t]?(this._subModels[t]=vp.alloc(),n=!0):this._subModels[t].destroy(),this._subModels[t].initialize(e,i.passes,this.getMacroPatches(t)),this._subModels[t].initPlanarShadowShader(),this._subModels[t].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(t),n){var r=lr.get(this._handle,nr.SUB_MODEL_ARRAY);jn.assign(r,t,this._subModels[t].handle)}},e.setSubModelMesh=function(t,e){this._subModels[t]&&(this._subModels[t].subMesh=e)},e.setSubModelMaterial=function(t,e){this._subModels[t]&&(this._subModels[t].passes=e.passes,this._updateAttributesAndBinding(t))},e.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onPipelineStateChanged()},e.onMacroPatchesStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onMacroPatchesStateChanged(this.getMacroPatches(e))},e.updateLightingmap=function(t,e){Qi.toArray(this._localData,e,oh.LIGHTINGMAP_UVPARAM),this._lightmap=t,this._lightmapUVParam=e,null===t&&(t=Zd.get("empty-texture"));var i=t.getGFXTexture();if(i)for(var n=lf.getSampler(this._device,t.mipmaps.length>1?zp:Fp),r=this._subModels,a=0;a<r.length;a++){var o=r[a].descriptorSet;o.bindTexture(xh,i),o.bindSampler(xh,n),o.update()}},e.getMacroPatches=function(){return this.receiveShadow?gp:null},e._updateAttributesAndBinding=function(t){var e=this._subModels[t];if(e){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,e.descriptorSet);var i=kn.get(ar.get(e.handle,tr.SHADER_0));this._updateInstancedAttributes(i.attributes,e.passes[0])}},e._getInstancedAttributeIndex=function(t){for(var e=this.instancedAttributes.attributes,i=0;i<e.length;i++)if(e[i].name===t)return i;return-1},e._updateInstancedAttributes=function(t,e){if(e.device.hasFeature(So.INSTANCED_ARRAYS)){var i=lr.get(this._handle,nr.INSTANCED_BUFFER);i&&Jn.free(i);var n=lr.get(this._handle,nr.INSTANCED_ATTR_ARRAY);n&&zn(n,Xn,pp,!1);for(var r=0,a=0;a<t.length;a++){var o=t[a];o.isInstanced&&(r+=xo[o.format].size)}var s=Jn.alloc(r),l=Jn.getBuffer(s);lr.set(this._handle,nr.INSTANCED_BUFFER,s);var c=this.instancedAttributes;c.buffer=new Uint8Array(l),c.views.length=c.attributes.length=0;for(var h=0,u=0;u<t.length;u++){var _=t[u];if(_.isInstanced){var f=pp.alloc(),d=pp.get(f);d.format=_.format,d.name=_.name,d.isNormalized=_.isNormalized,d.location=_.location,c.attributes.push(d),Xn.push(n,f);var p=xo[_.format];c.views.push(new(Oo(p))(l,h,p.count)),h+=p.size}}e.batchingScheme===Xd.INSTANCING&&fp.get(e).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex("a_matWorld0"),this._transformUpdated=!0}},e._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,oh.SIZE,oh.SIZE)))},e._updateLocalDescriptors=function(t,e){this._localBuffer&&e.bindBuffer(oh.BINDING,this._localBuffer)},t}(),kp=t("EffectAsset",ru("cc.EffectAsset")((Cp=xp=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"techniques",Sp,K(e)),J(e,"shaders",Ep,K(e)),J(e,"combinations",Ap,K(e)),J(e,"hideInEditor",bp,K(e)),e}Y(e,t),e.register=function(t){e._effects[t.name]=t},e.remove=function(t){if(e._effects[t])delete e._effects[t];else for(var i in e._effects)if(e._effects[i]._uuid===t)return void delete e._effects[i]},e.get=function(t){if(e._effects[t])return e._effects[t];for(var i in e._effects)if(e._effects[i]._uuid===t)return e._effects[i];return null},e.getAll=function(){return e._effects};var i=e.prototype;return i.onLoaded=function(){Wd.register(this),e.register(this),n.game.once(n.Game.EVENT_ENGINE_INITED,this._precompile,this)},i._precompile=function(){for(var t=this,e=n.director.root,i=function(i){var n=t.shaders[i],r=t.combinations[i];if(!r)return"continue";Object.keys(r).reduce((function(t,e){return t.reduce((function(t,i){for(var n=r[e],a=0;a<n.length;++a){var o=X({},i);o[e]=n[a],t.push(o)}return t}),[])}),[{}]).forEach((function(t){return Wd.getGFXShader(e.device,n.name,t,e.pipeline)}))},r=0;r<this.shaders.length;r++)i(r)},i.destroy=function(){return e.remove(this.name),t.prototype.destroy.call(this)},e}(M_),xp._effects={},Sp=$((Tp=Cp).prototype,"techniques",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ep=$(Tp.prototype,"shaders",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ap=$(Tp.prototype,"combinations",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bp=$(Tp.prototype,"hideInEditor",[cu,uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yp=Tp))||yp);n.EffectAsset=kp;var Gp=new Et("RenderTex"),Hp=new fs;Hp.endLayout=uo.SHADER_READONLY_OPTIMAL;var Vp,Wp,jp,qp,Xp,Yp,Kp,Zp,Qp,Jp,$p=new ds,tm=new ms([Hp],$p),em={width:1,height:1,renderPassInfo:tm},im=t("RenderTexture",(wp=ru("cc.RenderTexture"),Rp=bu(),Ip=xu(),Op=bu(),Pp=xu(),wp((Bp=function(t){function e(){var e;return J(e=t.call(this)||this,"_width",Np,K(e)),J(e,"_height",Lp,K(e)),e._textureHash=0,e._id=void 0,e._window=null,e._id=Gp.getNewId(),e._textureHash=qo(e._id,666),e}Y(e,t);var i=e.prototype;return i.getHash=function(){return this._textureHash},i.initialize=function(t){this._name=t.name||"",this._width=t.width,this._height=t.height,this._initWindow(t)},i.reset=function(t){this.initialize(t)},i.destroy=function(){return this._window&&(n.director.root.destroyWindow(this._window),this._window=null),t.prototype.destroy.call(this)},i.resize=function(t,e){this._width=t,this._height=e,this._window&&this._window.resize(t,e),this.emit("resize",this._window)},i.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},i.getGFXSampler=function(){var t=n.director.root;return lf.getSampler(t.device,j_)},i.getSamplerHash=function(){return j_},i.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},i._initWindow=function(t){var e=n.director.root;em.title=this._name,em.width=this._width,em.height=this._height,em.renderPassInfo=t&&t.passInfo?t.passInfo:tm,this._window?(this._window.destroy(),this._window.initialize(e.device,em)):this._window=e.createWindow(em)},q(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),e}(M_),Np=$((Dp=Bp).prototype,"_width",[cu,Rp,Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Lp=$(Dp.prototype,"_height",[cu,Op,Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Mp=Dp))||Mp));n.RenderTexture=im;var nm=t("Material",(Vp=ru("cc.Material"),Wp=Fu(kp),Vp((Jp=function(t){function e(){var e;return J(e=t.call(this)||this,"_effectAsset",Xp,K(e)),J(e,"_techIdx",Yp,K(e)),J(e,"_defines",Kp,K(e)),J(e,"_states",Zp,K(e)),J(e,"_props",Qp,K(e)),e._passes=[],e._hash=0,e.loaded=!1,e}Y(e,t),e.getHash=function(t){for(var e,i=0,n=Q(t.passes);!(e=n()).done;)i^=e.value.hash;return i};var i=e.prototype;return i.initialize=function(t){this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=kp.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states),this._update()},i.reset=function(t){this.initialize(t)},i.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},i.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},i.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},i.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},i.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var i,n=Q(this._passes);!(i=n()).done;){var r=i.value;r.resetUBOs(),r.resetTextures()}},i.setProperty=function(t,e,i){var n=!1;if(void 0===i)for(var r=this._passes,a=r.length,o=0;o<a;o++){var s=r[o];this._uploadProperty(s,t,e)&&(this._props[s.propertyIndex][t]=e,n=!0)}else{if(i>=this._passes.length)return void console.warn("illegal pass index: "+i+".");var l=this._passes[i];this._uploadProperty(l,t,e)&&(this._props[l.propertyIndex][t]=e,n=!0)}n||console.warn("illegal property name: "+t+".")},i.getProperty=function(t,e){if(void 0===e)for(var i=this._props,n=i.length,r=0;r<n;r++){var a=i[r];if(t in a)return a[t]}else{if(e>=this._props.length)return console.warn("illegal pass index: "+e+"."),null;var o=this._props[this._passes[e].propertyIndex];if(t in o)return o[t]}return null},i.copy=function(t){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var e=0;e<t._props.length;e++)this._props[e]=X({},t._props[e]);this._defines.length=t._defines.length;for(var i=0;i<t._defines.length;i++)this._defines[i]=X({},t._defines[i]);this._states.length=t._states.length;for(var n=0;n<t._states.length;n++)this._states[n]=X({},t._states[n]);this._effectAsset=t._effectAsset,this._update()},i._prepareInfo=function(t,e){var i=t;if(!Array.isArray(i)){var n=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;i=Array(n).fill(i)}for(var r=0;r<i.length;++r)Object.assign(e[r]||(e[r]={}),i[r])},i._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,i=[],r=0;r<e;++r){var a=t.passes[r],o=a.passIndex=r,s=a.defines=this._defines[o]||(this._defines[o]={}),l=a.stateOverrides=this._states[o]||(this._states[o]={});if(void 0!==a.propertyIndex&&(Object.assign(s,this._defines[a.propertyIndex]),Object.assign(l,this._states[a.propertyIndex])),void 0!==a.embeddedMacros&&Object.assign(s,a.embeddedMacros),!a.switch||s[a.switch]){var c=new ep(n.director.root);c.initialize(a),i.push(c)}}return i},i._update=function(t){var i=this;if(void 0===t&&(t=!0),this._effectAsset){if(this._passes&&this._passes.length)for(var n,r=Q(this._passes);!(n=r()).done;)n.value.destroy();this._passes=this._createPasses();var a=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=a,t)this._passes.forEach((function(t,e){var n=i._props[e];for(var r in n||(n=i._props[e]={}),void 0!==t.propertyIndex&&Object.assign(n,i._props[t.propertyIndex]),n)i._uploadProperty(t,r,n[r])}));else for(var o=0;o<this._props.length;o++)this._props[o]={}}else{var s=Zd.get("missing-effect-material");s&&(this._passes=s._passes.slice())}this._hash=e.getHash(this)},i._uploadProperty=function(t,e,i){var n=t.getHandle(e);if(!n)return!1;var r=ep.getPropertyTypeFromHandle(n);if(r===bd.UBO)Array.isArray(i)?t.setUniformArray(n,i):null!==i?t.setUniform(n,i):t.resetUniform(e);else if(r===bd.SAMPLER)if(Array.isArray(i))for(var a=0;a<i.length;a++)this._bindTexture(t,n,i[a],a);else i?this._bindTexture(t,n,i):t.resetTexture(e);return!0},i._bindTexture=function(t,e,i,n){var r=ep.getBindingFromHandle(e);if(i instanceof Is)t.bindTexture(r,i,n);else if(i instanceof hf||i instanceof im){var a=i.getGFXTexture();if(!a||!a.width||!a.height)return;t.bindTexture(r,a,n),t.bindSampler(r,i.getGFXSampler(),n)}},i._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=Q(this._passes);!(t=e()).done;)t.value.destroy();this._effectAsset=null,this._passes.length=0,this._props.length=0,this._defines.length=0,this._states.length=0},q(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(M_),Xp=$((qp=Jp).prototype,"_effectAsset",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yp=$(qp.prototype,"_techIdx",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kp=$(qp.prototype,"_defines",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zp=$(qp.prototype,"_states",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qp=$(qp.prototype,"_props",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jp=qp))||jp));n.Material=nm;var rm=he({Planar:0,ShadowMap:1}),am=he({HARD:0,FILTER_X5:1,FILTER_X9:2,FILTER_X25:3}),om=rm.ShadowMap+1,sm=function(){function t(){this.sphere=new La(0,0,0,.01),this.maxReceived=4,this._normal=new Ri(0,1,0),this._shadowColor=new Ci(0,0,0,76),this._matLight=new Vi,this._material=null,this._instancingMaterial=null,this._size=new Xi(512,512),this._handle=0,this._handle=Wr.alloc()}q(t,[{key:"enabled",get:function(){return!!Wr.get(this._handle,kr.ENABLE)},set:function(t){Wr.set(this._handle,kr.ENABLE,t?1:0),t||Wr.set(this._handle,kr.TYPE,om),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){Ri.copy(this._normal,t),Wr.setVec3(this._handle,kr.NORMAL,this._normal)}},{key:"distance",get:function(){return Wr.get(this._handle,kr.DISTANCE)},set:function(t){Wr.set(this._handle,kr.DISTANCE,t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t,Wr.setVec4(this._handle,kr.COLOR,t)}},{key:"type",get:function(){return Wr.get(this._handle,kr.TYPE)},set:function(t){Wr.set(this._handle,kr.TYPE,this.enabled?t:om),this.activate()}},{key:"near",get:function(){return Wr.get(this._handle,kr.NEAR)},set:function(t){Wr.set(this._handle,kr.NEAR,t)}},{key:"far",get:function(){return Wr.get(this._handle,kr.FAR)},set:function(t){Wr.set(this._handle,kr.FAR,t)}},{key:"aspect",get:function(){return Wr.get(this._handle,kr.ASPECT)},set:function(t){Wr.set(this._handle,kr.ASPECT,t)}},{key:"orthoSize",get:function(){return Wr.get(this._handle,kr.ORTHO_SIZE)},set:function(t){Wr.set(this._handle,kr.ORTHO_SIZE,t)}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,Wr.setVec2(this._handle,kr.SIZE,this._size)}},{key:"pcf",get:function(){return Wr.get(this._handle,kr.PCF_TYPE)},set:function(t){Wr.set(this._handle,kr.PCF_TYPE,t)}},{key:"shadowMapDirty",get:function(){return!!Wr.get(this._handle,kr.SHADOW_MAP_DIRTY)},set:function(t){Wr.set(this._handle,kr.SHADOW_MAP_DIRTY,t?1:0)}},{key:"bias",get:function(){return Wr.get(this._handle,kr.BIAS)},set:function(t){Wr.set(this._handle,kr.BIAS,t)}},{key:"autoAdapt",get:function(){return!!Wr.get(this._handle,kr.AUTO_ADAPT)},set:function(t){Wr.set(this._handle,kr.AUTO_ADAPT,t?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.getPlanarShader=function(t){return this._material||(this._material=new nm,this._material.initialize({effectName:"planar-shadow"}),Wr.set(this._handle,kr.PLANAR_PASS,this._material.passes[0].handle)),this._material.passes[0].getShaderVariant(t)},e.getPlanarInstanceShader=function(t){return this._instancingMaterial||(this._instancingMaterial=new nm,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Wr.set(this._handle,kr.INSTANCE_PASS,this._instancingMaterial.passes[0].handle)),this._instancingMaterial.passes[0].getShaderVariant(t)},e.initialize=function(t){Wr.set(this._handle,kr.TYPE,t.enabled?t.type:om),Wr.set(this._handle,kr.NEAR,t.near),Wr.set(this._handle,kr.FAR,t.far),Wr.set(this._handle,kr.ASPECT,t.aspect),Wr.set(this._handle,kr.ORTHO_SIZE,t.orthoSize),this._size=t.shadowMapSize,Wr.setVec2(this._handle,kr.SIZE,this._size),Wr.set(this._handle,kr.PCF_TYPE,t.pcf),Ri.copy(this._normal,t.normal),Wr.setVec3(this._handle,kr.NORMAL,this._normal),Wr.set(this._handle,kr.DISTANCE,t.distance),this._shadowColor.set(t.shadowColor),Wr.setVec4(this._handle,kr.COLOR,this._shadowColor),Wr.set(this._handle,kr.BIAS,t.bias),Wr.set(this._handle,kr.ENABLE,t.enabled?1:0),this.maxReceived=t.maxReceived,Wr.set(this._handle,kr.AUTO_ADAPT,t.autoAdapt?1:0)},e.activate=function(){if(this.enabled)this.type===rm.ShadowMap?this._updatePipeline():this._updatePlanarInfo();else{var t=n.director.root;t.pipeline.macros.CC_RECEIVE_SHADOW=0,t.onGlobalPipelineStateChanged()}},e._updatePlanarInfo=function(){this._material||(this._material=new nm,this._material.initialize({effectName:"planar-shadow"}),Wr.set(this._handle,kr.PLANAR_PASS,this._material.passes[0].handle)),this._instancingMaterial||(this._instancingMaterial=new nm,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Wr.set(this._handle,kr.INSTANCE_PASS,this._instancingMaterial.passes[0].handle));var t=n.director.root;t.pipeline.macros.CC_RECEIVE_SHADOW=0,t.onGlobalPipelineStateChanged()},e._updatePipeline=function(){var t=n.director.root;t.pipeline.macros.CC_RECEIVE_SHADOW=1,t.onGlobalPipelineStateChanged()},e.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(Wr.free(this._handle),this._handle=0),this.sphere.destroy()},t}();sm.MAX_FAR=2e3,sm.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),n.Shadows=sm;var lm=function(t){function e(e,i){var n;(n=t.call(this,e.root)||this)._parent=void 0,n._owner=void 0,n._dontNotify=!1,n._parent=e,n._owner=i,n._doInit(n._parent,!0);for(var r=0;r<n._shaderInfo.blocks.length;r++){var a=n._shaderInfo.blocks[r],o=n._blocks[a.binding],s=n._parent.blocks[a.binding];o.set(s)}n._rootBufferDirty=!0;for(var l=n._parent,c=0;c<n._shaderInfo.samplers.length;c++)for(var h=n._shaderInfo.samplers[c],u=0;u<h.count;u++){var _=l._descriptorSet.getSampler(h.binding,u),f=l._descriptorSet.getTexture(h.binding,u);n._descriptorSet.bindSampler(h.binding,_,u),n._descriptorSet.bindTexture(h.binding,f,u)}return t.prototype.tryCompile.call(K(n)),n}Y(e,t),q(e,[{key:"parent",get:function(){return this._parent}}]);var i=e.prototype;return i.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),ep.fillPipelineInfo(this,t),ep.fillPipelineInfo(this,e),this._onStateChange()},i.tryCompile=function(e){if(e&&!Bd(this._defines,e))return!1;var i=t.prototype.tryCompile.call(this);return this._onStateChange(),i},i.beginChangeStatesSilently=function(){this._dontNotify=!0},i.endChangeStatesSilently=function(){this._dontNotify=!1},i._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,ir.set(this._handle,Un.BATCHING_SCHEME,0)},i._onStateChange=function(){ir.set(this._handle,Un.HASH,ep.getPassHash(this,this._hShaderDefault)),this._owner.onPassStateChange(this._dontNotify)},e}(ep),cm=function(t){function e(e){var i;return(i=t.call(this)||this)._passes=[],i._parent=void 0,i._owner=void 0,i._subModelIdx=0,i._parent=e.parent,i._owner=e.owner||null,i._subModelIdx=e.subModelIdx||0,i.copy(i._parent),i}Y(e,t),q(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]);var i=e.prototype;return i.recompileShaders=function(t,e){if(this._passes&&this.effectAsset)if(void 0===e)for(var i,n=Q(this._passes);!(i=n()).done;)i.value.tryCompile(t);else this._passes[e].tryCompile(t)},i.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var i=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var n=0;n<this._passes.length;n++){var r=this._passes[n],a=this._states[n]||(this._states[n]={});for(var o in t)a[o]=t[o];r.overridePipelineStates(i[r.passIndex],a)}else{var s=this._states[e]||(this._states[e]={});for(var l in t)s[l]=t[l];this._passes[e].overridePipelineStates(i[e],s)}}},i.destroy=function(){return this._doDestroy(),!0},i.onPassStateChange=function(t){this._hash=nm.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},i._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var i=0;i<e.length;++i)t.push(new lm(e[i],this));return t},e}(nm),hm=null,um=null,_m=function(){function t(){this._envmap=null,this._globalDescriptorSet=null,this._model=null,this._default=null,this._handle=0,this._handle=zr.alloc()}q(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return zr.get(this._handle,Nr.ENABLE)},set:function(t){t?this.activate():this._updatePipeline(),zr.set(this._handle,Nr.ENABLE,t?1:0)}},{key:"useIBL",get:function(){return zr.get(this._handle,Nr.USE_IBL)},set:function(t){zr.set(this._handle,Nr.USE_IBL,t?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return zr.get(this._handle,Nr.IS_RGBE)},set:function(t){t&&(um&&um.recompileShaders({USE_RGBE_CUBEMAP:t}),this._model&&this._model.setSubModelMaterial(0,um)),zr.set(this._handle,Nr.IS_RGBE,t?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(t){this._envmap=t||this._default,this._envmap&&(n.director.root.pipeline.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){zr.set(this._handle,Nr.ENABLE,t.enabled?1:0),zr.set(this._handle,Nr.USE_IBL,t.useIBL?1:0),zr.set(this._handle,Nr.IS_RGBE,t.isRGBE?1:0),this._envmap=t.envmap},e.activate=function(){var t=n.director.root.pipeline;if(this._globalDescriptorSet=t.descriptorSet,this._default=Zd.get("default-cube-texture"),this._model||(this._model=n.director.root.createModel(n.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),zr.set(this._handle,Nr.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),t.ambient.groundAlbedo[3]=this._envmap.mipmapLevel,um)um.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var e=new nm;e.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),um=new cm({parent:e})}this.enabled&&(hm||(hm=n.utils.createMesh(n.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,hm.renderingSubMeshes[0],um)),this._updateGlobalBinding(),this._updatePipeline()},e._updatePipeline=function(){var t=this.useIBL?this.isRGBE?2:1:0,e=n.director.root,i=e.pipeline;i.macros.CC_USE_IBL!==t&&(i.macros.CC_USE_IBL=t,e.onGlobalPipelineStateChanged())},e._updateGlobalBinding=function(){var t=this.envmap.getGFXTexture(),e=lf.getSampler(n.director._device,this.envmap.getSamplerHash());this._globalDescriptorSet.bindSampler(th,e),this._globalDescriptorSet.bindTexture(th,t)},e.destroy=function(){this._handle&&(zr.free(this._handle),this._handle=0)},t}();n.Skybox=_m;var fm,dm,pm=function(t){function e(){var e;return(e=t.call(this)||this)._needUpdate=!1,e._pos=void 0,e._aabb=void 0,e._hAABB=0,e._aabb=sc.create(),e._pos=new Ri,e}Y(e,t),q(e,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(t){Xr.set(this._handle,Vr.SIZE,t)},get:function(){return Xr.get(this._handle,Vr.SIZE)}},{key:"range",set:function(t){Xr.set(this._handle,Vr.RANGE,t),this._needUpdate=!0},get:function(){return Xr.get(this._handle,Vr.RANGE)}},{key:"luminance",set:function(t){Xr.set(this._handle,Vr.ILLUMINANCE,t)},get:function(){return Xr.get(this._handle,Vr.ILLUMINANCE)}},{key:"aabb",get:function(){return this._aabb}}]);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),this._hAABB=dr.alloc(),Xr.set(this._handle,Vr.TYPE,np.SPHERE),Xr.set(this._handle,Vr.SIZE,.15),Xr.set(this._handle,Vr.RANGE,1),Xr.set(this._handle,Vr.AABB,this._hAABB),Xr.set(this._handle,Vr.ILLUMINANCE,1700/op(.15))},i.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=Xr.get(this._handle,Vr.RANGE);sc.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1,Xr.setVec3(this._handle,Vr.POSITION,this._pos),dr.setVec3(this._hAABB,cr.CENTER,this._aabb.center),dr.setVec3(this._hAABB,cr.HALF_EXTENSION,this._aabb.halfExtents)}},i.destroy=function(){return this._hAABB&&(dr.free(this._hAABB),this._hAABB=0),t.prototype.destroy.call(this)},e}(sp),mm=new Ri(0,0,-1),vm=new Li,gm=new Vi,ym=new Vi,Tm=new Vi,Sm=new Vi,Em=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new Ri(1,-1,-1),e._range=5,e._spotAngle=Math.cos(Math.PI/6),e._pos=void 0,e._aabb=void 0,e._frustum=void 0,e._angle=0,e._needUpdate=!1,e._hAABB=0,e._hFrustum=0,e._aabb=sc.create(),e._frustum=mc.create(),e._pos=new Ri,e}Y(e,t),q(e,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(t){Xr.set(this._handle,Vr.SIZE,t)},get:function(){return Xr.get(this._handle,Vr.SIZE)}},{key:"range",set:function(t){this._range=t,Xr.set(this._handle,Vr.RANGE,t),this._needUpdate=!0},get:function(){return Xr.get(this._handle,Vr.RANGE)}},{key:"luminance",set:function(t){Xr.set(this._handle,Vr.ILLUMINANCE,t)},get:function(){return Xr.get(this._handle,Vr.ILLUMINANCE)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return Xr.get(this._handle,Vr.SPOT_ANGLE)},set:function(t){this._angle=t,Xr.set(this._handle,Vr.SPOT_ANGLE,Math.cos(.5*t)),this._needUpdate=!0}},{key:"aspect",set:function(t){Xr.set(this._handle,Vr.ASPECT,t),this._needUpdate=!0},get:function(){return Xr.get(this._handle,Vr.ASPECT)}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),this._hAABB=dr.alloc(),this._hFrustum=Mr.alloc(),Xr.set(this._handle,Vr.TYPE,np.SPOT),Xr.set(this._handle,Vr.SIZE,.15),Xr.set(this._handle,Vr.AABB,this._hAABB),Xr.set(this._handle,Vr.ILLUMINANCE,1700/op(.15)),Xr.set(this._handle,Vr.RANGE,Math.cos(Math.PI/6)),Xr.set(this._handle,Vr.ASPECT,1),Xr.setVec3(this._handle,Vr.DIRECTION,this._dir)},i.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Ri.transformQuat(this._dir,mm,this._node.getWorldRotation(vm)),Ri.normalize(this._dir,this._dir),Xr.setVec3(this._handle,Vr.DIRECTION,this._dir),sc.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(gm),Vi.invert(gm,gm),Vi.perspective(ym,this._angle,1,.001,this._range),Vi.multiply(Tm,ym,gm),this._frustum.update(Tm,Sm),this._needUpdate=!1,Xr.setVec3(this._handle,Vr.POSITION,this._pos),dr.setVec3(this._hAABB,cr.CENTER,this._aabb.center),dr.setVec3(this._hAABB,cr.HALF_EXTENSION,this._aabb.halfExtents),vc(this._hFrustum,this._frustum))},i.destroy=function(){return this._hAABB&&(dr.free(this._hAABB),this._hAABB=0),this._hFrustum&&(Mr.free(this._hFrustum),this._hFrustum=0),t.prototype.destroy.call(this)},e}(sp),Am=Object.freeze({__proto__:null,Ambient:fa,get CameraFOVAxis(){return Ph},get CameraProjection(){return Mh},get CameraAperture(){return Dh},get CameraISO(){return Nh},get CameraShutter(){return Lh},SKYBOX_FLAG:Xh,Camera:Kh,CameraVisFlags:ip,VisibilityFlags:rp,DirectionalLight:hp,ColorTemperatureToRGB:ap,get LightType(){return np},nt2lm:op,Light:sp,get ModelType(){return dp},Model:Up,ShadowType:rm,PCFType:am,Shadows:sm,RenderScene:Zh,Skybox:_m,SphereLight:pm,SpotLight:Em,SubModel:_p});function bm(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function xm(t,e){return Math.ceil(t/e)*e}!function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(fm||(fm={})),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(dm||(dm={}));var Cm=function(){function t(t){this._device=void 0,this._format=ka.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new ns,this._region1=new ns,this._region2=new ns,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var e=t.prototype;return e.initialize=function(t){var e=xo[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=Oo(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},e.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},e.alloc=function(t,e){t=xm(t,this._alignment);var i=-1,n=-1;if(void 0!==e&&(i=e,n=this._findAvailableSpace(t,i)),n<0)for(var r=0;r<this._chunkCount&&(i=r,!((n=this._findAvailableSpace(t,i))>=0));++r);if(n>=0){var a=this._chunks[i];a.start+=t;var o={chunkIdx:i,start:n,end:n+t,texture:a.texture};return this._handles.push(o),o}var s=Math.sqrt(t/this._formatSize),l=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,bm(s)),c=this._chunks[this.createChunk(l)];c.start+=t;var h={chunkIdx:this._chunkCount-1,start:0,end:t,texture:c.texture};return this._handles.push(h),h},e.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},e.createChunk=function(t){var e=t*t*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+e+", format: "+this._format);var i={texture:this._device.createTexture(new Cs(io.TEX2D,no.SAMPLED|no.TRANSFER_DST,this._format,t,t,ao.IMMUTABLE)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=i,this._chunkCount++},e.update=function(t,e){var i=[],n=[],r=t.start/this._formatSize,a=e.byteLength/this._formatSize,o=r%t.texture.width,s=Math.floor(r/t.texture.width),l=Math.min(t.texture.width-o,a),c=0;o>0&&(this._region0.texOffset.x=o,this._region0.texOffset.y=s,this._region0.texExtent.width=l,this._region0.texExtent.height=1,i.push(new this._bufferViewCtor(e,c*this._formatSize,l*this._channels)),n.push(this._region0),o=0,s+=1,a-=l,c+=l),a>0&&(this._region1.texOffset.x=o,this._region1.texOffset.y=s,a>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(a/t.texture.width),l=this._region1.texExtent.width*this._region1.texExtent.height):(l=a,this._region1.texExtent.width=l,this._region1.texExtent.height=1),i.push(new this._bufferViewCtor(e,c*this._formatSize,l*this._channels)),n.push(this._region1),o=0,s+=this._region1.texExtent.height,a-=l,c+=l),a>0&&(this._region2.texOffset.x=o,this._region2.texOffset.y=s,this._region2.texExtent.width=a,this._region2.texExtent.height=1,i.push(new this._bufferViewCtor(e,c*this._formatSize,a*this._channels)),n.push(this._region2)),this._device.copyBuffersToTexture(i,t.texture,n)},e._findAvailableSpace=function(t,e){var i=this._chunks[e],n=!1,r=i.start;if(r+t<=i.size)n=!0;else{r=0;for(var a=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),o=0;o<a.length;o++){var s=a[o];if(r+t<=s.start){n=!0;break}r=s.end}!n&&r+t<=i.size&&(n=!0)}return n?r:-1},e._McDonaldAlloc=function(t){t=xm(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var i=this._chunks[e],n=!1,r=i.start;if(r+t<=i.end?n=!0:r>i.end?r+t<=i.size?n=!0:t<=i.end&&(i.start=r=0,n=!0):r===i.end&&(i.start=r=0,i.end=i.size,t<=i.end&&(n=!0)),n){i.start+=t;var a={chunkIdx:e,start:r,end:r+t,texture:i.texture};return this._handles.push(a),a}}var o=Math.sqrt(t/this._formatSize),s=this._roundUpFn&&this._roundUpFn(o,this._formatSize)||Math.max(1024,bm(o)),l=this._chunks[this.createChunk(s)];l.start+=t;var c={chunkIdx:this._chunkCount,start:0,end:t,texture:l.texture};return this._handles.push(c),c},t}(),wm=function(t){if(void 0===et[t]){var e=1<<tt;et[t]=e,tt+=1}},Rm=Object.freeze({__proto__:null,addStage:wm,scene:Am,createIA:function(t,e){if(!e.positions)return console.error("The data must have positions field"),null;for(var i=[],n=e.positions.length/3,r=0;r<n;++r)i.push(e.positions[3*r],e.positions[3*r+1],e.positions[3*r+2]),e.normals&&i.push(e.normals[3*r],e.normals[3*r+1],e.normals[3*r+2]),e.uvs&&i.push(e.uvs[2*r],e.uvs[2*r+1]),e.colors&&i.push(e.colors[3*r],e.colors[3*r+1],e.colors[3*r+2]);var a=[];a.push(new Xo(za.ATTR_POSITION,ka.RGB32F)),e.normals&&a.push(new Xo(za.ATTR_NORMAL,ka.RGB32F)),e.uvs&&a.push(new Xo(za.ATTR_TEX_COORD,ka.RG32F)),e.colors&&a.push(new Xo(za.ATTR_COLOR,ka.RGB32F));var o=t.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,4*i.length,4*i.length/n));o.update(new Float32Array(i));var s=null;return e.indices&&(s=t.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,2*e.indices.length,2))).update(new Uint16Array(e.indices)),t.createInputAssembler(new Yo(a,[o],s))},get RenderQueue(){return fm},get PassStage(){return dm},get PropertyType(){return bd},genHandle:Cd,getPropertyTypeFromHandle:wd,getTypeFromHandle:Rd,getSetIndexFromHandle:function(t){return(3145728&t)>>>20},getBindingFromHandle:Id,getOffsetFromHandle:Od,customizeType:Pd,type2reader:Md,type2writer:Dd,getDefaultFromType:Ld,overrideMacros:Bd,get BatchingSchemes(){return Xd},Pass:ep,getDeviceShaderVersion:Vd,programLib:Wd,get SamplerInfoIndex(){return H_},defaultSamplerHash:j_,genSamplerHash:Y_,samplerLib:lf,nearestPOT:bm,TextureBufferPool:Cm,MaterialInstance:cm,PassInstance:lm,ObjectPool:Ln,freeHandleArray:zn,get PoolType(){return Dn},NULL_HANDLE:0,ShaderPool:kn,DSPool:Gn,IAPool:Hn,PipelineLayoutPool:Vn,FramebufferPool:Wn,SubModelArrayPool:jn,ModelArrayPool:qn,AttributeArrayPool:Xn,FlatBufferArrayPool:Yn,LightArrayPool:Kn,BlendTargetArrayPool:Zn,UIBatchArrayPool:Qn,RawBufferPool:Jn,RawObjectPool:$n,get PassView(){return Un},PassPool:ir,get SubModelView(){return tr},SubModelPool:ar,get ModelView(){return nr},ModelPool:lr,get BatchView2D(){return or},BatchPool2D:ur,get AABBView(){return cr},AABBPool:dr,get SceneView(){return _r},ScenePool:vr,get CameraView(){return pr},CameraPool:Tr,get NodeView(){return gr},NodePool:Ar,get RootView(){return Er},RootPool:Cr,get RenderWindowView(){return br},RenderWindowPool:Ir,get FrustumView(){return wr},FrustumPool:Mr,get AmbientView(){return Or},AmbientPool:Lr,get SkyboxView(){return Nr},SkyboxPool:zr,get FogView(){return Br},FogPool:Gr,get ShadowsView(){return kr},ShadowsPool:Wr,get LightView(){return Vr},LightPool:Xr,get SphereView(){return jr},SpherePool:Zr,get FlatBufferView(){return Kr},FlatBufferPool:$r,get SubMeshView(){return Qr},SubMeshPool:ia,get RasterizerStateView(){return ta},RasterizerStatePool:aa,get DepthStencilStateView(){return na},DepthStencilStatePool:la,get BlendTargetView(){return oa},BlendTargetPool:ha,get BlendStateView(){return ca},BlendStatePool:_a});function Im(t){return t*t}function Om(t){return t*(2-t)}function Pm(t){return t*t*t}function Mm(t){return--t*t*t+1}function Dm(t){return t*t*t*t}function Nm(t){return 1- --t*t*t*t}function Lm(t){return t*t*t*t*t}function Bm(t){return--t*t*t*t*t+1}function Fm(t){return 1-Math.cos(t*Math.PI/2)}function zm(t){return Math.sin(t*Math.PI/2)}function Um(t){return 0===t?0:Math.pow(1024,t-1)}function km(t){return 1===t?1:1-Math.pow(2,-10*t)}function Gm(t){return 1-Math.sqrt(1-t*t)}function Hm(t){return Math.sqrt(1- --t*t)}function Vm(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function Wm(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function jm(t){var e=1.70158;return t*t*((e+1)*t-e)}function qm(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}function Xm(t){return 1-Ym(1-t)}function Ym(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}t("renderer",Rm);var Km=av(Im,Om),Zm=av(Pm,Mm),Qm=av(Dm,Nm),Jm=av(Lm,Bm),$m=av(Fm,zm),tv=av(Um,km),ev=av(Gm,Hm),iv=av(Vm,Wm),nv=av(jm,qm),rv=av(Xm,Ym);function av(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var ov,sv=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(t){return t},quadIn:Im,quadOut:Om,quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:Pm,cubicOut:Mm,cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:Dm,quartOut:Nm,quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:Lm,quintOut:Bm,quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:Fm,sineOut:zm,sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:Um,expoOut:km,expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:Gm,circOut:Hm,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:Vm,elasticOut:Wm,elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)},backIn:jm,backOut:qm,backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:Xm,bounceOut:Ym,bounceInOut:function(t){return t<.5?.5*Xm(2*t):.5*Ym(2*t-1)+.5},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)},quadOutIn:Km,cubicOutIn:Zm,quartOutIn:Qm,quintOutIn:Jm,sineOutIn:$m,expoOutIn:tv,circOutIn:ev,elasticOutIn:iv,backOutIn:nv,bounceOutIn:rv});t("easing",sv),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(ov||(ov={}));var lv,cv,hv,uv,_v,fv,dv,pv,mv,vv,gv,yv=t("sys",{NetworkType:ov,LANGUAGE_ENGLISH:"en",LANGUAGE_CHINESE:"zh",LANGUAGE_FRENCH:"fr",LANGUAGE_ITALIAN:"it",LANGUAGE_GERMAN:"de",LANGUAGE_SPANISH:"es",LANGUAGE_DUTCH:"du",LANGUAGE_RUSSIAN:"ru",LANGUAGE_KOREAN:"ko",LANGUAGE_JAPANESE:"ja",LANGUAGE_HUNGARIAN:"hu",LANGUAGE_PORTUGUESE:"pt",LANGUAGE_ARABIC:"ar",LANGUAGE_NORWEGIAN:"no",LANGUAGE_POLISH:"pl",LANGUAGE_TURKISH:"tr",LANGUAGE_UKRAINIAN:"uk",LANGUAGE_ROMANIAN:"ro",LANGUAGE_BULGARIAN:"bg",LANGUAGE_UNKNOWN:"unknown",OS_IOS:"iOS",OS_ANDROID:"Android",OS_WINDOWS:"Windows",OS_LINUX:"Linux",OS_OSX:"OS X",OS_UNKNOWN:"Unknown",UNKNOWN:-1,WIN32:0,LINUX:1,MACOS:2,ANDROID:3,IPHONE:4,IPAD:5,BLACKBERRY:6,NACL:7,EMSCRIPTEN:8,TIZEN:9,WINRT:10,WP8:11,MOBILE_BROWSER:100,DESKTOP_BROWSER:101,EDITOR_PAGE:102,EDITOR_CORE:103,WECHAT_GAME:104,QQ_PLAY:105,FB_PLAYABLE_ADS:106,BAIDU_MINI_GAME:107,VIVO_MINI_GAME:108,OPPO_MINI_GAME:109,HUAWEI_QUICK_GAME:110,XIAOMI_QUICK_GAME:111,COCOSPLAY:112,ALIPAY_MINI_GAME:113,QTT_MINI_GAME:116,BYTEDANCE_MINI_GAME:117,LINKSURE_MINI_GAME:119,BROWSER_TYPE_WECHAT:"wechat",BROWSER_TYPE_ANDROID:"androidbrowser",BROWSER_TYPE_IE:"ie",BROWSER_TYPE_EDGE:"edge",BROWSER_TYPE_QQ:"qqbrowser",BROWSER_TYPE_MOBILE_QQ:"mqqbrowser",BROWSER_TYPE_UC:"ucbrowser",BROWSER_TYPE_UCBS:"ucbs",BROWSER_TYPE_360:"360browser",BROWSER_TYPE_BAIDU_APP:"baiduboxapp",BROWSER_TYPE_BAIDU:"baidubrowser",BROWSER_TYPE_MAXTHON:"maxthon",BROWSER_TYPE_OPERA:"opera",BROWSER_TYPE_OUPENG:"oupeng",BROWSER_TYPE_MIUI:"miuibrowser",BROWSER_TYPE_FIREFOX:"firefox",BROWSER_TYPE_SAFARI:"safari",BROWSER_TYPE_CHROME:"chrome",BROWSER_TYPE_LIEBAO:"liebao",BROWSER_TYPE_QZONE:"qzone",BROWSER_TYPE_SOUGOU:"sogou",BROWSER_TYPE_HUAWEI:"huawei",BROWSER_TYPE_UNKNOWN:"unknown",isNative:!1,isBrowser:"object"==typeof window&&"object"==typeof document,isMobile:!1,isLittleEndian:(lv=new ArrayBuffer(2),new DataView(lv).setInt16(0,256,!0),256===new Int16Array(lv)[0]),platform:-1,language:"unknown",languageCode:"unknown",os:"Unknown",osVersion:"",osMainVersion:0,browserType:"unknown",browserVersion:"",windowPixelResolution:null,capabilities:null,localStorage:null,__audioSupport:null,__videoSupport:null,getNetworkType:function(){return ov.LAN},getBatteryLevel:function(){return 1},garbageCollect:function(){},isObjectValid:function(t){return null!=t},dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",_(t+="Using "+(n.game.renderType===n.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){window.open(t)},now:function(){return Date.now?Date.now():+new Date},restartVM:function(){},getSafeAreaRect:function(){var t=n.view.getVisibleSize();return n.rect(0,0,t.width,t.height)},__init:function(){var t=window,e=t.navigator,i=document,n=i.documentElement,r=e.userAgent.toLowerCase();yv.isMobile=/mobile|android|iphone|ipad/.test(r),yv.platform=yv.isMobile?yv.MOBILE_BROWSER:yv.DESKTOP_BROWSER;var a=e.language;yv.languageCode=a.toLowerCase(),a=(a=a||e.browserLanguage)?a.split("-")[0]:yv.LANGUAGE_ENGLISH,yv.language=a;var o=!1,s=!1,l="",c=0,h=/android\s*(\d+(?:\.\d+)*)/i.exec(r)||/android\s*(\d+(?:\.\d+)*)/i.exec(e.platform);h&&(o=!0,l=h[1]||"",c=parseInt(l)||0),(h=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(s=!0,l=h[2]||"",c=parseInt(l)||0):(/(iPhone|iPad|iPod)/.exec(e.platform)||"MacIntel"===e.platform&&e.maxTouchPoints&&e.maxTouchPoints>1)&&(s=!0,l="",c=0);var u=yv.OS_UNKNOWN;-1!==e.appVersion.indexOf("Win")?u=yv.OS_WINDOWS:s?u=yv.OS_IOS:-1!==e.appVersion.indexOf("Mac")?u=yv.OS_OSX:-1!==e.appVersion.indexOf("X11")&&-1===e.appVersion.indexOf("Linux")?u=yv.OS_UNIX:o?u=yv.OS_ANDROID:-1===e.appVersion.indexOf("Linux")&&-1===r.indexOf("ubuntu")||(u=yv.OS_LINUX),yv.os=u,yv.osVersion=l,yv.osMainVersion=c,yv.browserType=yv.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(r)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r),e=t?t[0].toLowerCase():yv.BROWSER_TYPE_UNKNOWN;("safari"===e&&o||"qq"===e&&/android.*applewebkit/i.test(r))&&(e=yv.BROWSER_TYPE_ANDROID);var i={micromessenger:yv.BROWSER_TYPE_WECHAT,trident:yv.BROWSER_TYPE_IE,edge:yv.BROWSER_TYPE_EDGE,"360 aphone":yv.BROWSER_TYPE_360,mxbrowser:yv.BROWSER_TYPE_MAXTHON,"opr/":yv.BROWSER_TYPE_OPERA,ubrowser:yv.BROWSER_TYPE_UC,huaweibrowser:yv.BROWSER_TYPE_HUAWEI};yv.browserType=i[e]||e}(),yv.browserVersion="",function(){var t=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(r);t||(t=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(r)),yv.browserVersion=t?t[4]:""}();var _=window.innerWidth||document.documentElement.clientWidth,f=window.innerHeight||document.documentElement.clientHeight,d=window.devicePixelRatio||1;yv.windowPixelResolution={width:d*_,height:d*f};var p,m=document.createElement("canvas");try{var v=yv.localStorage=t.localStorage;v.setItem("storage",""),v.removeItem("storage"),v=null}catch(t){var g=function(){E(5200)};yv.localStorage={getItem:g,setItem:g,removeItem:g,clear:g}}try{p=m.toDataURL("image/webp").startsWith("data:image/webp")}catch(t){p=!1}var y=!!m.getContext("2d"),S=!1;t.WebGLRenderingContext&&(S=!0);var A,b=yv.capabilities={canvas:y,opengl:S,webp:p,imageBitmap:!1,touches:!1,mouse:!1,keyboard:!1,accelerometer:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(m.width=m.height=2,createImageBitmap(m,{}).then((function(t){b.imageBitmap=!0,t.close&&t.close()})).catch((function(){}))),(void 0!==n.ontouchstart||void 0!==i.ontouchstart||e.msPointerEnabled)&&(b.touches=!0),void 0!==n.onmouseup&&(b.mouse=!0),void 0!==n.onkeyup&&(b.keyboard=!0),(t.DeviceMotionEvent||t.DeviceOrientationEvent)&&(b.accelerometer=!0),A={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1},yv.os===yv.OS_IOS&&(A.USE_LOADER_EVENT="loadedmetadata"),yv.browserType===yv.BROWSER_TYPE_FIREFOX&&(A.DELAY_CREATE_CTX=!0,A.USE_LOADER_EVENT="canplay"),yv.os===yv.OS_ANDROID&&yv.browserType===yv.BROWSER_TYPE_UC&&(A.ONE_SOURCE=!0);try{A.WEB_AUDIO&&(A._context=null,Object.defineProperty(A,"context",{get:function(){return this._context?this._context:this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}}))}catch(t){A.WEB_AUDIO=!1,T(5201)}var x,C=[];(x=document.createElement("audio")).canPlayType&&(x.canPlayType('audio/ogg; codecs="vorbis"')&&C.push(".ogg"),x.canPlayType("audio/mpeg")&&C.push(".mp3"),x.canPlayType('audio/wav; codecs="1"')&&C.push(".wav"),x.canPlayType("audio/mp4")&&C.push(".mp4"),x.canPlayType("audio/x-m4a")&&C.push(".m4a")),A.format=C,yv.__audioSupport=A,yv.__videoSupport={format:[]},function(){var t=document.createElement("video");if(t.canPlayType){var e=yv.__videoSupport.format;["mp4","webm"].forEach((function(i){t.canPlayType("video/"+i)&&e.push("."+i)})),yv.__videoSupport.format=e}}(),yv.__isWebIOS14OrIPadOS14Env=(yv.os===yv.OS_IOS||yv.os===yv.OS_OSX)&&yv.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent)}});"object"==typeof window&&"object"==typeof document&&yv.__init(),n.sys=yv;var Tv,Sv,Ev,Av,bv,xv,Cv,wv,Rv,Iv,Ov,Pv,Mv,Dv=t("RenderStage",(cv=ru("RenderStage"),hv=Ru(),uv=Ru(),_v=Ru(),cv((gv=function(){function t(){J(this,"_name",pv,this),J(this,"_priority",mv,this),J(this,"_tag",vv,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,t.tag&&(this._tag=t.tag),!0},e.activate=function(t,e){this._pipeline=t,this._flow=e},q(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),t}(),pv=$((dv=gv).prototype,"_name",[hv,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mv=$(dv.prototype,"_priority",[uv,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vv=$(dv.prototype,"_tag",[_v,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fv=dv))||fv));n.RenderStage=Dv;var Nv,Lv,Bv,Fv,zv,Uv,kv,Gv,Hv,Vv=t("RenderFlow",(Tv=ru("RenderFlow"),Sv=Ru(),Ev=Ru(),Av=Ru(),bv=Ru(),xv=Fu([Dv]),Tv((Mv=function(){function t(){J(this,"_name",Rv,this),J(this,"_priority",Iv,this),J(this,"_tag",Ov,this),J(this,"_stages",Pv,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,this._stages=t.stages,t.tag&&(this._tag=t.tag),!0},e.activate=function(t){this._pipeline=t,this._stages.sort((function(t,e){return t.priority-e.priority}));for(var e=0,i=this._stages.length;e<i;e++)this._stages[e].activate(t,this)},e.render=function(t){for(var e=0,i=this._stages.length;e<i;e++)this._stages[e].render(t)},e.destroy=function(){for(var t=0,e=this._stages.length;t<e;t++)this._stages[t].destroy();this._stages.length=0},q(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}}]),t}(),Rv=$((wv=Mv).prototype,"_name",[Sv,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Iv=$(wv.prototype,"_priority",[Ev,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ov=$(wv.prototype,"_tag",[Av,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pv=$(wv.prototype,"_stages",[bv,xv,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cv=wv))||Cv));n.RenderFlow=Vv;var Wv,jv,qv=t("RenderPipeline",(Nv=ru("cc.RenderPipeline"),Lv=Ru(),Bv=Ru(),Fv=Fu([Vv]),Nv((Hv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_tag",kv,K(e)),J(e,"_flows",Gv,K(e)),e._macros={},e._commandBuffers=[],e}Y(e,t);var i=e.prototype;return i.initialize=function(t){return this._flows=t.flows,t.tag&&(this._tag=t.tag),!0},i.activate=function(){this._device=n.director.root.device;var t=new Bs(Uc.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(t),this._descriptorSet=this._device.createDescriptorSet(new Ds(this._descriptorSetLayout));for(var e=0;e<this._flows.length;e++)this._flows[e].activate(this);return!0},i.render=function(t){for(var e=0;e<this.flows.length;e++)for(var i=0;i<t.length;i++){var n=t[i];this.flows[e].render(n)}},i.destroy=function(){for(var e=0;e<this._flows.length;e++)this._flows[e].destroy();this._flows.length=0,this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null);for(var i=0;i<this._commandBuffers.length;i++)this._commandBuffers[i].destroy();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},q(e,[{key:"macros",get:function(){return this._macros}},{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"device",get:function(){return this._device}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}}]),e}(M_),kv=$((Uv=Hv).prototype,"_tag",[Lv,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gv=$(Uv.prototype,"_flows",[Bv,Fv,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zv=Uv))||zv));n.RenderPipeline=qv,function(t){t[t.FORWARD=10]="FORWARD",t[t.UI=20]="UI"}(Wv||(Wv={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.FORWARD=1]="FORWARD",t[t.UI=10]="UI"}(jv||(jv={}));var Xv=t("PipelineStateManager",function(){function t(){}return t.getOrCreatePipelineState=function(t,e,i,n,r){var a=e.handle,o=ir.get(a,Un.HASH)^n.hash^r.attributesHash^i.id,s=this._PSOHashMap.get(o);if(!s){var l=Vn.get(ir.get(a,Un.PIPELINE_LAYOUT)),c=new ls(r.attributes),h=new cs(i,l,n,c,e.rasterizerState,e.depthStencilState,e.blendState,ir.get(a,Un.PRIMITIVE),ir.get(a,Un.DYNAMIC_STATES));s=t.createPipelineState(h),this._PSOHashMap.set(o,s)}return s},t}());function Yv(t,e){return t.hash-e.hash||t.depth-e.depth||t.shaderId-e.shaderId}function Kv(t,e){return t.hash-e.hash||e.depth-t.depth||t.shaderId-e.shaderId}Xv._PSOHashMap=new Map;var Zv=function(){function t(t){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=t,this._passPool=new __((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new f_(64,this._passDesc.sortFunc)}var e=t.prototype;return e.clear=function(){this.queue.clear(),this._passPool.reset()},e.insertRenderPass=function(t,e,i){var n=t.model.subModels[e],r=ar.get(n.handle,tr.PASS_0+i);if(n.passes[i].blendState.targets[0].blend!==this._passDesc.isTransparent||!(ir.get(r,Un.PHASE)&this._passDesc.phases))return!1;var a=0|ir.get(r,Un.PRIORITY)<<16|n.priority<<8|i,o=this._passPool.add();return o.hash=a,o.depth=t.depth||0,o.shaderId=ar.get(n.handle,tr.SHADER_0+i),o.subModel=n,o.passIdx=i,this.queue.push(o),!0},e.sort=function(){this.queue.sort()},e.recordCommandBuffer=function(t,e,i){for(var n=0;n<this.queue.length;++n){var r=this.queue.array[n],a=r.subModel,o=r.passIdx,s=a.inputAssembler,l=a.handle,c=a.passes[o],h=kn.get(ar.get(l,tr.SHADER_0+o)),u=Xv.getOrCreatePipelineState(t,c,h,e,s);i.bindPipelineState(u),i.bindDescriptorSet(Wc.MATERIAL,c.descriptorSet),i.bindDescriptorSet(Wc.LOCAL,a.descriptorSet),i.bindInputAssembler(s),i.draw(s)}},t}(),Qv=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),i=e.next();!i.done;){for(var n=0;n<i.value.batches.length;++n){var r=i.value.batches[n];if(r.mergeCount){for(var a=0;a<r.vbs.length;++a)r.vbs[a].update(r.vbDatas[a]);t.updateBuffer(r.vbIdx,r.vbIdxData.buffer),t.updateBuffer(r.ubo,r.uboData)}}i=e.next()}},e.recordCommandBuffer=function(t,e,i){for(var n=this.queue.values(),r=n.next();!r.done;){for(var a=!1,o=0;o<r.value.batches.length;++o){var s=r.value.batches[o];if(s.mergeCount){if(!a){var l=kn.get(s.hShader),c=Xv.getOrCreatePipelineState(t,s.pass,l,e,s.ia);i.bindPipelineState(c),i.bindDescriptorSet(Wc.MATERIAL,s.pass.descriptorSet),a=!0}i.bindDescriptorSet(Wc.LOCAL,s.descriptorSet,r.value.dynamicOffsets),i.bindInputAssembler(s.ia),i.draw(s.ia)}}r=n.next()}},t}(),Jv=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),i=e.next();!i.done;)i.value.hasPendingModels&&i.value.uploadBuffers(t),i=e.next()},e.recordCommandBuffer=function(t,e,i){for(var n=this.queue.values(),r=n.next();!r.done;){var a=r.value,o=a.instances,s=a.pass;if(a.hasPendingModels){i.bindDescriptorSet(Wc.MATERIAL,s.descriptorSet);for(var l=null,c=0;c<o.length;++c){var h=o[c];if(h.count){var u=kn.get(h.hShader),_=Xv.getOrCreatePipelineState(t,s,u,e,h.ia);l!==_&&(i.bindPipelineState(_),l=_),i.bindDescriptorSet(Wc.LOCAL,Gn.get(h.hDescriptorSet),r.value.dynamicOffsets),i.bindInputAssembler(h.ia),i.draw(h.ia)}}}r=n.next()}},t}(),$v=function(){function t(t){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=t.device}t.get=function(e,i){void 0===i&&(i=0);var n=t._buffers;n.has(e)||n.set(e,{});var r=n.get(e);return r[i]||(r[i]=new t(e))};var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.batches.length;++t){for(var e=this.batches[t],i=0;i<e.vbs.length;++i)e.vbs[i].destroy();e.vbIdx.destroy(),e.ia.destroy(),e.ubo.destroy()}this.batches.length=0},e.merge=function(t,e,i){var n=t.subMesh.flatBuffers;if(0!==n.length){for(var r=0,a=0,o=n[0].count,s=t.passes[e],l=ar.get(t.handle,tr.SHADER_0+e),c=t.descriptorSet,h=!1,u=0;u<this.batches.length;++u){var _=this.batches[u];if(_.vbs.length===n.length&&_.mergeCount<sh.BATCHING_COUNT){h=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==n[f].stride){h=!1;break}if(h){for(var d=0;d<_.vbs.length;++d){var p=n[d],m=_.vbs[d],v=_.vbDatas[d];(r=(o+_.vbCount)*p.stride)>m.size&&(m.resize(r),_.vbDatas[d]=new Uint8Array(r),_.vbDatas[d].set(v)),_.vbDatas[d].set(p.buffer,_.vbCount*p.stride)}var g=_.vbIdxData;(a=4*(o+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(a),_.vbIdxData=new Float32Array(a/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(g),g=_.vbIdxData);var y=_.vbCount,T=y+o,S=_.mergeCount;if(g[y]!==S||g[T-1]!==S)for(var E=y;E<T;E++)g[E]=S+.1;return Vi.toArray(_.uboData,i.transform.worldMatrix,sh.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(c.bindBuffer(sh.BINDING,_.ubo),c.update(),_.pass=s,_.hShader=l,_.descriptorSet=c),++_.mergeCount,_.vbCount+=o,void(_.ia.vertexCount+=o)}}}for(var A=[],b=[],x=[],C=0;C<n.length;++C){var w=n[C],R=this._device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,w.count*w.stride,w.stride));R.update(w.buffer.buffer),A.push(R),b.push(new Uint8Array(R.size)),x.push(R)}var I=this._device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,4*o,4)),O=new Float32Array(o);O.fill(0),I.update(O),x.push(I);for(var P=t.inputAssembler.attributes,M=new Array(P.length+1),D=0;D<P.length;++D)M[D]=P[D];M[P.length]=new Xo("a_dyn_batch_id",ka.R32F,!1,n.length);var N=new Yo(M,x),L=this._device.createInputAssembler(N),B=this._device.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,sh.SIZE,sh.SIZE));c.bindBuffer(sh.BINDING,B),c.update();var F=new Float32Array(sh.COUNT);Vi.toArray(F,i.transform.worldMatrix,sh.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:A,vbDatas:b,vbIdx:I,vbIdxData:O,vbCount:o,ia:L,ubo:B,uboData:F,pass:s,hShader:l,descriptorSet:c})}},e.clear=function(){for(var t=0;t<this.batches.length;++t){var e=this.batches[t];e.vbCount=0,e.mergeCount=0,e.ia.vertexCount=0}},t}();$v._buffers=new Map;var tg=new Ri,eg=new Ri,ig=new Ri,ng=new Vi,rg=new sc,ag=!1,og=[],sg=La.create(0,0,0,1),lg=new u_((function(){return{model:null,depth:0}}),128),cg=new u_((function(){return{model:null,depth:0}}),128);function hg(t,e){var i=0;t.node&&(Ri.subtract(tg,t.node.worldPosition,e.position),i=Ri.dot(tg,e.forward));var n=lg.alloc();return n.model=t,n.depth=i,n}function ug(t,e){var i=0;t.node&&(Ri.subtract(tg,t.node.worldPosition,e.position),i=Ri.dot(tg,e.forward));var n=cg.alloc();return n.model=t,n.depth=i,n}function _g(t,e,i,n){var r=t.shadows;Ri.negate(eg,i);var a=r.sphere.radius*sm.COEFFICIENT_OF_EXPANSION;return Ri.multiplyScalar(ig,eg,a),Ri.add(ig,ig,r.sphere.center),n.set(ig),Vi.fromRT(ng,e,ig),ng}function fg(t,e,i){var n=e.direction,r=t.normal,a=t.distance+.001,o=1/Ri.dot(r,n),s=n.x*o,l=n.y*o,c=n.z*o,h=r.x,u=r.y,_=r.z,f=t.matLight;f.m00=1-h*s,f.m01=-h*l,f.m02=-h*c,f.m03=0,f.m04=-u*s,f.m05=1-u*l,f.m06=-u*c,f.m07=0,f.m08=-_*s,f.m09=-_*l,f.m10=1-_*c,f.m11=0,f.m12=s*a,f.m13=l*a,f.m14=c*a,f.m15=1,Vi.toArray(i,f,Zc.MAT_LIGHT_PLANE_PROJ_OFFSET)}var dg=[to.LINEAR,to.LINEAR,to.NONE,eo.CLAMP,eo.CLAMP,eo.CLAMP],pg=new u_((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),mg=new Float32Array(4),vg=La.create(0,0,0,1),gg=[],yg=[],Tg=new Vi,Sg=new Vi;function Eg(t,e){return!(!e.worldBounds||Kl.aabbWithAABB(e.worldBounds,t.aabb))}function Ag(t,e){return!(!e.worldBounds||Kl.aabbWithAABB(e.worldBounds,t.aabb)&&Kl.aabbFrustum(e.worldBounds,t.frustum))}var bg=Qd("forward-add"),xg=[];function Cg(t,e){e.length=0;for(var i=!1,n=0;n<t.length;n++){for(var r=t[n].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===bg){a=o,i=!0;break}e.push(a)}return i}var wg,Rg,Ig,Og,Pg,Mg,Dg,Ng,Lg,Bg,Fg,zg,Ug,kg,Gg,Hg,Vg,Wg,jg,qg,Xg,Yg,Kg,Zg,Qg,Jg,$g,ty,ey,iy,ny,ry,ay,oy,sy,ly,cy,hy,uy,_y,fy,dy,py,my,vy,gy,yy,Ty,Sy,Ey,Ay,by,xy,Cy,wy,Ry,Iy,Oy,Py,My,Dy,Ny,Ly,By,Fy,zy,Uy,ky,Gy,Hy,Vy,Wy,jy,qy,Xy,Yy,Ky,Zy,Qy,Jy,$y=function(){function t(t){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._descriptorSetMap=new Map,this._globalUBO=new Float32Array(Yc.COUNT),this._cameraUBO=new Float32Array(Kc.COUNT),this._shadowUBO=new Float32Array(Zc.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._isHDR=void 0,this._fpScale=void 0,this._renderObjects=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._sampler=null,this._pipeline=t,this._device=t.device,this._isHDR=t.isHDR,this._fpScale=t.fpScale,this._renderObjects=t.renderObjects,this._instancedQueue=new Jv,this._batchedQueue=new Qv,this._lightBufferStride=Math.ceil(lh.SIZE/this._device.uboOffsetAlignment)*this._device.uboOffsetAlignment,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new Lo(this._lightBuffer,0,lh.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount);var e=Y_(dg);this._sampler=lf.getSampler(this._device,e)}var e=t.prototype;return e.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var t=0;t<this._lightPasses.length;t++){var e=this._lightPasses[t];e.dynamicOffsets.length=0,e.lights.length=0}pg.freeArray(this._lightPasses),this._lightPasses.length=0},e.destroy=function(){for(var t=Array.from(this._descriptorSetMap.values()),e=0;e<t.length;++e){var i=t[e];i&&(i.getBuffer(Yc.BINDING).destroy(),i.getBuffer(Zc.BINDING).destroy(),i.getSampler(Qc).destroy(),i.getSampler(nh).destroy(),i.getTexture(Qc).destroy(),i.getTexture(nh).destroy(),i.destroy())}this._descriptorSetMap.clear()},e.gatherLightPasses=function(t,e){var i=this._validLights;if(this.clear(),this._gatherValidLights(t,i),i.length){this._updateUBOs(t,e),this._updateLightDescriptorSet(t,e);for(var n=0;n<this._renderObjects.length;n++){var r=this._renderObjects[n].model,a=r.subModels;if(Cg(a,xg)&&(yg.length=0,this._lightCulling(r,i),yg.length))for(var o=0;o<a.length;o++){var s=xg[o];if(!(s<0)){var l=a[o],c=l.passes[s];l.descriptorSet.bindBuffer(lh.BINDING,this._firstLightBufferView),l.descriptorSet.update(),this._addRenderQueue(c,l,r,s,i)}}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)}},e.recordCommandBuffer=function(t,e,i){this._instancedQueue.recordCommandBuffer(t,e,i),this._batchedQueue.recordCommandBuffer(t,e,i);for(var n=0;n<this._lightPasses.length;n++){var r=this._lightPasses[n],a=r.subModel,o=r.passIdx,s=r.dynamicOffsets,l=r.lights,c=kn.get(ar.get(a.handle,tr.SHADER_0+o)),h=a.passes[o],u=a.inputAssembler,_=Xv.getOrCreatePipelineState(t,h,c,e,u),f=Gn.get(ir.get(h.handle,Un.DESCRIPTOR_SET)),d=a.descriptorSet;i.bindPipelineState(_),i.bindDescriptorSet(Wc.MATERIAL,f),i.bindInputAssembler(u);for(var p=0;p<s.length;++p){var m=l[p],v=this._getOrCreateDescriptorSet(m);gg[0]=s[p],i.bindDescriptorSet(Wc.GLOBAL,v),i.bindDescriptorSet(Wc.LOCAL,d,gg),i.draw(u)}}},e._gatherValidLights=function(t,e){for(var i=t.scene.sphereLights,n=0;n<i.length;n++){var r=i[n];r.baked||(La.set(vg,r.position.x,r.position.y,r.position.z,r.range),Kl.sphereFrustum(vg,t.frustum)&&(e.push(r),this._getOrCreateDescriptorSet(r)))}for(var a=t.scene.spotLights,o=0;o<a.length;o++){var s=a[o];s.baked||(La.set(vg,s.position.x,s.position.y,s.position.z,s.range),Kl.sphereFrustum(vg,t.frustum)&&(e.push(s),this._getOrCreateDescriptorSet(s)))}},e._lightCulling=function(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=!1;switch(n.type){case np.SPHERE:r=Eg(n,t);break;case np.SPOT:r=Ag(n,t)}r||yg.push(i)}},e._addRenderQueue=function(t,e,i,n,r){var a=t.batchingScheme;if(a===Xd.INSTANCING)for(var o=0;o<yg.length;o++){var s=yg[o],l=fp.get(t,s);l.merge(e,i.instancedAttributes,n),l.dynamicOffsets[0]=this._lightBufferStride*s,this._instancedQueue.queue.add(l)}else if(a===Xd.VB_MERGING)for(var c=0;c<yg.length;c++){var h=yg[c],u=$v.get(t,h);u.merge(e,n,i),u.dynamicOffsets[0]=this._lightBufferStride*h,this._batchedQueue.queue.add(u)}else{var _=pg.alloc();_.subModel=e,_.passIdx=n;for(var f=0;f<yg.length;f++){var d=yg[f];_.lights.push(r[d]),_.dynamicOffsets.push(this._lightBufferStride*d)}this._lightPasses.push(_)}},e._updateLightDescriptorSet=function(t,e){for(var i=this._pipeline.shadows,n=t.scene.mainLight,r=0;r<this._validLights.length;r++){var a=this._validLights[r],o=this._getOrCreateDescriptorSet(a);if(o){switch(this._updateGlobalDescriptorSet(t,e),a.type){case np.SPHERE:n&&fg(i,n,this._shadowUBO),Ci.toArray(this._shadowUBO,i.shadowColor,Zc.SHADOW_COLOR_OFFSET),this._shadowUBO[Zc.SHADOW_INFO_OFFSET+0]=i.size.x,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+3]=i.bias;break;case np.SPOT:if(n&&fg(i,n,this._shadowUBO),Vi.invert(Tg,a.node.getWorldMatrix()),Vi.perspective(Sg,a.spotAngle,a.aspect,.001,a.range),Vi.multiply(Sg,Sg,Tg),Vi.toArray(this._shadowUBO,Sg,Zc.MAT_LIGHT_VIEW_PROJ_OFFSET),Ci.toArray(this._shadowUBO,i.shadowColor,Zc.SHADOW_COLOR_OFFSET),this._shadowUBO[Zc.SHADOW_INFO_OFFSET+0]=i.size.x,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+3]=i.bias,this._pipeline.shadowFrameBufferMap.has(a)&&this._pipeline.shadowFrameBufferMap.has(a)){var s,l=null===(s=this._pipeline.shadowFrameBufferMap.get(a))||void 0===s?void 0:s.colorTextures[0];l&&o.bindTexture(nh,l)}}o.update(),e.updateBuffer(o.getBuffer(Yc.BINDING),this._globalUBO),e.updateBuffer(o.getBuffer(Kc.BINDING),this._cameraUBO),e.updateBuffer(o.getBuffer(Zc.BINDING),this._shadowUBO)}}},e._updateGlobalDescriptorSet=function(t){var e=n.director.root,i=this._pipeline.device,r=this._globalUBO,a=Math.floor(i.width),o=Math.floor(i.height);r[Yc.TIME_OFFSET]=e.cumulativeTime,r[Yc.TIME_OFFSET+1]=e.frameTime,r[Yc.TIME_OFFSET+2]=n.director.getTotalFrames(),r[Yc.SCREEN_SIZE_OFFSET]=i.width,r[Yc.SCREEN_SIZE_OFFSET+1]=i.height,r[Yc.SCREEN_SIZE_OFFSET+2]=1/i.width,r[Yc.SCREEN_SIZE_OFFSET+3]=1/i.height,r[Yc.NATIVE_SIZE_OFFSET]=a,r[Yc.NATIVE_SIZE_OFFSET+1]=o,r[Yc.NATIVE_SIZE_OFFSET+2]=1/r[Yc.NATIVE_SIZE_OFFSET],r[Yc.NATIVE_SIZE_OFFSET+3]=1/r[Yc.NATIVE_SIZE_OFFSET+1],this._updateCameraUBO(t)},e._updateCameraUBO=function(t){var e=this._pipeline,i=t.scene.mainLight,n=e.ambient,r=e.shadingScale,a=this._pipeline.device,o=Math.floor(a.width),s=Math.floor(a.height),l=e.fog,c=this._cameraUBO;c[Kc.SCREEN_SCALE_OFFSET]=t.width/o*r,c[Kc.SCREEN_SCALE_OFFSET+1]=t.height/s*r,c[Kc.SCREEN_SCALE_OFFSET+2]=1/c[Kc.SCREEN_SCALE_OFFSET],c[Kc.SCREEN_SCALE_OFFSET+3]=1/c[Kc.SCREEN_SCALE_OFFSET+1];var h=t.exposure;if(c[Kc.EXPOSURE_OFFSET]=h,c[Kc.EXPOSURE_OFFSET+1]=1/h,c[Kc.EXPOSURE_OFFSET+2]=this._isHDR?1:0,c[Kc.EXPOSURE_OFFSET+3]=this._fpScale/h,i){if(Ri.toArray(c,i.direction,Kc.MAIN_LIT_DIR_OFFSET),Ri.toArray(c,i.color,Kc.MAIN_LIT_COLOR_OFFSET),i.useColorTemperature){var u=i.colorTemperatureRGB;c[Kc.MAIN_LIT_COLOR_OFFSET]*=u.x,c[Kc.MAIN_LIT_COLOR_OFFSET+1]*=u.y,c[Kc.MAIN_LIT_COLOR_OFFSET+2]*=u.z}this._isHDR?c[Kc.MAIN_LIT_COLOR_OFFSET+3]=i.illuminance*this._fpScale:c[Kc.MAIN_LIT_COLOR_OFFSET+3]=i.illuminance*h}else Ri.toArray(c,Ri.UNIT_Z,Kc.MAIN_LIT_DIR_OFFSET),Qi.toArray(c,Qi.ZERO,Kc.MAIN_LIT_COLOR_OFFSET);Vi.toArray(c,t.matView,Kc.MAT_VIEW_OFFSET),Vi.toArray(c,t.node.worldMatrix,Kc.MAT_VIEW_INV_OFFSET),Vi.toArray(c,t.matProj,Kc.MAT_PROJ_OFFSET),Vi.toArray(c,t.matProjInv,Kc.MAT_PROJ_INV_OFFSET),Vi.toArray(c,t.matViewProj,Kc.MAT_VIEW_PROJ_OFFSET),Vi.toArray(c,t.matViewProjInv,Kc.MAT_VIEW_PROJ_INV_OFFSET),Ri.toArray(c,t.position,Kc.CAMERA_POS_OFFSET);var _=a.screenSpaceSignY;t.window.hasOffScreenAttachments&&(_*=a.UVSpaceSignY),c[Kc.CAMERA_POS_OFFSET+3]=_;var f=n.colorArray;this._isHDR?f[3]=n.skyIllum*this._fpScale:f[3]=n.skyIllum*h,c.set(f,Kc.AMBIENT_SKY_OFFSET),c.set(n.albedoArray,Kc.AMBIENT_GROUND_OFFSET),c.set(l.colorArray,Kc.GLOBAL_FOG_COLOR_OFFSET),c[Kc.GLOBAL_FOG_BASE_OFFSET]=l.fogStart,c[Kc.GLOBAL_FOG_BASE_OFFSET+1]=l.fogEnd,c[Kc.GLOBAL_FOG_BASE_OFFSET+2]=l.fogDensity,c[Kc.GLOBAL_FOG_ADD_OFFSET]=l.fogTop,c[Kc.GLOBAL_FOG_ADD_OFFSET+1]=l.fogRange,c[Kc.GLOBAL_FOG_ADD_OFFSET+2]=l.fogAtten},e._updateUBOs=function(t,e){var i=t.exposure;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=Ti(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new Lo(this._lightBuffer,0,lh.SIZE)));for(var n=0,r=0;n<this._validLights.length;n++,r+=this._lightBufferElementCount){var a=this._validLights[n];switch(a.type){case np.SPHERE:if(Ri.toArray(mg,a.position),mg[3]=0,this._lightBufferData.set(mg,r+lh.LIGHT_POS_OFFSET),mg[0]=a.size,mg[1]=a.range,mg[2]=0,this._lightBufferData.set(mg,r+lh.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Ri.toArray(mg,a.color),a.useColorTemperature){var o=a.colorTemperatureRGB;mg[0]*=o.x,mg[1]*=o.y,mg[2]*=o.z}this._isHDR?mg[3]=a.luminance*this._fpScale*this._lightMeterScale:mg[3]=a.luminance*i*this._lightMeterScale,this._lightBufferData.set(mg,r+lh.LIGHT_COLOR_OFFSET);break;case np.SPOT:if(Ri.toArray(mg,a.position),mg[3]=1,this._lightBufferData.set(mg,r+lh.LIGHT_POS_OFFSET),mg[0]=a.size,mg[1]=a.range,mg[2]=a.spotAngle,this._lightBufferData.set(mg,r+lh.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Ri.toArray(mg,a.direction),this._lightBufferData.set(mg,r+lh.LIGHT_DIR_OFFSET),Ri.toArray(mg,a.color),a.useColorTemperature){var s=a.colorTemperatureRGB;mg[0]*=s.x,mg[1]*=s.y,mg[2]*=s.z}this._isHDR?mg[3]=a.luminance*this._fpScale*this._lightMeterScale:mg[3]=a.luminance*i*this._lightMeterScale,this._lightBufferData.set(mg,r+lh.LIGHT_COLOR_OFFSET)}}e.updateBuffer(this._lightBuffer,this._lightBufferData)},e._getOrCreateDescriptorSet=function(t){if(!this._descriptorSetMap.has(t)){var e=this._device,i=e.createDescriptorSet(new Ds(this._pipeline.descriptorSetLayout)),n=e.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Yc.SIZE,Yc.SIZE));i.bindBuffer(Yc.BINDING,n);var r=e.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Kc.SIZE,Kc.SIZE));i.bindBuffer(Kc.BINDING,r);var a=e.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Zc.SIZE,Zc.SIZE));return i.bindBuffer(Zc.BINDING,a),i.bindSampler(Qc,this._sampler),i.bindTexture(Qc,Zd.get("default-texture").getGFXTexture()),i.bindSampler(nh,this._sampler),i.bindTexture(nh,Zd.get("default-texture").getGFXTexture()),i.update(),this._descriptorSetMap.set(t,i),i}return this._descriptorSetMap.get(t)},t}();fe(io),fe(no),fe(ho),fe(co),fe(uo),function(t){t[t.SCENE=0]="SCENE",t[t.POSTPROCESS=1]="POSTPROCESS",t[t.UI=2]="UI"}(Jy||(Jy={})),fe(Jy),wg=ru("RenderTextureDesc"),Rg=Fu(io),Ig=Fu(no),Og=Fu(ka),wg((Mg=$((Pg=function(){J(this,"name",Mg,this),J(this,"type",Dg,this),J(this,"usage",Ng,this),J(this,"format",Lg,this),J(this,"width",Bg,this),J(this,"height",Fg,this)}).prototype,"name",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dg=$(Pg.prototype,"type",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return io.TEX2D}}),Ng=$(Pg.prototype,"usage",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return no.COLOR_ATTACHMENT}}),Lg=$(Pg.prototype,"format",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ka.UNKNOWN}}),Bg=$(Pg.prototype,"width",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Fg=$(Pg.prototype,"height",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Pg));var tT,eT=(zg=ru("RenderTextureConfig"),Ug=Fu(im),zg((Hg=$((Gg=function(){J(this,"name",Hg,this),J(this,"texture",Vg,this)}).prototype,"name",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vg=$(Gg.prototype,"texture",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kg=Gg))||kg),iT=(Wg=ru("MaterialConfig"),jg=Fu(nm),Wg((Yg=$((Xg=function(){J(this,"name",Yg,this),J(this,"material",Kg,this)}).prototype,"name",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kg=$(Xg.prototype,"material",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qg=Xg))||qg),nT=(Zg=ru("FrameBufferDesc"),Qg=Fu([Ue]),Jg=Fu(im),Zg((ty=$(($g=function(){J(this,"name",ty,this),J(this,"renderPass",ey,this),J(this,"colorTextures",iy,this),J(this,"depthStencilTexture",ny,this),J(this,"texture",ry,this)}).prototype,"name",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ey=$($g.prototype,"renderPass",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iy=$($g.prototype,"colorTextures",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ny=$($g.prototype,"depthStencilTexture",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ry=$($g.prototype,"texture",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$g)),ay=ru("ColorDesc"),oy=Fu(ka),sy=Fu(co),ly=Fu(ho),cy=Fu(uo),hy=Fu(uo),ay((fy=$((_y=function(){J(this,"format",fy,this),J(this,"loadOp",dy,this),J(this,"storeOp",py,this),J(this,"sampleCount",my,this),J(this,"beginLayout",vy,this),J(this,"endLayout",gy,this)}).prototype,"format",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ka.UNKNOWN}}),dy=$(_y.prototype,"loadOp",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return co.CLEAR}}),py=$(_y.prototype,"storeOp",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ho.STORE}}),my=$(_y.prototype,"sampleCount",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vy=$(_y.prototype,"beginLayout",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uo.UNDEFINED}}),gy=$(_y.prototype,"endLayout",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uo.PRESENT_SRC}}),uy=_y))||uy),rT=(yy=ru("DepthStencilDesc"),Ty=Fu(ka),Sy=Fu(co),Ey=Fu(ho),Ay=Fu(co),by=Fu(ho),xy=Fu(uo),Cy=Fu(uo),yy((Iy=$((Ry=function(){J(this,"format",Iy,this),J(this,"depthLoadOp",Oy,this),J(this,"depthStoreOp",Py,this),J(this,"stencilLoadOp",My,this),J(this,"stencilStoreOp",Dy,this),J(this,"sampleCount",Ny,this),J(this,"beginLayout",Ly,this),J(this,"endLayout",By,this)}).prototype,"format",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ka.UNKNOWN}}),Oy=$(Ry.prototype,"depthLoadOp",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return co.CLEAR}}),Py=$(Ry.prototype,"depthStoreOp",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ho.STORE}}),My=$(Ry.prototype,"stencilLoadOp",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return co.CLEAR}}),Dy=$(Ry.prototype,"stencilStoreOp",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ho.STORE}}),Ny=$(Ry.prototype,"sampleCount",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ly=$(Ry.prototype,"beginLayout",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uo.UNDEFINED}}),By=$(Ry.prototype,"endLayout",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uo.DEPTH_STENCIL_ATTACHMENT_OPTIMAL}}),wy=Ry))||wy);Fy=ru("RenderPassDesc"),zy=Fu([nT]),Uy=Fu(rT),Fy((Gy=$((ky=function(){J(this,"index",Gy,this),J(this,"colorAttachments",Hy,this),J(this,"depthStencilAttachment",Vy,this)}).prototype,"index",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Hy=$(ky.prototype,"colorAttachments",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vy=$(ky.prototype,"depthStencilAttachment",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rT}}),ky)),function(t){t[t.FRONT_TO_BACK=0]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(tT||(tT={})),fe(tT);var aT,oT,sT,lT,cT,hT,uT,_T,fT,dT,pT,mT=(Wy=ru("RenderQueueDesc"),jy=Fu(tT),qy=Fu([Ue]),Wy((Ky=$((Yy=function(){J(this,"isTransparent",Ky,this),J(this,"sortMode",Zy,this),J(this,"stages",Qy,this)}).prototype,"isTransparent",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zy=$(Yy.prototype,"sortMode",[jy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tT.FRONT_TO_BACK}}),Qy=$(Yy.prototype,"stages",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xy=Yy))||Xy),vT=new sc,gT=function(){function t(t){this._pendingModels=[],this._instancedQueue=new Jv,this._pipeline=void 0,this._pipeline=t}var e=t.prototype;return e.gatherShadowPasses=function(t,e){var i=this._pipeline.shadows;if(this._instancedQueue.clear(),this._pendingModels.length=0,i.enabled&&i.type===rm.Planar){this._pipeline.updateShadowUBO(t);var n=t.scene,r=t.frustum,a=0!=(t.visibility&Fc.BitMask.DEFAULT);if(n.mainLight&&a){var o=this._pipeline.renderObjects,s=fp.get(i.instancingMaterial.passes[0]);this._instancedQueue.queue.add(s);for(var l=0;l<o.length;l++){var c=o[l].model;if(c.enabled&&c.node&&c.castShadow&&(!c.worldBounds||(sc.transform(vT,c.worldBounds,i.matLight),Kl.aabbFrustum(vT,r))))if(c.isInstancingEnabled)for(var h=c.subModels,u=0;u<h.length;u++){var _=h[u];s.merge(_,c.instancedAttributes,0,_.planarInstanceShaderHandle)}else this._pendingModels.push(c)}this._instancedQueue.uploadBuffers(e)}}},e.recordCommandBuffer=function(t,e,i){var n=this._pipeline.shadows;if(n.enabled&&n.type===rm.Planar&&(this._instancedQueue.recordCommandBuffer(t,e,i),this._pendingModels.length)){var r=n.material.passes[0],a=Gn.get(ir.get(r.handle,Un.DESCRIPTOR_SET));i.bindDescriptorSet(Wc.MATERIAL,a);for(var o=this._pendingModels.length,s=0;s<o;s++)for(var l=this._pendingModels[s],c=0;c<l.subModels.length;c++){var h=l.subModels[c],u=kn.get(h.planarShaderHandle),_=h.inputAssembler,f=Xv.getOrCreatePipelineState(t,r,u,e,_);i.bindPipelineState(f),i.bindDescriptorSet(Wc.LOCAL,h.descriptorSet),i.bindInputAssembler(_),i.draw(_)}}},t}(),yT=function(){function t(){this._phaseID=Qd("default")}var e=t.prototype;return e.activate=function(t){this._pipeline=t},e.render=function(t,e){for(var i=this._pipeline,n=i.device,r=i.commandBuffers[0],a=t.scene.batches,o=0;o<a.length;o++){var s=a[o],l=!1;if(t.visibility&s.visFlags&&(l=!0),l)for(var c=s.handle,h=ur.get(c,or.PASS_COUNT),u=0;u<h;u++){var _=s.passes[u];if(_.phase===this._phaseID){var f=ur.get(c,or.SHADER_0+u),d=kn.get(f),p=Hn.get(s.hInputAssembler),m=Gn.get(s.hDescriptorSet),v=Xv.getOrCreatePipelineState(n,_,d,e,p);r.bindPipelineState(v),r.bindDescriptorSet(Wc.MATERIAL,_.descriptorSet),r.bindDescriptorSet(Wc.LOCAL,m),r.bindInputAssembler(p),r.draw(p)}}}},t}(),TT=[new Jo(0,0,0,1)],ST=t("ForwardStage",(aT=ru("ForwardStage"),oT=Fu([mT]),sT=Ru(),aT((_T=uT=function(t){function e(){var e;return J(e=t.call(this)||this,"renderQueues",hT,K(e)),e._renderQueues=[],e._renderArea=new Zo,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Qd("default"),e._clearFlag=4294967295,e._batchedQueue=new Qv,e._instancedQueue=new Jv,e._uiPhase=new yT,e}Y(e,t);var i=e.prototype;return i.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},i.activate=function(e,i){t.prototype.activate.call(this,e,i);for(var n=0;n<this.renderQueues.length;n++){for(var r=0,a=0;a<this.renderQueues[n].stages.length;a++)r|=Qd(this.renderQueues[n].stages[a]);var o=Yv;switch(this.renderQueues[n].sortMode){case tT.BACK_TO_FRONT:o=Kv;break;case tT.FRONT_TO_BACK:o=Yv}this._renderQueues[n]=new Zv({isTransparent:this.renderQueues[n].isTransparent,phases:r,sortFunc:o})}this._additiveLightQueue=new $y(this._pipeline),this._planarQueue=new gT(this._pipeline),this._uiPhase.activate(e)},i.destroy=function(){},i.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,i=e.device;this._renderQueues.forEach(this.renderQueueClearFunc);for(var n=e.renderObjects,r=0,a=0,o=0,s=0;s<n.length;++s){var l=n[s],c=l.model.subModels;for(r=0;r<c.length;++r){var h=c[r],u=h.passes;for(a=0;a<u.length;++a){var _=u[a];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===Xd.INSTANCING){var d=fp.get(_);d.merge(h,l.model.instancedAttributes,a),this._instancedQueue.queue.add(d)}else if(f===Xd.VB_MERGING){var p=$v.get(_);p.merge(h,a,l.model),this._batchedQueue.queue.add(p)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(l,r,a)}}}}this._renderQueues.forEach(this.renderQueueSortFunc);var m=e.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(t,m),this._planarQueue.gatherShadowPasses(t,m);var v,g,y=t.viewport,T=t.window.hasOnScreenAttachments&&i.surfaceTransform%2?t.height:t.width,S=t.window.hasOnScreenAttachments&&i.surfaceTransform%2?t.width:t.height;if(this._renderArea.x=y.x*T,this._renderArea.y=y.y*S,this._renderArea.width=y.width*T*e.shadingScale,this._renderArea.height=y.height*S*e.shadingScale,t.clearFlag&vo.COLOR)if(e.isHDR){v=TT[0],g=t.clearColor,v.x=g.x*g.x,v.y=g.y*g.y,v.z=g.z*g.z;var E=e.fpScale/t.exposure;TT[0].x*=E,TT[0].y*=E,TT[0].z*=E}else TT[0].x=t.clearColor.x,TT[0].y=t.clearColor.y,TT[0].z=t.clearColor.z;TT[0].w=t.clearColor.w;var A=t.window.framebuffer,b=A.colorTextures[0]?A.renderPass:e.getRenderPass(t.clearFlag&this._clearFlag);m.beginRenderPass(b,A,this._renderArea,TT,t.clearDepth,t.clearStencil),m.bindDescriptorSet(Wc.GLOBAL,e.descriptorSet),this._renderQueues[0].recordCommandBuffer(i,b,m),this._instancedQueue.recordCommandBuffer(i,b,m),this._batchedQueue.recordCommandBuffer(i,b,m),this._additiveLightQueue.recordCommandBuffer(i,b,m),this._planarQueue.recordCommandBuffer(i,b,m),this._renderQueues[1].recordCommandBuffer(i,b,m),this._uiPhase.render(t,b),m.endRenderPass()},i.renderQueueClearFunc=function(t){t.clear()},i.renderQueueSortFunc=function(t){t.sort()},e}(Dv),uT.initInfo={name:"ForwardStage",priority:Wv.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:tT.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:tT.BACK_TO_FRONT,stages:["default","planarShadow"]}]},hT=$((cT=_T).prototype,"renderQueues",[oT,cu,sT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lT=cT))||lT)),ET=t("ForwardFlow",ru("ForwardFlow")((pT=dT=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var i=new ST;i.initialize(ST.initInfo),this._stages.push(i)}return!0},i.activate=function(e){t.prototype.activate.call(this,e)},i.render=function(e){(function(t,e){var i=e.scene,n=i.mainLight,r=t.shadows,a=t.renderObjects;lg.freeArray(a),a.length=0,r.enabled&&Ci.toArray(t.shadowUBO,r.shadowColor,Zc.SHADOW_COLOR_OFFSET),n&&r.type===rm.Planar&&function(t,e){var i=t.shadows,n=e.direction,r=i.normal,a=i.distance+.001,o=1/Ri.dot(r,n),s=n.x*o,l=n.y*o,c=n.z*o,h=r.x,u=r.y,_=r.z,f=i.matLight;f.m00=1-h*s,f.m01=-h*l,f.m02=-h*c,f.m03=0,f.m04=-u*s,f.m05=1-u*l,f.m06=-u*c,f.m07=0,f.m08=-_*s,f.m09=-_*l,f.m10=1-_*c,f.m11=0,f.m12=s*a,f.m13=l*a,f.m14=c*a,f.m15=1,Vi.toArray(t.shadowUBO,i.matLight,Zc.MAT_LIGHT_PLANE_PROJ_OFFSET)}(t,n),t.skybox.enabled&&t.skybox.model&&e.clearFlag&Xh&&a.push(hg(t.skybox.model,e));for(var o=i.models,s=0;s<o.length;s++){var l=o[s];if(l.enabled&&(l.node&&(e.visibility&l.node.layer)===l.node.layer||e.visibility&l.visFlags)){if(l.worldBounds&&!Kl.aabbFrustum(l.worldBounds,e.frustum))continue;a.push(hg(l,e))}}})(this._pipeline,e),t.prototype.render.call(this,e)},i.destroy=function(){t.prototype.destroy.call(this)},e}(Vv),dT.initInfo={name:"ForwardFlow",priority:jv.FORWARD,stages:[]},fT=pT))||fT),AT=new Vi,bT=new Vi,xT=new Qi,CT=new Ri,wT=new Vi,RT=Qd("shadow-caster"),IT=[];function OT(t,e){e.length=0;for(var i=!1,n=0;n<t.length;n++){for(var r=t[n].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===RT){a=o,i=!0;break}e.push(a)}return i}var PT,MT,DT,NT,LT,BT,FT,zT,UT,kT,GT,HT,VT,WT,jT,qT,XT=function(){function t(t){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._shadowMapBuffer=void 0,this._device=void 0,this._shadowInfo=void 0,this._descriptorSet=void 0,this._shadowObjects=void 0,this._shadowUBO=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=t,this._device=t.device,this._shadowInfo=t.shadows,this._descriptorSet=t.descriptorSet,this._shadowObjects=t.shadowObjects,this._shadowUBO=t.shadowUBO,this._shadowMapBuffer=t.descriptorSet.getBuffer(Zc.BINDING),this._instancedQueue=new Jv,this._batchedQueue=new Qv}var e=t.prototype;return e.gatherLightPasses=function(t,e){if(this.clear(),t&&this._shadowInfo.enabled&&this._shadowInfo.type===rm.ShadowMap){this._updateUBOs(t);for(var i=0;i<this._shadowObjects.length;i++){var n=this._shadowObjects[i].model;if(OT(n.subModels,IT))switch(t.type){case np.DIRECTIONAL:this.add(n,e,IT);break;case np.SPOT:if(n.worldBounds&&(!Kl.aabbWithAABB(n.worldBounds,t.aabb)||!Kl.aabbFrustum(n.worldBounds,t.frustum)))continue;this.add(n,e,IT)}}}},e.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},e.add=function(t,e,i){for(var n=t.subModels,r=0;r<n.length;r++){var a=n[r],o=i[r],s=a.passes[o],l=s.batchingScheme;if(a.descriptorSet.bindBuffer(Zc.BINDING,this._shadowMapBuffer),a.descriptorSet.update(),l===Xd.INSTANCING){var c=fp.get(s);c.merge(a,t.instancedAttributes,o),this._instancedQueue.queue.add(c)}else if(s.batchingScheme===Xd.VB_MERGING){var h=$v.get(s);h.merge(a,o,t),this._batchedQueue.queue.add(h)}else{var u=kn.get(ar.get(a.handle,tr.SHADER_0+o));this._subModelsArray.push(a),this._shaderArray.push(u),this._passArray.push(s)}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)},e.recordCommandBuffer=function(t,e,i){this._instancedQueue.recordCommandBuffer(t,e,i),this._batchedQueue.recordCommandBuffer(t,e,i);for(var n=0;n<this._subModelsArray.length;++n){var r=this._subModelsArray[n],a=this._shaderArray[n],o=this._passArray[n],s=r.inputAssembler,l=Xv.getOrCreatePipelineState(t,o,a,e,s),c=o.descriptorSet;i.bindPipelineState(l),i.bindDescriptorSet(Wc.MATERIAL,c),i.bindDescriptorSet(Wc.LOCAL,r.descriptorSet),i.bindInputAssembler(s),i.draw(s)}},e._updateUBOs=function(t){var e=0,i=0,n=0;switch(t.type){case np.DIRECTIONAL:if(t.update(),this._shadowInfo.autoAdapt){var r=t.node;r&&(wT=_g(this._pipeline,r.getWorldRotation(),t.direction,CT));var a=this._shadowInfo.sphere.radius;e=a*this._shadowInfo.aspect,i=a;var o=Ri.distance(this._shadowInfo.sphere.center,CT);n=Math.min(o*sm.COEFFICIENT_OF_EXPANSION,sm.MAX_FAR)}else wT=t.node.getWorldMatrix(),e=this._shadowInfo.orthoSize*this._shadowInfo.aspect,i=this._shadowInfo.orthoSize,n=this._shadowInfo.far;Vi.invert(AT,wT),Vi.ortho(bT,-e,e,-i,i,this._shadowInfo.near,n,this._device.clipSpaceMinZ,this._device.screenSpaceSignY*this._device.UVSpaceSignY);break;case np.SPOT:Vi.invert(AT,t.node.getWorldMatrix()),Vi.perspective(bT,t.spotAngle,t.aspect,.001,t.range)}Vi.multiply(bT,bT,AT),Vi.toArray(this._shadowUBO,bT,Zc.MAT_LIGHT_VIEW_PROJ_OFFSET),Ci.toArray(this._shadowUBO,this._shadowInfo.shadowColor,Zc.SHADOW_COLOR_OFFSET),xT.set(this._shadowInfo.size.x,this._shadowInfo.size.y,this._shadowInfo.pcf,this._shadowInfo.bias),Qi.toArray(this._shadowUBO,xT,Zc.SHADOW_INFO_OFFSET),this._descriptorSet.getBuffer(Zc.BINDING).update(this._shadowUBO)},t}(),YT=[new Jo(1,1,1,1)],KT=t("ShadowStage",ru("ShadowStage")((DT=MT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._shadowFrameBuffer=null,e._renderArea=new Zo,e._light=null,e}Y(e,t);var i=e.prototype;return i.setUsage=function(t,e){this._light=t,this._shadowFrameBuffer=e},i.destroy=function(){this._additiveShadowQueue.clear()},i.clearFramebuffer=function(t){if(this._light&&this._shadowFrameBuffer){YT[0].w=t.clearColor.w;var e=this._pipeline.commandBuffers[0],i=this._shadowFrameBuffer.renderPass;e.beginRenderPass(i,this._shadowFrameBuffer,this._renderArea,YT,t.clearDepth,t.clearStencil),e.endRenderPass()}},i.render=function(t){var e=this._pipeline,i=e.shadows,n=e.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,n);var r=t.viewport,a=i.size;this._renderArea.x=r.x*a.x,this._renderArea.y=r.y*a.y,this._renderArea.width=r.width*a.x*e.shadingScale,this._renderArea.height=r.height*a.y*e.shadingScale;var o=e.device,s=this._shadowFrameBuffer.renderPass;n.beginRenderPass(s,this._shadowFrameBuffer,this._renderArea,YT,t.clearDepth,t.clearStencil),n.bindDescriptorSet(Wc.GLOBAL,e.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(o,s,n),n.endRenderPass()}},i.activate=function(e,i){t.prototype.activate.call(this,e,i),this._additiveShadowQueue=new XT(e)},e}(Dv),MT.initInfo={name:"ShadowStage",priority:Wv.FORWARD,tag:0},PT=DT))||PT),ZT=t("ShadowFlow",ru("ShadowFlow")((BT=LT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._shadowRenderPass=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var i=new KT;i.initialize(KT.initInfo),this._stages.push(i)}return!0},i.render=function(t){var e=this._pipeline,i=e.shadows;if(i.enabled&&i.type===rm.ShadowMap){var n=function(t,e){og.length=0;var i=t.scene;og.push(i.mainLight);for(var n=i.spotLights,r=0;r<n.length;r++){var a=n[r];La.set(sg,a.position.x,a.position.y,a.position.z,a.range),Kl.sphereFrustum(sg,t.frustum)&&e>og.length&&og.push(a)}return og}(t,i.maxReceived);if(function(t,e){var i=e.scene,n=t.shadows,r=t.shadowObjects;cg.freeArray(r),r.length=0,ag=!1;for(var a=i.models,o=0;o<a.length;o++){var s=a[o];(s.node&&(e.visibility&s.node.layer)===s.node.layer||e.visibility&s.visFlags)&&s.castShadow&&s.worldBounds&&(ag||(rg.copy(s.worldBounds),ag=!0),sc.merge(rg,rg,s.worldBounds),r.push(ug(s,e)))}rg&&sc.toBoundingSphere(n.sphere,rg)}(e,t),0!==e.shadowObjects.length){for(var r=0;r<n.length;r++){var a=n[r];e.shadowFrameBufferMap.has(a)||this._initShadowFrameBuffer(e,a);var o=e.shadowFrameBufferMap.get(a);i.shadowMapDirty&&this.resizeShadowMap(a,i.size);for(var s=0;s<this._stages.length;s++){var l=this._stages[s];l.setUsage(a,o),l.render(t)}}e.updateShadowUBO(t)}else this.clearShadowMap(n,t)}},i.destroy=function(){t.prototype.destroy.call(this);for(var e=Array.from(this._pipeline.shadowFrameBufferMap.values()),i=0;i<e.length;i++){var n=e[i];if(n){for(var r=n.colorTextures,a=0;a<r.length;a++){var o=r[i];o&&o.destroy()}r.length=0;var s=n.depthStencilTexture;s&&s.destroy(),n.destroy()}}this._pipeline.shadowFrameBufferMap.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy()},i._initShadowFrameBuffer=function(t,e){var i=t.device,n=t.shadows.size;if(!this._shadowRenderPass){var r=new fs;r.format=ka.RGBA8,r.loadOp=co.CLEAR,r.storeOp=ho.STORE,r.sampleCount=1,r.beginLayout=uo.UNDEFINED,r.endLayout=uo.PRESENT_SRC;var a=new ds;a.format=i.depthStencilFormat,a.depthLoadOp=co.CLEAR,a.depthStoreOp=ho.DISCARD,a.stencilLoadOp=co.CLEAR,a.stencilStoreOp=ho.DISCARD,a.sampleCount=1,a.beginLayout=uo.UNDEFINED,a.endLayout=uo.DEPTH_STENCIL_ATTACHMENT_OPTIMAL;var o=new ms([r],a);this._shadowRenderPass=i.createRenderPass(o)}var s=[];s.push(i.createTexture(new Cs(io.TEX2D,no.COLOR_ATTACHMENT|no.SAMPLED,ka.RGBA8,n.x,n.y)));var l=i.createTexture(new Cs(io.TEX2D,no.DEPTH_STENCIL_ATTACHMENT,i.depthStencilFormat,n.x,n.y)),c=i.createFramebuffer(new Ho(this._shadowRenderPass,s,l));t.shadowFrameBufferMap.set(e,c)},i.clearShadowMap=function(t,e){for(var i=this._pipeline,n=0;n<t.length;n++){var r=t[n],a=i.shadowFrameBufferMap.get(r);if(i.shadowFrameBufferMap.has(r))for(var o=0;o<this._stages.length;o++){var s=this._stages[o];s.setUsage(r,a),s.clearFramebuffer(e)}}},i.resizeShadowMap=function(t,e){var i=e.x,n=e.y,r=this._pipeline;if(r.shadowFrameBufferMap.has(t)){var a=r.shadowFrameBufferMap.get(t);if(!a)return;var o=a.colorTextures;if(o&&o.length>0)for(var s=0;s<o.length;s++){var l=o[s];l&&l.resize(i,n)}var c=a.depthStencilTexture;c&&c.resize(i,n);var h=a.renderPass;a.destroy(),a.initialize(new Ho(h,o,c))}},e}(Vv),LT.initInfo={name:"ShadowFlow",priority:jv.SHADOW,tag:Jy.SCENE,stages:[]},NT=BT))||NT),QT=he({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),JT=QT.LAYERED+1,$T=function(){function t(){this._fogColor=new Ci("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=0,this._handle=Gr.alloc()}q(t,[{key:"enabled",set:function(t){Gr.set(this._handle,Br.ENABLE,t?1:0),t||Gr.set(this._handle,Br.TYPE,JT),t?this.activate():this._updatePipeline()},get:function(){return Gr.get(this._handle,Br.ENABLE)}},{key:"fogColor",set:function(t){this._fogColor.set(t),Ci.toArray(this._colorArray,this._fogColor),Gr.setVec4(this._handle,Br.COLOR,this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return Gr.get(this._handle,Br.TYPE)},set:function(t){Gr.set(this._handle,Br.TYPE,this.enabled?t:JT),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return Gr.get(this._handle,Br.DENSITY)},set:function(t){Gr.set(this._handle,Br.DENSITY,t)}},{key:"fogStart",get:function(){return Gr.get(this._handle,Br.START)},set:function(t){Gr.set(this._handle,Br.START,t)}},{key:"fogEnd",get:function(){return Gr.get(this._handle,Br.END)},set:function(t){Gr.set(this._handle,Br.END,t)}},{key:"fogAtten",get:function(){return Gr.get(this._handle,Br.ATTEN)},set:function(t){Gr.set(this._handle,Br.ATTEN,t)}},{key:"fogTop",get:function(){return Gr.get(this._handle,Br.TOP)},set:function(t){Gr.set(this._handle,Br.TOP,t)}},{key:"fogRange",get:function(){return Gr.get(this._handle,Br.RANGE)},set:function(t){Gr.set(this._handle,Br.RANGE,t)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){Gr.set(this._handle,Br.ENABLE,t.enabled?1:0),Gr.set(this._handle,Br.TYPE,t.enabled?t.type:JT),this._fogColor.set(t.fogColor),Ci.toArray(this._colorArray,this._fogColor),Gr.setVec4(this._handle,Br.COLOR,this._fogColor),Gr.set(this._handle,Br.DENSITY,t.fogDensity),Gr.set(this._handle,Br.START,t.fogStart),Gr.set(this._handle,Br.END,t.fogEnd),Gr.set(this._handle,Br.ATTEN,t.fogAtten),Gr.set(this._handle,Br.TOP,t.fogTop),Gr.set(this._handle,Br.RANGE,t.fogRange)},e.activate=function(){this._updatePipeline()},e._updatePipeline=function(){var t=n.director.root,e=this.enabled?this.type:JT,i=t.pipeline;i.macros.CC_USE_FOG!==e&&(i.macros.CC_USE_FOG=e,t.onGlobalPipelineStateChanged())},e.destroy=function(){this._handle&&(Gr.free(this._handle),this._handle=0)},t}();n.Fog=$T;var tS=new Vi,eS=new Vi,iS=new Ri,nS=[to.LINEAR,to.LINEAR,to.NONE,eo.CLAMP,eo.CLAMP,eo.CLAMP],rS=t("ForwardPipeline",(FT=ru("ForwardPipeline"),zT=Fu([eT]),UT=Ru(),kT=Fu([iT]),GT=Ru(),FT((qT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"renderTextures",WT,K(e)),J(e,"materials",jT,K(e)),e.fog=new $T,e.ambient=new fa,e.skybox=new _m,e.shadows=new sm,e.renderObjects=[],e.shadowObjects=[],e.shadowFrameBufferMap=new Map,e._isHDR=!1,e._shadingScale=1,e._fpScale=1/1024,e._renderPasses=new Map,e._globalUBO=new Float32Array(Yc.COUNT),e._cameraUBO=new Float32Array(Kc.COUNT),e._shadowUBO=new Float32Array(Zc.COUNT),e}Y(e,t);var i=e.prototype;return i.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var i=new ZT;i.initialize(ZT.initInfo),this._flows.push(i);var n=new ET;n.initialize(ET.initInfo),this._flows.push(n)}return!0},i.activate=function(){return this._macros={},!(!t.prototype.activate.call(this)||!this._activeRenderer()&&(b(2402),1))},i.render=function(t){this._commandBuffers[0].begin(),this.updateGlobalUBO();for(var e=0;e<t.length;e++){var i=t[e];if(i.scene){this.updateCameraUBO(i);for(var n=0;n<this._flows.length;n++)this._flows[n].render(i)}}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)},i.getRenderPass=function(t){var e=this._renderPasses.get(t);if(e)return e;var i=this.device,n=new fs,r=new ds;n.format=i.colorFormat,r.format=i.depthStencilFormat,r.stencilStoreOp=ho.DISCARD,r.depthStoreOp=ho.DISCARD,t&vo.COLOR||(t&Xh?n.loadOp=co.DISCARD:(n.loadOp=co.LOAD,n.beginLayout=uo.PRESENT_SRC)),(t&vo.DEPTH_STENCIL)!==vo.DEPTH_STENCIL&&(t&vo.DEPTH||(r.depthLoadOp=co.LOAD),t&vo.STENCIL||(r.stencilLoadOp=co.LOAD),r.beginLayout=uo.DEPTH_STENCIL_ATTACHMENT_OPTIMAL);var a=new ms([n],r);return e=i.createRenderPass(a),this._renderPasses.set(t,e),e},i.updateGlobalUBO=function(){this._descriptorSet.update();var t=n.director.root,e=this._globalUBO,i=this.device,r=Math.floor(i.width),a=Math.floor(i.height);e[Yc.TIME_OFFSET]=t.cumulativeTime,e[Yc.TIME_OFFSET+1]=t.frameTime,e[Yc.TIME_OFFSET+2]=n.director.getTotalFrames(),e[Yc.SCREEN_SIZE_OFFSET]=i.width,e[Yc.SCREEN_SIZE_OFFSET+1]=i.height,e[Yc.SCREEN_SIZE_OFFSET+2]=1/i.width,e[Yc.SCREEN_SIZE_OFFSET+3]=1/i.height,e[Yc.NATIVE_SIZE_OFFSET]=r,e[Yc.NATIVE_SIZE_OFFSET+1]=a,e[Yc.NATIVE_SIZE_OFFSET+2]=1/e[Yc.NATIVE_SIZE_OFFSET],e[Yc.NATIVE_SIZE_OFFSET+3]=1/e[Yc.NATIVE_SIZE_OFFSET+1],this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(Yc.BINDING),this._globalUBO)},i._activeRenderer=function(){var t=this.device;this._commandBuffers.push(t.commandBuffer);var e=t.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Yc.SIZE,Yc.SIZE));this._descriptorSet.bindBuffer(Yc.BINDING,e);var i=t.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Kc.SIZE,Kc.SIZE));this._descriptorSet.bindBuffer(Kc.BINDING,i);var n=t.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,Zc.SIZE,Zc.SIZE));this._descriptorSet.bindBuffer(Zc.BINDING,n);var r=Y_(nS),a=lf.getSampler(t,r);return this._descriptorSet.bindSampler(Qc,a),this._descriptorSet.bindTexture(Qc,Zd.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(nh,a),this._descriptorSet.bindTexture(nh,Zd.get("default-texture").getGFXTexture()),this._descriptorSet.update(),this.macros.CC_USE_HDR=this._isHDR,this.macros.CC_SUPPORT_FLOAT_TEXTURE=this.device.hasFeature(So.TEXTURE_FLOAT),!0},i.updateShadowUBO=function(t){this._descriptorSet.update();var e=t.scene.mainLight,i=this.device,n=this.shadows;if(n.enabled){if(e&&n.type===rm.ShadowMap){var r;this.shadowFrameBufferMap.has(e)&&this._descriptorSet.bindTexture(Qc,this.shadowFrameBufferMap.get(e).colorTextures[0]);var a=0,o=0,s=0;if(n.autoAdapt){r=_g(this,e.node.getWorldRotation(),e.direction,iS);var l=n.sphere.radius;a=l*n.aspect,o=l;var c=Ri.distance(n.sphere.center,iS);s=Math.min(c*sm.COEFFICIENT_OF_EXPANSION,sm.MAX_FAR)}else r=e.node.getWorldMatrix(),a=n.orthoSize*n.aspect,o=n.orthoSize,s=n.far;Vi.invert(tS,r);var h=i.screenSpaceSignY*i.UVSpaceSignY;Vi.ortho(eS,-a,a,-o,o,n.near,s,i.clipSpaceMinZ,h),Vi.multiply(eS,eS,tS),Vi.toArray(this._shadowUBO,eS,Zc.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[Zc.SHADOW_INFO_OFFSET]=n.size.x,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[Zc.SHADOW_INFO_OFFSET+3]=n.bias}else e&&n.type===rm.Planar&&fg(n,e,this._shadowUBO);Ci.toArray(this._shadowUBO,n.shadowColor,Zc.SHADOW_COLOR_OFFSET),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(Zc.BINDING),this._shadowUBO)}},i.updateCameraUBO=function(t){var e=this.device,i=(t.scene?t.scene:n.director.getScene().renderScene).mainLight,r=this.ambient,a=this.fog,o=Math.floor(e.width),s=Math.floor(e.height),l=this._cameraUBO,c=t.exposure;if(l[Kc.SCREEN_SCALE_OFFSET]=t.width/o*this.shadingScale,l[Kc.SCREEN_SCALE_OFFSET+1]=t.height/s*this.shadingScale,l[Kc.SCREEN_SCALE_OFFSET+2]=1/l[Kc.SCREEN_SCALE_OFFSET],l[Kc.SCREEN_SCALE_OFFSET+3]=1/l[Kc.SCREEN_SCALE_OFFSET+1],l[Kc.EXPOSURE_OFFSET]=c,l[Kc.EXPOSURE_OFFSET+1]=1/c,l[Kc.EXPOSURE_OFFSET+2]=this._isHDR?1:0,l[Kc.EXPOSURE_OFFSET+3]=this._fpScale/c,i){if(Ri.toArray(l,i.direction,Kc.MAIN_LIT_DIR_OFFSET),Ri.toArray(l,i.color,Kc.MAIN_LIT_COLOR_OFFSET),i.useColorTemperature){var h=i.colorTemperatureRGB;l[Kc.MAIN_LIT_COLOR_OFFSET]*=h.x,l[Kc.MAIN_LIT_COLOR_OFFSET+1]*=h.y,l[Kc.MAIN_LIT_COLOR_OFFSET+2]*=h.z}this._isHDR?l[Kc.MAIN_LIT_COLOR_OFFSET+3]=i.illuminance*this._fpScale:l[Kc.MAIN_LIT_COLOR_OFFSET+3]=i.illuminance*c}else Ri.toArray(l,Ri.UNIT_Z,Kc.MAIN_LIT_DIR_OFFSET),Qi.toArray(l,Qi.ZERO,Kc.MAIN_LIT_COLOR_OFFSET);var u=r.colorArray;this._isHDR?u[3]=r.skyIllum*this._fpScale:u[3]=r.skyIllum*c,l.set(u,Kc.AMBIENT_SKY_OFFSET),l.set(r.albedoArray,Kc.AMBIENT_GROUND_OFFSET),Vi.toArray(l,t.matView,Kc.MAT_VIEW_OFFSET),Vi.toArray(l,t.node.worldMatrix,Kc.MAT_VIEW_INV_OFFSET),Vi.toArray(l,t.matProj,Kc.MAT_PROJ_OFFSET),Vi.toArray(l,t.matProjInv,Kc.MAT_PROJ_INV_OFFSET),Vi.toArray(l,t.matViewProj,Kc.MAT_VIEW_PROJ_OFFSET),Vi.toArray(l,t.matViewProjInv,Kc.MAT_VIEW_PROJ_INV_OFFSET),Ri.toArray(l,t.position,Kc.CAMERA_POS_OFFSET);var _=e.screenSpaceSignY;t.window.hasOffScreenAttachments&&(_*=e.UVSpaceSignY),l[Kc.CAMERA_POS_OFFSET+3]=_,l.set(a.colorArray,Kc.GLOBAL_FOG_COLOR_OFFSET),l[Kc.GLOBAL_FOG_BASE_OFFSET]=a.fogStart,l[Kc.GLOBAL_FOG_BASE_OFFSET+1]=a.fogEnd,l[Kc.GLOBAL_FOG_BASE_OFFSET+2]=a.fogDensity,l[Kc.GLOBAL_FOG_ADD_OFFSET]=a.fogTop,l[Kc.GLOBAL_FOG_ADD_OFFSET+1]=a.fogRange,l[Kc.GLOBAL_FOG_ADD_OFFSET+2]=a.fogAtten,this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(Kc.BINDING),this._cameraUBO)},i.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(Yc.BINDING).destroy(),this._descriptorSet.getBuffer(Zc.BINDING).destroy(),this._descriptorSet.getBuffer(Kc.BINDING).destroy(),this._descriptorSet.getSampler(Qc).destroy(),this._descriptorSet.getSampler(nh).destroy(),this._descriptorSet.getTexture(Qc).destroy(),this._descriptorSet.getTexture(nh).destroy())},i.destroy=function(){this.destroyUBOs();for(var e=this._renderPasses.values(),i=e.next();!i.done;)i.value.destroy(),i=e.next();return this._commandBuffers.length=0,this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),t.prototype.destroy.call(this)},q(e,[{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR!==t&&(this._isHDR=t,this._cameraUBO[Kc.EXPOSURE_OFFSET+2]=this._isHDR?1:0)}},{key:"shadingScale",get:function(){return this._shadingScale}},{key:"fpScale",get:function(){return this._fpScale}},{key:"shadowUBO",get:function(){return this._shadowUBO}}]),e}(qv),WT=$((VT=qT).prototype,"renderTextures",[zT,cu,UT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jT=$(VT.prototype,"materials",[kT,cu,GT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HT=VT))||HT));var aS=p_.Flags.Destroyed,oS=p_.Flags.PersistentMask,sS=ei.IDENTIFIER_RE,lS={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},cS=ei.escapeForJS,hS=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},t}();function uS(t,e){return e instanceof hS?new hS(e.varName,t+e.expression):t+e}function _S(t,e,i){Array.isArray(i)?(i[0]=uS(e,i[0]),t.push(i)):t.push(uS(e,i)+";")}var fS=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var n=this._exps[i];_S(t,e+dS(n[0])+"=",n[1])}},t}();function dS(t){return sS.test(t)?"."+t:"["+cS(t)+"]"}fS.pool=void 0,fS.pool=new oe((function(t){t._exps.length=0,t._targetExp=null}),1),fS.pool.get=function(t){var e=this._get()||new fS;return e._targetExp=t,e};var pS=function(){function t(t,e){var i;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=Dt(),Wt(this.funcModuleCache,lS),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(i="var "+this.globalVariables.join(",")+";");var n=function(t){var e=[];return function t(e,i){for(var n,r=Q(i);!(n=r()).done;){var a=n.value;Array.isArray(a)?t(e,a):e.push(a)}}(e,t),e.join("")}(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",n)(this.objs,this.funcs);for(var r=0,a=this.objsToClear_iN$t.length;r<a;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var i=Nt(t);if(i){var n=this.funcModuleCache[i];if(n)return n;if(void 0===n){var r=-1!==i.indexOf(".");if(r)try{if(r=t===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(t){}}}var a=this.funcs.indexOf(t);a<0&&(a=this.funcs.length,this.funcs.push(t));var o="F["+a+"]";return e&&(o="("+o+")"),this.funcModuleCache[i]=o,o},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,i,n){var r=fS.pool.get(n),a=e.constructor.__props__;a||(a=Object.keys(e));for(var o=0;o<a.length;o++){var s=a[o],l=i[s];if(e[s]!==l){var c=this.enumerateField(i,s,l);r.append(s,c)}}r.writeCode(t),fS.pool.put(r)},e.enumerateCCClass=function(t,e,i){for(var r=i.__values__,a=De(i),o=0;o<r.length;o++){var s=r[o],l=e[s],c=a[s+"$_$default"];if(!mS(c,l))if("object"==typeof l&&l instanceof n.ValueType&&(c=ei.getDefault(c))&&c.constructor===l.constructor){var h="o"+dS(s);this.setValueType(t,c,l,h)}else this.setObjProp(t,e,s,l)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new hS(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)_S(i,e+"["+n+"]=",this.enumerateField(t,n,t[n]));return i},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId,n=[new hS(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&_S(n,i+"["+r+"]=",t[r]);return n},e.enumerateField=function(t,e,i){if("object"==typeof i&&i){var n=i._iN$t;if(n){var r=n.globalVar;if(!r){r=n.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var a=n.source[0];n.source[0]=uS(r+"=",a)}return r}return ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?cS(i):("_objFlags"===e&&t instanceof p_&&(i&=oS),i)},e.setObjProp=function(t,e,i,n){_S(t,"o"+dS(i)+"=",this.enumerateField(e,i,n))},e.enumerateObject=function(t,e){var i=e.constructor;if(n.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var a=e[r];"object"==typeof a&&a&&a===e._iN$t||this.setObjProp(t,e,r,a)}},e.instantiateObj=function(t){if(t instanceof n.ValueType)return ei.getNewValueTypeCode(t);if(t instanceof n.Asset)return this.getObjRef(t);if(t._objFlags&aS)return null;var e,i=t.constructor;if(n.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof n.Component){if(t instanceof n._BaseNode||t instanceof n.Component)return this.getObjRef(t)}else if(this.parent instanceof n._BaseNode)if(t instanceof n._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof n.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new hS("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new hS("o","{}");else{if(i)return this.getObjRef(t);e=new hS("o","Object.create(null)")}var r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},t}();function mS(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof n.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return wt(t)&&wt(e)}return!1}var vS,gS=function(){function t(t){this._uiComp=null,this.opacity=1,this._uiTransformComp=null,this._node=void 0,this._node=t}return q(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?E(12002):this._uiComp=t}}]),t}();!function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed"}(vS||(vS=t("SystemEventType",{}))),fe(vS),n.SystemEventType=vS;var yS=new Xi,TS=t("EventMouse",function(t){function e(i,n,r){var a;return(a=t.call(this,h_.MOUSE,n)||this).movementX=0,a.movementY=0,a.eventType=void 0,a._button=e.BUTTON_MISSING,a._x=0,a._y=0,a._prevX=0,a._prevY=0,a._scrollX=0,a._scrollY=0,a.eventType=i,r&&(a._prevX=r.x,a._prevY=r.y),a}Y(e,t);var i=e.prototype;return i.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},i.getScrollX=function(){return this._scrollX},i.getScrollY=function(){return this._scrollY},i.setLocation=function(t,e){this._x=t,this._y=e},i.getLocation=function(t){return t||(t=new Xi),Xi.set(t,this._x,this._y),t},i.getLocationInView=function(t){return t||(t=new Xi),Xi.set(t,this._x,n.view._designResolutionSize.height-this._y),t},i.getUILocation=function(t){return t||(t=new Xi),Xi.set(t,this._x,this._y),n.view._convertPointWithScale(t),t},i.getPreviousLocation=function(t){return t||(t=new Xi),Xi.set(t,this._prevX,this._prevY),t},i.getUIPreviousLocation=function(t){return t||(t=new Xi),Xi.set(t,this._prevX,this._prevY),n.view._convertPointWithScale(t),t},i.getDelta=function(t){return t||(t=new Xi),Xi.set(t,this._x-this._prevX,this._y-this._prevY),t},i.getDeltaX=function(){return this._x-this._prevX},i.getDeltaY=function(){return this._y-this._prevY},i.getUIDelta=function(t){return t||(t=new Xi),Xi.set(t,(this._x-this._prevX)/n.view.getScaleX(),(this._y-this._prevY)/n.view.getScaleY()),t},i.getUIDeltaX=function(){return(this._x-this._prevX)/n.view.getScaleX()},i.getUIDeltaY=function(){return(this._y-this._prevY)/n.view.getScaleY()},i.setButton=function(t){this._button=t},i.getButton=function(){return this._button},i.getLocationX=function(){return this._x},i.getLocationY=function(){return this._y},i.getUILocationX=function(){var t=n.view.getViewportRect();return(this._x-t.x)/n.view.getScaleX()},i.getUILocationY=function(){var t=n.view.getViewportRect();return(this._y-t.y)/n.view.getScaleY()},e}(h_));TS.NONE=0,TS.DOWN=1,TS.UP=2,TS.MOVE=3,TS.SCROLL=4,TS.BUTTON_MISSING=-1,TS.BUTTON_LEFT=0,TS.BUTTON_RIGHT=2,TS.BUTTON_MIDDLE=1,TS.BUTTON_4=3,TS.BUTTON_5=4,TS.BUTTON_6=5,TS.BUTTON_7=6,TS.BUTTON_8=7;var SS=t("EventTouch",function(t){function e(e,i,n,r){var a;return(a=t.call(this,h_.TOUCH,i)||this).touch=null,a.simulate=!1,a._eventCode=void 0,a._touches=void 0,a._allTouches=void 0,a._eventCode=n||0,a._touches=e||[],a._allTouches=r||[],a}Y(e,t);var i=e.prototype;return i.getEventCode=function(){return this._eventCode},i.getTouches=function(){return this._touches},i.getAllTouches=function(){return this._allTouches},i.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},i.getLocation=function(t){return this.touch?this.touch.getLocation(t):new Xi},i.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new Xi},i.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new Xi},i.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new Xi},i.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new Xi},i.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new Xi},i.getID=function(){return this.touch?this.touch.getID():null},i.getDelta=function(t){return this.touch?this.touch.getDelta(t):new Xi},i.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new Xi},i.getDeltaX=function(){return this.touch?this.touch.getDelta(yS).x:0},i.getDeltaY=function(){return this.touch?this.touch.getDelta(yS).y:0},i.getLocationX=function(){return this.touch?this.touch.getLocationX():0},i.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e}(h_));SS.MAX_TOUCHES=5,SS.BEGAN=0,SS.MOVED=1,SS.ENDED=2,SS.CANCELLED=3;var ES=t("EventAcceleration",function(t){function e(e,i){var n;return(n=t.call(this,h_.ACCELERATION,i)||this).acc=void 0,n.acc=e,n}return Y(e,t),e}(h_)),AS=t("EventKeyboard",function(t){function e(e,i,n){var r;return(r=t.call(this,h_.KEYBOARD,n)||this).keyCode=void 0,r.rawEvent=void 0,r.isPressed=void 0,"number"==typeof e?r.keyCode=e:(r.keyCode=e.keyCode,r.rawEvent=e),r.isPressed=i,r}return Y(e,t),e}(h_));h_.EventMouse=TS,h_.EventTouch=SS,h_.EventAcceleration=ES,h_.EventKeyboard=AS;var bS=function(){function t(t,e,i){this._cameraPriority=0,this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=i,this._type=t||0,this._listenerID=e||""}t.create=function(t){w(t&&t.event,1900);var e=t.event;delete t.event;var i=null;if(e===n.EventListener.TOUCH_ONE_BY_ONE?i=new wS:e===n.EventListener.TOUCH_ALL_AT_ONCE?i=new RS:e===n.EventListener.MOUSE?i=new CS:e===n.EventListener.KEYBOARD?i=new OS:e===n.EventListener.ACCELERATION&&(i=new IS(t.callback),delete t.callback),i)for(var r=0,a=Object.keys(t);r<a.length;r++){var o=a[r];i[o]=t[o]}return i},q(t,[{key:"onEvent",get:function(){return this._onEvent}}]);var e=t.prototype;return e._setPaused=function(t){this._paused=t},e._isPaused=function(){return this._paused},e._setRegistered=function(t){this._registered=t},e._isRegistered=function(){return this._registered},e._getType=function(){return this._type},e._getListenerID=function(){return this._listenerID},e._setFixedPriority=function(t){this._fixedPriority=t},e._getFixedPriority=function(){return this._fixedPriority},e._setSceneGraphPriority=function(t){this._target=t,this._node=t},e._getSceneGraphPriority=function(){return this._node},e.checkAvailable=function(){return null!==this._onEvent},e.clone=function(){return null},e.setEnabled=function(t){this._isEnabled=t},e.isEnabled=function(){return this._isEnabled},t}();bS.UNKNOWN=0,bS.TOUCH_ONE_BY_ONE=1,bS.TOUCH_ALL_AT_ONCE=2,bS.KEYBOARD=3,bS.MOUSE=4,bS.ACCELERATION=6,bS.CUSTOM=8,bS.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var xS=bS.ListenerID,CS=function(t){function e(){var e;return(e=t.call(this,bS.MOUSE,xS.MOUSE,null)||this).onMouseDown=null,e.onMouseUp=null,e.onMouseMove=null,e.onMouseScroll=null,e._onEvent=function(t){return e._callback(t)},e}Y(e,t);var i=e.prototype;return i._callback=function(t){var e=n.Event.EventMouse;switch(t.eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},i.clone=function(){var t=new e;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},i.checkAvailable=function(){return!0},e}(bS),wS=function(t){function e(){var e;return(e=t.call(this,bS.TOUCH_ONE_BY_ONE,xS.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,e.onTouchBegan=null,e.onTouchMoved=null,e.onTouchEnded=null,e.onTouchCancelled=null,e._claimedTouches=[],e}Y(e,t);var i=e.prototype;return i.setSwallowTouches=function(t){this.swallowTouches=t},i.isSwallowTouches=function(){return this.swallowTouches},i.clone=function(){var t=new e;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},i.checkAvailable=function(){return!!this.onTouchBegan||(T(1801),!1)},e}(bS),RS=function(t){function e(){var e;return(e=t.call(this,bS.TOUCH_ALL_AT_ONCE,xS.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,e.onTouchesMoved=null,e.onTouchesEnded=null,e.onTouchesCancelled=null,e}Y(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},i.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(T(1802),!1)},e}(bS),IS=function(t){function e(e){var i;return(i=t.call(this,bS.ACCELERATION,xS.ACCELERATION,null)||this)._onAccelerationEvent=null,i._onEvent=function(t){return i._callback(t)},i._onAccelerationEvent=e,i}Y(e,t);var i=e.prototype;return i._callback=function(t){this._onAccelerationEvent&&this._onAccelerationEvent(t.acc,t)},i.checkAvailable=function(){return w(this._onAccelerationEvent,1803),!0},i.clone=function(){return new e(this._onAccelerationEvent)},e}(bS),OS=function(t){function e(){var e;return(e=t.call(this,bS.KEYBOARD,xS.KEYBOARD,null)||this).onKeyPressed=null,e.onKeyReleased=null,e._onEvent=function(t){return e._callback(t)},e}Y(e,t);var i=e.prototype;return i._callback=function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},i.clone=function(){var t=new e;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},i.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(T(1800),!1)},e}(bS);n.EventListener=bS;var PS=bS.ListenerID,MS=function(){function t(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var e=t.prototype;return e.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},e.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},e.push=function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},e.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},e.clearFixedListeners=function(){this._fixedListeners.length=0},e.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},e.getFixedPriorityListeners=function(){return this._fixedListeners},e.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},t}(),DS=function(){function t(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners={},this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var e=t.prototype;return e.pauseTarget=function(t,e){if(void 0===e&&(e=!1),t instanceof n._BaseNode){var i=this._nodeListenersMap[t.uuid];if(i)for(var r=0;r<i.length;++r)i[r]._setPaused(!0);if(!0===e){var a=t.children;if(a)for(var o=0;o<a.length;++o){var s=a[o];this.pauseTarget(s,!0)}}}else E(3506)},e.resumeTarget=function(t,e){if(void 0===e&&(e=!1),t instanceof n._BaseNode){var i=this._nodeListenersMap[t.uuid];if(i)for(var r=0;r<i.length;++r)i[r]._setPaused(!1);if(this._setDirtyForNode(t),!0===e&&t.children.length>0){var a=t.children;if(a)for(var o=0;o<a.length;++o){var s=a[o];this.resumeTarget(s,!0)}}}else E(3506)},e.frameUpdateListeners=function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var i in t)t[i].empty()&&(delete e[i],delete t[i]);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,a=n.length;r<a;r++)this._forceAddEventListener(n[r]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},e.hasEventListener=function(t){return!!this._getListeners(t)},e.addListener=function(t,e){if(w(t&&e,3503),!(n.js.isNumber(e)||e instanceof n._BaseNode))return E(3506),null;if(t instanceof n.EventListener){if(t._isRegistered())return T(3505),null}else w(!n.js.isNumber(e),3504),t=n.EventListener.create(t);if(!t.checkAvailable())return null;if(n.js.isNumber(e)){if(0===e)return T(3500),null;t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else{if(!(i=e)||!i.getComponent("cc.UITransform"))return T(3512),null;t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t)}var i;return t},e.addCustomListener=function(t,e){var i=bS.create({event:n.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(i,1),i},e.removeListener=function(t){if(null!=t){var e=!1,i=this._listenersMap;for(var r in t===this._currentTouchListener&&(this._currentTouchListener=this._currentTouch=null),i){var a=i[r],o=a.getFixedPriorityListeners(),s=a.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(s,t))?this._setDirty(t._getListenerID(),2):(e=this._removeListenerInVector(o,t))&&this._setDirty(t._getListenerID(),1),a.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[r]),e)break}if(!e)for(var l=this._toAddedListeners,c=l.length-1;c>=0;c--){var h=l[c];if(h===t){n.js.array.removeAt(l,c),h._setRegistered(!1);break}}}},e.removeListeners=function(t,e){if(void 0===e&&(e=!1),n.js.isNumber(t)||t instanceof n._BaseNode)if(void 0!==t._id){var i=this._nodeListenersMap[t._id];if(i){for(var r=n.js.array.copy(i),a=0;a<r.length;++a){var o=r[a];this.removeListener(o)}delete this._nodeListenersMap[t._id]}for(var s=this._toAddedListeners,l=0;l<s.length;){var c=s[l];c._getSceneGraphPriority()===t?(c._setSceneGraphPriority(null),c._setRegistered(!1),s.splice(l,1)):++l}if(!0===e)for(var h=t.getChildren(),u=0;u<h.length;++u){var _=h[u];this.removeListeners(_,!0)}}else t===n.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(PS.TOUCH_ONE_BY_ONE):t===n.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(PS.TOUCH_ALL_AT_ONCE):t===n.EventListener.MOUSE?this._removeListenersForListenerID(PS.MOUSE):t===n.EventListener.ACCELERATION?this._removeListenersForListenerID(PS.ACCELERATION):t===n.EventListener.KEYBOARD?this._removeListenersForListenerID(PS.KEYBOARD):T(3501);else E(3506)},e.removeCustomListeners=function(t){this._removeListenersForListenerID(t)},e.removeAllListeners=function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i)},e.setPriority=function(t,e){if(null!=t){var i=this._listenersMap;for(var n in i){var r=i[n].getFixedPriorityListeners();if(r&&-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&T(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),1)))}}},e.setEnabled=function(t){this._isEnabled=t},e.isEnabled=function(){return this._isEnabled},e.dispatchEvent=function(t){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType){if(t.getType().startsWith(n.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=function(t){var e=h_,i=t.type;return i===e.ACCELERATION?PS.ACCELERATION:i===e.KEYBOARD?PS.KEYBOARD:i.startsWith(e.MOUSE)?PS.MOUSE:(i.startsWith(e.TOUCH)&&T(2e3),"")}(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}else b(3511)},e._onListenerCallback=function(t,e){e.currentTarget=t._target;var i=t.onEvent;return i&&i(e),e.isStopped()},e.dispatchCustomEvent=function(t,e){var i=new n.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)},e._setDirtyForNode=function(t){var e=this._nodeListenersMap[t._id];if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var r=e[i]._getListenerID();this._dirtyListeners[r]||(this._dirtyListeners[r]=!0)}if(t.children.length>0)for(var a=t.children,o=0,s=a?a.length:0;o<s;o++)this._setDirtyForNode(a[o])},e._addListener=function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},e._forceAddEventListener=function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new MS,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,2);var n=t._getSceneGraphPriority();null===n&&T(3507),this._associateNodeAndEventListener(n,t),n.activeInHierarchy&&this.resumeTarget(n)}else this._setDirty(e,1)},e._getListeners=function(t){return this._listenersMap[t]},e._updateDirtyFlagForSceneGraph=function(){var t=this._dirtyListeners;for(var e in t)this._setDirty(e,2),t[e]=!1},e._removeAllListenersInVector=function(t){if(t)for(var e,i=t.length-1;i>=0;i--)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&n.js.array.removeAt(t,i)},e._removeListenersForListenerID=function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners(),r=e.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(i),delete this._priorityDirtyFlagMap[t],this._inDispatch||(e.clear(),delete this._listenersMap[t])}for(var a=this._toAddedListeners,o=a.length-1;o>=0;o--){var s=a[o];s&&s._getListenerID()===t&&n.js.array.removeAt(a,o)}},e._sortEventListeners=function(t){var e=0,i=this._priorityDirtyFlagMap;i[t]&&(e=i[t]),0!==e&&(i[t]=0,1&e&&this._sortListenersOfFixedPriority(t),2&e&&n.director.getScene()&&this._sortListenersOfSceneGraphPriority(t))},e._sortListenersOfSceneGraphPriority=function(t){var e=this._getListeners(t);if(e){var i=e.getSceneGraphPriorityListeners();if(i&&0!==i.length){var n=e.getSceneGraphPriorityListeners();n.forEach((function(t){var e=t._getSceneGraphPriority()._uiProps.uiTransformComp;t._cameraPriority=e.cameraPriority})),n.sort(this._sortEventListenersOfSceneGraphPriorityDes)}}},e._sortEventListenersOfSceneGraphPriorityDes=function(t,e){var i=t._getSceneGraphPriority(),n=e._getSceneGraphPriority();if(!(e&&n&&n._activeInHierarchy&&n._uiProps.uiTransformComp))return-1;if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return 1;var r=i,a=n,o=!1;if(t._cameraPriority!==e._cameraPriority)return e._cameraPriority-t._cameraPriority;for(;r.parent._id!==a.parent._id;)r=null===r.parent.parent?(o=!0)&&n:r.parent,a=null===a.parent.parent?(o=!0)&&i:a.parent;if(r._id===a._id){if(r._id===n._id)return-1;if(r._id===i._id)return 1}var s=r.getSiblingIndex(),l=a.getSiblingIndex();return o?s-l:l-s},e._sortListenersOfFixedPriority=function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;n<r&&!(i[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},e._sortListenersOfFixedPriorityAsc=function(t,e){return t._getFixedPriority()-e._getFixedPriority()},e._onUpdateListeners=function(t){var e=t.getFixedPriorityListeners(),i=t.getSceneGraphPriorityListeners(),r=this._toRemovedListeners;if(i)for(var a=i.length-1;a>=0;a--){var o=i[a];if(!o._isRegistered()){n.js.array.removeAt(i,a);var s=r.indexOf(o);-1!==s&&r.splice(s,1)}}if(e)for(var l=e.length-1;l>=0;l--){var c=e[l];if(!c._isRegistered()){n.js.array.removeAt(e,l);var h=r.indexOf(c);-1!==h&&r.splice(h,1)}}i&&0===i.length&&t.clearSceneGraphListeners(),e&&0===e.length&&t.clearFixedListeners()},e._updateTouchListeners=function(){var t=this._inDispatch;if(w(t>0,3508),!(t>1)){var e;(e=this._listenersMap[PS.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(e),(e=this._listenersMap[PS.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(e),w(1===t,3509);var i=this._toAddedListeners;if(0!==i.length){for(var n=0,r=i.length;n<r;n++)this._forceAddEventListener(i[n]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},e._cleanToRemovedListeners=function(){for(var t=this._toRemovedListeners,e=0;e<t.length;++e){var i=t[e],n=this._listenersMap[i._getListenerID()];if(n){var r=n.getFixedPriorityListeners(),a=n.getSceneGraphPriorityListeners();if(a){var o=a.indexOf(i);-1!==o&&a.splice(o,1)}if(r){var s=r.indexOf(i);-1!==s&&r.splice(s,1)}}}t.length=0},e._onTouchEventCallback=function(t,e){if(!t._isRegistered())return!1;var i=e.event,n=i.touch;i.currentTarget=t._getSceneGraphPriority();var r=!1,a=-1,o=i.getEventCode();if(o===SS.BEGAN){if(!pe.ENABLE_MULTI_TOUCH&&NS._currentTouch){var s=NS._currentTouchListener._node;if(!s||s.activeInHierarchy)return!1}t.onTouchBegan&&(r=t.onTouchBegan(n,i))&&t._isRegistered()&&!t._isPaused()&&(t._claimedTouches.push(n),!pe.ENABLE_MULTI_TOUCH&&NS._currentTouch||(NS._currentTouch=n),NS._currentTouchListener=t)}else if(t._claimedTouches.length>0&&-1!==(a=t._claimedTouches.indexOf(n))){if(r=!0,!pe.ENABLE_MULTI_TOUCH&&NS._currentTouch&&NS._currentTouch!==n)return!1;o===SS.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):o===SS.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._isRegistered()&&t._claimedTouches.splice(a,1),(pe.ENABLE_MULTI_TOUCH||NS._currentTouch===n)&&(NS._currentTouch=null),NS._currentTouchListener=null):o===SS.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._isRegistered()&&t._claimedTouches.splice(a,1),(pe.ENABLE_MULTI_TOUCH||NS._currentTouch===n)&&(NS._currentTouch=null),NS._currentTouchListener=null)}return i.isStopped()?(NS._updateTouchListeners(i),!0):!!(r&&t._isRegistered()&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(n,1),!0)},e._dispatchTouchEvent=function(t){this._sortEventListeners(PS.TOUCH_ONE_BY_ONE),this._sortEventListeners(PS.TOUCH_ALL_AT_ONCE);var e=this._getListeners(PS.TOUCH_ONE_BY_ONE),i=this._getListeners(PS.TOUCH_ALL_AT_ONCE);if(null!==e||null!==i){var r=t.getTouches(),a=n.js.array.copy(r),o={event:t,needsMutableSet:e&&i,touches:a,selTouch:null};if(e)for(var s=0;s<r.length;++s){var l=r[s];t.touch=l,t.propagationStopped=t.propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,o)}i&&a.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:a}),t.isStopped())||this._updateTouchListeners(t)}},e._onTouchesEventCallback=function(t,e){if(!t._isRegistered())return!1;var i=e.event,n=e.touches,r=i.getEventCode();return i.currentTarget=t._getSceneGraphPriority(),r===SS.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(n,i):r===SS.MOVED&&t.onTouchesMoved?t.onTouchesMoved(n,i):r===SS.ENDED&&t.onTouchesEnded?t.onTouchesEnded(n,i):r===SS.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(n,i),!!i.isStopped()&&(NS._updateTouchListeners(i),!0)},e._associateNodeAndEventListener=function(t,e){var i=this._nodeListenersMap[t.uuid];i||(i=[],this._nodeListenersMap[t.uuid]=i),i.push(e)},e._dissociateNodeAndEventListener=function(t,e){var i=this._nodeListenersMap[t.uuid];i&&(n.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.uuid])},e._dispatchEventToListeners=function(t,e,i){var n=!1,r=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),o=0;if(r&&0!==r.length)for(;o<t.gt0Index;++o){var s=r[o];if(s.isEnabled()&&!s._isPaused()&&s._isRegistered()&&e(s,i)){n=!0;break}}if(a&&!n)for(var l=0;l<a.length;++l){var c=a[l];if(c.isEnabled()&&!c._isPaused()&&c._isRegistered()&&e(c,i)){n=!0;break}}if(r&&!n)for(;o<r.length;++o){var h=r[o];if(h.isEnabled()&&!h._isPaused()&&h._isRegistered()&&e(h,i)){n=!0;break}}},e._setDirty=function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]|=e},e._sortNumberAsc=function(t,e){return t-e},e._removeListenerInCallback=function(t,e){if(null==t)return!1;for(var i=t.length-1;i>=0;i--){var r=t[i];if(r._onCustomEvent===e||r.onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?n.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0}return!1},e._removeListenerInVector=function(t,e){if(null==t)return!1;for(var i=t.length-1;i>=0;i--){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?n.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0}return!1},t}(),NS=t("eventManager",new DS);n.eventManager=NS,p_.Flags.Destroying;var LS,BS,FS,zS,US,kS,GS,HS,VS,WS=p_.Flags.Destroying,jS=p_.Flags.DontDestroy,qS=p_.Flags.Deactivating,XS=new Et("Node");function YS(t){return t?"string"==typeof t?re(t):t:(b(3804),null)}var KS,ZS,QS,JS,$S,tE,eE,iE,nE,rE,aE,oE=t("BaseNode",ru("cc.BaseNode")((VS=HS=function(t){Y(i,t),i._setScene=function(t){t._updateScene()},i._findComponent=function(t,e){var i=e,n=t._components;if(i._sealed)for(var r=0;r<n.length;++r){var a=n[r];if(a.constructor===e)return a}else for(var o=0;o<n.length;++o){var s=n[o];if(s instanceof e)return s}return null},i._findComponents=function(t,e,i){var n=e,r=t._components;if(n._sealed)for(var a=0;a<r.length;++a){var o=r[a];o.constructor===e&&i.push(o)}else for(var s=0;s<r.length;++s){var l=r[s];l instanceof e&&i.push(l)}},i._findChildComponent=function(t,e){for(var n=0;n<t.length;++n){var r=t[n],a=i._findComponent(r,e);if(a)return a;if(r._children.length>0&&(a=i._findChildComponent(r._children,e)))return a}return null},i._findChildComponents=function(t,e,n){for(var r=0;r<t.length;++r){var a=t[r];i._findComponents(a,e,n),a._children.length>0&&i._findChildComponents(a._children,e,n)}};var e=i.prototype;function i(e){var i;return J(i=t.call(this,e)||this,"_parent",FS,K(i)),J(i,"_children",zS,K(i)),J(i,"_active",US,K(i)),J(i,"_components",kS,K(i)),J(i,"_prefab",GS,K(i)),i._scene=null,i._activeInHierarchy=!1,i._id=XS.getNewId(),i._name=void 0,i._eventProcessor=new n.NodeEventProcessor(K(i)),i._eventMask=0,i._siblingIndex=0,i._originalSceneId="",i._registerIfAttached=void 0,i._name=void 0!==e?e:"New Node",i}return e._updateScene=function(){null==this._parent?d("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},q(i,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&jS)>0},set:function(t){t?this._objFlags|=jS:this._objFlags&=~jS}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&n.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),e.attr=function(t){Wt(this,t)},e.getParent=function(){return this._parent},e.setParent=function(t,e){if(void 0===e&&(e=!1),this._parent!==t){var i=this._parent,n=t;if(this._parent=n,this._siblingIndex=0,this._onSetParent(i,e),this.emit&&this.emit(vS.PARENT_CHANGED,i),i&&!(i._objFlags&WS)){var r=i._children.indexOf(this);i._children.splice(r,1),i._updateSiblingIndex(),i.emit&&i.emit(vS.CHILD_REMOVED,this)}n&&(n._children.push(this),this._siblingIndex=n._children.length-1,n.emit&&n.emit(vS.CHILD_ADDED,this)),this._onHierarchyChanged(i)}},e.getChildByUuid=function(t){if(!t)return _("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},e.getChildByName=function(t){if(!t)return _("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},e.getChildByPath=function(t){for(var e=t.split("/"),i=this,n=function(t){var n=e[t];if(0===n.length)return"continue";var r=i.children.find((function(t){return t.name===n}));if(!r)return{v:null};i=r},r=0;r<e.length;++r){var a=n(r);switch(a){case"continue":continue;default:if("object"==typeof a)return a.v}}return i},e.addChild=function(t){t.setParent(this)},e.insertChild=function(t,e){t.parent=this,t.setSiblingIndex(e)},e.getSiblingIndex=function(){return this._siblingIndex},e.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&qS)b(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},e.walk=function(t,e){var n=1,r=null,a=null,o=0,s=i._stacks[i._stackId];s||(s=[],i._stacks.push(s)),i._stackId++,s.length=0,s[0]=this;for(var l=null,c=!1;n;)if(a=s[--n])if(!c&&t?t(a):c&&e&&e(a),s[n]=null,c){if(l===this._parent)break;if(c=!1,r)if(r[++o])s[n]=r[o],n++;else if(l&&(s[n]=l,n++,c=!0,l._parent?(o=(r=l._parent._children).indexOf(l),l=l._parent):(l=null,r=null),o<0))break}else a._children.length>0?(l=a,r=a._children,o=0,s[n]=r[o],n++):(s[n]=a,n++,c=!0);s.length=0,i._stackId--},e.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},e.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var i=t[e];i&&(i.parent=null)}this._children.length=0},e.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},e.getComponent=function(t){var e=YS(t);return e?i._findComponent(this,e):null},e.getComponents=function(t){var e=YS(t),n=[];return e&&i._findComponents(this,e,n),n},e.getComponentInChildren=function(t){var e=YS(t);return e?i._findChildComponent(this._children,e):null},e.getComponentsInChildren=function(t){var e=YS(t),n=[];return e&&(i._findComponents(this,e,n),i._findChildComponents(this._children,e,n)),n},e.addComponent=function(t){var e;if("string"==typeof t){if(!(e=re(t)))throw n._RF.peek()&&b(3808,t),TypeError(R(3807,t))}else{if(!t)throw TypeError(R(3804));e=t}if("function"!=typeof e)throw TypeError(R(3809));if(!Xt(e,n.Component))throw TypeError(R(3810));var i=e._requireComponent;i&&!this.getComponent(i)&&this.addComponent(i);var r=new e;return r.node=this,this._components.push(r),this._activeInHierarchy&&n.director._nodeActivator.activateComp(r),r},e.removeComponent=function(t){if(t){var e=null;(e=t instanceof Jf?t:this.getComponent(t))&&e.destroy()}else b(3813)},e.on=function(t,e,i,n){switch(void 0===n&&(n=!1),t){case vS.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(t,e,i,n)},e.off=function(t,e,i,n){if(void 0===n&&(n=!1),this._eventProcessor.off(t,e,i,n),!this._eventProcessor.hasEventListener(t))switch(t){case vS.TRANSFORM_CHANGED:this._eventMask&=-2}},e.once=function(t,e,i,n){this._eventProcessor.once(t,e,i,n)},e.emit=function(t,e,i,n,r,a){this._eventProcessor.emit(t,e,i,n,r,a)},e.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},e.hasEventListener=function(t,e,i){return this._eventProcessor.hasEventListener(t,e,i)},e.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(vS.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},e.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},e.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},e._removeComponent=function(t){if(t){if(!(this._objFlags&WS)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&b(3815)}}else b(3814)},e._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit(vS.SIBLING_ORDER_CHANGED)},e._onSetParent=function(t){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk(i._setScene))},e._onPostActivated=function(){},e._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},e._onPreDestroy=function(){this._onPreDestroyBase()},e._onHierarchyChanged=function(t){return this._onHierarchyChangedBase(t)},e._instantiate=function(t,e){return t||(t=n.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},e._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof n.Scene||n.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&n.director._nodeActivator.activateNode(this,e)},e._onPreDestroyBase=function(){this._objFlags|=WS;var t=this._parent,e=!!t&&0!=(t._objFlags&WS);if(this._persistNode&&n.game.removePersistRootNode(this),!e&&t){this.emit(vS.PARENT_CHANGED,this);var i=t._children.indexOf(this);t._children.splice(i,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit(vS.CHILD_REMOVED,this)}this.emit(vS.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,a=0;a<r.length;++a)r[a]._destroyImmediate();for(var o=this._components,s=0;s<o.length;++s)o[s]._destroyImmediate();return e},i}(p_),HS.idGenerator=XS,HS._stacks=[[]],HS._stackId=0,$((BS=VS).prototype,"_persistNode",[lu],Object.getOwnPropertyDescriptor(BS.prototype,"_persistNode"),BS.prototype),$(BS.prototype,"name",[yu],Object.getOwnPropertyDescriptor(BS.prototype,"name"),BS.prototype),$(BS.prototype,"children",[yu],Object.getOwnPropertyDescriptor(BS.prototype,"children"),BS.prototype),$(BS.prototype,"active",[yu],Object.getOwnPropertyDescriptor(BS.prototype,"active"),BS.prototype),$(BS.prototype,"activeInHierarchy",[yu],Object.getOwnPropertyDescriptor(BS.prototype,"activeInHierarchy"),BS.prototype),$(BS.prototype,"parent",[yu],Object.getOwnPropertyDescriptor(BS.prototype,"parent"),BS.prototype),FS=$(BS.prototype,"_parent",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zS=$(BS.prototype,"_children",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),US=$(BS.prototype,"_active",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),kS=$(BS.prototype,"_components",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GS=$(BS.prototype,"_prefab",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LS=BS))||LS);function sE(t){var e=t._prefab;if(e&&e.instance){if(!e.asset)return b(3701,t.name),void(e.instance=void 0);var i=t._objFlags,r=t._parent,a=t._id,o=t._prefab;n.game._isCloning=!0,e.asset._doInstantiate(t),n.game._isCloning=!1,t._objFlags=i,t._parent=r,t._id=a,t._prefab&&(t._prefab.instance=null==o?void 0:o.instance)}}function lE(t,e,i){var n,r=e,a=null===(n=t._prefab)||void 0===n?void 0:n.instance;!i&&a&&(e[a.fileId]={},r=e[a.fileId]);var o=t._prefab;o&&(r[o.fileId]=t);for(var s=t.components,l=0;l<s.length;l++){var c=s[l];c.__prefab&&(r[c.__prefab.fileId]=c)}for(var h=0;h<t.children.length;h++)lE(t.children[h],r,!1)}function cE(t,e){if(!t)return null;for(var i=e,n=0;n<t.length;n++){if(!i)return null;i=i[t[n]]}return i}function hE(t,e,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.targetInfo){var a=cE(r.targetInfo.localID,i);if(!a)continue;if(r.nodes)for(var o=0;o<r.nodes.length;o++){var s=r.nodes[o];a._children.push(s),s._parent=a,s._onBatchCreated(!1)}}}}function uE(t,e,i){if(!(e.length<=0))for(var n=null,r=0;r<e.length;r++){var a=e[r];if(a&&a.targetInfo){if(!(n=cE(a.targetInfo.localID,i)))continue;var o=n,s=a.propertyPath.slice();if(s.length>0){var l=s.pop();if(!l)continue;for(var c=0;c<s.length&&(o=o[s[c]]);c++);if(!o)continue;if(Array.isArray(o))if("length"===l)o[l]=a.value;else{var h=Number.parseInt(l);Number.isInteger(h)&&h<o.length&&(o[l]=a.value)}else o[l]=a.value}}}}function _E(t){var e,i=null===(e=t._prefab)||void 0===e?void 0:e.targetOverrides;if(i)for(var n=0;n<i.length;n++){var r,a,o=i[n],s=o.source,l=o.sourceInfo;if(l){var c,h,u=null===(c=o.source)||void 0===c||null===(h=c._prefab)||void 0===h?void 0:h.instance;u&&u.targetMap&&(s=cE(l.localID,u.targetMap))}if(s){var _,f=o.targetInfo;if(f){var d=null===(r=o.target)||void 0===r||null===(a=r._prefab)||void 0===a?void 0:a.instance;if(d&&d.targetMap&&(_=cE(f.localID,d.targetMap))){var p=o.propertyPath.slice(),m=s;if(p.length>0){var v=p.pop();if(!v)return;for(var g=0;g<p.length&&(m=m[p[g]]);g++);if(!m)continue;m[v]=_}}}}}}n._BaseNode=oE;var fE,dE,pE,mE,vE,gE,yE,TE,SE,EE,AE,bE,xE,CE,wE,RE,IE,OE,PE,ME,DE,NE,LE,BE,FE,zE,UE,kE,GE,HE,VE,WE,jE,qE,XE,YE,KE,ZE,QE,JE,$E,tA,eA,iA,nA,rA,aA,oA,sA,lA,cA,hA,uA,_A,fA,dA,pA,mA,vA,gA=new Ri,yA=new Li,TA=new Li,SA=new Array(10),EA=new Li,AA=new Mi,bA=new Mi,xA=new Vi,CA=new Map,wA=t("Node",(KS=ru("cc.Node"),ZS=Fu(Ri),KS((aE=rE=function(t){function e(e){var i;return(i=t.call(this,e)||this)._uiProps=new gS(K(i)),i._static=!1,i._pos=new Ri,i._rot=new Li,i._scale=new Ri(1,1,1),i._mat=new Vi,J(i,"_lpos",$S,K(i)),J(i,"_lrot",tE,K(i)),J(i,"_lscale",eE,K(i)),J(i,"_layer",iE,K(i)),J(i,"_euler",nE,K(i)),i._dirtyFlags=kh.NONE,i._eulerDirty=!1,i._poolHandle=0,i._poolHandle=Ar.alloc(),Ar.set(i._poolHandle,gr.LAYER,i._layer),i}Y(e,t),e.isNode=function(t){return t instanceof e&&(t.constructor===e||!(t instanceof n.Scene))};var i=e.prototype;return i.destroy=function(){return this._poolHandle&&(Ar.free(this._poolHandle),this._poolHandle=0),t.prototype.destroy.call(this)},i.setParent=function(e,i){void 0===i&&(i=!1),i&&this.updateWorldTransform(),t.prototype.setParent.call(this,e,i)},i._onSetParent=function(e,i){if(t.prototype._onSetParent.call(this,e,i),i){var n=this._parent;n?(n.updateWorldTransform(),Vi.multiply(xA,Vi.invert(xA,n._mat),this._mat),Vi.toRTS(xA,this._lrot,this._lpos,this._lscale)):(Ri.copy(this._lpos,this._pos),Li.copy(this._lrot,this._rot),Ri.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(kh.TRS)},i._onHierarchyChanged=function(e){this.eventProcessor.reattach(),t.prototype._onHierarchyChangedBase.call(this,e)},i._onBatchCreated=function(e){var i;t.prototype._onBatchCreated.call(this,e),Ar.set(this._poolHandle,gr.LAYER,this._layer),Ar.setVec3(this._poolHandle,gr.WORLD_SCALE,this._scale);var n=null===(i=this._prefab)||void 0===i?void 0:i.instance;!e&&n&&sE(this),this.hasChangedFlags=kh.TRS,this._dirtyFlags=kh.TRS;for(var r=this._children.length,a=0;a<r;++a)this._children[a]._onBatchCreated(e);if(!e&&n){var o={};n.targetMap=o,lE(this,o,!0),hE(0,n.mountedChildren,o),uE(0,n.propertyOverrides,o)}_E(this)},i._onBeforeSerialize=function(){this.eulerAngles},i._onPostActivated=function(t){t?(NS.resumeTarget(this),this.invalidateChildren(kh.TRS)):NS.pauseTarget(this)},i.translate=function(t,e){var i=e||Uh.LOCAL;if(i===Uh.LOCAL)Ri.transformQuat(gA,t,this._lrot),this._lpos.x+=gA.x,this._lpos.y+=gA.y,this._lpos.z+=gA.z;else if(i===Uh.WORLD)if(this._parent){Li.invert(yA,this._parent.worldRotation),Ri.transformQuat(gA,t,yA);var n=this.worldScale;this._lpos.x+=gA.x/n.x,this._lpos.y+=gA.y/n.y,this._lpos.z+=gA.z/n.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(kh.POSITION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.POSITION)},i.rotate=function(t,e){var i=e||Uh.LOCAL;if(Li.normalize(yA,t),i===Uh.LOCAL)Li.multiply(this._lrot,this._lrot,yA);else if(i===Uh.WORLD){var n=this.worldRotation;Li.multiply(TA,yA,n),Li.invert(yA,n),Li.multiply(TA,yA,TA),Li.multiply(this._lrot,this._lrot,TA)}this._eulerDirty=!0,this.invalidateChildren(kh.ROTATION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.ROTATION)},i.lookAt=function(t,e){this.getWorldPosition(gA),Ri.subtract(gA,gA,t),Ri.normalize(gA,gA),Li.fromViewUp(yA,gA,e),this.setWorldRotation(yA)},i.invalidateChildren=function(t){var e=this.hasChangedFlags;if((this._dirtyFlags&e&t)!==t){this._dirtyFlags|=t,this.hasChangedFlags=e|t;for(var i=t|kh.POSITION,n=this._children.length,r=0;r<n;++r){var a=this._children[r];a.isValid&&a.invalidateChildren(i)}}},i.updateWorldTransform=function(){if(this._dirtyFlags){for(var t,e=this,i=0;e&&e._dirtyFlags;)SA[i++]=e,e=e._parent;for(var n=0;i;)n|=(t=SA[--i])._dirtyFlags,e?(n&kh.POSITION&&(Ri.transformMat4(t._pos,t._lpos,e._mat),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z,Ar.setVec3(t._poolHandle,gr.WORLD_POSITION,t._pos)),n&kh.RS&&(Vi.fromRTS(t._mat,t._lrot,t._lpos,t._lscale),Vi.multiply(t._mat,e._mat,t._mat),n&kh.ROTATION&&(Li.multiply(t._rot,e._rot,t._lrot),Ar.setVec4(t._poolHandle,gr.WORLD_ROTATION,t._rot)),Mi.fromQuat(AA,Li.conjugate(EA,t._rot)),Mi.multiplyMat4(AA,AA,t._mat),t._scale.x=AA.m00,t._scale.y=AA.m04,t._scale.z=AA.m08,Ar.setVec3(t._poolHandle,gr.WORLD_SCALE,t._scale))):(n&kh.POSITION&&(Ri.copy(t._pos,t._lpos),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z,Ar.setVec3(t._poolHandle,gr.WORLD_POSITION,t._pos)),n&kh.RS&&(n&kh.ROTATION&&(Li.copy(t._rot,t._lrot),Ar.setVec4(t._poolHandle,gr.WORLD_ROTATION,t._rot)),n&kh.SCALE&&(Ri.copy(t._scale,t._lscale),Ar.setVec3(t._poolHandle,gr.WORLD_SCALE,t._scale),Vi.fromRTS(t._mat,t._rot,t._pos,t._scale)))),n!==kh.NONE&&Ar.setMat4(t._poolHandle,gr.WORLD_MATRIX,t._mat),t._dirtyFlags=kh.NONE,e=t}},i.setPosition=function(t,e,i){void 0===e&&void 0===i?Ri.copy(this._lpos,t):void 0===i?Ri.set(this._lpos,t,e,this._lpos.z):Ri.set(this._lpos,t,e,i),this.invalidateChildren(kh.POSITION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.POSITION)},i.getPosition=function(t){return t?Ri.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Ri.copy(new Ri,this._lpos)},i.setRotation=function(t,e,i,n){void 0===e||void 0===i||void 0===n?Li.copy(this._lrot,t):Li.set(this._lrot,t,e,i,n),this._eulerDirty=!0,this.invalidateChildren(kh.ROTATION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.ROTATION)},i.setRotationFromEuler=function(t,e,i){var n=void 0===i?this._euler.z:i;void 0===e?(Ri.copy(this._euler,t),Li.fromEuler(this._lrot,t.x,t.y,t.z)):(Ri.set(this._euler,t,e,n),Li.fromEuler(this._lrot,t,e,n)),this._eulerDirty=!1,this.invalidateChildren(kh.ROTATION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.ROTATION)},i.getRotation=function(t){return t?Li.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Li.copy(new Li,this._lrot)},i.setScale=function(t,e,i){void 0===e&&void 0===i?Ri.copy(this._lscale,t):void 0===i?Ri.set(this._lscale,t,e,this._lscale.z):Ri.set(this._lscale,t,e,i),this.invalidateChildren(kh.SCALE),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.SCALE)},i.getScale=function(t){return t?Ri.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Ri.copy(new Ri,this._lscale)},i.inverseTransformPoint=function(t,e){Ri.copy(t,e);for(var i=this,n=0;i._parent;)SA[n++]=i,i=i._parent;for(;n>=0;)Ri.transformInverseRTS(t,t,i._lrot,i._lpos,i._lscale),i=SA[--n];return t},i.setWorldPosition=function(t,e,i){void 0===e||void 0===i?Ri.copy(this._pos,t):Ri.set(this._pos,t,e,i),Ar.setVec3(this._poolHandle,gr.WORLD_POSITION,this._pos);var n=this._parent,r=this._lpos;n?(n.updateWorldTransform(),Ri.transformMat4(r,this._pos,Vi.invert(xA,n._mat))):Ri.copy(r,this._pos),this.invalidateChildren(kh.POSITION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.POSITION)},i.getWorldPosition=function(t){return this.updateWorldTransform(),t?Ri.copy(t,this._pos):Ri.copy(new Ri,this._pos)},i.setWorldRotation=function(t,e,i,n){void 0===e||void 0===i||void 0===n?Li.copy(this._rot,t):Li.set(this._rot,t,e,i,n),Ar.setVec4(this._poolHandle,gr.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),Li.multiply(this._lrot,Li.conjugate(this._lrot,this._parent._rot),this._rot)):Li.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(kh.ROTATION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.ROTATION)},i.setWorldRotationFromEuler=function(t,e,i){Li.fromEuler(this._rot,t,e,i),this._parent?(this._parent.updateWorldTransform(),Li.multiply(this._lrot,Li.conjugate(this._lrot,this._parent._rot),this._rot)):Li.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(kh.ROTATION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.ROTATION)},i.getWorldRotation=function(t){return this.updateWorldTransform(),t?Li.copy(t,this._rot):Li.copy(new Li,this._rot)},i.setWorldScale=function(t,e,i){void 0===e||void 0===i?Ri.copy(this._scale,t):Ri.set(this._scale,t,e,i),Ar.setVec3(this._poolHandle,gr.WORLD_SCALE,this._scale);var n=this._parent;n?(n.updateWorldTransform(),Mi.fromQuat(AA,Li.conjugate(EA,n._rot)),Mi.multiplyMat4(AA,AA,n._mat),bA.m00=this._scale.x,bA.m04=this._scale.y,bA.m08=this._scale.z,Mi.multiply(AA,bA,Mi.invert(AA,AA)),this._lscale.x=Ri.set(gA,AA.m00,AA.m01,AA.m02).length(),this._lscale.y=Ri.set(gA,AA.m03,AA.m04,AA.m05).length(),this._lscale.z=Ri.set(gA,AA.m06,AA.m07,AA.m08).length()):Ri.copy(this._lscale,this._scale),this.invalidateChildren(kh.SCALE),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.SCALE)},i.getWorldScale=function(t){return this.updateWorldTransform(),t?Ri.copy(t,this._scale):Ri.copy(new Ri,this._scale)},i.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new Vi;return Vi.copy(e,this._mat)},i.getWorldRS=function(t){this.updateWorldTransform();var e=t||new Vi;return Vi.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},i.getWorldRT=function(t){this.updateWorldTransform();var e=t||new Vi;return Vi.fromRT(e,this._rot,this._pos)},i.setRTS=function(t,e,i){var n=0;t&&(n|=kh.ROTATION,void 0!==t.w?(Li.copy(this._lrot,t),this._eulerDirty=!0):(Ri.copy(this._euler,t),Li.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(Ri.copy(this._lpos,e),n|=kh.POSITION),i&&(Ri.copy(this._lscale,i),n|=kh.SCALE),n&&(this.invalidateChildren(n),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,n))},i.pauseSystemEvents=function(t){NS.pauseTarget(this,t)},i.resumeSystemEvents=function(t){NS.resumeTarget(this,t)},q(e,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)},get:function(){return this._eulerDirty&&(Li.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler}},{key:"angle",get:function(){return this._euler.z},set:function(t){Ri.set(this._euler,0,0,t),Li.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(kh.ROTATION),1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Vi.toRTS(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(kh.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(vS.TRANSFORM_CHANGED,kh.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Ri.transformQuat(new Ri,Ri.FORWARD,this.worldRotation)},set:function(t){var e=t.length();Ri.multiplyScalar(gA,t,-1/e),Li.fromViewUp(yA,gA),this.setWorldRotation(yA)}},{key:"layer",set:function(t){this._layer=t,Ar.set(this._poolHandle,gr.LAYER,this._layer),this.emit(vS.LAYER_CHANGED,this._layer)},get:function(){return this._layer}},{key:"hasChangedFlags",get:function(){return CA.get(this)||0},set:function(t){CA.set(this,t),Ar.set(this._poolHandle,gr.FLAGS_CHANGED,t)}}]),e}(oE),rE.bookOfChange=CA,rE.EventType=vS,rE.NodeSpace=Uh,rE.TransformDirtyBit=kh,rE.TransformBit=kh,$S=$((JS=aE).prototype,"_lpos",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri}}),tE=$(JS.prototype,"_lrot",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Li}}),eE=$(JS.prototype,"_lscale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri(1,1,1)}}),iE=$(JS.prototype,"_layer",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fc.Enum.DEFAULT}}),nE=$(JS.prototype,"_euler",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri}}),$(JS.prototype,"eulerAngles",[ZS],Object.getOwnPropertyDescriptor(JS.prototype,"eulerAngles"),JS.prototype),$(JS.prototype,"angle",[yu],Object.getOwnPropertyDescriptor(JS.prototype,"angle"),JS.prototype),$(JS.prototype,"layer",[yu],Object.getOwnPropertyDescriptor(JS.prototype,"layer"),JS.prototype),QS=JS))||QS));n.Node=wA;var RA=ru("cc.TargetInfo")((pE=$((dE=function(){J(this,"localID",pE,this)}).prototype,"localID",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fE=dE))||fE,IA=(mE=ru("cc.TargetOverrideInfo"),vE=Fu(p_),gE=Fu(RA),yE=Fu(wA),TE=Fu(RA),mE((AE=$((EE=function(){J(this,"source",AE,this),J(this,"sourceInfo",bE,this),J(this,"propertyPath",xE,this),J(this,"target",CE,this),J(this,"targetInfo",wE,this)}).prototype,"source",[cu,vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bE=$(EE.prototype,"sourceInfo",[cu,gE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xE=$(EE.prototype,"propertyPath",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CE=$(EE.prototype,"target",[cu,yE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wE=$(EE.prototype,"targetInfo",[cu,TE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SE=EE))||SE),OA=ru("cc.CompPrefabInfo")((OE=$((IE=function(){J(this,"fileId",OE,this)}).prototype,"fileId",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),RE=IE))||RE,PA=(PE=ru("CCPropertyOverrideInfo"),ME=Fu(RA),PE((zE=function(){function t(){J(this,"targetInfo",LE,this),J(this,"propertyPath",BE,this),J(this,"value",FE,this)}return t.prototype.isTarget=function(){},t}(),LE=$((NE=zE).prototype,"targetInfo",[cu,ME],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BE=$(NE.prototype,"propertyPath",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FE=$(NE.prototype,"value",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=NE))||DE),MA=(UE=ru("cc.MountedChildrenInfo"),kE=Fu(RA),GE=Fu([wA]),UE((qE=function(){function t(){J(this,"targetInfo",WE,this),J(this,"nodes",jE,this)}return t.prototype.isTarget=function(){},t}(),WE=$((VE=qE).prototype,"targetInfo",[cu,kE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jE=$(VE.prototype,"nodes",[cu,GE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HE=VE))||HE),DA=(XE=ru("cc.PrefabInstance"),YE=Fu(wA),KE=Fu([MA]),ZE=Fu([PA]),QE=Fu([RA]),XE((aA=function(){function t(){J(this,"fileId",tA,this),J(this,"prefabRootNode",eA,this),J(this,"mountedChildren",iA,this),J(this,"propertyOverrides",nA,this),J(this,"removedComponents",rA,this),this.targetMap={}}var e=t.prototype;return e.findPropertyOverride=function(){},e.removePropertyOverride=function(){},t}(),tA=$(($E=aA).prototype,"fileId",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eA=$($E.prototype,"prefabRootNode",[cu,YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iA=$($E.prototype,"mountedChildren",[cu,KE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nA=$($E.prototype,"propertyOverrides",[cu,ZE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rA=$($E.prototype,"removedComponents",[cu,QE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JE=$E))||JE),NA=(oA=ru("cc.PrefabInfo"),sA=Fu(wA),lA=Fu(n.Prefab),cA=Fu(DA),hA=Fu([IA]),oA((fA=$((_A=function(){J(this,"root",fA,this),J(this,"asset",dA,this),J(this,"fileId",pA,this),J(this,"instance",mA,this),J(this,"targetOverrides",vA,this)}).prototype,"root",[cu,sA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=$(_A.prototype,"asset",[cu,lA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=$(_A.prototype,"fileId",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mA=$(_A.prototype,"instance",[cu,cA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vA=$(_A.prototype,"targetOverrides",[cu,hA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uA=_A))||uA);n._PrefabInfo=NA;var LA,BA,FA,zA,UA,kA,GA,HA,VA,WA,jA,qA,XA,YA,KA=Object.freeze({__proto__:null,TargetInfo:RA,TargetOverrideInfo:IA,CompPrefabInfo:OA,PropertyOverrideInfo:PA,MountedChildrenInfo:MA,PrefabInstance:DA,PrefabInfo:NA,createNodeWithPrefab:sE,generateTargetMap:lE,getTarget:cE,applyMountedChildren:hE,applyPropertyOverrides:uE,applyTargetOverrides:_E}),ZA=he({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),QA=t("Prefab",ru("cc.Prefab")((GA=kA=function(t){function e(){var e;return J(e=t.call(this)||this,"data",FA,K(e)),J(e,"optimizationPolicy",zA,K(e)),J(e,"asyncLoadAssets",UA,K(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}Y(e,t);var i=e.prototype;return i.createNode=function(t){var e=n.instantiate(this);e.name=this.name,t(null,e)},i.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof n._BaseNode&&t,new pS(t,e).result)},i._doInstantiate=function(t){return this.data._prefab||E(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},i._instantiate=function(){var t;return this.optimizationPolicy!==ZA.SINGLE_INSTANCE&&(this.optimizationPolicy===ZA.MULTI_INSTANCE||this._instantiatedTimes+1>=e.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this._instantiatedTimes,t},e}(M_),kA.OptimizationPolicy=ZA,kA.OptimizationPolicyThreshold=3,FA=$((BA=GA).prototype,"data",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zA=$(BA.prototype,"optimizationPolicy",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ZA.AUTO}}),UA=$(BA.prototype,"asyncLoadAssets",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),LA=BA))||LA);le.value(QA,"_utils",KA),n.Prefab=QA,Lt(n,"cc._Prefab","Prefab"),t("PrefabLink",(HA=ru("cc.PrefabLink"),VA=Fu(QA),WA=Tu(),HA((YA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"prefab",XA,K(e)),e}return Y(e,t),e}(Jf),XA=$((qA=YA).prototype,"prefab",[VA,cu,WA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jA=qA))||jA));var JA=new Ri;function $A(t,e,i,n){n||(n=new Ri),t.convertToUINode(e,i,n);var r=i.position;return n.add(r),n}function tb(t,e,i){return i||(i=new Ri),t.worldToScreen(e,i),i.x/=n.view.getScaleX(),i.y/=n.view.getScaleY(),i}var eb=t("convertUtils",{WorldNode3DToLocalNodeUI:$A,WorldNode3DToWorldNodeUI:tb});n.pipelineUtils=eb,lt(n.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=e[0],r=e[3]||JA;return n.convertToUINode(e[1],e[2],r),r.add(e[2].position),e[3]||r.clone()}}]);var ib=new Xi,nb=t("Touch",function(){function t(t,e,i){void 0===i&&(i=0),this._point=new Xi,this._prevPoint=new Xi,this._lastModified=0,this._id=0,this._startPoint=new Xi,this._startPointCaptured=!1,this.setTouchInfo(i,t,e)}q(t,[{key:"lastModified",get:function(){return this._lastModified}}]);var e=t.prototype;return e.getLocation=function(t){return t||(t=new Xi),t.set(this._point.x,this._point.y),t},e.getLocationX=function(){return this._point.x},e.getLocationY=function(){return this._point.y},e.getUILocation=function(t){return t||(t=new Xi),t.set(this._point.x,this._point.y),n.view._convertPointWithScale(t),t},e.getUILocationX=function(){var t=n.view.getViewportRect();return(this._point.x-t.x)/n.view.getScaleX()},e.getUILocationY=function(){var t=n.view.getViewportRect();return(this._point.y-t.y)/n.view.getScaleY()},e.getPreviousLocation=function(t){return t||(t=new Xi),t.set(this._prevPoint.x,this._prevPoint.y),t},e.getUIPreviousLocation=function(t){return t||(t=new Xi),t.set(this._prevPoint.x,this._prevPoint.y),n.view._convertPointWithScale(t),t},e.getStartLocation=function(t){return t||(t=new Xi),t.set(this._startPoint.x,this._startPoint.y),t},e.getUIStartLocation=function(t){return t||(t=new Xi),t.set(this._startPoint.x,this._startPoint.y),n.view._convertPointWithScale(t),t},e.getDelta=function(t){return t||(t=new Xi),t.set(this._point),t.subtract(this._prevPoint),t},e.getUIDelta=function(t){return t||(t=new Xi),ib.set(this._point),ib.subtract(this._prevPoint),t.set(n.view.getScaleX(),n.view.getScaleY()),Xi.divide(t,ib,t),t},e.getLocationInView=function(t){return t||(t=new Xi),t.set(this._point.x,n.view._designResolutionSize.height-this._point.y),t},e.getPreviousLocationInView=function(t){return t||(t=new Xi),t.set(this._prevPoint.x,n.view._designResolutionSize.height-this._prevPoint.y),t},e.getStartLocationInView=function(t){return t||(t=new Xi),t.set(this._startPoint.x,n.view._designResolutionSize.height-this._startPoint.y),t},e.getID=function(){return this._id},e.setTouchInfo=function(t,e,i){void 0===t&&(t=0),this._prevPoint=this._point,this._point=new Xi(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=new Xi(this._point),this._startPointCaptured=!0)},e.setPoint=function(t,e){"object"==typeof t?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t||0,this._point.y=e||0),this._lastModified=n.director.getCurrentTime()},e.setPrevPoint=function(t,e){this._prevPoint="object"==typeof t?new Xi(t.x,t.y):new Xi(t||0,e||0),this._lastModified=n.director.getCurrentTime()},t}());n.Touch=nb;var rb,ab=pe.TOUCH_TIMEOUT,ob=new Xi,sb=new Xi,lb=t("Acceleration",(function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=t,this.y=e,this.z=i,this.timestamp=n}));n.internal.Acceleration=lb;var cb=new(function(){function t(){this._mousePressed=!1,this._isRegisterEvent=!1,this._preTouchPoint=new Xi,this._prevMousePoint=new Xi,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._accelEnabled=!1,this._accelInterval=.2,this._accelMinus=1,this._accelCurTime=0,this._acceleration=null,this._accelDeviceEvent=null,this._glView=null,this._pointLocked=!1}var e=t.prototype;return e.handleTouchesBegin=function(t){for(var e=[],i=this._touchesIntegerDict,n=0;n<t.length;++n){var r=t[n],a=r.getID();if(null!==a&&void 0===i[a]){var o=this._getUnUsedIndex();if(-1===o){T(2300,o);continue}r.getLocation(ob);var s=new nb(ob.x,ob.y,a);this._touches[o]=s,r.getPreviousLocation(ob),s.setPrevPoint(ob),i[a]=o,e.push(s)}}if(e.length>0){var l=new SS(e,!1,SS.BEGAN,pe.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);NS.dispatchEvent(l)}},e.handleTouchesMove=function(t){for(var e=[],i=this._touches,n=0;n<t.length;++n){var r=t[n],a=r.getID();if(null!==a){var o=this._touchesIntegerDict[a];void 0!==o&&i[o]&&(r.getLocation(ob),i[o].setPoint(ob),r.getPreviousLocation(ob),i[o].setPrevPoint(ob),e.push(i[o]))}}if(e.length>0){var s=new SS(e,!1,SS.MOVED,pe.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);NS.dispatchEvent(s)}},e.handleTouchesEnd=function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){var i=new SS(e,!1,SS.ENDED,pe.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);NS.dispatchEvent(i)}this._preTouchPool.length=0},e.handleTouchesCancel=function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){var i=new SS(e,!1,SS.CANCELLED,pe.ENABLE_MULTI_TOUCH?this._getUsefulTouches():e);NS.dispatchEvent(i)}this._preTouchPool.length=0},e.getSetOfTouchesEndOrCancel=function(t){for(var e=[],i=this._touches,n=this._touchesIntegerDict,r=0;r<t.length;++r){var a=t[r],o=a.getID();if(null!==o){var s=n[o];void 0!==s&&i[s]&&(a.getLocation(ob),i[s].setPoint(ob),a.getPreviousLocation(ob),i[s].setPrevPoint(ob),e.push(i[s]),this._removeUsedIndexBit(s),delete n[o])}}return e},e.getHTMLElementPosition=function(t){var e=document.documentElement,i=yv.os===yv.OS_IOS&&yv.isBrowser?window.screenLeft:window.pageXOffset;i-=e.clientLeft;var n=yv.os===yv.OS_IOS&&yv.isBrowser?window.screenTop:window.pageYOffset;if(n-=e.clientTop,t.getBoundingClientRect){var r=t.getBoundingClientRect();return{left:r.left+i,top:r.top+n,width:r.width,height:r.height}}return t instanceof HTMLCanvasElement?{left:i,top:n,width:t.width,height:t.height}:{left:i,top:n,width:parseInt(t.style.width||"0",void 0),height:parseInt(t.style.height||"0",void 0)}},e.getPreTouch=function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},e.setPreTouch=function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},e.getTouchByXY=function(t,e,i,n){var r=this._preTouchPoint,a=this._glView.convertToLocationInView(e,i,n);this._pointLocked&&(a.x=r.x+t.movementX,a.y=r.y-t.movementY);var o=new nb(a.x,a.y,0);return o.setPrevPoint(r.x,r.y),r.x=a.x,r.y=a.y,o},e.getMouseEvent=function(t,e,i){var n=this._prevMousePoint,r=new TS(i,!1,n);return n.x=t.x,n.y=t.y,this._glView._convertMouseToLocation(n,e),r.setLocation(n.x,n.y),r},e.getPointByEvent=function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},e.getTouchesByEvent=function(t,e){for(var i=[],n=this._glView,r=this._preTouchPoint,a=t.changedTouches.length,o=0;o<a;o++){var s=t.changedTouches[o];if(s){var l;l=yv.BROWSER_TYPE_FIREFOX===yv.browserType?n.convertToLocationInView(s.pageX,s.pageY,e,ob):n.convertToLocationInView(s.clientX,s.clientY,e,ob);var c=void 0;if(null!=s.identifier?(c=new nb(l.x,l.y,s.identifier),this.getPreTouch(c).getLocation(sb),c.setPrevPoint(sb.x,sb.y),this.setPreTouch(c)):(c=new nb(l.x,l.y)).setPrevPoint(r.x,r.y),r.x=l.x,r.y=l.y,i.push(c),!pe.ENABLE_MULTI_TOUCH)break}}return i},e.registerSystemEvent=function(t){if(!this._isRegisterEvent&&t){this._glView=n.view;var e=yv.isMobile,i=yv.capabilities.mouse,r=yv.capabilities.touches;i&&this._registerMouseEvents(t,e),window.navigator.msPointerEnabled&&this._registerMousePointerEvents(t),r&&this._registerTouchEvents(t),this._registerKeyboardEvent(),this._isRegisterEvent=!0}},e.setAccelerometerEnabled=function(t){if(this._accelEnabled!==t){this._accelEnabled=t;var e=n.director.getScheduler();e.enableForTarget(this),this._accelEnabled?(this._registerAccelerometerEvent(),this._accelCurTime=0,e.scheduleUpdate(this)):(this._unregisterAccelerometerEvent(),this._accelCurTime=0,e.unscheduleUpdate(this))}},e.didAccelerate=function(t){if(this._accelEnabled){var e=this._acceleration,i=0,r=0,a=0;if(this._accelDeviceEvent===window.DeviceMotionEvent){var o=t.accelerationIncludingGravity;o&&(i=this._accelMinus*(o.x||0)*.1,r=this._accelMinus*(o.y||0)*.1,a=.1*(o.z||0))}else{var s=t;i=(s.gamma||0)/90*.981,r=-(s.beta||0)/90*.981,a=(s.alpha||0)/90*.981}if(n.view._isRotated){var l=i;i=-r,r=l}e.x=i,e.y=r,e.z=a,e.timestamp=t.timeStamp||Date.now();var c=e.x;90===window.orientation?(e.x=-e.y,e.y=c):-90===window.orientation?(e.x=e.y,e.y=-c):180===window.orientation&&(e.x=-e.x,e.y=-e.y),n.sys.os===n.sys.OS_ANDROID&&n.sys.browserType!==n.sys.BROWSER_TYPE_MOBILE_QQ&&(e.x=-e.x,e.y=-e.y)}},e.update=function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,NS.dispatchEvent(new ES(this._acceleration))),this._accelCurTime+=t},e.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},e._getUnUsedIndex=function(){for(var t=this._indexBitsUsed,e=n.director.getCurrentTime(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var r=this._touches[i];if(e-r.lastModified>ab){this._removeUsedIndexBit(i);var a=r.getID();return null!==a&&delete this._touchesIntegerDict[a],i}t>>=1}return-1},e._removeUsedIndexBit=function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},e._registerMouseEvents=function(t,e){this._registerPointerLockEvent(),e||this._registerWindowMouseEvents(t),this._registerElementMouseEvents(t,e)},e._registerPointerLockEvent=function(){var t=this,e=function(){var e=n.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e?t._pointLocked=!0:t._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",e,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",e,!1)},e._registerWindowMouseEvents=function(t){var e=this;window.addEventListener("mousedown",(function(){e._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(i){if(e._mousePressed){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);if(!rn(n.left,n.top,n.width,n.height).contains(new Xi(r.x,r.y))){e.handleTouchesEnd([e.getTouchByXY(i,r.x,r.y,n)]);var a=e.getMouseEvent(r,n,TS.UP);a.setButton(i.button),NS.dispatchEvent(a)}}}),!1)},e._registerElementMouseEvents=function(t,e){var i=this,n=function(e,n,r){t.addEventListener(e,(function(e){var a=i.getHTMLElementPosition(t),o=i.getPointByEvent(e,a),s=i.getMouseEvent(o,a,n);s.setButton(e.button),r(e,s,o,a),NS.dispatchEvent(s),e.stopPropagation(),e.preventDefault()}))};e||(n("mousedown",TS.DOWN,(function(e,n,r,a){i._mousePressed=!0,i.handleTouchesBegin([i.getTouchByXY(e,r.x,r.y,a)]),t.focus()})),n("mouseup",TS.UP,(function(t,e,n,r){i._mousePressed=!1,i.handleTouchesEnd([i.getTouchByXY(t,n.x,n.y,r)])})),n("mousemove",TS.MOVE,(function(t,e,n,r){i.handleTouchesMove([i.getTouchByXY(t,n.x,n.y,r)]),i._mousePressed||e.setButton(TS.BUTTON_MISSING),void 0!==t.movementX&&void 0!==t.movementY&&(e.movementX=t.movementX,e.movementY=t.movementY)}))),n("mousewheel",TS.SCROLL,(function(t,e){e.setScrollData(0,t.wheelDelta)})),n("DOMMouseScroll",TS.SCROLL,(function(t,e){e.setScrollData(0,-120*t.detail)}))},e._registerMousePointerEvents=function(t){var e=this,i={MSPointerDown:this.handleTouchesBegin,MSPointerMove:this.handleTouchesMove,MSPointerUp:this.handleTouchesEnd,MSPointerCancel:this.handleTouchesCancel},n=function(n){var r=i[n];t.addEventListener(n,(function(i){var n=e.getHTMLElementPosition(t);n.left-=document.documentElement.scrollLeft,n.top-=document.documentElement.scrollTop,r.call(e,[e.getTouchByXY(i,i.clientX,i.clientY,n)]),i.stopPropagation()}),!1)};for(var r in i)n(r)},e._registerTouchEvents=function(t){var e=this,i=function(i){return function(n){if(n.changedTouches){var r=e.getHTMLElementPosition(t),a=document.body;r.left-=a.scrollLeft||0,r.top-=a.scrollTop||0,i(e.getTouchesByEvent(n,r)),n.stopPropagation(),n.preventDefault()}}};t.addEventListener("touchstart",i((function(i){e.handleTouchesBegin(i),t.focus()})),!1),t.addEventListener("touchmove",i((function(t){e.handleTouchesMove(t)})),!1),t.addEventListener("touchend",i((function(t){e.handleTouchesEnd(t)})),!1),t.addEventListener("touchcancel",i((function(t){e.handleTouchesCancel(t)})),!1)},e._registerKeyboardEvent=function(){var t=n.game.canvas;t.addEventListener("keydown",(function(t){NS.dispatchEvent(new AS(t,!0)),t.stopPropagation(),t.preventDefault()}),!1),t.addEventListener("keyup",(function(t){NS.dispatchEvent(new AS(t,!1)),t.stopPropagation(),t.preventDefault()}),!1)},e._registerAccelerometerEvent=function(){var t=this;this._acceleration=new lb,this._accelDeviceEvent=window.DeviceMotionEvent||window.DeviceOrientationEvent,n.sys.browserType===n.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";rb=function(){return t.didAccelerate.apply(t,arguments)},window.addEventListener(e,rb,!1)},e._unregisterAccelerometerEvent=function(){var t=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";rb&&window.removeEventListener(t,rb,!1)},e._getUsefulTouches=function(){var t=[],e=this._touchesIntegerDict;for(var i in e){var n=e[parseInt(i)];if(null!=n){var r=this._touches[n];t.push(r)}}return t},t}());n.internal.inputManager=cb;var hb=t("Game",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).frame=null,e.container=null,e.canvas=null,e.renderType=-1,e.eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e.config={},e.onStart=null,e.collisionMatrix=[],e.groupList=[],e._persistRootNodes={},e._paused=!0,e._configLoaded=!1,e._isCloning=!1,e._inited=!1,e._engineInited=!1,e._rendererInitialized=!1,e._gfxDevice=null,e._intervalId=null,e}Y(e,t);var i=e.prototype;return i.setFrameRate=function(t){var e=this.config;"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),e.frameRate=t,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},i.getFrameRate=function(){return this.config.frameRate||0},i.step=function(){n.director.mainLoop()},i.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},i.resume=function(){this._paused&&this._runMainLoop()},i.isPaused=function(){return this._paused},i.restart=function(){var t=this;return new Promise((function(t){return n.director.once(n.Director.EVENT_AFTER_DRAW,(function(){return t()}))})).then((function(){for(var i in t._persistRootNodes)t.removePersistRootNode(t._persistRootNodes[i]);return n.director.getScene().destroy(),n.Object._deferredDestroy(),n.director.reset(),t.pause(),t._setRenderPipelineNShowSplash().then((function(){t.resume(),t._safeEmit(e.EVENT_RESTART)}))}))},i.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),window.close()},i.on=function(t,i,n,r){return this._engineInited&&t===e.EVENT_ENGINE_INITED?i.call(n):this.eventTargetOn(t,i,n,r)},i.once=function(t,i,n){return this._engineInited&&t===e.EVENT_ENGINE_INITED?i.call(n):this.eventTargetOnce(t,i,n)},i.init=function(t){var e=this;return this._initConfig(t),this.config.assetOptions&&n.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return e._initEvents(),n.director.root.dataPoolManager&&n.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(t.customJointTextureLayouts),e._engineInited}))},i.run=function(t,e){var i,n=this;return"function"!=typeof t&&t?(i=this.init(t),this.onStart=null!=e?e:null):this.onStart=null!=t?t:null,Promise.resolve(i).then((function(){return ub.config.registerSystemEvent&&cb.registerSystemEvent(ub.canvas),n._setRenderPipelineNShowSplash()}))},i.addPersistRootNode=function(t){if(n.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=n.director._scene;if(n.isValid(i))if(t.parent){if(!(t.parent instanceof n.Scene))return void E(3801);if(t.parent!==i)return void E(3802);t._originalSceneId=i.uuid}else t.parent=i;this._persistRootNodes[e]=t,t._persistNode=!0,n.assetManager._releaseManager._addPersistNodeRef(t)}}else E(3800)},i.removePersistRootNode=function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,t._originalSceneId="",n.assetManager._releaseManager._removePersistNodeRef(t))},i.isPersistRootNode=function(t){return!!t._persistNode},i._initEngine=function(){var t=this;return this._initDevice(),Promise.resolve(n.director._init()).then((function(){_("Cocos Creator v"+r),t.emit(e.EVENT_ENGINE_INITED),t._engineInited=!0,n.internal.dynamicAtlasManager.enabled=!pe.CLEANUP_IMAGE_CACHE}))},i._setAnimFrame=function(){this._lastTime=performance.now();var t=this.config.frameRate;this._frameTime=1e3/t,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var e=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==t&&30!==t?(window.rAF=e?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=e||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},i._stTimeWithRAF=function(t){var e=performance.now(),i=Math.max(0,e-ub._lastTime),n=Math.max(0,ub._frameTime-i),r=window.setTimeout((function(){window.requestAnimationFrame(t)}),n);return ub._lastTime=e+n,r},i._stTime=function(t){var e=performance.now(),i=Math.max(0,e-ub._lastTime),n=Math.max(0,ub._frameTime-i),r=window.setTimeout(t,n);return ub._lastTime=e+n,r},i._ctTime=function(t){window.clearTimeout(t)},i._runMainLoop=function(){var t=this;if(this._inited){var e,i=this.config,r=n.director,a=i.frameRate;if(O(!!i.showFPS),r.startAnimation(),30===a){var o=!0;e=function(i){t._intervalId=window.rAF(e),(o=!o)||r.mainLoop(i)}}else e=function(i){t._intervalId=window.rAF(e),r.mainLoop(i)};this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF(e),this._paused=!1}},i._initConfig=function(t){"number"!=typeof t.debugMode&&(t.debugMode=x.NONE),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||e>2||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=!!t.showFPS,this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],m(t.debugMode),this.config=t,this._configLoaded=!0,this._setAnimFrame()},i._determineRenderType=function(){var t=this.config,i=parseInt(t.renderMode,10);this.renderType=e.RENDER_TYPE_CANVAS;var r=!1;if(0===i?n.sys.capabilities.opengl?(this.renderType=e.RENDER_TYPE_WEBGL,r=!0):n.sys.capabilities.canvas&&(this.renderType=e.RENDER_TYPE_CANVAS,r=!0):1===i&&n.sys.capabilities.canvas?(this.renderType=e.RENDER_TYPE_CANVAS,r=!0):2===i&&n.sys.capabilities.opengl&&(this.renderType=e.RENDER_TYPE_WEBGL,r=!0),!r)throw new Error(R(3820,i))},i._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===e.RENDER_TYPE_WEBGL){var t=[],i=!!window.WebGL2RenderingContext,r=window.navigator.userAgent.toLowerCase();(-1!==r.indexOf("safari")&&-1===r.indexOf("chrome")||yv.browserType===yv.BROWSER_TYPE_UC)&&(i=!1),i&&n.WebGL2Device&&t.push(n.WebGL2Device),n.WebGLDevice&&t.push(n.WebGLDevice);for(var a=new ko(this.canvas,pe.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,yv.windowPixelResolution.width,yv.windowPixelResolution.height,Xc),o=0;o<t.length&&(this._gfxDevice=new t[o],!this._gfxDevice.initialize(a));o++);}if(!this._gfxDevice)return d("can not support canvas rendering in 3D"),void(this.renderType=e.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){return!1}}},i._initEvents=function(){var t,i=this,n=window;void 0!==document.hidden?t="hidden":void 0!==document.mozHidden?t="mozHidden":void 0!==document.msHidden?t="msHidden":void 0!==document.webkitHidden&&(t="webkitHidden");var r=!1,a=this;function o(){r||(r=!0,a.emit(e.EVENT_HIDE))}function s(t,i,n,o,s){r&&(r=!1,a.emit(e.EVENT_SHOW,t,i,n,o,s))}if(t)for(var l=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],c=0;c<l.length;c++)document.addEventListener(l[c],(function(e){var i=document[t];(i=i||e.hidden)?o():s()}));else n.addEventListener("blur",o),n.addEventListener("focus",s);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(n.onfocus=s),"onpageshow"in window&&"onpagehide"in window&&(n.addEventListener("pagehide",o),n.addEventListener("pageshow",s),document.addEventListener("pagehide",o),document.addEventListener("pageshow",s)),this.on(e.EVENT_HIDE,(function(){i.pause()})),this.on(e.EVENT_SHOW,(function(){i.resume()}))},i._setRenderPipelineNShowSplash=function(){var t=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(t._showSplashScreen()).then((function(){t._inited=!0,t._setAnimFrame(),t._runMainLoop(),t._safeEmit(e.EVENT_GAME_INITED),t.onStart&&t.onStart()}))}))},i._setupRenderPipeline=function(){var t=this,e=this.config.renderPipeline;return e?new Promise((function(t,i){n.assetManager.loadAny(e,(function(e,n){return!e&&n instanceof qv?t(n):i(e)}))})).then((function(e){t._setRenderPipeline(e)})).catch((function(i){f(i),f("Failed load render pipeline: "+e+", engine failed to initialize, will fallback to default pipeline"),t._setRenderPipeline()})):this._setRenderPipeline()},i._showSplashScreen=function(){if(n.internal.SplashScreen){var t=n.internal.SplashScreen.instance;return t.main(n.director.root),new Promise((function(e){t.setOnFinish((function(){return e()})),t.loadFinish=!0}))}return null},i._setRenderPipeline=function(t){n.director.root.setRenderPipeline(t)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(e.EVENT_RENDERER_INITED)},i._safeEmit=function(t){this.emit(t)},q(e,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),e}(P_));hb.EVENT_HIDE="game_on_hide",hb.EVENT_SHOW="game_on_show",hb.EVENT_LOW_MEMORY="game_on_low_memory",hb.EVENT_GAME_INITED="game_inited",hb.EVENT_ENGINE_INITED="engine_inited",hb.EVENT_RENDERER_INITED="renderer_inited",hb.EVENT_RESTART="game_on_restart",hb.RENDER_TYPE_CANVAS=0,hb.RENDER_TYPE_WEBGL=1,hb.RENDER_TYPE_OPENGL=2,n.Game=hb;var ub=t("game",n.game=new hb),_b={topLeft:n.v2(0,0),topRight:n.v2(0,0),top:n.v2(0,0),bottomLeft:n.v2(0,0),bottomRight:n.v2(0,0),bottom:n.v2(0,0),center:n.v2(0,0),left:n.v2(0,0),right:n.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,a=r+i,o=n+e;this.topLeft.x=n,this.topLeft.y=a,this.topRight.x=o,this.topRight.y=a,this.top.x=n+e/2,this.top.y=a,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}};n.visibleRect=_b;var fb=new(function(){function t(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=n.sys.browserType}var e=t.prototype;return e.init=function(){this.html=document.getElementsByTagName("html")[0]},e.availWidth=function(t){return n.sys.isMobile||!t||t===this.html?window.innerWidth:t.clientWidth},e.availHeight=function(t){return n.sys.isMobile||!t||t===this.html?window.innerHeight:t.clientHeight},t}());switch(n.sys.os===n.sys.OS_IOS&&(fb.adaptationType=n.sys.BROWSER_TYPE_SAFARI),fb.adaptationType){case n.sys.BROWSER_TYPE_SAFARI:fb.meta["minimal-ui"]="true",fb.availWidth=function(t){return t.clientWidth},fb.availHeight=function(t){return t.clientHeight};break;case n.sys.BROWSER_TYPE_SOUGOU:case n.sys.BROWSER_TYPE_UC:fb.availWidth=function(t){return t.clientWidth},fb.availHeight=function(t){return t.clientHeight}}var db=t("View",function(t){function e(){var e;(e=t.call(this)||this)._resizeWithBrowserSize=void 0,e._designResolutionSize=void 0,e._originalDesignResolutionSize=void 0,e._frameSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._devicePixelRatio=void 0,e._maxPixelRatio=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resizing=void 0,e._orientationChanging=void 0,e._isRotated=void 0,e._orientation=void 0,e._isAdjustViewport=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0;var i=pb,r=mb;return e._frameSize=new tn(0,0),e._designResolutionSize=new tn(0,0),e._originalDesignResolutionSize=new tn(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new nn(0,0,0,0),e._visibleRect=new nn(0,0,0,0),e._autoFullScreen=!1,e._devicePixelRatio=1,e._maxPixelRatio=2,e._retinaEnabled=!1,e._resizeCallback=null,e._resizing=!1,e._resizeWithBrowserSize=!1,e._orientationChanging=!0,e._isRotated=!1,e._orientation=n.macro.ORIENTATION_AUTO,e._isAdjustViewport=!0,e._rpExactFit=new vb(i.EQUAL_TO_FRAME,r.EXACT_FIT),e._rpShowAll=new vb(i.EQUAL_TO_FRAME,r.SHOW_ALL),e._rpNoBorder=new vb(i.EQUAL_TO_FRAME,r.NO_BORDER),e._rpFixedHeight=new vb(i.EQUAL_TO_FRAME,r.FIXED_HEIGHT),e._rpFixedWidth=new vb(i.EQUAL_TO_FRAME,r.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,n.game.once(n.Game.EVENT_ENGINE_INITED,e.init,K(e)),e}Y(e,t);var i=e.prototype;return i.init=function(){fb.init(),this._initFrameSize();var t=n.game.canvas.width,e=n.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,n.winSize.width=this._visibleRect.width,n.winSize.height=this._visibleRect.height,n.visibleRect&&n.visibleRect.init(this._visibleRect)},i.resizeWithBrowserSize=function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},i.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},i.setOrientation=function(t){(t&=n.macro.ORIENTATION_AUTO)&&this._orientation!==t&&(this._orientation=t)},i.adjustViewportMeta=function(t){this._isAdjustViewport=t},i.enableRetina=function(t){this._retinaEnabled=!!t},i.isRetinaEnabled=function(){return this._retinaEnabled},i.enableAutoFullScreen=function(t){t&&t!==this._autoFullScreen&&n.sys.isMobile&&n.sys.browserType!==n.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,n.screen.autoFullScreen(n.game.frame)):this._autoFullScreen=!1},i.isAutoFullScreenEnabled=function(){return this._autoFullScreen},i.setCanvasSize=function(t,e){var i=n.game.canvas,r=n.game.container;this._devicePixelRatio=window.devicePixelRatio,i.width=yv.windowPixelResolution.width,i.height=yv.windowPixelResolution.height,i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",this._resizeEvent()},i.getCanvasSize=function(){return new tn(n.game.canvas.width,n.game.canvas.height)},i.getFrameSize=function(){return new tn(this._frameSize.width,this._frameSize.height)},i.setFrameSize=function(t,e){this._frameSize.width=t,this._frameSize.height=e,n.game.frame.style.width=t+"px",n.game.frame.style.height=e+"px",this._resizeEvent()},i.getVisibleSize=function(){return new tn(this._visibleRect.width,this._visibleRect.height)},i.getVisibleSizeInPixel=function(){return new tn(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},i.getVisibleOrigin=function(){return new Xi(this._visibleRect.x,this._visibleRect.y)},i.getVisibleOriginInPixel=function(){return new Xi(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},i.getResolutionPolicy=function(){return this._resolutionPolicy},i.setResolutionPolicy=function(t){if(t instanceof vb)this._resolutionPolicy=t;else{var e=vb;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},i.setDesignResolutionSize=function(t,e,i){if(t>0&&e>0){this.setResolutionPolicy(i);var r=this._resolutionPolicy;if(r&&r.preApply(this),n.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),r){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var a=r.apply(this,this._designResolutionSize);if(a.scale&&2===a.scale.length&&(this._scaleX=a.scale[0],this._scaleY=a.scale[1]),a.viewport){var o=this._viewportRect,s=this._visibleRect,l=a.viewport;o.x=l.x,o.y=l.y,o.width=l.width,o.height=l.height,s.x=0,s.y=0,s.width=l.width/this._scaleX,s.height=l.height/this._scaleY}r.postApply(this),n.winSize.width=this._visibleRect.width,n.winSize.height=this._visibleRect.height,_b&&_b.init(this._visibleRect),this.emit("design-resolution-changed")}else T(2201)}else b(2200)},i.getDesignResolutionSize=function(){return new tn(this._designResolutionSize.width,this._designResolutionSize.height)},i.setRealPixelResolution=function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},i.getViewportRect=function(){return this._viewportRect},i.getScaleX=function(){return this._scaleX},i.getScaleY=function(){return this._scaleY},i.getDevicePixelRatio=function(){return this._devicePixelRatio},i.convertToLocationInView=function(t,e,i,r){var a=r||new Xi,o=this._devicePixelRatio*(t-i.left),s=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?(a.x=n.game.canvas.width-s,a.y=o):(a.x=o,a.y=s),n.GAME_VIEW&&(a.x/=n.gameView.canvas.width/n.game.canvas.width,a.y/=n.gameView.canvas.height/n.game.canvas.height),a},i._convertPointWithScale=function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},i._resizeEvent=function(){var t=n.view,e=t._frameSize.width,i=t._frameSize.height,r=t._isRotated;if(n.sys.isMobile){var a=n.game.container.style,o=a.margin;a.margin="0",a.display="none",t._initFrameSize(),a.margin=o,a.display="block"}else t._initFrameSize();if(t._orientationChanging||t._isRotated!==r||t._frameSize.width!==e||t._frameSize.height!==i){var s=t._originalDesignResolutionSize.width,l=t._originalDesignResolutionSize.height;t._resizing=!0,s>0&&t.setDesignResolutionSize(s,l,t._resolutionPolicy),t._resizing=!1,t.emit("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},i._orientationChange=function(){n.view._orientationChanging=!0,n.view._resizeEvent()},i._initFrameSize=function(){var t=this._frameSize,e=fb.availWidth(n.game.frame),i=fb.availHeight(n.game.frame),r=e>=i;!n.sys.isMobile||r&&this._orientation&n.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&n.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,n.game.container.style["-webkit-transform"]="rotate(0deg)",n.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,n.game.container.style["-webkit-transform"]="rotate(90deg)",n.game.container.style.transform="rotate(90deg)",n.game.container.style["-webkit-transform-origin"]="0px 0px 0px",n.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,n.game.canvas.style["-webkit-transform"]="translateZ(0px)",n.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){n.view._orientationChanging=!1}),1e3)},i._adjustSizeKeepCanvasSize=function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},i._setViewportMeta=function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,a,o=document.getElementsByName("viewport"),s=o?o[0]:null;for(r in n=s?s.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1===n.indexOf(r)?n+=","+r+"="+t[r]:e&&(a=new RegExp(r+"s*=s*[^,]+"),n=n.replace(a,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,s&&(s.content=n),document.head.appendChild(i)},i._adjustViewportMeta=function(){this._isAdjustViewport&&(this._setViewportMeta(fb.meta,!1),this._isAdjustViewport=!1)},i._convertMouseToLocation=function(t,e){t.x=this._devicePixelRatio*(t.x-e.left),t.y=this._devicePixelRatio*(e.top+e.height-t.y),n.GAME_VIEW&&(t.x/=n.gameView.canvas.width/n.game.canvas.width,t.y/=n.gameView.canvas.height/n.game.canvas.height)},i._convertTouchWidthScale=function(t){var e=this._viewportRect,i=this._scaleX,n=this._scaleY;t._point.x=(t._point.x-e.x)/i,t._point.y=(t._point.y-e.y)/n,t._prevPoint.x=(t._prevPoint.x-e.x)/i,t._prevPoint.y=(t._prevPoint.y-e.y)/n},i._convertTouchesWithScale=function(t){for(var e,i,n=this._viewportRect,r=this._scaleX,a=this._scaleY,o=0;o<t.length;o++){var s=t[o];e=s._point,i=s._prevPoint,e.x=(e.x-n.x)/r,e.y=(e.y-n.y)/a,i.x=(i.x-n.x)/r,i.y=(i.y-n.y)/a}},e}(P_));db.instance=void 0;var pb=function(){function t(){this.name="ContainerStrategy"}var e=t.prototype;return e.preApply=function(){},e.apply=function(){},e.postApply=function(){},e._setupContainer=function(t,e,i){var r=n.game.canvas,a=n.game.container;n.sys.os===n.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),a.style.width=r.style.width=e+"px",a.style.height=r.style.height=i+"px",t._devicePixelRatio=1,t.isRetinaEnabled()&&(t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),r.width=e*t._devicePixelRatio,r.height=i*t._devicePixelRatio},e._fixContainer=function(){document.body.insertBefore(n.game.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=n.game.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0},t}();pb.EQUAL_TO_FRAME=void 0,pb.PROPORTION_TO_FRAME=void 0;var mb=function(){function t(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var e=t.prototype;return e.preApply=function(){},e.apply=function(){return{scale:[1,1]}},e.postApply=function(){},e._buildResult=function(t,e,i,n,r,a){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var o=new nn(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return this._result.scale=[r,a],this._result.viewport=o,this._result},t}();mb.EXACT_FIT=void 0,mb.SHOW_ALL=void 0,mb.NO_BORDER=void 0,mb.FIXED_HEIGHT=void 0,mb.FIXED_WIDTH=void 0,function(){var t=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="EqualToFrame",e}return Y(e,t),e.prototype.apply=function(t){var e=t._frameSize.height,i=n.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px"},e}(pb),e=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="ProportionalToFrame",e}return Y(e,t),e.prototype.apply=function(t,e){var i,r,a=t._frameSize.width,o=t._frameSize.height,s=n.game.container.style,l=e.width,c=e.height,h=a/l,u=o/c;h<u?(i=a,r=c*h):(i=l*u,r=o);var _=Math.round((a-i)/2),f=Math.round((o-r)/2);i=a-2*_,r=o-2*f,this._setupContainer(t,i,r),t._isRotated?s.margin="0 0 0 "+o+"px":s.margin="0px",s.paddingLeft=_+"px",s.paddingRight=_+"px",s.paddingTop=f+"px",s.paddingBottom=f+"px"},e}(pb),i=("undefined"==typeof window?global:window).__globalAdapter;i&&(i.adaptContainerStrategy&&i.adaptContainerStrategy(pb.prototype),i.adaptView&&i.adaptView(db.prototype)),pb.EQUAL_TO_FRAME=new t,pb.PROPORTION_TO_FRAME=new e;var r=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="ExactFit",e}return Y(e,t),e.prototype.apply=function(t,e){var i=n.game.canvas.width,r=n.game.canvas.height,a=i/e.width,o=r/e.height;return this._buildResult(i,r,i,r,a,o)},e}(mb),a=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="ShowAll",e}return Y(e,t),e.prototype.apply=function(t,e){var i,r,a=n.game.canvas.width,o=n.game.canvas.height,s=e.width,l=e.height,c=a/s,h=o/l,u=0;return c<h?(i=a,r=l*(u=c)):(i=s*(u=h),r=o),this._buildResult(a,o,i,r,u,u)},e}(mb),o=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="NoBorder",e}return Y(e,t),e.prototype.apply=function(t,e){var i,r,a,o=n.game.canvas.width,s=n.game.canvas.height,l=e.width,c=e.height,h=o/l,u=s/c;return h<u?(r=l*(i=u),a=s):(r=o,a=c*(i=h)),this._buildResult(o,s,r,a,i,i)},e}(mb),s=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="FixedHeight",e}return Y(e,t),e.prototype.apply=function(t,e){var i=n.game.canvas.width,r=n.game.canvas.height,a=r/e.height,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}(mb),l=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="FixedWidth",e}return Y(e,t),e.prototype.apply=function(t,e){var i=n.game.canvas.width,r=n.game.canvas.height,a=i/e.width,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}(mb);mb.EXACT_FIT=new r,mb.SHOW_ALL=new a,mb.NO_BORDER=new o,mb.FIXED_HEIGHT=new s,mb.FIXED_WIDTH=new l}();var vb=t("ResolutionPolicy",function(){function t(t,e){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)}var e=t.prototype;return e.preApply=function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},e.apply=function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},e.postApply=function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},e.setContainerStrategy=function(t){t instanceof pb&&(this._containerStrategy=t)},e.setContentStrategy=function(t){t instanceof mb&&(this._contentStrategy=t)},q(t,[{key:"canvasSize",get:function(){return new Xi(n.game.canvas.width,n.game.canvas.height)}}]),t}());vb.EXACT_FIT=0,vb.NO_BORDER=1,vb.SHOW_ALL=2,vb.FIXED_HEIGHT=3,vb.FIXED_WIDTH=4,vb.UNKNOWN=5,vb.ContainerStrategy=pb,vb.ContentStrategy=mb,n.ResolutionPolicy=vb;var gb=t("view",db.instance=n.view=new db);n.winSize=new tn,ct(db.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),lt(vS,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var yb=null,Tb=null,Sb=null,Eb=null,Ab=t("SystemEvent",function(t){function e(){return t.call(this)||this}Y(e,t);var i=e.prototype;return i.setAccelerometerEnabled=function(t){t&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(t){T(3520,t),cb.setAccelerometerEnabled("granted"===t)})).catch((function(t){E(3521,t.message),cb.setAccelerometerEnabled(!1)})):cb.setAccelerometerEnabled(t)},i.setAccelerometerInterval=function(t){cb.setAccelerometerInterval(t)},i.on=function(e,i,r,a){return t.prototype.on.call(this,e,i,r,a),e!==vS.KEY_DOWN&&e!==vS.KEY_UP||yb||(yb=bS.create({event:bS.KEYBOARD,onKeyPressed:function(t,e){e.type=vS.KEY_DOWN,bb.emit(e.type,e)},onKeyReleased:function(t,e){e.type=vS.KEY_UP,bb.emit(e.type,e)}}),NS.addListener(yb,256)),e===vS.DEVICEMOTION&&(Tb||(Tb=bS.create({event:bS.ACCELERATION,callback:function(t,e){e.type=vS.DEVICEMOTION,n.systemEvent.emit(e.type,e)}}),NS.addListener(Tb,256))),e!==vS.TOUCH_START&&e!==vS.TOUCH_MOVE&&e!==vS.TOUCH_END&&e!==vS.TOUCH_CANCEL||Sb||(Sb=bS.create({event:bS.TOUCH_ONE_BY_ONE,onTouchBegan:function(t,e){return e.type=vS.TOUCH_START,n.systemEvent.emit(e.type,t,e),!0},onTouchMoved:function(t,e){e.type=vS.TOUCH_MOVE,n.systemEvent.emit(e.type,t,e)},onTouchEnded:function(t,e){e.type=vS.TOUCH_END,n.systemEvent.emit(e.type,t,e)},onTouchCancelled:function(t,e){e.type=vS.TOUCH_CANCEL,n.systemEvent.emit(e.type,t,e)}}),NS.addListener(Sb,256)),e!==vS.MOUSE_DOWN&&e!==vS.MOUSE_MOVE&&e!==vS.MOUSE_UP&&e!==vS.MOUSE_WHEEL||Eb||(Eb=bS.create({event:bS.MOUSE,onMouseDown:function(t){t.type=vS.MOUSE_DOWN,n.systemEvent.emit(t.type,t)},onMouseMove:function(t){t.type=vS.MOUSE_MOVE,n.systemEvent.emit(t.type,t)},onMouseUp:function(t){t.type=vS.MOUSE_UP,n.systemEvent.emit(t.type,t)},onMouseScroll:function(t){t.type=vS.MOUSE_WHEEL,n.systemEvent.emit(t.type,t)}}),NS.addListener(Eb,256)),i},i.off=function(e,i,n){if(t.prototype.off.call(this,e,i,n),yb&&(e===vS.KEY_DOWN||e===vS.KEY_UP)){var r=this.hasEventListener(vS.KEY_DOWN),a=this.hasEventListener(vS.KEY_UP);r||a||(NS.removeListener(yb),yb=null)}if(Tb&&e===vS.DEVICEMOTION&&(NS.removeListener(Tb),Tb=null),Sb&&(e===vS.TOUCH_START||e===vS.TOUCH_MOVE||e===vS.TOUCH_END||e===vS.TOUCH_CANCEL)){var o=this.hasEventListener(vS.TOUCH_START),s=this.hasEventListener(vS.TOUCH_MOVE),l=this.hasEventListener(vS.TOUCH_END),c=this.hasEventListener(vS.TOUCH_CANCEL);o||s||l||c||(NS.removeListener(Sb),Sb=null)}if(Eb&&(e===vS.MOUSE_DOWN||e===vS.MOUSE_MOVE||e===vS.MOUSE_UP||e===vS.MOUSE_WHEEL)){var h=this.hasEventListener(vS.MOUSE_DOWN),u=this.hasEventListener(vS.MOUSE_MOVE),_=this.hasEventListener(vS.MOUSE_UP),f=this.hasEventListener(vS.MOUSE_WHEEL);h||u||_||f||(NS.removeListener(Eb),Eb=null)}},e}(P_));Ab.EventType=vS,n.SystemEvent=Ab;var bb=t("systemEvent",new Ab);n.systemEvent=bb;var xb=t("screen",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){var t,e,i;this._fn={};var n,r=this._fnMap;for(t=0,e=r.length;t<e;t++)if((i=r[t])&&void 0!==document[i[1]]){for(t=0,n=i.length;t<n;t++)this._fn[r[0][t]]=i[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(t,e,i){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var n=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(n,this._onfullscreenchange),this._onfullscreenchange=e,document.addEventListener(n,e,!1)}if(i){var r=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(r,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(r,i,{once:!0})}var a=t[this._fn.requestFullscreen]();return window.Promise&&a instanceof Promise&&a.catch((function(){})),a}},exitFullScreen:function(){var t;return this.fullScreen()&&(t=document[this._fn.exitFullscreen]()).catch((function(){})),t},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e)},disableAutoFullScreen:function(t){if(this._preOnTouch){var e=n.game.canvas||t,i=this._touchEvent;e.removeEventListener(i,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(t,e){var i=this,r=n.game.canvas||t,a=this._fn.fullscreenerror,o=this._touchEvent,s=function(){i._preOnFullScreenError=null,i._preOnTouch&&r.removeEventListener(o,i._preOnTouch),i._preOnTouch=function(){i._preOnTouch=null,i.requestFullScreen(t,e)},r.addEventListener(o,i._preOnTouch,{once:!0})};this._preOnFullScreenError&&t.removeEventListener(a,this._preOnFullScreenError),this._preOnFullScreenError=s,t.addEventListener(a,s,{once:!0})}});xb.init(),n.screen=xb;var Cb=function(){var t=e.prototype;function e(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return t.main=function(t){if(null!=t){if(window._CCSettings&&window._CCSettings.splashScreen){var e=this.setting=window._CCSettings.splashScreen;e.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,e.base64src=this.setting.base64src||"",e.effect=this.setting.effect||"FADE-INOUT",e.clearColor=this.setting.clearColor||new Jo(.88,.88,.88,1),e.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,e.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new Jo(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{n.view.enableRetina(!0);var i=window._CCSettings.designResolution;i?n.view.setDesignResolutionSize(i.width,i.height,i.policy):n.view.setDesignResolutionSize(960,640,4),this.root=t,this.device=t.device,n.game.once(n.Game.EVENT_GAME_INITED,(function(){n.director._lateUpdate=performance.now()}),n.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var r=this.setting.clearColor;this.clearColors=[new Jo(r.x,r.y,r.z,r.w)];var a=this.device,o=a.width,s=a.height,l=a.surfaceTransform;this.screenWidth=l%2?s:o,this.screenHeight=l%2?o:s,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else d("RENDER ROOT IS NULL.")},t.setOnFinish=function(t){if(this._directCall&&t)return e._ins=void 0,void t();this.callBack=t},t._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),n.game.resume())},t.init=function(){var t=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),n.game.pause(),this.handle=requestAnimationFrame((function e(i){if(!t.cancelAnimate){t.startTime<0&&(t.startTime=i);var n=i-t.startTime,r=Mm(hi(n/t.setting.totalTime));"NONE"===t.setting.effect&&(r=1),t.material.setProperty("u_precent",r),t.material.passes[0].update(),t.setting.displayWatermark&&t.textMaterial&&(t.textMaterial.setProperty("u_precent",r),t.textMaterial.passes[0].update()),t.frame(i),n>t.setting.totalTime&&(t.splashFinish=!0),requestAnimationFrame(e)}}))},t.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},t.frame=function(){if(!this.cancelAnimate){var t=this.device;t.acquire();var e=this.cmdBuff,i=this.framebuffer,n=this.renderArea;n.height=t.height,n.width=t.width,e.begin(),e.beginRenderPass(i.renderPass,i,n,this.clearColors,1,0);var r=this.material.passes[0],a=Xv.getOrCreatePipelineState(t,r,this.shader,i.renderPass,this.assmebler);if(e.bindPipelineState(a),e.bindDescriptorSet(Wc.MATERIAL,r.descriptorSet),e.bindInputAssembler(this.assmebler),e.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var o=this.textMaterial.passes[0],s=Xv.getOrCreatePipelineState(t,o,this.textShader,i.renderPass,this.textAssmebler);e.bindPipelineState(s),e.bindDescriptorSet(Wc.MATERIAL,o.descriptorSet),e.bindInputAssembler(this.textAssmebler),e.draw(this.textAssmebler)}e.endRenderPass(),e.end(),t.queue.submit([e]),t.present()}},t.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var t=this.textImg.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var e="Powered by Cocos Creator",i=t.measureText(e);t.fillText(e,(330-i.width)/2,6),this.textRegion=new ns,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new Cs(io.TEX2D,no.SAMPLED|no.TRANSFER_DST,ka.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new nm,this.textMaterial.initialize({effectName:"splash-screen"});var n=this.textMaterial.passes[0],r=n.getBinding("mainTexture");n.bindTexture(r,this.textTexture),this.textShader=kn.get(n.getShaderVariant()),Gn.get(ir.get(n.handle,Un.DESCRIPTOR_SET)).update();var a=4*Float32Array.BYTES_PER_ELEMENT,o=4*a;this.textVB=this.device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,o,a));var s=new Float32Array(16),l=-this.textImg.width/2,c=this.textImg.height;c=this.screenWidth<this.screenHeight?(l=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(l=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var h=0;s[h++]=l,s[h++]=c,s[h++]=0,s[h++]=1,s[h++]=-l,s[h++]=c,s[h++]=1,s[h++]=1,s[h++]=l,s[h++]=-c,s[h++]=0,s[h++]=0,s[h++]=-l,s[h++]=-c,s[h++]=1,s[h++]=0;for(var u=0;u<s.length;u+=4)s[u]+=this.screenWidth/2,s[u+1]+=.1*this.screenHeight;for(var _=this.device.screenSpaceSignY,f=Hi[this.device.surfaceTransform],d=0;d<s.length;d+=4){var p=s[d]/this.screenWidth*2-1,m=(s[d+1]/this.screenHeight*2-1)*_;s[d]=f[0]*p+f[2]*m,s[d+1]=f[1]*p+f[3]*m}this.textVB.update(s);var v=Uint16Array.BYTES_PER_ELEMENT,g=6*v;this.textIB=this.device.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,g,v));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var T=[new Xo("a_position",ka.RG32F),new Xo("a_texCoord",ka.RG32F)],S=new Yo(T,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(S)},t.initCMD=function(){var t=this.device;this.renderArea=new Zo(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer},t.initIA=function(){var t=this.device,e=4*Float32Array.BYTES_PER_ELEMENT,i=4*e;this.vertexBuffers=t.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,i,e));var n=new Float32Array(16),r=-this.image.width/2,a=this.image.height;a=this.screenWidth<this.screenHeight?(r=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(r=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var o=0;n[o++]=r,n[o++]=a,n[o++]=0,n[o++]=1,n[o++]=-r,n[o++]=a,n[o++]=1,n[o++]=1,n[o++]=r,n[o++]=-a,n[o++]=0,n[o++]=0,n[o++]=-r,n[o++]=-a,n[o++]=1,n[o++]=0;for(var s=0;s<n.length;s+=4)n[s]+=this.screenWidth/2,n[s+1]+=this.screenHeight/2;for(var l=this.device.screenSpaceSignY,c=Hi[this.device.surfaceTransform],h=0;h<n.length;h+=4){var u=n[h]/this.screenWidth*2-1,_=(n[h+1]/this.screenHeight*2-1)*l;n[h]=c[0]*u+c[2]*_,n[h+1]=c[1]*u+c[3]*_}this.vertexBuffers.update(n);var f=Uint16Array.BYTES_PER_ELEMENT,d=6*f;this.indicesBuffers=t.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,d,f));var p=new Uint16Array(6);p[0]=0,p[1]=1,p[2]=2,p[3]=1,p[4]=3,p[5]=2,this.indicesBuffers.update(p);var m=[new Xo("a_position",ka.RG32F),new Xo("a_texCoord",ka.RG32F)],v=new Yo(m,[this.vertexBuffers],this.indicesBuffers);this.assmebler=t.createInputAssembler(v)},t.initPSO=function(){var t=this.device;this.material=new nm,this.material.initialize({effectName:"splash-screen"});var e=new gs;e.addressU=eo.CLAMP,e.addressV=eo.CLAMP,this.sampler=t.createSampler(e),this.texture=t.createTexture(new Cs(io.TEX2D,no.SAMPLED|no.TRANSFER_DST,ka.RGBA8,this.image.width,this.image.height));var i=this.material.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.texture),this.shader=kn.get(i.getShaderVariant());var r=Gn.get(ir.get(i.handle,Un.DESCRIPTOR_SET));r.bindSampler(n,this.sampler),r.update(),this.region=new ns,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,t.copyTexImagesToTexture([this.image],this.texture,[this.region])},t.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,e._ins=void 0},q(e,[{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();Cb._ins=void 0,n.internal.SplashScreen=Cb;var wb=t("System",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},q(t,[{key:"priority",set:function(t){this._priority=t},get:function(){return this._priority}},{key:"id",set:function(t){this._id=t},get:function(){return this._id}}]),t}()),Rb=new Et("Scheduler"),Ib=function(t,e,i,n){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=n};Ib.get=function(t,e,i,n){var r=Ib._listEntries.pop();return r?(r.target=t,r.priority=e,r.paused=i,r.markedForDeletion=n):r=new Ib(t,e,i,n),r},Ib.put=function(t){Ib._listEntries.length<20&&(t.target=null,Ib._listEntries.push(t))},Ib._listEntries=[];var Ob=function(t,e,i,n){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=i,this.callback=n};Ob.get=function(t,e,i,n){var r=Ob._hashUpdateEntries.pop();return r?(r.list=t,r.entry=e,r.target=i,r.callback=n):r=new Ob(t,e,i,n),r},Ob.put=function(t){Ob._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,Ob._hashUpdateEntries.push(t))},Ob._hashUpdateEntries=[];var Pb=function(t,e,i,n,r,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=a};Pb.get=function(t,e,i,n,r,a){var o=Pb._hashTimerEntries.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=n,o.currentTimerSalvaged=r,o.paused=a):o=new Pb(t,e,i,n,r,a),o},Pb.put=function(t){Pb._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,Pb._hashTimerEntries.push(t))},Pb._hashTimerEntries=[];var Mb=function(){function t(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var e=t.prototype;return e.initWithCallback=function(t,e,i,r,a,o){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=r,this._delay=o,this._useDelay=this._delay>0,this._repeat=a,this._runForever=this._repeat===n.macro.REPEAT_FOREVER,!0},e.getInterval=function(){return this._interval},e.setInterval=function(t){this._interval=t},e.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},e.getCallback=function(){return this._callback},e.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},e.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},t}();Mb._timers=[],Mb.get=function(){return Mb._timers.pop()||new Mb},Mb.put=function(t){Mb._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,Mb._timers.push(t))};var Db=t("Scheduler",function(t){function e(){var e;return(e=t.call(this)||this)._timeScale=void 0,e._updatesNegList=void 0,e._updates0List=void 0,e._updatesPosList=void 0,e._hashForUpdates=void 0,e._hashForTimers=void 0,e._currentTarget=void 0,e._currentTargetSalvaged=void 0,e._updateHashLocked=void 0,e._arrayForTimers=void 0,e._timeScale=1,e._updatesNegList=[],e._updates0List=[],e._updatesPosList=[],e._hashForUpdates=Dt(!0),e._hashForTimers=Dt(!0),e._currentTarget=null,e._currentTargetSalvaged=!1,e._updateHashLocked=!1,e._arrayForTimers=[],e}Y(e,t),e.enableForTarget=function(t){var e=!1;(t.uuid||t.id)&&(e=!0),e||(t.__instanceId?E(1513):t.id=Rb.getNewId())};var i=e.prototype;return i.setTimeScale=function(t){this._timeScale=t},i.getTimeScale=function(){return this._timeScale},i.update=function(t){var e,i,n,r,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,n=(i=this._updatesNegList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,n=(i=this._updates0List).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,n=(i=this._updatesPosList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||r.target.update(t);var o=this._arrayForTimers;for(e=0;e<o.length;e++){if(a=o[e],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(t),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(t,e,i,r,a,o){if("function"!=typeof t){var s=t;t=e,e=s}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(o=!!r,r=n.macro.REPEAT_FOREVER,a=0),w(e,1502);var l=e.uuid||e.id;if(l){var c,h,u=this._hashForTimers[l];if(u?u.paused!==o&&E(1511):(u=Pb.get(null,e,0,null,null,o),this._arrayForTimers.push(u),this._hashForTimers[l]=u),null==u.timers)u.timers=[];else for(h=0;h<u.timers.length;++h)if((c=u.timers[h])&&t===c._callback)return T(1507,c.getInterval(),i),void(c._interval=i);(c=Mb.get()).initWithCallback(this,t,e,i,r,a),u.timers.push(c),this._currentTarget===u&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else b(1510)},i.scheduleUpdate=function(t,e,i){var n=t.uuid||t.id;if(n){var r=this._hashForUpdates[n];if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return T(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(t)}var a,o=Ib.get(t,e,i,!1);0===e?(a=this._updates0List,this._appendIn(a,o)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,o,e)),this._hashForUpdates[n]=Ob.get(a,o,t,null)}else b(1510)},i.unschedule=function(t,e){if(e&&t){var i=e.uuid||e.id;if(i){var n=this._hashForTimers[i];if(n)for(var r=n.timers,a=0,o=r.length;a<o;a++){var s=r[a];if(t===s._callback)return s!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(a,1),Mb.put(s),n.timerIndex>=a&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}else b(1510)}},i.unscheduleUpdate=function(t){if(t){var e=t.uuid||t.id;if(e){var i=this._hashForUpdates[e];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else b(1510)}},i.unscheduleAllForTarget=function(t){if(t){var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];if(i){var n=i.timers;n.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,a=n.length;r<a;r++)Mb.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}else b(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(n.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(t){var e,i,n,r=this._arrayForTimers;for(e=r.length-1;e>=0;e--)i=r[e],this.unscheduleAllForTarget(i.target);var a=0;if(t<0)for(e=0;e<this._updatesNegList.length;)a=this._updatesNegList.length,(n=this._updatesNegList[e])&&n.priority>=t&&this.unscheduleUpdate(n.target),a===this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)a=this._updates0List.length,(n=this._updates0List[e])&&this.unscheduleUpdate(n.target),a===this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)a=this._updatesPosList.length,(n=this._updatesPosList[e])&&n.priority>=t&&this.unscheduleUpdate(n.target),a===this._updatesPosList.length&&e++},i.isScheduled=function(t,e){w(t,1508),w(e,1509);var i=e.uuid||e.id;if(i){var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,a=0;a<r.length;++a)if(t===r[a]._callback)return!0;return!1}b(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(n.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(t){var e,i,n,r,a=[],o=this._arrayForTimers;for(i=0,n=o.length;i<n;i++)(e=o[i])&&(e.paused=!0,a.push(e.target));if(t<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=t&&(r.paused=!0,a.push(r.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,a.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=t&&(r.paused=!0,a.push(r.target));return a},i.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},i.pauseTarget=function(t){w(t,1503);var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];i&&(i.paused=!0);var n=this._hashForUpdates[e];n&&(n.entry.paused=!0)}else b(1510)},i.resumeTarget=function(t){w(t,1504);var e=t.uuid||t.id;if(e){var i=this._hashForTimers[e];i&&(i.paused=!1);var n=this._hashForUpdates[e];n&&(n.entry.paused=!1)}else b(1510)},i.isTargetPaused=function(t){w(t,1505);var e=t.uuid||t.id;if(!e)return b(1510),!1;var i=this._hashForTimers[e];if(i)return i.paused;var n=this._hashForUpdates[e];return!!n&&n.entry.paused},i._removeHashElement=function(t){var e=t.target.uuid||t.target.id;delete this._hashForTimers[e];for(var i=this._arrayForTimers,n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}Pb.put(t)},i._removeUpdateFromHash=function(t){var e=t.target.uuid||t.target.id,i=this._hashForUpdates[e];if(i){for(var n=i.list,r=i.entry,a=0,o=n.length;a<o;a++)if(n[a]===r){n.splice(a,1);break}delete this._hashForUpdates[e],Ib.put(r),Ob.put(i)}},i._priorityIn=function(t,e,i){for(var n=0;n<t.length;n++)if(i<t[n].priority)return void t.splice(n,0,e);t.push(e)},i._appendIn=function(t,e){t.push(e)},e}(wb));Db.PRIORITY_SYSTEM=1<<31,Db.PRIORITY_NON_SYSTEM=Db.PRIORITY_SYSTEM+1,Db.ID="scheduler",n.Scheduler=Db;var Nb=function(){function t(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=0,this._cameras=[]}t.registerCreateFunc=function(e){e._createWindowFun=function(e){return new t(e)}},q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return Wn.get(Ir.get(this._poolHandle,br.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===Ir.get(this._poolHandle,br.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===Ir.get(this._poolHandle,br.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]);var e=t.prototype;return e.initialize=function(t,e){this._poolHandle=Ir.alloc(),void 0!==e.title&&(this._title=e.title),void 0!==e.swapchainBufferIndices&&(this._swapchainBufferIndices=e.swapchainBufferIndices),void 0!==e.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=e.shouldSyncSizeWithSwapchain),this._width=e.width,this._height=e.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=e.renderPassInfo,n=i.colorAttachments,r=i.depthStencilAttachment,a=0;a<n.length;a++)n[a].format===ka.UNKNOWN&&(n[a].format=t.colorFormat);r&&r.format===ka.UNKNOWN&&(r.format=t.depthStencilFormat),this._renderPass=t.createRenderPass(e.renderPassInfo);for(var o=0;o<n.length;o++){var s=null;this._swapchainBufferIndices&1<<o?Ir.set(this._poolHandle,br.HAS_ON_SCREEN_ATTACHMENTS,1):(s=t.createTexture(new Cs(io.TEX2D,no.COLOR_ATTACHMENT|no.SAMPLED,n[o].format,this._width,this._height)),Ir.set(this._poolHandle,br.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(s)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=t.createTexture(new Cs(io.TEX2D,no.DEPTH_STENCIL_ATTACHMENT|no.SAMPLED,r.format,this._width,this._height)),Ir.set(this._poolHandle,br.HAS_OFF_SCREEN_ATTACHMENTS,1)):Ir.set(this._poolHandle,br.HAS_ON_SCREEN_ATTACHMENTS,1));var l=Wn.alloc(t,new Ho(this._renderPass,this._colorTextures,this._depthStencilTexture));return Ir.set(this._poolHandle,br.FRAMEBUFFER,l),!0},e.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var e=this._colorTextures[t];e&&e.destroy()}this._colorTextures.length=0,this._poolHandle&&(Wn.get(Ir.get(this._poolHandle,br.FRAMEBUFFER)).destroy(),this._poolHandle=0)},e.resize=function(t,e){if(this._width=t,this._height=e,t>this._nativeWidth||e>this._nativeHeight){this._nativeWidth=t,this._nativeHeight=e;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(t,e),i=!0);for(var n=0;n<this._colorTextures.length;n++){var r=this._colorTextures[n];r&&(r.resize(t,e),i=!0)}var a=Wn.get(Ir.get(this._poolHandle,br.FRAMEBUFFER));i&&a&&(a.destroy(),a.initialize(new Ho(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var o,s=Q(this._cameras);!(o=s()).done;){var l=o.value;l.isWindowSize&&l.resize(t,e)}},e.extractRenderCameras=function(){for(var t=[],e=0;e<this._cameras.length;e++){var i=this._cameras[e];i.enabled&&(i.update(),t.push(i))}return t},e.attachCamera=function(t){for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]===t)return;this._cameras.push(t),this.sortCameras()},e.detachCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return void this._cameras.splice(e,1)},e.clearCameras=function(){this._cameras.length=0},e.sortCameras=function(){this._cameras.sort((function(t,e){return t.priority-e.priority}))},t}(),Lb=function(){function t(t){var e=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=0,this._device=t,this._dataPoolMgr=n.internal.DataPoolManager&&new n.internal.DataPoolManager(t),Zh.registerCreateFunc(this),Nb.registerCreateFunc(this),this._cameraPool=new u_((function(){return new Kh(e._device)}),4)}q(t,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(t){this._curWindow=t},get:function(){return this._curWindow}},{key:"tempWindow",set:function(t){this._tempWindow=t},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Cr.get(this._poolHandle,Er.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Cr.get(this._poolHandle,Er.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(t){t>0?(this._fixedFPS=t,this._fixedFPSFrameTime=1e3/t):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var e=t.prototype;return e.initialize=function(){var t=this;this._poolHandle=Cr.alloc();var e=new fs,i=new ds;i.depthStoreOp=ho.DISCARD,i.stencilStoreOp=ho.DISCARD;var r=new ms([e],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:r,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(Zd.initBuiltinRes(this._device)).then((function(){n.view.on("design-resolution-changed",(function(){var e=n.game.canvas.width,i=n.game.canvas.height;t.resize(e,i)}),t)}))},e.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Cr.free(this._poolHandle),this._poolHandle=0)},e.resize=function(t,e){this._device.resize(t,e),this._mainWindow.resize(t,e);for(var i,n=Q(this._windows);!(i=n()).done;){var r=i.value;r.shouldSyncSizeWithSwapchain&&r.resize(t,e)}},e.setRenderPipeline=function(t){if(t||(t=this.createDefaultPipeline()),this._pipeline=t,!this._pipeline.activate())return!1;var e=n.director.getScene();return e&&e.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&n.internal.Batcher2D&&(this._batcher=new n.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},e.createDefaultPipeline=function(){var t=new rS;return t.initialize({flows:[]}),t},e.onGlobalPipelineStateChanged=function(){for(var t=0;t<this._scenes.length;t++)this._scenes[t].onGlobalPipelineStateChanged()},e.activeWindow=function(t){this._curWindow=t},e.resetCumulativeTime=function(){Cr.set(this._poolHandle,Er.CUMULATIVE_TIME,0)},e.frameMove=function(t){var e=this;Cr.set(this._poolHandle,Er.FRAME_TIME,t),++this._frameCount,Cr.set(this._poolHandle,Er.CUMULATIVE_TIME,Cr.get(this._poolHandle,Er.CUMULATIVE_TIME)+t),this._fpsTime+=t,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var i=0;i<this._scenes.length;++i)this._scenes[i].removeBatches();this._batcher&&this._batcher.update(),this._pipeline&&function(){e._device.acquire();var t=e._windows,i=e._scenes,r=n.director.getTotalFrames();e._batcher&&e._batcher.uploadBuffers();for(var a=0;a<i.length;a++)i[a].update(r);n.director.emit(n.Director.EVENT_BEFORE_COMMIT);for(var o=[],s=0;s<t.length;s++)t[s].extractRenderCameras().forEach((function(t){o.push(t)}));o.sort((function(t,e){return t.priority-e.priority})),e._pipeline.render(o),e._device.present()}(),this._batcher&&this._batcher.reset()},e.createWindow=function(t){var e=this._createWindowFun(this);return e.initialize(this.device,t),this._windows.push(e),e},e.destroyWindow=function(t){for(var e=0;e<this._windows.length;++e)if(this._windows[e]===t)return t.destroy(),void this._windows.splice(e,1)},e.destroyWindows=function(){for(var t,e=Q(this._windows);!(t=e()).done;)t.value.destroy();this._windows=[]},e.createScene=function(t){var e=this._createSceneFun(this);return e.initialize(t),this._scenes.push(e),e},e.destroyScene=function(t){for(var e=0;e<this._scenes.length;++e)if(this._scenes[e]===t)return t.destroy(),void this._scenes.splice(e,1)},e.destroyScenes=function(){for(var t,e=Q(this._scenes);!(t=e()).done;)t.value.destroy();this._scenes=[]},e.createModel=function(t){var e=this._modelPools.get(t);e||(this._modelPools.set(t,new u_((function(){return new t}),10)),e=this._modelPools.get(t));var i=e.alloc();return i.initialize(),i},e.destroyModel=function(t){var e=this._modelPools.get(t.constructor);e?(e.free(t),t.destroy(),t.scene&&t.scene.removeModel(t)):E(1300,t.constructor.name)},e.createCamera=function(){return this._cameraPool.alloc()},e.createLight=function(t){var e=this._lightPools.get(t);e||(this._lightPools.set(t,new u_((function(){return new t}),4)),e=this._lightPools.get(t));var i=e.alloc();return i.initialize(),i},e.destroyLight=function(t){var e=this._lightPools.get(t.constructor);if(t.destroy(),e&&(e.free(t),t.scene))switch(t.type){case np.SPHERE:t.scene.removeSphereLight(t);break;case np.SPOT:t.scene.removeSpotLight(t)}},t}();n.Root=Lb;var Bb={};lt(Bb,"vmath",[{name:"vec2",newName:"Vec2",target:an,targetName:"math"},{name:"vec3",newName:"Vec3",target:an,targetName:"math"},{name:"vec4",newName:"Vec4",target:an,targetName:"math"},{name:"quat",newName:"Quat",target:an,targetName:"math"},{name:"mat3",newName:"Mat3",target:an,targetName:"math"},{name:"mat4",newName:"Mat4",target:an,targetName:"math"},{name:"color4",newName:"Color",target:an,targetName:"math"},{name:"rect",newName:"Rect",target:an,targetName:"math"},{name:"approx",newName:"approx",target:an,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:an,targetName:"math"},{name:"equals",newName:"equals",target:an,targetName:"math"},{name:"clamp",newName:"clamp",target:an,targetName:"math"},{name:"clamp01",newName:"clamp01",target:an,targetName:"math"},{name:"lerp",newName:"lerp",target:an,targetName:"math"},{name:"toRadian",newName:"toRadian",target:an,targetName:"math"},{name:"toDegree",newName:"toDegree",target:an,targetName:"math"},{name:"random",newName:"random",target:an,targetName:"math"},{name:"randomRange",newName:"randomRange",target:an,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:an,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:an,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:an,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:an,targetName:"math"},{name:"repeat",newName:"repeat",target:an,targetName:"math"},{name:"pingPong",newName:"pingPong",target:an,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:an,targetName:"math"}]),n.vmath=Bb,lt(Db.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:Db,targetName:"Scheduler"}]),lt(SS.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:SS,targetName:"EventTouch"}]),lt(_p.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),ct(_p.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),lt(Lb.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]);var Fb=Object.freeze({__proto__:null,ccclass:ru,property:lu,requireComponent:au,executionOrder:ou,disallowMultiple:su,executeInEditMode:fu,menu:du,playOnFocus:pu,inspector:mu,icon:vu,help:gu,type:Fu,integer:Du,float:Nu,boolean:Lu,string:Bu});t("_decorator",Fb);var zb,Ub,kb,Gb,Hb,Vb,Wb,jb,qb,Xb,Yb,Kb=p_.Flags.Destroyed,Zb=p_.Flags.PersistentMask,Qb=[];function Jb(t){var e;if(t instanceof p_){if(t._instantiate)return n.game._isCloning=!0,e=t._instantiate(null,!0),n.game._isCloning=!1,e;if(t instanceof n.Asset)throw new TypeError(R(6903))}return n.game._isCloning=!0,e=$b(t),n.game._isCloning=!1,e}function $b(t,e){var i;tx(t,i=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var n=0,r=Qb.length;n<r;++n)Qb[n]._iN$t=null;return Qb.length=0,i}function tx(t,e,i){le.value(t,"_iN$t",e,!0),Qb.push(t);var r=t.constructor;if(n.Class._isCCClass(r))!function(t,e,i,n){for(var r=t.__values__,a=0;a<r.length;a++){var o=r[a],s=e[o];if("object"==typeof s&&s){var l=i[o];l instanceof de&&l.constructor===s.constructor?l.set(s):i[o]=s._iN$t||ex(s,n)}else i[o]=s}}(r,t,e,i);else for(var a in t)if(t.hasOwnProperty(a)&&(95!==a.charCodeAt(0)||95!==a.charCodeAt(1)||"__type__"===a)){var o=t[a];if("object"==typeof o&&o){if(o===e)continue;e[a]=o._iN$t||ex(o,i)}else e[a]=o}t instanceof p_&&(e._objFlags&=Zb)}function ex(t,e){if(t instanceof de)return t.clone();if(t instanceof n.Asset)return t;var i;if(ArrayBuffer.isView(t)){var r=t.length;i=new t.constructor(r),t._iN$t=i,Qb.push(t);for(var a=0;a<r;++a)i[a]=t[a];return i}if(Array.isArray(t)){var o=t.length;i=new Array(o),t._iN$t=i,Qb.push(t);for(var s=0;s<o;++s){var l=t[s];i[s]="object"==typeof l&&l?l._iN$t||ex(l,e):l}return i}if(t._objFlags&Kb)return null;var c=t.constructor;if(n.Class._isCCClass(c)){if(e)if(e instanceof n.Component){if(t instanceof n._BaseNode||t instanceof n.Component)return t}else if(e instanceof n._BaseNode)if(t instanceof n._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof n.Component&&!t.node.isChildOf(e))return t;i=new c}else if(c===Object)i={};else{if(c)return t;i=Object.create(null)}return tx(t,i,e),i}function ix(t,e){return(e<<3)+t}Jb._clone=$b,n.instantiate=Jb,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(Xb||(Xb={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(Yb||(Yb={}));var nx=t("CompactValueTypeArray",ru("cc.CompactValueTypeArray")((jb=Wb=function(){function t(){J(this,"_byteOffset",kb,this),J(this,"_unitCount",Gb,this),J(this,"_unitElement",Hb,this),J(this,"_length",Vb,this)}return t.lengthFor=function(t,e,i){return rx(e).requiredUnits*t.length*ax(i).BYTES_PER_ELEMENT},t.compress=function(e,i,n,r,a,o){for(var s=rx(i),l=ax(n),c=s.requiredUnits*e.length,h=new l(r,a,c),u=0;u<e.length;++u)s.compress(h,u,e[u]);var _=new t;return _._unitElement=ix(n,i),_._byteOffset=o,_._unitCount=c,_._length=e.length,_},t.prototype.decompress=function(t){for(var e,i={storageUnit:7&(e=this._unitElement),elementType:e>>3},n=i.storageUnit,r=rx(i.elementType),a=new(ax(n))(t,this._byteOffset,this._unitCount),o=new Array(this._length),s=0;s<this._length;++s)o[s]=r.decompress(a,s);return o},t}(),Wb.StorageUnit=Xb,Wb.ElementType=Yb,kb=$((Ub=jb).prototype,"_byteOffset",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gb=$(Ub.prototype,"_unitCount",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hb=$(Ub.prototype,"_unitElement",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ix(Xb.Uint8,Yb.Scalar)}}),Vb=$(Ub.prototype,"_length",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zb=Ub))||zb);function rx(t){return lx[t]}function ax(t){switch(t){case Xb.Uint8:return Uint8Array;case Xb.Uint16:return Uint16Array;case Xb.Uint32:return Uint32Array;case Xb.Int8:return Int8Array;case Xb.Int16:return Int16Array;case Xb.Int32:return Int32Array;case Xb.Float32:return Float32Array;case Xb.Float64:return Float64Array}}var ox,sx,lx=((qb={})[Yb.Scalar]={requiredUnits:1,compress:function(t,e,i){t[e]=i},decompress:function(t,e){return t[e]}},qb[Yb.Vec2]={requiredUnits:2,compress:function(t,e,i){t[2*e]=i.x,t[2*e+1]=i.y},decompress:function(t,e){return new Ri(t[2*e],t[2*e+1])}},qb[Yb.Vec3]={requiredUnits:3,compress:function(t,e,i){t[3*e]=i.x,t[3*e+1]=i.y,t[3*e+2]=i.z},decompress:function(t,e){return new Ri(t[3*e],t[3*e+1],t[3*e+2])}},qb[Yb.Vec4]={requiredUnits:4,compress:function(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:function(t,e){return new Qi(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},qb[Yb.Quat]={requiredUnits:4,compress:function(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:function(t,e){return new Li(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},qb[Yb.Mat4]={requiredUnits:16,compress:function(t,e,i){Vi.toArray(t,i,16*e)},decompress:function(t,e){return Vi.fromArray(new Vi,t,16*e)}},qb);n._decorator=Fb,ct(hf.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),lt(im.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var cx,hx=t("BufferAsset",ru("cc.BufferAsset")(($((sx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._buffer=null,e}return Y(e,t),e.prototype.buffer=function(){return this._buffer},q(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(M_)).prototype,"_nativeAsset",[zu],Object.getOwnPropertyDescriptor(sx.prototype,"_nativeAsset"),sx.prototype),ox=sx))||ox);n.BufferAsset=hx;var ux=((cx={})[go.UNORM]="Uint",cx[go.SNORM]="Int",cx[go.UINT]="Uint",cx[go.INT]="Int",cx[go.UFLOAT]="Float",cx[go.FLOAT]="Float",cx.default="Uint",cx);function _x(t){return(ux[t.type]||ux.default)+t.size/t.count*8}function fx(t,e,i,n,r){void 0===i&&(i=ka.R32F),void 0===n&&(n=0),void 0===r&&(r=0);var a=xo[i];r||(r=a.size);for(var o="set"+_x(a),s=a.size/a.count,l=Math.floor(e.length/a.count),c=yv.isLittleEndian,h=0;h<l;++h)for(var u=n+r*h,_=0;_<a.count;++_){var f=u+s*_;t[o](f,e[a.count*h+_],c)}}function dx(t,e,i,n,r,a){void 0===e&&(e=ka.R32F),void 0===i&&(i=0),void 0===n&&(n=t.byteLength-i),void 0===r&&(r=0),void 0===a&&(a=[]);var o=xo[e];r||(r=o.size);for(var s="get"+_x(o),l=o.size/o.count,c=Math.floor(n/r),h=yv.isLittleEndian,u=0;u<c;++u)for(var _=i+r*u,f=0;f<o.count;++f){var d=_+l*f;a[o.count*u+f]=t[s](d,h)}return a}function px(t,e,i,n,r,a,o){void 0===i&&(i=ka.R32F),void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n),void 0===a&&(a=0),o||(o=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var s=xo[i];a||(a=s.size);for(var l="set"+_x(s),c="get"+_x(s),h=s.size/s.count,u=Math.floor(r/a),_=yv.isLittleEndian,f=0;f<u;++f)for(var d=n+a*f,p=0;p<s.count;++p){var m=d+h*p,v=t[c](m,_);o[l](m,e(v,p,t),_)}return o}var mx,vx,gx,yx,Tx,Sx,Ex,Ax,bx,xx=t("RenderingSubMesh",function(){function t(t,e,i,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=0,this._attributes=e,this._vertexBuffers=t,this._indexBuffer=n,this._indirectBuffer=r,this._primitiveMode=i,this._iaInfo=new Yo(e,t,n,r),this._handle=ia.alloc();var a=Yn.alloc();ia.set(this._handle,Qr.FLAT_BUFFER_ARRAY,a)}var e=t.prototype;return e.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,e=0,i=t.struct.primitives[this.subMeshIdx],n=ia.get(this._handle,Qr.FLAT_BUFFER_ARRAY);i.indexView&&(e=i.indexView.count);for(var r=0;r<i.vertexBundelIndices.length;r++){var a=i.vertexBundelIndices[r],o=t.struct.vertexBundles[a],s=i.indexView?i.indexView.count:o.view.count,l=o.view.stride,c=l*s,h=new Uint8Array(t.data.buffer,o.view.offset,o.view.length),u=Jn.alloc(i.indexView?c:o.view.length),_=$r.alloc();$r.set(_,Kr.STRIDE,l),$r.set(_,Kr.AMOUNT,s),$r.set(_,Kr.BUFFER,u),Yn.push(n,_);var f=Jn.getBuffer(u),d=new Uint8Array(f);if(i.indexView){for(var p=t.readIndices(this.subMeshIdx),m=0;m<e;++m)for(var v=m*l,g=p[m]*l,y=0;y<l;++y)d[v+y]=h[g+y];this._flatBuffers.push({stride:l,count:s,buffer:d})}else d.set(t.data.subarray(o.view.offset,o.view.offset+o.view.length)),this._flatBuffers.push({stride:l,count:s,buffer:d})}}},e.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(zn(ia.get(this._handle,Qr.FLAT_BUFFER_ARRAY),Yn,$r),ia.free(this._handle),this._handle=0)},e.enableVertexIdChannel=function(t){if(!this._vertexIdChannel){var e=this.vertexBuffers.length,i=this.attributes.length,n=this._allocVertexIdBuffer(t);this._vertexBuffers.push(n),this._attributes.push(new Xo("a_vertexId",ka.R32F,!1,e)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:e,index:i}}},e._allocVertexIdBuffer=function(t){for(var e=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,i=new Float32Array(e),n=0;n<e;++n)i[n]=n+.5;var r=t.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.DEVICE,i.byteLength,i.BYTES_PER_ELEMENT));return r.update(i),r},q(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Ri.ZERO,max:Ri.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Ri.ZERO,max:Ri.ZERO}};var t=this.mesh,e=this.subMeshIdx,i=t.readAttribute(e,za.ATTR_POSITION),n=t.readIndices(e),r=new Ri,a=new Ri,o=this.attributes.find((function(t){return t.name===za.ATTR_POSITION}));if(o){var s=xo[o.format].count;2===s?(r.set(i[0],i[1],0),a.set(i[0],i[1],0)):(r.set(i[0],i[1],i[2]),a.set(i[0],i[1],i[2]));for(var l=0;l<i.length;l+=s)2===s?(r.x=i[l]>r.x?i[l]:r.x,r.y=i[l+1]>r.y?i[l+1]:r.y,a.x=i[l]<a.x?i[l]:a.x,a.y=i[l+1]<a.y?i[l+1]:a.y):(r.x=i[l]>r.x?i[l]:r.x,r.y=i[l+1]>r.y?i[l+1]:r.y,r.z=i[l+2]>r.z?i[l+2]:r.z,a.x=i[l]<a.x?i[l]:a.x,a.y=i[l+1]<a.y?i[l+1]:a.y,a.z=i[l+2]<a.z?i[l+2]:a.z)}return this._geometricInfo={positions:i,indices:n,boundingBox:{max:r,min:a}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var t=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var e=this._jointMappedBuffers=[],i=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var r,a,o=this.mesh.struct,s=o.primitives[this.subMeshIdx];if(!o.jointMaps||void 0===s.jointMapIndex||!o.jointMaps[s.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var l=n.director.root.device,c=0;c<s.vertexBundelIndices.length;c++){var h=o.vertexBundles[s.vertexBundelIndices[c]];a=0,r=ka.UNKNOWN;for(var u=0;u<h.attributes.length;u++){var _=h.attributes[u];if(_.name===za.ATTR_JOINTS){r=_.format;break}a+=xo[_.format].size}r?function(){var n=new Uint8Array(t.mesh.data.buffer,h.view.offset,h.view.length),u=new DataView(n.slice().buffer),_=o.jointMaps[s.jointMapIndex];px(u,(function(t){return _.indexOf(t)}),r,a,h.view.length,h.view.stride,u);var f=l.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.DEVICE,h.view.length,h.view.stride));f.update(u.buffer),e.push(f),i.push(c)}():e.push(this.vertexBuffers[s.vertexBundelIndices[c]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(l)),e}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),t}()),Cx=t("SceneAsset",ru("cc.SceneAsset")((Tx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"scene",gx,K(e)),J(e,"asyncLoadAssets",yx,K(e)),e}return Y(e,t),e}(M_),gx=$((vx=Tx).prototype,"scene",[yu,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yx=$(vx.prototype,"asyncLoadAssets",[yu,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mx=vx))||mx);n.SceneAsset=Cx;var wx,Rx,Ix,Ox,Px=t("TextAsset",ru("cc.TextAsset")((bx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"text",Ax,K(e)),e}return Y(e,t),e.prototype.toString=function(){return this.text},e}(M_),Ax=$((Ex=bx).prototype,"text",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Sx=Ex))||Sx);n.TextAsset=Px;var Mx=t("JsonAsset",ru("cc.JsonAsset")((Ox=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"json",Ix,K(e)),e}return Y(e,t),e}(M_),Ix=$((Rx=Ox).prototype,"json",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wx=Rx))||wx);n.JsonAsset=Mx;var Dx=new Array(16),Nx=null,Lx=new Xi,Bx=[vS.TOUCH_START.toString(),vS.TOUCH_MOVE.toString(),vS.TOUCH_END.toString(),vS.TOUCH_CANCEL.toString()],Fx=[vS.MOUSE_DOWN.toString(),vS.MOUSE_ENTER.toString(),vS.MOUSE_MOVE.toString(),vS.MOUSE_LEAVE.toString(),vS.MOUSE_UP.toString(),vS.MOUSE_WHEEL.toString()];function zx(t,e){var i=this.owner;return!(!i||!i._uiProps.uiTransformComp||(t.getUILocation(Lx),!i._uiProps.uiTransformComp.isHit(Lx,this)||(e.type=vS.TOUCH_START.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e),0)))}function Ux(t,e){var i=this.owner;return!(!i||!i._uiProps.uiTransformComp||(e.type=vS.TOUCH_MOVE.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e),0))}function kx(t,e){var i=this.owner;i&&i._uiProps.uiTransformComp&&(t.getUILocation(Lx),i._uiProps.uiTransformComp.isHit(Lx,this)?e.type=vS.TOUCH_END.toString():e.type=vS.TOUCH_CANCEL.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e))}function Gx(t,e){var i=this.owner;i&&i._uiProps.uiTransformComp&&(e.type=vS.TOUCH_CANCEL.toString(),e.touch=t,e.bubbles=!0,i.dispatchEvent(e))}function Hx(t){var e=this.owner;e&&e._uiProps.uiTransformComp&&(Lx=t.getUILocation(),e._uiProps.uiTransformComp.isHit(Lx,this)&&(t.type=vS.MOUSE_DOWN.toString(),t.bubbles=!0,e.dispatchEvent(t)))}function Vx(t){var e=this.owner;if(e&&e._uiProps.uiTransformComp){if(Lx=t.getUILocation(),e._uiProps.uiTransformComp.isHit(Lx,this))this._previousIn||(Nx&&Nx.eventProcessor.mouseListener&&(t.type=vS.MOUSE_LEAVE,Nx.dispatchEvent(t),Nx.eventProcessor.mouseListener&&(Nx.eventProcessor.mouseListener._previousIn=!1)),Nx=e,t.type=vS.MOUSE_ENTER.toString(),e.dispatchEvent(t),this._previousIn=!0),t.type=vS.MOUSE_MOVE.toString(),t.bubbles=!0,e.dispatchEvent(t);else{if(!this._previousIn)return;t.type=vS.MOUSE_LEAVE.toString(),e.dispatchEvent(t),this._previousIn=!1,Nx=null}t.propagationStopped=!0}}function Wx(t){var e=this.owner;e&&e._uiProps.uiTransformComp&&(Lx=t.getUILocation(),e._uiProps.uiTransformComp.isHit(Lx,this)&&(t.type=vS.MOUSE_UP.toString(),t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0))}function jx(t){var e=this.owner;e&&e._uiProps.uiTransformComp&&(Lx=t.getUILocation(),e._uiProps.uiTransformComp.isHit(Lx,this)&&(t.type=vS.MOUSE_WHEEL.toString(),t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0))}function qx(t,e){if(e){for(var i=0,n=[],r=t;r&&wA.isNode(r);r=r.parent,++i){var a=r.getComponent(e);if(a){var o={index:i,comp:a};n?n.push(o):n=[o]}}return n.length>0?n:null}return null}function Xx(t,e){if(!t._persistNode){if(t.eventProcessor.bubblingTargets)for(var i=0;i<e.length;++i)if(t.eventProcessor.bubblingTargets.hasEventListener(e[i]))return!0;if(t.eventProcessor.capturingTargets)for(var n=0;n<e.length;++n)if(t.eventProcessor.capturingTargets.hasEventListener(e[n]))return!0;return!1}return!0}var Yx,Kx,Zx,Qx,Jx,$x,tC,eC,iC,nC,rC,aC,oC,sC,lC,cC,hC,uC,_C,fC,dC,pC,mC,vC,gC,yC,TC,SC,EC,AC,bC,xC,CC,wC,RC,IC,OC,PC,MC,DC,NC,LC,BC,FC,zC,UC,kC,GC,HC,VC,WC,jC,qC,XC,YC,KC,ZC,QC,JC,$C,tw,ew,iw,nw,rw,aw,ow,sw,lw,cw,hw,uw,_w,fw,dw,pw,mw,vw,gw,yw,Tw,Sw,Ew,Aw,bw,xw,Cw,ww,Rw,Iw,Ow,Pw,Mw,Dw,Nw,Lw,Bw,Fw,zw,Uw,kw,Gw,Hw,Vw,Ww,jw,qw,Xw=function(){function t(t){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._node=t}q(t,[{key:"node",get:function(){return this._node}}]);var e=t.prototype;return e.reattach=function(){var e;this.node.walk((function(i){e||(e=qx(i,t._comp)),i.eventProcessor.touchListener&&(i.eventProcessor.touchListener.mask=e),i.eventProcessor.mouseListener&&(i.eventProcessor.mouseListener.mask=e)}))},e.destroy=function(){Nx===this._node&&(Nx=null),(this.touchListener||this.mouseListener)&&(NS.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},e.on=function(t,e,i,n){return this._checknSetupSysEvent(t)?this._onDispatch(t,e,i,n):(this.bubblingTargets||(this.bubblingTargets=new b_),this.bubblingTargets.on(t,e,i))},e.once=function(t,e,i,n){var r,a=this;(r=this._checknSetupSysEvent(t)&&n?this.capturingTargets=this.capturingTargets||new b_:this.bubblingTargets=this.bubblingTargets||new b_).on(t,e,i,!0),r.on(t,(function(){a.off(t,e,i)}),void 0,!0)},e.off=function(t,e,i,n){var r=-1!==Bx.indexOf(t),a=!r&&-1!==Fx.indexOf(t);r||a?(this._offDispatch(t,e,i,n),r?this.touchListener&&!Xx(this._node,Bx)&&(NS.removeListener(this.touchListener),this.touchListener=null):a&&this.mouseListener&&!Xx(this._node,Fx)&&(NS.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(t,e,i)},e.emit=function(t,e,i,n,r,a){this.bubblingTargets&&this.bubblingTargets.emit(t,e,i,n,r,a)},e.dispatchEvent=function(t){!function(t,e){var i,n=0;for(e.target=t,Dx.length=0,t.eventProcessor.getCapturingTargets(e.type,Dx),e.eventPhase=1,n=Dx.length-1;n>=0;--n)if((i=Dx[n]).eventProcessor.capturingTargets&&(e.currentTarget=i,i.eventProcessor.capturingTargets.emit(e.type,e,Dx),e.propagationStopped))return void(Dx.length=0);if(Dx.length=0,e.eventPhase=2,e.currentTarget=t,t.eventProcessor.capturingTargets&&t.eventProcessor.capturingTargets.emit(e.type,e),!e.propagationImmediateStopped&&t.eventProcessor.bubblingTargets&&t.eventProcessor.bubblingTargets.emit(e.type,e),!e.propagationStopped&&e.bubbles)for(t.eventProcessor.getBubblingTargets(e.type,Dx),e.eventPhase=3,n=0;n<Dx.length;++n)if((i=Dx[n]).eventProcessor.bubblingTargets&&(e.currentTarget=i,i.eventProcessor.bubblingTargets.emit(e.type,e),e.propagationStopped))return void(Dx.length=0);Dx.length=0}(this._node,t),Dx.length=0},e.hasEventListener=function(t,e,i){var n=!1;return this.bubblingTargets&&(n=this.bubblingTargets.hasEventListener(t,e,i)),!n&&this.capturingTargets&&(n=this.capturingTargets.hasEventListener(t,e,i)),n},e.targetOff=function(t){this.capturingTargets&&this.capturingTargets.removeAll(t),this.bubblingTargets&&this.bubblingTargets.removeAll(t),this.touchListener&&!Xx(this.node,Bx)&&(NS.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!Xx(this.node,Fx)&&(NS.removeListener(this.mouseListener),this.mouseListener=null)},e.getCapturingTargets=function(t,e){for(var i=this._node.parent;i;)i.eventProcessor.capturingTargets&&i.eventProcessor.capturingTargets.hasEventListener(t)&&e.push(i),i=i.parent},e.getBubblingTargets=function(t,e){for(var i=this._node.parent;i;)i.eventProcessor.bubblingTargets&&i.eventProcessor.bubblingTargets.hasEventListener(t)&&e.push(i),i=i.parent},e._checknSetupSysEvent=function(e){var i=this,r=!1,a=!1;return-1!==Bx.indexOf(e)?(this.touchListener||(this.touchListener=n.EventListener.create({event:n.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:qx(this._node,t._comp),onTouchBegan:zx,onTouchMoved:Ux,onTouchEnded:kx,onTouchCancelled:Gx}),NS.addListener(this.touchListener,this._node),r=!0),a=!0):-1!==Fx.indexOf(e)&&(this.mouseListener||(this.mouseListener=n.EventListener.create({event:n.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:qx(this._node,t._comp),onMouseDown:Hx,onMouseMove:Vx,onMouseUp:Wx,onMouseScroll:jx}),NS.addListener(this.mouseListener,this._node),r=!0),a=!0),r&&!this._node.activeInHierarchy&&n.director.getScheduler().schedule((function(){i._node.activeInHierarchy||NS.pauseTarget(i._node)}),this._node,0,0,0,!1),a},e._onDispatch=function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=null;return(r=n?this.capturingTargets=this.capturingTargets||new b_:this.bubblingTargets=this.bubblingTargets||new b_).hasEventListener(t,e,i)||r.on(t,e,i),e}b(6800)},e._offDispatch=function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=n?this.capturingTargets:this.bubblingTargets;r&&r.off(t,e,i)}else this.capturingTargets&&this.capturingTargets.removeAll(t),this.bubblingTargets&&this.bubblingTargets.removeAll(t)},t}();Xw._comp=null,n.NodeEventProcessor=Xw,lt(oE.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),lt(wA.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Xi),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new tn),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){"number"==typeof t?this._uiProps.uiTransformComp.setContentSize(t,e):this._uiProps.uiTransformComp.setContentSize(t)}}]),ct(wA.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),ct(Fc,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),lt(Fc,"Layers",[{name:"Default",newName:"DEFAULT",target:Fc.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Fc.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Fc.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Fc.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Fc.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Fc.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Fc.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Fc.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Fc,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Fc,targetName:"Layers"}]),ct(Fc.Enum,"Layers.Enum",[{name:"ALWAYS"}]),ct(Fc.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var Yw=new Ri(0,1,0),Kw=new Ri,Zw=new Li,Qw=(Yx=ru("cc.AmbientInfo"),Kx=Fu(Fe),Yx((eC=function(){function t(){J(this,"_skyColor",Jx,this),J(this,"_skyIllum",$x,this),J(this,"_groundAlbedo",tC,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},q(t,[{key:"skyColor",set:function(t){this._skyColor.set(t),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(t){this._skyIllum=t,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(t){this._groundAlbedo.set(t),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),t}(),Jx=$((Qx=eC).prototype,"_skyColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(51,128,204,1)}}),$x=$(Qx.prototype,"_skyIllum",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fa.SKY_ILLUM}}),tC=$(Qx.prototype,"_groundAlbedo",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(51,51,51,255)}}),$(Qx.prototype,"skyColor",[yu],Object.getOwnPropertyDescriptor(Qx.prototype,"skyColor"),Qx.prototype),$(Qx.prototype,"skyIllum",[yu,Kx],Object.getOwnPropertyDescriptor(Qx.prototype,"skyIllum"),Qx.prototype),$(Qx.prototype,"groundAlbedo",[yu],Object.getOwnPropertyDescriptor(Qx.prototype,"groundAlbedo"),Qx.prototype),Zx=Qx))||Zx);n.AmbientInfo=Qw;var Jw=(iC=ru("cc.SkyboxInfo"),nC=Fu(Td),rC=Fu(Td),iC((uC=function(){function t(){J(this,"_envmap",sC,this),J(this,"_isRGBE",lC,this),J(this,"_enabled",cC,this),J(this,"_useIBL",hC,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},q(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(t){this._useIBL=t,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(t){this._envmap=t,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(t){this._isRGBE=t,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),t}(),sC=$((oC=uC).prototype,"_envmap",[nC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lC=$(oC.prototype,"_isRGBE",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cC=$(oC.prototype,"_enabled",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hC=$(oC.prototype,"_useIBL",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(oC.prototype,"enabled",[yu],Object.getOwnPropertyDescriptor(oC.prototype,"enabled"),oC.prototype),$(oC.prototype,"useIBL",[yu],Object.getOwnPropertyDescriptor(oC.prototype,"useIBL"),oC.prototype),$(oC.prototype,"envmap",[yu,rC],Object.getOwnPropertyDescriptor(oC.prototype,"envmap"),oC.prototype),$(oC.prototype,"isRGBE",[yu],Object.getOwnPropertyDescriptor(oC.prototype,"isRGBE"),oC.prototype),aC=oC))||aC);n.SkyboxInfo=Jw;var $w=(_C=ru("cc.FogInfo"),fC=Fu(QT),dC=Tu(),pC=Fu(Fe),mC=Au(),vC=Cu(),gC=Ru(),yC=Tu(),TC=Fu(Fe),SC=Cu(),EC=Ru(),AC=Tu(),bC=Fu(Fe),xC=Cu(),CC=Ru(),wC=Tu(),RC=Fu(Fe),IC=bu(),OC=Cu(),PC=Ru(),MC=Tu(),DC=Fu(Fe),NC=Cu(),LC=Ru(),BC=Tu(),FC=Fu(Fe),zC=Cu(),UC=Ru(),_C((JC=QC=function(){function t(){J(this,"_type",HC,this),J(this,"_fogColor",VC,this),J(this,"_enabled",WC,this),J(this,"_fogDensity",jC,this),J(this,"_fogStart",qC,this),J(this,"_fogEnd",XC,this),J(this,"_fogAtten",YC,this),J(this,"_fogTop",KC,this),J(this,"_fogRange",ZC,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},q(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),QC.FogType=QT,HC=$((GC=JC).prototype,"_type",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return QT.LINEAR}}),VC=$(GC.prototype,"_fogColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci("#C8C8C8")}}),WC=$(GC.prototype,"_enabled",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jC=$(GC.prototype,"_fogDensity",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),qC=$(GC.prototype,"_fogStart",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),XC=$(GC.prototype,"_fogEnd",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),YC=$(GC.prototype,"_fogAtten",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),KC=$(GC.prototype,"_fogTop",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),ZC=$(GC.prototype,"_fogRange",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),$(GC.prototype,"enabled",[yu],Object.getOwnPropertyDescriptor(GC.prototype,"enabled"),GC.prototype),$(GC.prototype,"fogColor",[yu],Object.getOwnPropertyDescriptor(GC.prototype,"fogColor"),GC.prototype),$(GC.prototype,"type",[yu,fC],Object.getOwnPropertyDescriptor(GC.prototype,"type"),GC.prototype),$(GC.prototype,"fogDensity",[dC,pC,mC,vC,wu,gC],Object.getOwnPropertyDescriptor(GC.prototype,"fogDensity"),GC.prototype),$(GC.prototype,"fogStart",[yC,TC,SC,EC],Object.getOwnPropertyDescriptor(GC.prototype,"fogStart"),GC.prototype),$(GC.prototype,"fogEnd",[AC,bC,xC,CC],Object.getOwnPropertyDescriptor(GC.prototype,"fogEnd"),GC.prototype),$(GC.prototype,"fogAtten",[wC,RC,IC,OC,PC],Object.getOwnPropertyDescriptor(GC.prototype,"fogAtten"),GC.prototype),$(GC.prototype,"fogTop",[MC,DC,NC,LC],Object.getOwnPropertyDescriptor(GC.prototype,"fogTop"),GC.prototype),$(GC.prototype,"fogRange",[BC,FC,zC,UC],Object.getOwnPropertyDescriptor(GC.prototype,"fogRange"),GC.prototype),kC=GC))||kC),tR=($C=ru("cc.ShadowsInfo"),tw=Fu(rm),ew=Tu(),iw=Fu(Fe),nw=Tu(),rw=Fu(am),aw=Tu(),ow=Fu(ze),sw=Tu(),lw=Fu(Fe),cw=Tu(),hw=Fu(Fe),uw=Tu(),_w=Fu(Fe),fw=Tu(),dw=Fu(Be),pw=Tu(),mw=Tu(),vw=Fu(Fe),gw=Tu(),yw=Fu(Fe),Tw=Tu(),$C((Fw=function(){function t(){J(this,"_type",Aw,this),J(this,"_enabled",bw,this),J(this,"_normal",xw,this),J(this,"_distance",Cw,this),J(this,"_shadowColor",ww,this),J(this,"_autoAdapt",Rw,this),J(this,"_pcf",Iw,this),J(this,"_bias",Ow,this),J(this,"_near",Pw,this),J(this,"_far",Mw,this),J(this,"_aspect",Dw,this),J(this,"_orthoSize",Nw,this),J(this,"_maxReceived",Lw,this),J(this,"_size",Bw,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(Zw),this.normal=Ri.transformQuat(Kw,Yw,Zw),t.getWorldPosition(Kw),this.distance=Ri.dot(this._normal,Kw)},e.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},q(t,[{key:"enabled",set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(t){this._type=t,this._resource&&(this._resource.type=t)},get:function(){return this._type}},{key:"shadowColor",set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)},get:function(){return this._shadowColor}},{key:"normal",set:function(t){Ri.copy(this._normal,t),this._resource&&(this._resource.normal=t)},get:function(){return this._normal}},{key:"distance",set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)},get:function(){return this._distance}},{key:"pcf",set:function(t){this._pcf=t,this._resource&&(this._resource.pcf=t)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(t){this._autoAdapt=t,this._resource&&(this._resource.autoAdapt=t)},get:function(){return this._autoAdapt}},{key:"near",set:function(t){this._near=t,this._resource&&(this._resource.near=t)},get:function(){return this._near}},{key:"far",set:function(t){this._far=t,this._resource&&(this._resource.far=t)},get:function(){return this._far}},{key:"orthoSize",set:function(t){this._orthoSize=t,this._resource&&(this._resource.orthoSize=t)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(t){this._size.set(t),this._resource&&(this._resource.size=t,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(t){this._aspect=t,this._resource&&(this._resource.aspect=t)},get:function(){return this._aspect}},{key:"bias",set:function(t){this._bias=t,this._resource&&(this._resource.bias=t)},get:function(){return this._bias}}]),t}(),Aw=$((Ew=Fw).prototype,"_type",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rm.Planar}}),bw=$(Ew.prototype,"_enabled",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xw=$(Ew.prototype,"_normal",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri(0,1,0)}}),Cw=$(Ew.prototype,"_distance",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ww=$(Ew.prototype,"_shadowColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(0,0,0,76)}}),Rw=$(Ew.prototype,"_autoAdapt",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Iw=$(Ew.prototype,"_pcf",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return am.HARD}}),Ow=$(Ew.prototype,"_bias",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),Pw=$(Ew.prototype,"_near",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Mw=$(Ew.prototype,"_far",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),Dw=$(Ew.prototype,"_aspect",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Nw=$(Ew.prototype,"_orthoSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Lw=$(Ew.prototype,"_maxReceived",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),Bw=$(Ew.prototype,"_size",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(512,512)}}),$(Ew.prototype,"enabled",[yu],Object.getOwnPropertyDescriptor(Ew.prototype,"enabled"),Ew.prototype),$(Ew.prototype,"type",[yu,tw],Object.getOwnPropertyDescriptor(Ew.prototype,"type"),Ew.prototype),$(Ew.prototype,"shadowColor",[yu],Object.getOwnPropertyDescriptor(Ew.prototype,"shadowColor"),Ew.prototype),$(Ew.prototype,"normal",[ew],Object.getOwnPropertyDescriptor(Ew.prototype,"normal"),Ew.prototype),$(Ew.prototype,"distance",[iw,nw],Object.getOwnPropertyDescriptor(Ew.prototype,"distance"),Ew.prototype),$(Ew.prototype,"pcf",[rw,aw],Object.getOwnPropertyDescriptor(Ew.prototype,"pcf"),Ew.prototype),$(Ew.prototype,"autoAdapt",[ow,sw],Object.getOwnPropertyDescriptor(Ew.prototype,"autoAdapt"),Ew.prototype),$(Ew.prototype,"near",[lw,cw],Object.getOwnPropertyDescriptor(Ew.prototype,"near"),Ew.prototype),$(Ew.prototype,"far",[hw,uw],Object.getOwnPropertyDescriptor(Ew.prototype,"far"),Ew.prototype),$(Ew.prototype,"orthoSize",[_w,fw],Object.getOwnPropertyDescriptor(Ew.prototype,"orthoSize"),Ew.prototype),$(Ew.prototype,"maxReceived",[dw,pw],Object.getOwnPropertyDescriptor(Ew.prototype,"maxReceived"),Ew.prototype),$(Ew.prototype,"shadowMapSize",[mw],Object.getOwnPropertyDescriptor(Ew.prototype,"shadowMapSize"),Ew.prototype),$(Ew.prototype,"aspect",[vw,gw],Object.getOwnPropertyDescriptor(Ew.prototype,"aspect"),Ew.prototype),$(Ew.prototype,"bias",[yw,Tw],Object.getOwnPropertyDescriptor(Ew.prototype,"bias"),Ew.prototype),Sw=Ew))||Sw);n.ShadowsInfo=tR;var eR,iR,nR,rR,aR=(zw=ru("cc.SceneGlobals"),Uw=Fu(Jw),zw((qw=function(){function t(){J(this,"ambient",Hw,this),J(this,"shadows",Vw,this),J(this,"_skybox",Ww,this),J(this,"fog",jw,this)}return t.prototype.activate=function(){var t=n.director.root.pipeline;this.ambient.activate(t.ambient),this.skybox.activate(t.skybox),this.shadows.activate(t.shadows),this.fog.activate(t.fog)},q(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),Hw=$((Gw=qw).prototype,"ambient",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qw}}),Vw=$(Gw.prototype,"shadows",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tR}}),Ww=$(Gw.prototype,"_skybox",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jw}}),jw=$(Gw.prototype,"fog",[yu,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $w}}),$(Gw.prototype,"skybox",[yu,Uw],Object.getOwnPropertyDescriptor(Gw.prototype,"skybox"),Gw.prototype),kw=Gw))||kw);n.SceneGlobals=aR;var oR,sR=t("Scene",ru("cc.Scene")(($((iR=function(t){Y(i,t);var e=i.prototype;function i(e){var i;return J(i=t.call(this,e)||this,"autoReleaseAssets",nR,K(i)),J(i,"_globals",rR,K(i)),i._renderScene=null,i.dependAssets=null,i._inited=void 0,i._prefabSyncedInLiveReload=!1,i._pos=Ri.ZERO,i._rot=Li.IDENTITY,i._scale=Ri.ONE,i._mat=Vi.IDENTITY,i._dirtyFlags=0,i._activeInHierarchy=!1,n.director&&n.director.root&&(i._renderScene=n.director.root.createScene({})),i._inited=!n.game||!n.game._isCloning,i}return e._updateScene=function(){this._scene=this},q(i,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),e.destroy=function(){var t=p_.prototype.destroy.call(this);if(t)for(var e=this._children,i=0;i<e.length;++i)e[i].active=!1;return n.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},e.addComponent=function(){throw new Error(R(3822))},e._onHierarchyChanged=function(){},e._onBatchCreated=function(e){t.prototype._onBatchCreated.call(this,e);for(var i=this._children.length,n=0;n<i;++n)this._children[n]._onBatchCreated(e);_E(this)},e.getPosition=function(t){return Ri.copy(t||new Ri,Ri.ZERO)},e.getRotation=function(t){return Li.copy(t||new Li,Li.IDENTITY)},e.getScale=function(t){return Ri.copy(t||new Ri,Ri.ONE)},e.getWorldPosition=function(t){return Ri.copy(t||new Ri,Ri.ZERO)},e.getWorldRotation=function(t){return Li.copy(t||new Li,Li.IDENTITY)},e.getWorldScale=function(t){return Ri.copy(t||new Ri,Ri.ONE)},e.getWorldMatrix=function(t){return Vi.copy(t||new Vi,Vi.IDENTITY)},e.getWorldRS=function(t){return Vi.copy(t||new Vi,Vi.IDENTITY)},e.getWorldRT=function(t){return Vi.copy(t||new Vi,Vi.IDENTITY)},e.updateWorldTransform=function(){},e._instantiate=function(){},e._load=function(){this._inited||(this._onBatchCreated(!1),this._inited=!0),this.walk(oE._setScene)},e._activate=function(t){t=!1!==t,n.director._nodeActivator.activateNode(this,t),this._globals.activate()},q(i,[{key:"position",get:function(){return Ri.ZERO}},{key:"worldPosition",get:function(){return Ri.ZERO}},{key:"rotation",get:function(){return Li.IDENTITY}},{key:"worldRotation",get:function(){return Li.IDENTITY}},{key:"scale",get:function(){return Ri.ONE}},{key:"worldScale",get:function(){return Ri.ONE}},{key:"eulerAngles",get:function(){return Ri.ZERO}},{key:"worldMatrix",get:function(){return Vi.IDENTITY}}]),i}(oE)).prototype,"globals",[yu],Object.getOwnPropertyDescriptor(iR.prototype,"globals"),iR.prototype),nR=$(iR.prototype,"autoReleaseAssets",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rR=$(iR.prototype,"_globals",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new aR}}),eR=iR))||eR);function lR(t,e){if(!e){var i=n.director.getScene();if(!i)return null;e=i}return e.getChildByPath(t)}n.Scene=sR,n.find=lR,p_.Flags.HideInHierarchy;var cR=t("PrivateNode",ru("cc.PrivateNode")(oR=function(t){function e(e){return t.call(this,e)||this}return Y(e,t),e}(wA))||oR);n.PrivateNode=cR;var hR=se.fastRemoveAt,uR=p_.Flags.IsStartCalled,_R=p_.Flags.IsOnEnableCalled;function fR(t,e){for(var i=e.constructor._executionOrder,n=e._id,r=0,a=t.length-1,o=a>>>1;r<=a;o=r+a>>>1){var s=t[o],l=s.constructor._executionOrder;if(l>i)a=o-1;else if(l<i)r=o+1;else{var c=s._id;if(c>n)a=o-1;else{if(!(c<n))return o;r=o+1}}}return~r}function dR(t,e){for(var i=t.array,n=t.i+1;n<i.length;){var r=i[n];r.node._activeInHierarchy?++n:(t.removeAt(n),e&&(r._objFlags&=~e))}}p_.Flags.IsEditorOnEnableCalled;var pR=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=mt;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function mR(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}pR.stableRemoveInactive=dR;var vR=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},i.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},i.cancelInactive=function(t){dR(this._zero,t),dR(this._neg,t),dR(this._pos,t)},i.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(mR),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(mR),this._invoke(e),e.array.length=0)},e}(pR),gR=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var i=e<0?this._neg.array:this._pos.array,n=fR(i,t);n<0&&i.splice(~n,0,t)}},i.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var i=e<0?this._neg:this._pos,n=fR(i.array,t);n>=0&&i.removeAt(n)}},i.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}(pR);function yR(t,e,i){var r="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}",a=e?Function("it","dt",r):Function("it",r);return function(t,e,i){return function(r,a){try{e(r,a)}catch(e){n._throw(e);var o=r.array;for(i&&(o[r.i]._objFlags|=i),++r.i;r.i<o.length;++r.i)try{t(o[r.i],a)}catch(t){n._throw(t),i&&(o[r.i]._objFlags|=i)}}}}(Function("c","dt",t),a,i)}var TR=yR("c.start();c._objFlags|="+uR,!1,uR),SR=yR("c.update(dt)",!0),ER=yR("c.lateUpdate(dt)",!0),AR=function(t){var e=n.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var r=i[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||e._onEnabled(r))}},bR=function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new vR(TR),this.updateInvoker=new gR(SR),this.lateUpdateInvoker=new gR(ER),this._updating=!1},e._onEnabled=function(t){n.director.getScheduler().resumeTarget(t),t._objFlags|=_R,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){n.director.getScheduler().pauseTarget(t),t._objFlags&=~_R;var e=this._deferredComps.indexOf(t);e>=0?hR(this._deferredComps,e):(!t.start||t._objFlags&uR||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&_R)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&_R&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&uR||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,i=t.length;e<i;e++)this._scheduleImmediate(t[e]);t.length=0},t}(),xR=p_.Flags.IsPreloadStarted,CR=p_.Flags.IsOnLoadStarted,wR=p_.Flags.IsOnLoadCalled,RR=p_.Flags.Deactivating,IR=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.add=function(t){this._zero.array.push(t)},i.remove=function(t){this._zero.fastRemove(t)},i.cancelInactive=function(t){pR.stableRemoveInactive(this._zero,t)},i.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(pR),OR=yR("c.__preload();"),PR=yR("c.onLoad();c._objFlags|="+wR,!1,wR),MR=new oe(4);function DR(t,e,i){e?t._removeComponent(e):se.removeAt(t._components,i)}MR.get=function(){var t=this._get()||{preload:new IR(OR),onLoad:new vR(PR),onEnable:new vR(AR)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var NR=t("NodeActivator",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var i=MR.get();this._activatingStack.push(i),this._activateNodeRecursively(t,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),MR.put(i)}else{this._deactivateNodeRecursively(t);for(var n,r=Q(this._activatingStack);!(n=r()).done;){var a=n.value;a.preload.cancelInactive(xR),a.onLoad.cancelInactive(CR),a.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},e.activateComp=function(t,e,i,r){if(v_(t,!0)&&(t._objFlags&xR||(t._objFlags|=xR,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&CR||(t._objFlags|=CR,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=wR):t._objFlags|=wR),t._enabled)){if(!t.node._activeInHierarchy)return;n.director._compScheduler.enableComp(t,r)}},e.destroyComp=function(t){n.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&wR&&t.onDestroy()},e._activateNodeRecursively=function(t,e,i,r){if(t._objFlags&RR)b(3816,t.name);else{t._activeInHierarchy=!0;for(var a=t._components.length,o=0;o<a;++o){var s=t._components[o];s instanceof n.Component?this.activateComp(s,e,i,r):(DR(t,s,o),--o,--a)}t._childArrivalOrder=t._children.length;for(var l=0,c=t._children.length;l<c;++l){var h=t._children[l];h._active&&this._activateNodeRecursively(h,e,i,r)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=RR,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var r=t._components[i];if(r._enabled&&(n.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~RR)}for(var a=0,o=t._children.length;a<o;++a){var s=t._children[a];if(s._activeInHierarchy&&(this._deactivateNodeRecursively(s),t._activeInHierarchy))return void(t._objFlags&=~RR)}t._onPostActivated(!1),t._objFlags&=~RR},t}()),LR=t("Director",function(t){function e(){var e;return(e=t.call(this)||this)._compScheduler=void 0,e._nodeActivator=void 0,e._invalid=void 0,e._paused=void 0,e._purgeDirectorInNextLoop=void 0,e._root=void 0,e._loadingScene=void 0,e._scene=void 0,e._totalFrames=void 0,e._lastUpdate=void 0,e._deltaTime=void 0,e._startTime=void 0,e._scheduler=void 0,e._systems=void 0,e._invalid=!1,e._paused=!1,e._purgeDirectorInNextLoop=!1,e._root=null,e._loadingScene="",e._scene=null,e._totalFrames=0,e._lastUpdate=0,e._deltaTime=0,e._startTime=0,e._scheduler=new Db,e._compScheduler=new bR,e._nodeActivator=new NR,e._systems=[],n.game.once(hb.EVENT_RENDERER_INITED,e._initOnRendererInitialized,K(e)),e}Y(e,t);var i=e.prototype;return i.calculateDeltaTime=function(t){t||(t=performance.now()),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,this._lastUpdate=t},i.convertToGL=function(t){var e=n.game.container,i=n.view,r=e.getBoundingClientRect(),a=r.left+window.pageXOffset-e.clientLeft,o=r.top+window.pageYOffset-e.clientTop,s=i._devicePixelRatio*(t.x-a),l=i._devicePixelRatio*(o+r.height-t.y);return i._isRotated?Zi(i._viewportRect.width-l,s):Zi(s,l)},i.convertToUI=function(t){var e=n.game.container,i=n.view,r=e.getBoundingClientRect(),a=r.left+window.pageXOffset-e.clientLeft,o=r.top+window.pageYOffset-e.clientTop,s=Zi(0,0);return i._isRotated?(s.x=a+t.y/i._devicePixelRatio,s.y=o+r.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(s.x=a+t.x*i._devicePixelRatio,s.y=o+r.height-t.y*i._devicePixelRatio),s},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return en(n.winSize)},i.getWinSizeInPixels=function(){return en(n.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){n.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),NS&&NS.setEnabled(!1),n.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),n.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(e.EVENT_RESET),NS&&NS.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(t,e,i){t instanceof Cx&&(t=t.scene),w(t instanceof sR,1216),t._load();for(var r=Object.keys(n.game._persistRootNodes).map((function(t){return n.game._persistRootNodes[t]})),a=0;a<r.length;a++){var o=r[a];o.emit(n.Node.SCENE_CHANGED_FOR_PERSISTS,t.renderScene);var s=t.uuid===o._originalSceneId&&t.getChildByUuid(o.uuid);if(s){var l=s.getSiblingIndex();s._destroyImmediate(),t.insertChild(o,l)}else o.parent=t}var c=this._scene;n.isValid(c)&&c.destroy(),n.assetManager._releaseManager._autoRelease(c,t,n.game._persistRootNodes),this._scene=null,p_._deferredDestroy(),e&&e(),this.emit(n.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,t),this.emit(n.Director.EVENT_AFTER_SCENE_LAUNCH,t)},i.runScene=function(t,e,i){var r=this;t instanceof Cx&&(t=t.scene),w(t,1205),w(t instanceof sR,1216),t._load(),this.once(n.Director.EVENT_AFTER_DRAW,(function(){r.runSceneImmediate(t,e,i)}))},i.loadScene=function(t,e,i){var r=this;if(this._loadingScene)return E(1208,t,this._loadingScene),!1;var a=n.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));return a?(this.emit(n.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,console.time("LoadScene "+t),a.loadScene(t,(function(n,a){console.timeEnd("LoadScene "+t),r._loadingScene="",n?(d(n),e&&e(n)):r.runSceneImmediate(a,i,e)})),!0):(b(1209,t),!1)},i.preloadScene=function(t,e,i){var r=n.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));if(r)r.preloadScene(t,null,e,i);else{var a='Can not preload the scene "'+t+'" because it is not in the build settings.';i&&i(new Error(a)),d("preloadScene: "+a)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||T(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(t){n.Camera.main&&(n.Camera.main.depth=!!t)},i.setClearColor=function(t){n.Camera.main&&(n.Camera.main.backgroundColor=t)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/n.game.getFrameRate()},i.setAnimationInterval=function(t){n.game.setFrameRate(Math.round(1e3/t))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(Db.ID,t,200))},i.registerSystem=function(t,e,i){e.id=t,e.priority=i,e.init(),this._systems.push(e),this._systems.sort(wb.sortByPriority)},i.unregisterSystem=function(t){se.fastRemove(this._systems,t),this._systems.sort(wb.sortByPriority)},i.getSystem=function(t){return this._systems.find((function(e){return e.id===t}))},i.getAnimationManager=function(){return this.getSystem(n.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(t){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(t);var i=this._deltaTime;if(!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var n=0;n<this._systems.length;++n)this._systems[n].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(e.EVENT_AFTER_UPDATE),p_._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(i)}this.emit(e.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(e.EVENT_AFTER_DRAW),NS.frameUpdateListeners(),wA.bookOfChange.clear(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,NS&&NS.setEnabled(!0),this.registerSystem(Db.ID,this._scheduler,200),this.emit(e.EVENT_INIT)},i._init=function(){return this._root=new Lb(n.game._gfxDevice),this._root.initialize({}).catch((function(t){return b(1217),Promise.reject(t)}))},q(e,[{key:"root",get:function(){return this._root}}]),e}(P_));LR.EVENT_INIT="director_init",LR.EVENT_RESET="director_reset",LR.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",LR.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",LR.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",LR.EVENT_BEFORE_UPDATE="director_before_update",LR.EVENT_AFTER_UPDATE="director_after_update",LR.EVENT_BEFORE_DRAW="director_before_draw",LR.EVENT_AFTER_DRAW="director_after_draw",LR.EVENT_BEFORE_COMMIT="director_before_commit",LR.EVENT_BEFORE_PHYSICS="director_before_physics",LR.EVENT_AFTER_PHYSICS="director_after_physics",LR.instance=void 0,n.Director=LR;var BR=t("director",LR.instance=n.director=new LR),FR=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Uu,this.scenes=new Uu,this.paths=new Uu}var e=t.prototype;return e.init=function(t){!function(t){var e=t.uuids,i=t.paths,n=t.types,r=t.deps,a=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,s=e.length;o<s;o++)e[o]=i_(e[o]);for(var l in i){var c=i[l],h=c[1];c[1]=n[h]}}else{for(var u=Object.create(null),_=0,f=e.length;_<f;_++){var d=e[_];e[_]=u[d]=i_(d)}e=u}for(var p in i){var m=i[p];a[e[p]]=m}var v=t.scenes;for(var g in v){var y=v[g];v[g]=e[y]}var T=t.packs;for(var S in T)for(var E=T[S],A=0;A<E.length;++A)E[A]=e[E[A]];var b=t.versions;if(b)for(var x in b)for(var C=b[x],w=0;w<C.length;w+=2){var R=C[w];C[w]=e[R]||R}var I=t.redirect;if(I)for(var O=0;O<I.length;O+=2)I[O]=e[I[O]],I[O+1]=r[I[O+1]]}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect)},e.getInfoWithPath=function(t,e){if(!t)return null;t=s_(t);var i=this.paths.get(t);if(i){if(!e)return i[0];for(var n=0,r=i.length;n<r;n++){var a=i[n];if(le.isChildClassOf(a.ctor,e))return a}}return null},e.getDirWithPath=function(t,e,i){"/"===(t=s_(t))[t.length-1]&&(t=t.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(r,t)||!t)for(var a=0,o=i.length;a<o;a++){var s=i[a];e&&!le.isChildClassOf(s.ctor,e)||n.push(s)}})),n},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,i){return i.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,i=t.length;e<i;e++){var n=t[e];this.assetInfos.add(n,{uuid:n})}}},e._initPath=function(t){if(t){var e=this.paths;for(var i in e.clear(),t){var n=t[i],r=n[0],a=n[1],o=3===n.length,s=this.assetInfos.get(i);s.path=r,s.ctor=le._getClassById(a),e.has(r)?o?e.get(r).push(s):e.get(r).splice(0,0,s):e.add(r,[s])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var i=this.assetInfos;for(var n in t){var r=t[n],a=i.get(r);a.url=n,e.add(n,a)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var i in t){var n=t[i],r={uuid:i,packedUuids:n,ext:".json"};e.add(i,r);for(var a=0,o=n.length;a<o;a++){var s=n[a],l=e.get(s),c=l.packs;c?1===o?c.splice(0,0,r):c.push(r):l.packs=[r]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,i=t.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var a=i[n];e.get(a).ver=i[n+1]}if(i=t.native)for(var o=0,s=i.length;o<s;o+=2){var l=i[o];e.get(l).nativeVer=i[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,i=0,n=t.length;i<n;i+=2){var r=t[i];e.get(r).redirect=t[i+1]}},t}();function zR(t,e){t._uuid&&e.push(t._uuid)}function UR(t,e){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var a=t[r];if("object"==typeof a&&a)if(Array.isArray(a))for(var o=0;o<a.length;o++){var s=a[o];s instanceof M_&&zR(s,e)}else if(a.constructor&&a.constructor!==Object)a instanceof M_&&zR(a,e);else for(var l=Object.getOwnPropertyNames(a),c=0;c<l.length;c++){var h=a[l[c]];h instanceof M_&&zR(h,e)}}}}function kR(t,e,i,n){i.push(t._uuid);for(var r=nd.getDeps(t._uuid),a=0,o=r.length;a<o;a++){var s=Hu.get(r[a]);if(s){var l=s._uuid;l in e?e[l]+=n:e[l]=s.refCount+n,i.includes(l)||kR(s,e,i,n)}}}var GR=[],HR=new(function(){function t(){this._persistNodeDeps=new Uu,this._toDelete=new Uu,this._eventListener=!1}var e=t.prototype;return e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];!function t(e,i){for(var n=0;n<e._components.length;n++)UR(e._components[n],i);for(var r=0;r<e._children.length;r++)t(e._children[r],i)}(t,e);for(var i=0,n=e.length;i<n;i++){var r=Hu.get(e[i]);r&&r.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),i=0,n=e.length;i<n;i++){var r=Hu.get(e[i]);r&&r.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,i){if(t){for(var n=nd.getDeps(t.uuid),r=0,a=n.length;r<a;r++){var o=Hu.get(n[r]);o&&o.decRef(t.autoReleaseAssets)}var s=nd._depends.get(t.uuid);if(s&&s.persistDeps)for(var l=s.persistDeps,c=0,h=l.length;c<h;c++){var u=Hu.get(l[c]);u&&u.decRef(t.autoReleaseAssets)}t.uuid!==e.uuid&&nd.remove(t.uuid)}var _=nd._depends.get(e.uuid);for(var f in _&&(_.persistDeps=[]),i){for(var d,p,m=i[f],v=this._persistNodeDeps.get(m.uuid),g=Q(v);!(p=g()).done;){var y=p.value,T=Hu.get(y);T&&T.addRef()}_&&(d=_.persistDeps).push.apply(d,v)}},e.tryRelease=function(t,e){void 0===e&&(e=!1),t instanceof M_&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,xe(this._freeAssets.bind(this)))))},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var i=t._uuid;if(this._toDelete.remove(i),v_(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,kR(t,e,GR,-1),GR.length=0,0!==e[t._uuid])return e[t._uuid];for(var i in e)0!==e[i]&&kR(Hu.get(i),e,GR,1);return GR.length=0,e[t._uuid]}(t)>0)){Hu.remove(i);for(var n=nd.getDeps(i),r=0,a=n.length;r<a;r++){var o=Hu.get(n[r]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),nd.remove(i)}},t}()),VR=null;function WR(t,e){for(var i=0,n=t.input.length;i<n;i++){var r=t.input[i];e&&!r.isNative&&r.content instanceof M_&&r.content.decRef(!1),r.recycle()}t.input=null}function jR(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function qR(t,e,i,n,r,a,o){try{var s=nd.parse(t,e),l=!0;if(e instanceof M_&&!e.__nativeDepend__&&(l=!1),r){for(var c=0,h=s.deps.length;c<h;c++){var u=s.deps[c];u in i||(i[u]=!0,n.push({uuid:u,bundle:o&&o.name}))}l&&s.nativeDep&&(o&&(s.nativeDep.bundle=o.name),n.push(X({},s.nativeDep)))}else{a=!!e.asyncLoadAssets||a&&!s.preventDeferredLoadDependents;for(var _=0,f=s.deps.length;_<f;_++){var p=s.deps[_];p in i||(i[p]=!0,n.push({uuid:p,__asyncLoadAssets__:a,bundle:o&&o.name}))}l&&!a&&!s.preventPreloadNativeObject&&s.nativeDep&&(o&&(s.nativeDep.bundle=o.name),n.push(X({},s.nativeDep)))}}catch(t){d(t.message,t.stack)}}function XR(t,e,i){e&&(i=void 0!==i?i:n.assetManager.cacheAsset,!o_(e)&&i&&Hu.add(t,e))}function YR(t,e,i){var n=!1,r=e.__depends__;if(r){for(var a=0,o=r.length;a<o;a++){var s=r[a],l=i[s.uuid+"@import"];l?s.owner[s.prop]=l.addRef():(d("The asset "+s.uuid+" is missing!"),n=!0)}e.__depends__=null}return e.__nativeDepend__&&(i[t+"@native"]?e._nativeAsset=i[t+"@native"]:n=!0,e.__nativeDepend__=!1),n}function KR(t,e,i){var n=0,r=[],a=t.length;0===a&&i&&i(r);for(var o=function(t){t&&r.push(t),++n===a&&i&&i(r)},s=0;s<a;s++)e(t[s],o)}function ZR(t,e,i){var n=t,r=e,a=i;if(void 0===i){var o="function"==typeof t;e?(a=e,o||(r=null)):void 0===e&&o&&(a=t,n=null,r=null),void 0!==e&&o&&(r=t,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:a}}function QR(t,e,i){var n=t,r=e,a=i;if(void 0===i){var o=le.isChildClassOf(t,M_);e?(a=e,o&&(r=null)):void 0!==e||o||(a=t,r=null,n=null),void 0===e||o||(r=t,n=null)}return{type:n,onProgress:r||VR,onComplete:a}}function JR(t){return function(e,i){if(t){var n=[];Array.isArray(i)?i.forEach((function(t){return t instanceof M_&&n.push(t.addRef())})):i instanceof M_&&n.push(i.addRef()),xe((function(){n.forEach((function(t){return t.decRef(!1)})),t(e,i)}))}}}var $R=function(){function t(){this._config=new FR}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,i){return this._config.getDirWithPath(t,e,i)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),ju.add(t.name,this)},e.load=function(t,e,i,r){var a=QR(e,i,r),o=a.type,s=a.onProgress,l=a.onComplete,c={__requestType__:Gu.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(t)};n.assetManager.loadAny(t,c,s,l)},e.preload=function(t,e,i,r){var a=QR(e,i,r),o=a.type,s=a.onProgress,l=a.onComplete;n.assetManager.preloadAny(t,{__requestType__:Gu.PATH,type:o,bundle:this.name},s,l)},e.loadDir=function(t,e,i,r){var a=QR(e,i,r),o=a.type,s=a.onProgress,l=a.onComplete;n.assetManager.loadAny(t,{__requestType__:Gu.DIR,type:o,bundle:this.name,__outputAsArray__:!0},s,l)},e.preloadDir=function(t,e,i,r){var a=QR(e,i,r),o=a.type,s=a.onProgress,l=a.onComplete;n.assetManager.preloadAny(t,{__requestType__:Gu.DIR,type:o,bundle:this.name},s,l)},e.loadScene=function(t,e,i,r){var a=ZR(e,i,r),o=a.options,s=a.onProgress,l=a.onComplete;o.preset=o.preset||"scene",o.bundle=this.name,n.assetManager.loadAny({scene:t},o,s,(function(t,e){if(t)d(t.message,t.stack);else if(e instanceof Cx&&e.scene){var i=e.scene;i._id=e._uuid,i.name=e.name}else t=new Error("The asset "+e._uuid+" is not a scene");l&&l(t,e)}))},e.preloadScene=function(t,e,i,r){var a=ZR(e,i,r),o=a.options,s=a.onProgress,l=a.onComplete;o.bundle=this.name,n.assetManager.preloadAny({scene:t},o,s,(function(e){e&&b(1210,t,e.message),l&&l(e)}))},e.get=function(t,e){var i=this.getInfoWithPath(t,e);return i&&Hu.get(i.uuid)||null},e.release=function(t,e){var i=this.get(t,e);i&&HR.tryRelease(i,!0)},e.releaseUnusedAssets=function(){var t=this;Hu.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&HR.tryRelease(e)}))},e.releaseAll=function(){var t=this;Hu.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&HR.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},q(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),tI=t("resources",new $R);function eI(t,e,i){var n=new Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",a),i&&i(null,n)}function a(){n.removeEventListener("load",r),n.removeEventListener("error",a),i&&i(new Error(R(4930,t)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",a),n.src=t,n}function iI(t,e,i,n){var r=new XMLHttpRequest,a="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(var o in e.xhrHeader)r.setRequestHeader(o,e.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+a+r.status+"(no response)"))},i&&(r.onprogress=function(t){t.lengthComputable&&i(t.loaded,t.total)}),r.onerror=function(){n&&n(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+a+r.status+"(abort)"))},r.send(null),r}n.resources=tI;var nI={};function rI(t,e,i){if(nI[t])return i&&i(null),null;var n=document.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",a,!1),nI[t]=!0,i&&i(null)}function a(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",a,!1),i&&i(new Error(R(4928,t)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.async=e.scriptAsyncLoading||!1,n.src=t,n.addEventListener("load",r,!1),n.addEventListener("error",a,!1),document.body.appendChild(n),n}var aI=/^(?:\w+:\/\/|\.+\/).+/,oI=function(t,e,i){(yv.capabilities.imageBitmap&&n.assetManager.allowImageBitmap?sI:eI)(t,e,i)},sI=function(t,e,i){e.xhrResponseType="blob",iI(t,e,e.onFileProgress,i)},lI=function(t,e,i){e.xhrResponseType="json",iI(t,e,e.onFileProgress,i)},cI=function(t,e,i){e.xhrResponseType="arraybuffer",iI(t,e,e.onFileProgress,i)},hI=function(t,e,i){e.xhrResponseType="text",iI(t,e,e.onFileProgress,i)},uI=function(t,e,i){var n=z(t),r=t;aI.test(r)||(r=-1!==_I.remoteBundles.indexOf(n)?_I.remoteServerAddress+"remote/"+n:"assets/"+n);var a=e.version||_I.bundleVers[n],o=0,s=null,l=null;lI(r+"/config."+(a?a+".":"")+"json",e,(function(t,e){t&&(l=t),(s=e)&&(s.base=r+"/"),2==++o&&i(l,s)})),rI(r+"/index."+(a?a+".":"")+"js",e,(function(t){t?(l=t,2==++o&&i(t)):_I.importBundleEntry(n).then((function(){2==++o&&i(l,s)})).catch((function(t){l=t,2==++o&&i(l)}))}))},_I=new(function(){function t(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=eI,this.downloadDomAudio=null,this.downloadFile=iI,this.downloadScript=rI,this._downloaders={".png":oI,".jpg":oI,".bmp":oI,".jpeg":oI,".gif":oI,".ico":oI,".tiff":oI,".webp":oI,".image":oI,".pvr":cI,".pkm":cI,".astc":cI,".txt":hI,".xml":hI,".vsh":hI,".fsh":hI,".atlas":hI,".tmx":hI,".tsx":hI,".json":lI,".ExportJson":lI,".plist":hI,".fnt":hI,".binary":cI,".bin":cI,".dbbin":cI,".skel":cI,".js":rI,bundle:uI,default:hI},this._downloading=new Uu,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var i=t.prototype;return i.init=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=i},i.register=function(t,e){"object"==typeof t?Wt(this._downloaders,t):this._downloaders[t]=e},i.importBundleEntry=function(t){return e.import("virtual:///prerequisite-imports/"+t)},i.download=function(t,e,i,n,r){var a=this,o=Vu.get(t);if(o)r(null,o);else{var s=this._downloading.get(t);if(s){s.push(r);var l=this._queue.find((function(e){return e.id===t}));if(!l)return;var c=n.priority||0;l.priority<c&&(l.priority=c,this._queueDirty=!0)}else{var h=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,u=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,_=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[i]||this._downloaders.default;!function t(e,i,n,r,a){void 0===a&&(a=0),e(a,(function(o,s){a++,!o||a>i?r&&r(o,s):setTimeout((function(){t(e,i,n,r,a)}),n)}))}((function(i,o){if(0===i&&a._downloading.add(t,[r]),a.limited){a._updateTime();var s=function(t,e){a._totalNum--,a._handleQueueInNextFrame(u,_),o(t,e)};a._totalNum<u&&a._totalNumThisPeriod<_?(f(jR(e,a.appendTimeStamp),n,s),a._totalNum++,a._totalNumThisPeriod++):(a._queue.push({id:t,priority:n.priority||0,url:e,options:n,done:s,handler:f}),a._queueDirty=!0,a._totalNum<u&&a._handleQueueInNextFrame(u,_))}else f(jR(e,a.appendTimeStamp),n,o)}),h,this.retryInterval,(function(e,i){e||Vu.add(t,i);for(var n=a._downloading.remove(t),r=0,o=n.length;r<o;r++)n[r](e,i)}))}}},i.loadSubpackage=function(t,e){n.assetManager.loadBundle(t,null,e)},i._updateTime=function(){var t=Date.now(),e=n.director.getDeltaTime(),i=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=t)},i._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(jR(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(t,e)},i._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(xe(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},q(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}());function fI(t,e,i,n){var r=null,a=null;try{(r=new V_)._nativeUrl=t,r._nativeAsset=e}catch(t){a=t}n(a,r)}function dI(t,e,i,n){var r=new Mx;r.json=e,n(null,r)}function pI(t,e,i,n){var r=new Px;r.text=e,n(null,r)}function mI(t,e,i,n){var r=new hx;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}function vI(t,e,i,n){var r=new M_;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}function gI(t,e,i,n){var r=ju.get(e.name);r||(r=e.name===Ku.RESOURCES?tI:new $R,e.base=e.base||t+"/",r.init(e)),n(null,r)}var yI=new(function(){function t(){this._creating=new Uu,this._producers={".png":fI,".jpg":fI,".bmp":fI,".jpeg":fI,".gif":fI,".ico":fI,".tiff":fI,".webp":fI,".image":fI,".pvr":fI,".pkm":fI,".txt":pI,".xml":pI,".vsh":pI,".fsh":pI,".atlas":pI,".tmx":pI,".tsx":pI,".fnt":pI,".json":dI,".ExportJson":dI,".binary":mI,".bin":mI,".dbbin":mI,".skel":mI,bundle:gI,default:vI}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?le.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,i,n,r){var a=this,o=this._producers[i]||this._producers.default,s=Hu.get(t);if(n.reloadAsset||!s){var l=this._creating.get(t);l?l.push(r):(this._creating.add(t,[r]),o(t,e,n,(function(e,i){!e&&i instanceof M_&&(i._uuid=t,XR(t,i,n.cacheAsset));for(var r=a._creating.remove(t),o=0,s=r.length;o<s;o++)r[o](e,i)})))}else r(null,s)},t}()),TI=new(function(){function t(){this._loading=new Uu,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,i,n){var r=le.createMap(!0),a=null;if(Array.isArray(e)){(e=function(t){if(t[0]<1)throw new Error(R(5304,t[0]));bf(t,!0,void 0),xf(t);for(var e=new Of(t[0]),i=t[1],n=t[2],r=t[3],a=t[4],o=t[5],s=0;s<o.length;++s)o[s].unshift(e,i,n,r,a);return o}(e)).length!==t.length&&b(4915);for(var o=0;o<t.length;o++)r[t[o]+"@import"]=e[o]}else{var s=le._getClassId(yd);if(e.type===s&&e.data){var l=e.data;l.length!==t.length&&b(4915);for(var c=0;c<t.length;c++)r[t[c]+"@import"]=Pf(s,{base:l[c][0],mipmaps:l[c][1]})}else a=new Error("unmatched type pack!"),r=null}n(a,r)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?le.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,i,n,r){e?(0,this._unpackers[i])(t,e,n,r):r(new Error("package data is wrong!"))},e.load=function(t,e,i){var n=this;if(!t.isNative&&t.info&&t.info.packs)if(Vu.has(t.id))i(null,Vu.get(t.id));else{var r=t.info.packs,a=r.find((function(t){return n._loading.has(t.uuid)}));if(a)this._loading.get(a.uuid).push({onComplete:i,id:t.id});else{a=r[0],this._loading.add(a.uuid,[{onComplete:i,id:t.id}]);var o=l_(a.uuid,{ext:a.ext,bundle:t.config.name});_I.download(a.uuid,o,a.ext,t.options,(function(e,i){Vu.remove(a.uuid),e&&d(e.message,e.stack),n.unpack(a.packedUuids,i,a.ext,t.options,(function(t,i){if(!t)for(var r in i)Vu.add(r,i[r]);for(var o=n._loading.remove(a.uuid),s=0,l=o.length;s<l;s++){var c=o[s];if(e||t)c.onComplete(e||t);else{var h=i[c.id];h?c.onComplete(null,h):c.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else _I.download(t.id,t.url,t.ext,t.options,i)},t}());function SI(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,a=t.progress,o=[],s=a.total;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],KR(t.input,(function(r,l){if(!r.isNative&&Hu.has(r.uuid)){var c=Hu.get(r.uuid);return c.addRef(),AI(r,t,c,null,c.__asyncLoadAssets__,o,s),void l()}TI.load(r,t.options,(function(c,h){c?t.isFinish||(!n.assetManager.force||i?(d(c.message,c.stack),a.canInvoke=!1,e(c)):AI(r,t,null,null,!1,o,s)):t.isFinish||AI(r,t,null,h,!r.isNative,o,s),l()}))}),(function(){if(t.isFinish)return WR(t,!0),void t.dispatch("error");if(o.length>0){var n=Qu.create({input:o,progress:a,options:r,onProgress:t.onProgress,onError:Qu.prototype.recycle,onComplete:function(r){var a;r||((a=t.output).push.apply(a,n.output),n.recycle()),i&&EI(t),e(r)}});Xu.async(n)}else i&&EI(t),e()}))}function EI(t){for(var e=t.output,i=0,n=e.length;i<n;i++)e[i].content&&e[i].content.decRef(!1)}function AI(t,e,i,n,r,a,o){var s=e.options.__exclude__,l=e.progress;t.content=i,t.file=n,e.output.push(t),r&&(s[t.uuid]=!0,qR(t.uuid,n||i,s,a,!0,!1,t.config),l.total=o+a.length),l.canInvoke&&e.dispatch("progress",++l.finish,l.total,t)}var bI=new(function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return E(5100),{};for(var i=null,n=0,r=e.childNodes.length;n<r&&1!==(i=e.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},i._parseArray=function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},i._parseDict=function(t){for(var e={},i="",n=0,r=t.childNodes.length;n<r;n++){var a=t.childNodes[n];1===a.nodeType&&("key"===a.tagName?i=a.firstChild.nodeValue:e[i]=this._parseNode(a))}return e},e}(function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}()));function xI(t,e){return t[e]<<8|t[e+1]}var CI=new(function(){function t(){this._parsing=new Uu,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,i){t instanceof HTMLImageElement?i(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){i(null,t)}),(function(t){i(t,null)}))},e.parseAudio=function(t,e,i){t instanceof ArrayBuffer?yv.__audioSupport.context.decodeAudioData(t,(function(t){i(null,t)}),(function(t){i(new Error("Error with decoding audio data"+t.err),null)})):i(null,t)},e.parsePVRTex=function(t,e,i){var n=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(a,0,13);if(55727696===o[0]){var s=o[7],l=o[6],c=o[12]+52;r={_data:new Uint8Array(a,c),_compressed:!0,width:s,height:l,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var h=o[0],u=o[1],_=o[2];r={_data:new Uint8Array(a,h),_compressed:!0,width:_,height:u,format:0}}}catch(t){n=t}i(n,r)},e.parsePKMTex=function(t,e,i){var n=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a),s=xI(o,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var l=xI(o,12),c=xI(o,14);xI(o,8),xI(o,10),r={_data:new Uint8Array(a,16),_compressed:!0,width:l,height:c,format:0}}catch(t){n=t}i(n,r)},e.parseASTCTex=function(t,e,i){var n=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=o[4],l=o[5],c=o[6];if((s<3||s>6||l<3||l>6||c<3||c>6)&&(s<4||7===s||9===s||11===s||s>12||l<4||7===l||9===l||11===l||l>12||1!==c))throw new Error("Invalid block number in ASTC header");var h=function(t,e){return 4===t?D_.RGBA_ASTC_4x4:5===t?4===e?D_.RGBA_ASTC_5x4:D_.RGBA_ASTC_5x5:6===t?5===e?D_.RGBA_ASTC_6x5:D_.RGBA_ASTC_6x6:8===t?5===e?D_.RGBA_ASTC_8x5:6===e?D_.RGBA_ASTC_8x6:D_.RGBA_ASTC_8x8:10===t?5===e?D_.RGBA_ASTC_10x5:6===e?D_.RGBA_ASTC_10x6:8===e?D_.RGBA_ASTC_10x8:D_.RGBA_ASTC_10x10:10===e?D_.RGBA_ASTC_12x10:D_.RGBA_ASTC_12x12}(s,l),u=o[7]+(o[8]<<8)+(o[9]<<16),_=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],r={_data:new Uint8Array(a,16),_compressed:!0,width:u,height:_,format:h}}catch(t){n=t}i(n,r)},e.parsePlist=function(t,e,i){var n=null,r=bI.parse(t);r||(n=new Error("parse failed")),i(n,r)},e.parseImport=function(t,e,i){if(t){var n=null,r=null;try{n=ed(t,e)}catch(t){r=t}i(r,n)}else i(new Error("The json file of asset "+e.__uuid__+" is empty or missing"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?Wt(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,i,n,r){var a=this,o=Wu.get(t);if(o)r(null,o);else{var s=this._parsing.get(t);if(s)s.push(r);else{var l=this._parsers[i];l?(this._parsing.add(t,[r]),l(e,n,(function(e,i){e?Vu.remove(t):o_(i)||Wu.add(t,i);for(var n=a._parsing.remove(t),r=0,o=n.length;r<o;r++)n[r](e,i)}))):r(null,e)}}},t}());function wI(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,a=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],KR(t.input,(function(o,s){var l=Qu.create({input:o,onProgress:t.onProgress,options:r,progress:a,onComplete:function(r,c){r&&!t.isFinish&&(!n.assetManager.force||i?(d(r.message,r.stack),a.canInvoke=!1,e(r)):a.canInvoke&&t.dispatch("progress",++a.finish,a.total,o)),t.output.push(c),l.recycle(),s(null)}});RI.async(l)}),(function(){if(r.__exclude__=null,t.isFinish)return WR(t,!0),void t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var i=t.output=[],n=0,r=e.length;n<r;n++)i.push(e[n].content);else t.output=e[0].content}(t),WR(t,!0),e()}))}var RI=new ku("loadOneAsset",[function(t,e){var i=t.output=t.input,n=i.options,r=i.isNative,a=i.uuid,o=i.file,s=n.reloadAsset;o||!s&&!r&&Hu.has(a)?e():TI.load(i,t.options,(function(t,n){i.file=n,e(t)}))},function(t,e){var i=t.output=t.input,n=t.progress,r=t.options.__exclude__,a=i.id,o=i.file,s=i.options;if(i.isNative)CI.parse(a,o,i.ext,s,(function(r,o){r?e(r):(i.content=o,n.canInvoke&&t.dispatch("progress",++n.finish,n.total,i),Vu.remove(a),Wu.remove(a),e())}));else{var l=i.uuid;if(l in r){var c=r[l],h=c.finish,u=c.content,_=c.err,f=c.callbacks;n.canInvoke&&t.dispatch("progress",++n.finish,n.total,i),h||function t(e,i,n,r){if(void 0===r&&(r={}),!n[i]||r[i])return!1;r[i]=!0;var a=!1,o=nd.getDeps(i);if(o)for(var s=0,l=o.length;s<l;s++){var c=o[s];if(c===e||t(e,c,n,r)){a=!0;break}}return a}(l,l,r)?(u&&u.addRef(),i.content=u,e(_)):f.push({done:e,item:i})}else if(!s.reloadAsset&&Hu.has(l)){var d=Hu.get(l);s.__asyncLoadAssets__||!d.__asyncLoadAssets__?(i.content=d.addRef(),n.canInvoke&&t.dispatch("progress",++n.finish,n.total,i),e()):II(t,d,e,!1)}else s.__uuid__=l,CI.parse(a,o,"import",s,(function(i,n){i?e(i):II(t,n,e,!0)}))}}]);function II(t,e,i,n){var r=t.input,a=t.progress,o=r,s=o.uuid,l=o.id,c=o.options,h=o.config,u=c.__asyncLoadAssets__,_=c.cacheAsset,f=[];e.addRef&&e.addRef(),qR(s,e,Object.create(null),f,!1,u,h),a.canInvoke&&t.dispatch("progress",++a.finish,a.total+=f.length,r);var p=t.options.__exclude__[s]={content:e,finish:!1,callbacks:[{done:i,item:r}]},m=Qu.create({input:f,options:t.options,onProgress:t.onProgress,onError:Qu.prototype.recycle,progress:a,onComplete:function(t){if(e.decRef&&e.decRef(!1),e.__asyncLoadAssets__=u,p.finish=!0,p.err=t,!t){for(var i,r=Array.isArray(m.output)?m.output:[m.output],a=Object.create(null),o=Q(r);!(i=o()).done;){var c=i.value;c&&(a[c instanceof M_?c._uuid+"@import":s+"@native"]=c)}if(n){YR(s,e,a);try{!e.onLoaded||e.__onLoadedInvoked__||e.__nativeDepend__||(e.onLoaded(),e.__onLoadedInvoked__=!0)}catch(t){d(t.message,t.stack)}Vu.remove(l),Wu.remove(l),XR(s,e,_)}else if(e.__nativeDepend__){YR(s,e,a);try{!e.onLoaded||e.__onLoadedInvoked__||e.__nativeDepend__||(e.onLoaded(),e.__onLoadedInvoked__=!0)}catch(t){d(t.message,t.stack)}}m.recycle()}for(var h=p.callbacks,f=0,v=h.length;f<v;f++){var g=h[f];e.addRef&&e.addRef(),g.item.content=e,g.done(t)}h.length=0}});qu.async(m)}function OI(t,e){var i=t.options,n=Object.create(null),r=Object.create(null);for(var a in i)switch(a){case Gu.PATH:case Gu.UUID:case Gu.DIR:case Gu.SCENE:case Gu.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[a]=i[a];break;case"__exclude__":case"__outputAsArray__":r[a]=i[a];break;default:n[a]=i[a],r[a]=i[a]}t.options=r;var o=Qu.create({input:t.input,options:n}),s=null;try{t.output=t.source=Yu.sync(o)}catch(t){s=t;for(var l=0,c=o.output.length;l<c;l++)o.output[l].recycle()}o.recycle(),e(s)}var PI=function(){function t(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},q(t,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),t}();PI.MAX_DEAD_NUM=500,PI._deadPool=[];var MI=[];function DI(t){var e=t.options,i=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var n=function(n){var r=i[n],a=PI.create(),o=null,s=null;if("string"==typeof r&&((r=Object.create(null))[e.__requestType__||Gu.UUID]=i[n]),"object"==typeof r)for(var l in Vt(r,e),r.preset&&Vt(r,Zu[r.preset]),r){switch(l){case Gu.UUID:if("break"===function(){var t=a.uuid=i_(r.uuid);if(!r.bundle){var e=ju.find((function(e){return!!e.getAssetInfo(t)}));r.bundle=e&&e.name}if(ju.has(r.bundle)){if(o=ju.get(r.bundle).config,(s=o.getAssetInfo(t))&&s.redirect){if(!ju.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");o=ju.get(s.redirect).config,s=o.getAssetInfo(t)}a.config=o,a.info=s}return a.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Gu.DIR:if(ju.has(r.bundle)){ju.get(r.bundle).config.getDirWithPath(r.dir,r.type,MI);for(var c,h=Q(MI);!(c=h()).done;){var u=c.value;i.push({uuid:u.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}MI.length=0}a.recycle(),a=null;break;case Gu.PATH:if(ju.has(r.bundle)){if(o=ju.get(r.bundle).config,(s=o.getInfoWithPath(r.path,r.type))&&s.redirect){if(!ju.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");o=ju.get(s.redirect).config,s=o.getAssetInfo(s.uuid)}if(!s)throw a.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);a.config=o,a.uuid=s.uuid,a.info=s}a.ext=r.ext||".json";break;case Gu.SCENE:if(!r.bundle){var _=ju.find((function(t){return!!t.getSceneInfo(r.scene)}));r.bundle=_&&_.name}if(ju.has(r.bundle)){if(o=ju.get(r.bundle).config,(s=o.getSceneInfo(r.scene))&&s.redirect){if(!ju.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");o=ju.get(s.redirect).config,s=o.getAssetInfo(s.uuid)}if(!s)throw a.recycle(),new Error("Bundle "+o.name+" doesn't contain scene "+r.scene);a.config=o,a.uuid=s.uuid,a.info=s}break;case"__isNative__":a.isNative=r.__isNative__;break;case Gu.URL:a.url=r.url,a.uuid=r.uuid||r.url,a.ext=r.ext||B(r.url),a.isNative=void 0===r.__isNative__||r.__isNative__;break;default:a.options[l]=r[l]}if(!a)break}if(!a)return"continue";if(t.output.push(a),!a.uuid&&!a.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<i.length;r++)n(r);return null}function NI(t){for(var e=t.output=t.input,i=0;i<e.length;i++){var r=e[i];if(!r.url){var a,o,s=r.config;o=r.isNative?s&&s.nativeBase?s.base+s.nativeBase:n.assetManager.generalNativeBase:s&&s.importBase?s.base+s.importBase:n.assetManager.generalImportBase;var l=r.uuid,c="";r.info&&(c=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),a=".ttf"===r.ext?o+"/"+l.slice(0,2)+"/"+l+c+"/"+r.options.__nativeName__:o+"/"+l.slice(0,2)+"/"+l+c+r.ext,r.url=a}}return null}var LI=t("AssetManager",function(){function t(){this.pipeline=qu.append(OI).append(wI),this.fetchPipeline=Xu.append(OI).append(SI),this.transformPipeline=Yu.append(DI).append(NI),this.bundles=ju,this.assets=Hu,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=nd,this.force=!1,this.allowImageBitmap=!yv.isMobile,this.utils=c_,this.downloader=_I,this.parser=CI,this.packManager=TI,this.cacheAsset=!0,this.cacheManager=null,this.presets=Zu,this.factory=yI,this.preprocessPipe=OI,this.fetchPipe=SI,this.loadPipe=wI,this.references=null,this._releaseManager=HR,this._files=Vu,this._parsed=Wu,this._parsePipeline=null}var e=t.prototype;return e.init=function(t){void 0===t&&(t={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.server,t.bundleVers,t.remoteBundles),this.parser.init(),this.dependUtil.init();var e=t.importBase||"";e&&e.endsWith("/")&&(e=e.substr(0,e.length-1));var i=t.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=e,this.generalNativeBase=i},e.getBundle=function(t){return ju.get(t)||null},e.removeBundle=function(t){t._destroy(),ju.remove(t.name)},e.loadAny=function(t,e,i,n){var r=ZR(e,i,n),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"default",t=Array.isArray(t)?t.slice():t;var l=Qu.create({input:t,onProgress:o,onComplete:JR(s),options:a});qu.async(l)},e.preloadAny=function(t,e,i,n){var r=ZR(e,i,n),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"preload",t=Array.isArray(t)?t.slice():t;var l=Qu.create({input:t,onProgress:o,onComplete:JR(s),options:a});Xu.async(l)},e.postLoadNative=function(t,e,i){var n=ZR(e,void 0,i),r=n.options,a=n.onComplete;if(t._native&&t.__nativeDepend__){var o=nd.getNativeDep(t._uuid);if(o){if(!ju.has(o.bundle)){var s=ju.find((function(e){return!!e.getAssetInfo(t._uuid)}));s&&(o.bundle=s.name)}this.loadAny(o,r,(function(e,i){e?d(e.message,e.stack):t.isValid&&t.__nativeDepend__&&(t._nativeAsset=i,t.__nativeDepend__=!1),a&&a(e)}))}}else JR(a)(null)},e.loadRemote=function(t,e,i){var n=ZR(e,void 0,i),r=n.options,a=n.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(e,i){e?(d(e.message,e.stack),a&&a(e,i)):yI.create(t,i,r.ext||B(t),r,(function(t,e){a&&a(t,e)}))}))):JR(a)(null,this.assets.get(t))},e.loadBundle=function(t,e,i){var n=ZR(e,void 0,i),r=n.options,a=n.onComplete,o=z(t);this.bundles.has(o)?JR(a)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(e,i){e?(d(e.message,e.stack),a&&a(e,i)):yI.create(t,i,"bundle",r,(function(t,e){a&&a(t,e)}))})))},e.releaseAsset=function(t){HR.tryRelease(t,!0)},e.releaseUnusedAssets=function(){Hu.forEach((function(t){HR.tryRelease(t)}))},e.releaseAll=function(){Hu.forEach((function(t){HR.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},q(t,[{key:"main",get:function(){return ju.get(Ku.MAIN)||null}},{key:"resources",get:function(){return ju.get(Ku.RESOURCES)||null}}]),t}());LI.Pipeline=ku,LI.Task=Qu,LI.Cache=Uu,LI.RequestItem=PI,LI.Bundle=$R,LI.BuiltinBundleName=Ku;var BI=t("assetManager",n.assetManager=new LI);n.AssetManager=LI;var FI=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],zI=[".mp3",".ogg",".wav",".m4a"];function UI(){return!0}var kI={transformURL:function(t){var e=r_(t);if(!e)return t;var i=ju.find((function(t){return!!t.getAssetInfo(e)}));if(!i)return t;var n,r=i.getAssetInfo(e);if(!(n=t.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==t.indexOf(n))return t;var a=!1;if(".ttf"===B(t)&&(a=!0),a){var o=U(t),s=z(t);t=o+"."+n+"/"+s}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(t){return t+"."+n}));return t}},GI=t("CCLoader",function(){function t(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=QR}var e=t.prototype;return e.load=function(t,e,i){void 0===i&&void 0!==e&&(i=e,e=null);for(var n=Array.isArray(t)?t:[t],r=0;r<n.length;r++){var a=n[r];"string"==typeof a?n[r]={url:a,__isNative__:!0}:(a.type&&(a.ext="."+a.type,a.type=void 0),a.url&&(a.__isNative__=!0))}var o=[],s=[];BI.loadAny(n,null,(function(t,i,n){n.content&&(FI.includes(n.ext)?o.push(n.content):zI.includes(n.ext)&&s.push(n.content)),e&&e(t,i,n)}),(function(t,e){var r=null;if(!t){e=Array.isArray(e)?e:[e];for(var a=function(t){var i=e[t];if(!(i instanceof M_)){var r=i,a=n[t].url;o.includes(r)?yI.create(a,i,".png",{},(function(i,n){r=e[t]=n})):s.includes(r)&&yI.create(a,i,".mp3",{},(function(i,n){r=e[t]=n})),Hu.add(a,r)}},l=0;l<e.length;l++)a(l);if(e.length>1){var c=Object.create(null);e.forEach((function(t){c[t._uuid]=t})),r={isCompleted:UI,_map:c}}else r=e[0]}i&&i(t,r)}))},e.getXMLHttpRequest=function(){return new XMLHttpRequest},e.getItem=function(t){return BI.assets.has(t)?{content:BI.assets.get(t)}:null},e.loadRes=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n),a=r.type,o=r.onProgress,s=r.onComplete,l=B(t);l&&!tI.getInfoWithPath(t,a)&&(t=t.slice(0,-l.length)),tI.load(t,a,o,s)},e.loadResArray=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n),a=r.type,o=r.onProgress,s=r.onComplete;t.forEach((function(e,i){var n=B(e);n&&!tI.getInfoWithPath(e,a)&&(t[i]=e.slice(0,-n.length))})),tI.load(t,a,o,s)},e.loadResDir=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n),a=r.type,o=r.onProgress,s=r.onComplete;tI.loadDir(t,a,o,(function(e,i){var n=[];e||(n=tI.getDirWithPath(t,a).map((function(t){return t.path}))),s&&s(e,i,n)}))},e.getRes=function(t,e){return Hu.has(t)?Hu.get(t):tI.get(t,e)},e.getResCount=function(){return Hu.count},e.getDependsRecursively=function(t){if(!t)return[];var e="string"==typeof t?t:t._uuid;return nd.getDepsRecursively(e).concat([e])},e.addDownloadHandlers=function(t){var e=Object.create(null),i=function(i){var n=t[i];e["."+i]=function(t,e,i){n({url:t},i)}};for(var n in t)i(n);_I.register(e)},e.addLoadHandlers=function(t){var e=Object.create(null),i=function(i){var n=t[i];e["."+i]=function(t,e,i){n({content:t},i)}};for(var n in t)i(n);CI.register(e)},e.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];"string"==typeof i&&(i=Hu.get(i)),BI.releaseAsset(i)}else t&&("string"==typeof t&&(t=Hu.get(t)),BI.releaseAsset(t))},e.releaseAsset=function(t){BI.releaseAsset(t)},e.releaseRes=function(t,e){tI.release(t,e)},e.releaseAll=function(){BI.releaseAll(),Hu.clear()},e.removeItem=function(t){return!!Hu.remove(t)},e.setAutoRelease=function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},e.setAutoReleaseRecursively=function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var i=nd.getDepsRecursively(t),n=0;n<i.length;n++)this._autoReleaseSetting[i[n]]=e},e.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},q(t,[{key:"onProgress",set:function(t){VR=t}},{key:"_cache",get:function(){return Hu._map}},{key:"md5Pipe",get:function(){return kI}},{key:"downloader",get:function(){return _I}},{key:"loader",get:function(){return BI.parser}}]),t}()),HI=t("loader",new GI),VI=t("AssetLibrary",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,BI.init(t),t.rawAssets&&tI.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Ku.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets)})},loadAsset:function(t,e){BI.loadAny(t,e)}}),WI=t("url",{});lt(WI,"url",[{name:"normalize",target:BI.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?l_({path:k(t.substr(10)),bundle:Ku.RESOURCES,__isNative__:!0,ext:B(t)}):""}}]),ct(VI,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),ct(HI,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),lt(n,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return HI}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return VI}},{name:"Pipeline",target:LI,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return WI}}]),ct(n,"cc",[{name:"LoadingItems",suggest:R(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),lt(pe,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:_I,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),lt(BR,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var e;return BI.main?null===(e=BI.main.getSceneInfo(t))||void 0===e?void 0:e.uuid:""}}]),lt(ub,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return BI.main&&BI.main.config.scenes.forEach((function(e){t.push(e)})),t}}]);var jI,qI,XI,YI,KI,ZI,QI,JI,$I,tO,eO,iO,nO,rO,aO=HR._autoRelease;HR._autoRelease=function(t,e,i){aO.call(HR,t,e,i);for(var n=HI._autoReleaseSetting,r=Object.keys(n),a=0;a<r.length;a++){var o=r[a];if(!0===n[o]){var s=Hu.get(o);s&&HR.tryRelease(s)}}};var oO,sO,lO,cO,hO,uO,_O,fO,dO,pO,mO,vO,gO,yO,TO,SO,EO,AO,bO,xO,CO,wO,RO,IO,OO,PO,MO,DO,NO,LO,BO,FO,zO,UO,kO,GO,HO,VO,WO,jO,qO,XO,YO,KO,ZO,QO,JO,$O,tP,eP,iP,nP,rP,aP,oP,sP,lP,cP,hP,uP,_P,fP,dP,pP,mP,vP,gP,yP=t("EventHandler",(jI=ru("cc.ClickEvent"),qI=Fu(n.Node),XI=Eu(),YI=Eu(),KI=Eu(),ZI=Eu(),jI((rO=function(){function t(){J(this,"target",$I,this),J(this,"component",tO,this),J(this,"_componentId",eO,this),J(this,"handler",iO,this),J(this,"customEventData",nO,this)}t.emitEvents=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var a=0,o=e.length;a<o;a++){var s=e[a];s instanceof t&&s.emit(n)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(n.isValid(e)){this._genCompIdIfNeeded();var i=n.js._getClassById(this._componentId),r=e.getComponent(i);if(n.isValid(r)){var a=r[this.handler];"function"==typeof a&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),a.apply(r,t))}}},e._compName2Id=function(t){var e=n.js.getClassByName(t);return n.js._getClassId(e)},e._compId2Name=function(t){var e=n.js._getClassById(t);return n.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},q(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),$I=$((JI=rO).prototype,"target",[cu,qI,XI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tO=$(JI.prototype,"component",[cu,yu,YI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eO=$(JI.prototype,"_componentId",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iO=$(JI.prototype,"handler",[cu,yu,KI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nO=$(JI.prototype,"customEventData",[cu,yu,ZI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),QI=JI))||QI));n.Component.EventHandler=yP;var TP,SP,EP,AP,bP,xP,CP,wP,RP,IP,OP,PP=new Ri,MP=he(Mh),DP=he(Ph),NP=he(Dh),LP=he(Lh),BP=he(Nh),FP=he({SKYBOX:Xh|vo.DEPTH_STENCIL,SOLID_COLOR:vo.ALL,DEPTH_ONLY:vo.DEPTH_STENCIL,DONT_CLEAR:vo.NONE}),zP=(oO=ru("cc.Camera"),sO=gu(),lO=du(),cO=Ru(),hO=Eu(),uO=Fu(Fc.BitMask),_O=Ru(),fO=Eu(),dO=Fu(FP),pO=Ru(),mO=Eu(),vO=Ru(),gO=Eu(),yO=Ru(),TO=Eu(),SO=Ru(),EO=Eu(),AO=Fu(MP),bO=Ru(),xO=Eu(),CO=Fu(DP),wO=Ru(),RO=Eu(),IO=Ru(),OO=Eu(),PO=Ru(),MO=Eu(),DO=Ru(),NO=Eu(),LO=Ru(),BO=Eu(),FO=Fu(NP),zO=Ru(),UO=Eu(),kO=Fu(LP),GO=Ru(),HO=Eu(),VO=Fu(BP),WO=Ru(),jO=Eu(),qO=Ru(),XO=Eu(),YO=Fu(im),KO=Ru(),ZO=Eu(),TP=oO(QO=sO(QO=lO(QO=fu((gP=vP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_projection",$O,K(e)),J(e,"_priority",tP,K(e)),J(e,"_fov",eP,K(e)),J(e,"_fovAxis",iP,K(e)),J(e,"_orthoHeight",nP,K(e)),J(e,"_near",rP,K(e)),J(e,"_far",aP,K(e)),J(e,"_color",oP,K(e)),J(e,"_depth",sP,K(e)),J(e,"_stencil",lP,K(e)),J(e,"_clearFlags",cP,K(e)),J(e,"_rect",hP,K(e)),J(e,"_aperture",uP,K(e)),J(e,"_shutter",_P,K(e)),J(e,"_iso",fP,K(e)),J(e,"_screenScale",dP,K(e)),J(e,"_visibility",pP,K(e)),J(e,"_targetTexture",mP,K(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e}Y(e,t);var i=e.prototype;return i.onLoad=function(){this._createCamera()},i.onEnable=function(){this.node.hasChangedFlags|=kh.POSITION,this._camera&&this._attachToScene()},i.onDisable=function(){this._camera&&this._detachFromScene()},i.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},i.screenPointToRay=function(t,e,i){return i||(i=Ra.create()),this._camera&&this._camera.screenPointToRay(i,t,e),i},i.worldToScreen=function(t,e){return e||(e=new Ri),this._camera&&this._camera.worldToScreen(e,t),e},i.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},i.convertToUINode=function(t,e,i){if(i||(i=new Ri),!this._camera)return i;this.worldToScreen(t,PP);var r=e.getComponent("cc.UITransform"),a=gb.getVisibleSize(),o=PP.x-.5*this._camera.width,s=PP.y-.5*this._camera.height;return PP.x=o/n.view.getScaleX()+.5*a.width,PP.y=s/n.view.getScaleY()+.5*a.height,r&&r.convertToNodeSpaceAR(PP,i),i},i._createCamera=function(){this._camera||(this._camera=n.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?n.director.root&&n.director.root.mainWindow:n.director.root&&n.director.root.tempWindow,priority:this._priority}),this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=_i(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},i._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},i._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},i._chechTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},i._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},q(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===Ph.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=_i(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&(this._camera.viewport=t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var e=this._targetTexture;this._targetTexture=t,this._chechTargetTextureEvent(e),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?n.director.root&&n.director.root.mainWindow:n.director.root&&n.director.root.tempWindow)}}]),e}(Jf),vP.ProjectionType=MP,vP.FOVAxis=DP,vP.ClearFlag=FP,vP.Aperture=NP,vP.Shutter=LP,vP.ISO=BP,$O=$((JO=gP).prototype,"_projection",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MP.PERSPECTIVE}}),tP=$(JO.prototype,"_priority",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eP=$(JO.prototype,"_fov",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),iP=$(JO.prototype,"_fovAxis",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DP.VERTICAL}}),nP=$(JO.prototype,"_orthoHeight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),rP=$(JO.prototype,"_near",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),aP=$(JO.prototype,"_far",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),oP=$(JO.prototype,"_color",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci("#333333")}}),sP=$(JO.prototype,"_depth",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),lP=$(JO.prototype,"_stencil",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cP=$(JO.prototype,"_clearFlags",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FP.SOLID_COLOR}}),hP=$(JO.prototype,"_rect",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new nn(0,0,1,1)}}),uP=$(JO.prototype,"_aperture",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NP.F16_0}}),_P=$(JO.prototype,"_shutter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return LP.D125}}),fP=$(JO.prototype,"_iso",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return BP.ISO100}}),dP=$(JO.prototype,"_screenScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),pP=$(JO.prototype,"_visibility",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bh}}),mP=$(JO.prototype,"_targetTexture",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(JO.prototype,"priority",[cO,hO],Object.getOwnPropertyDescriptor(JO.prototype,"priority"),JO.prototype),$(JO.prototype,"visibility",[uO,_O,fO],Object.getOwnPropertyDescriptor(JO.prototype,"visibility"),JO.prototype),$(JO.prototype,"clearFlags",[dO,pO,mO],Object.getOwnPropertyDescriptor(JO.prototype,"clearFlags"),JO.prototype),$(JO.prototype,"clearColor",[vO,gO],Object.getOwnPropertyDescriptor(JO.prototype,"clearColor"),JO.prototype),$(JO.prototype,"clearDepth",[yO,TO],Object.getOwnPropertyDescriptor(JO.prototype,"clearDepth"),JO.prototype),$(JO.prototype,"clearStencil",[SO,EO],Object.getOwnPropertyDescriptor(JO.prototype,"clearStencil"),JO.prototype),$(JO.prototype,"projection",[AO,bO,xO],Object.getOwnPropertyDescriptor(JO.prototype,"projection"),JO.prototype),$(JO.prototype,"fovAxis",[CO,wO,RO],Object.getOwnPropertyDescriptor(JO.prototype,"fovAxis"),JO.prototype),$(JO.prototype,"fov",[IO,OO],Object.getOwnPropertyDescriptor(JO.prototype,"fov"),JO.prototype),$(JO.prototype,"orthoHeight",[PO,MO],Object.getOwnPropertyDescriptor(JO.prototype,"orthoHeight"),JO.prototype),$(JO.prototype,"near",[DO,NO],Object.getOwnPropertyDescriptor(JO.prototype,"near"),JO.prototype),$(JO.prototype,"far",[LO,BO],Object.getOwnPropertyDescriptor(JO.prototype,"far"),JO.prototype),$(JO.prototype,"aperture",[FO,zO,UO],Object.getOwnPropertyDescriptor(JO.prototype,"aperture"),JO.prototype),$(JO.prototype,"shutter",[kO,GO,HO],Object.getOwnPropertyDescriptor(JO.prototype,"shutter"),JO.prototype),$(JO.prototype,"iso",[VO,WO,jO],Object.getOwnPropertyDescriptor(JO.prototype,"iso"),JO.prototype),$(JO.prototype,"rect",[qO,XO],Object.getOwnPropertyDescriptor(JO.prototype,"rect"),JO.prototype),$(JO.prototype,"targetTexture",[YO,KO,ZO],Object.getOwnPropertyDescriptor(JO.prototype,"targetTexture"),JO.prototype),QO=JO))||QO)||QO)||QO)||QO,t({Camera:TP,CameraComponent:TP}),TP);n.Camera=zP;var UP,kP,GP,HP,VP,WP,jP,qP,XP={parent:null,owner:null,subModelIdx:0},YP=t("RenderableComponent",(SP=ru("cc.RenderableComponent"),EP=Fu([nm]),AP=Fu(nm),bP=Ru(),xP=Su(),SP((OP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_materials",RP,K(e)),J(e,"_visFlags",IP,K(e)),e._materialInstances=[],e._models=[],e}Y(e,t);var i=e.prototype;return i.getMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},i.setMaterial=function(t,e){t&&t instanceof cm&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[e]=t;var i=this._materialInstances[e];i?i.parent!==this._materials[e]&&(i.destroy(),this._materialInstances[e]=null,this._onMaterialModified(e,this._materials[e])):this._onMaterialModified(e,this._materials[e])},i.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){XP.parent=this._materials[t],XP.owner=this,XP.subModelIdx=t;var e=new cm(XP);this.setMaterialInstance(t,e)}return this._materialInstances[t]},i.setMaterialInstance=function(t,e){e&&e.parent?e!==this._materialInstances[t]&&(this._materialInstances[t]=e,this._onMaterialModified(t,e)):e!==this._materials[t]&&this.setMaterial(e,t)},i.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},i._collectModels=function(){return this._models},i._attachToScene=function(){},i._detachFromScene=function(){},i._onMaterialModified=function(){},i._onRebuildPSO=function(){},i._clearMaterials=function(){},i._onVisibilityChange=function(){},q(e,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){var e=t.length-this._materials.length;if(e>0)this._materials.length=t.length,this._materialInstances.length=t.length;else if(e<0)for(var i=this._materials.length-e;i<this._materials.length;++i)this.setMaterialInstance(i,null);for(var n=0;n<this._materialInstances.length;n++)this._materialInstances[n]!=t[n]&&this.setMaterialInstance(n,t[n])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){1===this._materials.length&&this._materials[0]===t||this.setMaterialInstance(0,t)}}]),e}(Jf),RP=$((wP=OP).prototype,"_materials",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IP=$(wP.prototype,"_visFlags",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fc.Enum.NONE}}),$(wP.prototype,"sharedMaterials",[AP,bP,xP],Object.getOwnPropertyDescriptor(wP.prototype,"sharedMaterials"),wP.prototype),CP=wP))||CP));function KP(t){return"string"==typeof t||"number"==typeof t}function ZP(t,e){return t instanceof e}n.RenderableComponent=YP,lt(zP,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),lt(zP.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),n.CameraComponent=zP,le.setClassAlias(zP,"cc.CameraComponent");var QP,JP,$P,tM,eM,iM,nM=ru("cc.animation.HierarchyPath")((HP=function(){function t(t){J(this,"path",GP,this),this.path=t||""}return t.prototype.get=function(t){return t instanceof wA?t.getChildByPath(this.path)||(f('Node "'+t.name+'" has no path "'+this.path+'"'),null):(f("Target of hierarchy path should be of type Node."),null)},t}(),GP=$((kP=HP).prototype,"path",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),UP=kP))||UP,rM=ru("cc.animation.ComponentPath")((qP=function(){function t(t){J(this,"component",jP,this),this.component=t||""}return t.prototype.get=function(t){return t instanceof wA?t.getComponent(this.component)||(f('Node "'+t.name+'" has no component "'+this.component+'"'),null):(f("Target of component path should be of type Node."),null)},t}(),jP=$((WP=qP).prototype,"component",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),VP=WP))||VP;function aM(t){for(var e=t,i=0;i<(arguments.length<=1?0:arguments.length-1);++i){var n=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];if(KP(n)){if(!(n in e))return f('Target object has no property "'+n+'"'),null;e=e[n]}else e=n.get(e);if(null===e)break}return e}var oM,sM,lM,cM,hM,uM,_M,fM,dM,pM,mM,vM=ru("cc.animation.UniformProxyFactory")((iM=function(){function t(t,e){J(this,"passIndex",$P,this),J(this,"uniformName",tM,this),J(this,"channelIndex",eM,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],i=e.getHandle(this.uniformName);if(!i)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');var r=ep.getPropertyTypeFromHandle(i);if(r===bd.UBO){var a=void 0===this.channelIndex?i:e.getHandle(this.uniformName,this.channelIndex,Ua.FLOAT);if(!a)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var i,n=Q(t.shaderInfo.blocks);!(i=n()).done;)for(var r,a=Q(i.value.members);!(r=a()).done;){var o=r.value;if(o.name===e)return o.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(a,t)}}:{set:function(t){e.setUniform(a,t)}}}if(r===bd.SAMPLER){var o=ep.getBindingFromHandle(i),s=e.properties[this.uniformName],l=s&&s.value?s.value+"-texture":Ld(s.type),c=Zd.get(l);return c||(f("Illegal texture default value: "+l+"."),c=Zd.get("default-texture")),{set:function(t){t||(t=c);var i=t.getGFXTexture();i&&i.width&&i.height&&(e.bindTexture(o,i),t instanceof hf&&e.bindSampler(o,lf.getSampler(n.game._gfxDevice,t.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+r+".")},t}(),$P=$((JP=iM).prototype,"passIndex",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tM=$(JP.prototype,"uniformName",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eM=$(JP.prototype,"channelIndex",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),QP=JP))||QP,gM=ru("cc.animation.MorphWeightsValueProxy")((cM=function(){function t(){J(this,"subMeshIndex",lM,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(i){t.setWeights(i,e.subMeshIndex)}}},t}(),lM=$((sM=cM).prototype,"subMeshIndex",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oM=sM))||oM,yM=ru("cc.animation.MorphWeightsAllValueProxy")(hM=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var i,n,r=null!==(i=null===(n=t.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,a=0;a<r;++a)t.setWeights(e,a)}}},t}())||hM;function TM(t,e,i,n){var r,a,o,s,l,c,h=new e,u=new e,_=new e,f=ru(t)((c=function(){function t(t,i,n){J(this,"dataPoint",o,this),J(this,"inTangent",s,this),J(this,"outTangent",l,this),this.dataPoint=t||new e,this.inTangent=i||new e,this.outTangent=n||new e}var r=t.prototype;return r.lerp=function(t,e,r){var a=this.dataPoint,o=t.dataPoint;u=i(u,this.inTangent,r),_=i(_,t.outTangent,r);var s=e*e*e,l=e*e,c=s-2*l+e,f=-2*s+3*l,d=s-l;return h=i(h,a,2*s-3*l+1),h=n(h,h,u,c),h=n(h,h,o,f),h=n(h,h,_,d)},r.getNoLerp=function(){return this.dataPoint},t}(),o=$((a=c).prototype,"dataPoint",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),s=$(a.prototype,"inTangent",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),l=$(a.prototype,"outTangent",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),r=a))||r;if(e===Li){var d=f.prototype.lerp;f.prototype.lerp=function(t,e,i){var n=d.call(this,t,e,i);return Li.normalize(n,n),n}}return f}var SM=t("CubicSplineVec2Value",TM("cc.CubicSplineVec2Value",Xi,Xi.multiplyScalar,Xi.scaleAndAdd));n.CubicSplineVec2Value=SM;var EM=t("CubicSplineVec3Value",TM("cc.CubicSplineVec3Value",Ri,Ri.multiplyScalar,Ri.scaleAndAdd));n.CubicSplineVec3Value=EM;var AM=t("CubicSplineVec4Value",TM("cc.CubicSplineVec4Value",Qi,Qi.multiplyScalar,Qi.scaleAndAdd));n.CubicSplineVec4Value=AM;var bM=t("CubicSplineQuatValue",TM("cc.CubicSplineQuatValue",Li,Li.multiplyScalar,Li.scaleAndAdd));n.CubicSplineQuatValue=bM;var xM=t("CubicSplineNumberValue",ru("cc.CubicSplineNumberValue")((mM=function(){function t(t,e,i){J(this,"dataPoint",fM,this),J(this,"inTangent",dM,this),J(this,"outTangent",pM,this),this.dataPoint=t,this.inTangent=e,this.outTangent=i}var e=t.prototype;return e.lerp=function(t,e,i){var n=this.dataPoint,r=t.dataPoint,a=e*e*e,o=e*e;return n*(2*a-3*o+1)+this.outTangent*i*(a-2*o+e)+r*(-2*a+3*o)+t.inTangent*i*(a-o)},e.getNoLerp=function(){return this.dataPoint},t}(),fM=$((_M=mM).prototype,"dataPoint",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dM=$(_M.prototype,"inTangent",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pM=$(_M.prototype,"outTangent",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uM=_M))||uM);function CM(t,e,i){void 0===i&&(i=1e-6);for(var n=0,r=t.length-1,a=r>>>1;n<=r;a=n+r>>>1){var o=t[a];if(o>e+i)r=a-1;else{if(!(o<e-i))return a;n=a+1}}return~n}function wM(t,e,i,n,r){var a=1-r;return a*(a*(t+(3*e-t)*r)+3*i*r*r)+n*r*r*r}n.CubicSplineNumberValue=xM,t("animation",Object.freeze({__proto__:null,UniformProxyFactory:vM,MorphWeightsValueProxy:gM,MorphWeightsAllValueProxy:yM,isPropertyPath:KP,isCustomPath:ZP,HierarchyPath:nM,ComponentPath:rM,evaluatePath:aM,CubicSplineVec2Value:SM,CubicSplineVec3Value:EM,CubicSplineVec4Value:AM,CubicSplineQuatValue:bM,CubicSplineNumberValue:xM})),n.bezier=wM;var RM=Math.cos,IM=Math.acos,OM=Math.max,PM=2*Math.PI,MM=Math.sqrt;function DM(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function NM(t,e){var i=function(t,e){var i,n,r,a,o=e-0,s=e-t[0],l=3*o,c=3*s,h=3*(e-t[2]),u=1/(-o+c-h+(e-1)),_=(l-6*s+h)*u,f=_*(1/3),d=(-l+c)*u,p=1/3*(3*d-_*_),m=p*(1/3),v=(2*_*_*_-9*_*d+o*u*27)/27,g=v/2,y=g*g+m*m*m;if(y<0){var T=1/3*-p,S=MM(T*T*T),E=-v/(2*S),A=IM(E<-1?-1:E>1?1:E),b=2*DM(S);return n=b*RM(A*(1/3))-f,r=b*RM((A+PM)*(1/3))-f,a=b*RM((A+2*PM)*(1/3))-f,n>=0&&n<=1?r>=0&&r<=1?a>=0&&a<=1?OM(n,r,a):OM(n,r):a>=0&&a<=1?OM(n,a):n:r>=0&&r<=1?a>=0&&a<=1?OM(r,a):r:a}if(0===y)return r=-(i=g<0?DM(-g):-DM(g))-f,(n=2*i-f)>=0&&n<=1?r>=0&&r<=1?OM(n,r):n:r;var x=MM(y);return(i=DM(-g+x))-DM(g+x)-f}(t,e),n=t[1];return((1-i)*(n+(t[3]-n)*i)*3+i*i)*i}n.bezierByTime=NM;var LM=t("RatioSampler",function(){function t(t){var e,i;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;for(var n=!0,r=1,a=t.length;r<a;r++)if(e=t[r]-t[r-1],1===r)i=e;else if(Math.abs(e-i)>1e-6){n=!1;break}this._findRatio=n?UM:CM}return t.prototype.sample=function(t){return this._findRatio(this.ratios,t)},t}());n.RatioSampler=LM;var BM=t("AnimCurve",function(){function t(e,i){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=i,this._values=e.values;var n=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=n(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(n);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,a=Object.keys(e.easingMethods);r<a.length;r++){var o=a[r];this.types[o]=n(e.easingMethods[o])}}else this.type=null;var s=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=tD(s)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}t.Bezier=function(t){return t};var e=t.prototype;return e.hasLerp=function(){return!!this._lerp},e.valueAt=function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var i=0;i<this._array.length;++i)this._array[i]=this._values[this._array.length*t+i];return this._array},e.valueBetween=function(t,e,i,n,r){if(this._lerp){var a=this.types?this.types[e]:this.type,o=r-i,s=(t-i)/o;if(a&&(s=zM(s,a)),void 0===this._array){var l=this._values[e],c=this._values[n];return this._lerp(l,c,s,o*this._duration)}for(var h=0;h<this._array.length;++h){var u=this._values[this._array.length*e+h],_=this._values[this._array.length*n+h];this._array[h]=this._lerp(u,_,s,o*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*e+f];return this._array},e.empty=function(){return 0===this._values.length},e.constant=function(){return 1===this._values.length},t}());function FM(t,e,i){var n=e.sample(i);if(n<0)if((n=~n)<=0)n=0;else{if(!(n>=e.ratios.length))return t.valueBetween(i,n-1,e.ratios[n-1],n,e.ratios[n]);n=e.ratios.length-1}return t.valueAt(n)}function zM(t,e){if("string"==typeof e){var i=sv[e];i?t=i(t):b(3906,e)}else Array.isArray(e)&&(t=NM(e,t));return t}function UM(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];if(e>r)return i;var a=(e=(e-n)/(r-n))/(1/i),o=0|a;return a-o<1e-6?o:o+1-a<1e-6?o+1:~(o+1)}BM.Linear=null,n.AnimCurve=BM,t("EventInfo",function(){function t(){this.events=[]}return t.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},t}()),n.sampleAnimationCurve=FM;var kM,GM,HM,VM,WM,jM,qM,XM,YM,KM,ZM,QM,JM,$M,tD=function(){function t(t,e,i,n){return t.lerp(e,i,n)}return function(e){if(null!==e){if("number"==typeof e)return ui;if("object"==typeof e&&e.constructor){if(e instanceof Li)return i=new Li,function(t,e,n){return Li.slerp(i,t,e,n)};if(e instanceof de)return function(t){var e=new t;return function(i,n,r){return t.lerp(e,i,n,r),e}}(e.constructor);if(e.constructor===Number)return ui;if("function"==typeof e.lerp)return t}var i}}}(),eD=function(){function t(){}return t.getOrExtract=function(e){var i=t.pool.get(e);return i&&i.info.sample===e.sample||(i&&n.director.root.dataPoolManager.releaseAnimationClip(e),i=function(t){var e={};t.curves.forEach((function(t){if(!t.valueAdapter&&ZP(t.modifiers[0],nM)&&KP(t.modifiers[1])){var i=t.modifiers[0].path,n=e[i];n||(n=e[i]={}),n[t.modifiers[1]]={values:t.data.values,keys:t.data.keys}}}));for(var i=Math.ceil(t.sample*t.duration)+1,n=function(){var n=a[r],o=e[n];if(!o)return"continue";Object.defineProperty(o,"worldMatrix",{get:function(){if(!o._worldMatrix){var r=o.position,a=o.rotation,s=o.scale;iD(t,r,i),iD(t,a,i),iD(t,s,i),function(t,e,i){var n=i.position.values,r=i.rotation.values,a=i.scale.values,o=n.map((function(){return new Vi})),s=e.lastIndexOf("/"),l=null;if(s>0){var c=t[e.substring(0,s)];if(!c)return void console.warn("no data for parent bone?");l=c.worldMatrix.values}for(var h=0;h<n.length;h++){var u=n[h],_=r[h],f=a[h],d=o[h];Vi.fromRTS(d,_,u,f),l&&Vi.multiply(d,l[h],d)}Object.keys(i).forEach((function(t){return delete i[t]})),i._worldMatrix={keys:0,interpolate:!1,values:o}}(e,n,o)}return o._worldMatrix}})},r=0,a=Object.keys(e);r<a.length;r++)n();return{info:{frames:i,sample:t.sample},data:e}}(e),t.pool.set(e,i)),i},t.destroy=function(e){t.pool.delete(e)},t}();function iD(t,e,i){var n=t.keys[e.keys],r=[];if(n&&1!==n.length)for(var a=e.values[0]instanceof Li,o=0,s=0;o<i;o++){for(var l=o/t.sample;n[s]<=l;)s++;s>n.length-1?l=n[s=n.length-1]:0===s&&(s=1);var c=e.values[s-1].clone(),h=n[s]-n[s-1],u=h?hi((l-n[s-1])/h):1;a?c.slerp(e.values[s],u):c.lerp(e.values[s],u),r[o]=c}else for(var _=0;_<i;_++)r[_]=e.values[0].clone();e.values=r}eD.pool=new Map;var nD=t("AnimationClip",ru("cc.AnimationClip")(($M=JM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"sample",HM,K(e)),J(e,"speed",VM,K(e)),J(e,"wrapMode",WM,K(e)),J(e,"events",jM,K(e)),J(e,"_duration",qM,K(e)),J(e,"_keys",XM,K(e)),J(e,"_stepness",YM,K(e)),J(e,"_curves",KM,K(e)),J(e,"_commonTargets",ZM,K(e)),J(e,"_hash",QM,K(e)),e.frameRate=0,e._ratioSamplers=[],e._runtimeCurves=void 0,e._runtimeEvents=void 0,e._data=null,e}Y(e,t),e.createWithSpriteFrames=function(t,i){if(!Array.isArray(t))return b(3905),null;var n=new e;n.sample=i||n.sample,n.duration=t.length/n.sample;for(var r=1/n.sample,a=new Array(t.length),o=new Array(a.length),s=0;s<t.length;s++)a[s]=s*r,o[s]=t[s];return n.keys=[a],n.curves=[{modifiers:[new rM("cc.Sprite"),"spriteFrame"],data:{keys:0,values:o}}],n};var i=e.prototype;return i.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},i.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},i.updateEventDatas=function(){delete this._runtimeEvents},i.getEventGroupIndexAtRatio=function(t){return this._runtimeEvents||this._createRuntimeEvents(),CM(this._runtimeEvents.ratios,t)},i.hasEvents=function(){return 0!==this.events.length},i.destroy=function(){return n.director.root.dataPoolManager&&n.director.root.dataPoolManager.releaseAnimationClip(this),eD.destroy(this),t.prototype.destroy.call(this)},i._createPropertyCurves=function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new LM(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new BM(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}})),this._applyStepness()},i._createRuntimeEvents=function(){for(var t,e=this,i=[],n=[],r=function(){var r=t.value,a=r.frame/e._duration,o=i.findIndex((function(t){return t===a}));o<0&&(o=i.length,i.push(a),n.push({events:[]})),n[o].events.push({functionName:r.func,parameters:r.params})},a=Q(this.events.sort((function(t,e){return t.frame-e.frame})));!(t=a()).done;)r();this._runtimeEvents={ratios:i,eventGroups:n}},i._applyStepness=function(){},i._decodeCVTAs=function(){var t=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(t){for(var e=this._keys,i=0;i<e.length;++i){var n=e[i];n instanceof nx&&(e[i]=n.decompress(t))}for(var r=0;r<this._curves.length;++r){var a=this._curves[r];a.data.values instanceof nx&&(a.data.values=a.data.values.decompress(t))}}},q(e,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(t){this._stepness=t,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var t=this._nativeAsset,e=new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t);return this._hash=qo(e,666)}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}}]),e}(M_),JM.preventDeferredLoadDependents=!0,JM.WrapMode=pc,HM=$((GM=$M).prototype,"sample",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),VM=$(GM.prototype,"speed",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),WM=$(GM.prototype,"wrapMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pc.Normal}}),jM=$(GM.prototype,"events",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qM=$(GM.prototype,"_duration",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XM=$(GM.prototype,"_keys",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YM=$(GM.prototype,"_stepness",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KM=$(GM.prototype,"_curves",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZM=$(GM.prototype,"_commonTargets",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QM=$(GM.prototype,"_hash",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kM=GM))||kM);function rD(t,e,i){var n,r=e[e.length-1];if(0!==e.length&&KP(r)&&!i){var a=aM.apply(void 0,[t].concat(e.slice(0,e.length-1)));if(null===a)return null;n={isProxy:!1,object:a,property:r}}else{if(!i)return d("Empty animation curve."),null;var o=aM.apply(void 0,[t].concat(e));if(null===o)return null;n={isProxy:!0,proxy:i.forTarget(o)}}return{setValue:function(t){n.isProxy?n.proxy.set(t):n.object[n.property]=t},getValue:function(){return n.isProxy?n.proxy.get?n.proxy.get():(d("Target doesn't provide a get method."),null):n.object[n.property]}}}function aD(t,e,i){var n=rD(t,e,i);if(null===n)return null;var r=n.getValue(),a=sD(r);if(!a)return d("Value is not copyable!"),null;var o=a.createBuffer(),s=a.copy;return Object.assign(n,{peek:function(){return o},pull:function(){var t=n.getValue();s(o,t)},push:function(){n.setValue(o)}})}n.AnimationClip=nD;var oD,sD=((oD=new Map).set(Xi,{createBuffer:function(){return new Xi},copy:Xi.copy}),oD.set(Ri,{createBuffer:function(){return new Ri},copy:Ri.copy}),oD.set(Qi,{createBuffer:function(){return new Qi},copy:Qi.copy}),oD.set(Ci,{createBuffer:function(){return new Ci},copy:Ci.copy}),oD.set(tn,{createBuffer:function(){return new tn},copy:function(t,e){return t.set(e)}}),function(t){return oD.get(null==t?void 0:t.constructor)}),lD=function(){function t(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var e=t.prototype;return e.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(R(3912)):(this._isPlaying=!0,this.onPlay())},e.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},e.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},e.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},e.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.update=function(){},e.onPlay=function(){},e.onPause=function(){},e.onResume=function(){},e.onStop=function(){},e.onError=function(){},q(t,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),cD=function(){function t(){this._nodeBlendStates=new Map,this._states=new Set}var e=t.prototype;return e.ref=function(t,e){var i=this._nodeBlendStates.get(t);i||(i={dirty:!1,properties:{}},this._nodeBlendStates.set(t,i));var n=i.properties[e];return n||(n=i.properties[e]=new _D(i,hD(e)?new Ri:new Li)),++n.refCount,n},e.deRef=function(t,e){var i=this._nodeBlendStates.get(t);if(i){var n=i.properties[e];n&&(--n.refCount,n.refCount>0||(delete i.properties[e],function(t){return!(t.properties.position||t.properties.rotation||t.properties.eulerAngles||t.properties.scale)}(i)&&this._nodeBlendStates.delete(t)))}},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){if(t.dirty){t.dirty=!1;var i,n,r,a=t.properties,o=a.position,s=a.scale,l=a.rotation,c=a.eulerAngles,h=!1;o&&0!==o.weight&&(o.weight=0,i=o.value,h=!0),s&&0!==s.weight&&(s.weight=0,n=s.value,h=!0),l&&0!==l.weight&&(l.weight=0,r=l.value,h=!0),c&&0!==c.weight&&(c.weight=0,r=c.value,h=!0),h&&e.setRTS(r,i,n)}})),this._states.forEach((function(t){t.onBlendFinished()}))},e.bindState=function(t){this._states.add(t)},e.unbindState=function(t){this._states.delete(t)},t}();function hD(t){return!function(t){return"rotation"===t}(t)}var uD,_D=function(){function t(t,e){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=t,this.value=e}return t.prototype.markAsDirty=function(){this._node.dirty=!0},t}();function fD(t,e,i){return 0===i.weight&&Ri.zero(i.value),0===e?i.value:1===e?Ri.copy(i.value,t):Ri.scaleAndAdd(i.value,i.value,t,e)}function dD(t,e,i){if(0===i.weight&&Li.identity(i.value),0===e)return i.value;if(1===e)return Li.copy(i.value,t);var n=e/(i.weight+e);return Li.slerp(i.value,i.value,t,n)}!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(uD||(uD={})),fe(uD);var pD=function(){function t(t,e,i){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=t.curve,this._curveDetail=t,this._boundTarget=i}var e=t.prototype;return e.applySample=function(t,e,i,n,r){var a;this._curve.empty()||(a=this._curve.hasLerp()&&i?this._curve.valueBetween(t,n.from,n.fromRatio,n.to,n.toRatio):this._curve.valueAt(e),this._setValue(a,r))},e._setValue=function(t){this._boundTarget.setValue(t)},q(t,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),t}(),mD=t("AnimationState",function(t){function e(e,i){var n;return void 0===i&&(i=""),(n=t.call(this)||this).duration=1,n.speed=1,n.time=0,n.weight=0,n.frameRate=0,n._targetNode=null,n._curveLoaded=!1,n._clip=void 0,n._process=n.process,n._samplerSharedGroups=[],n._target=null,n._ignoreIndex=-1,n._commonTargetStatuses=[],n._wrapMode=pc.Normal,n._repeatCount=1,n._delay=0,n._delayTime=0,n._currentFramePlayed=!1,n._name=void 0,n._lastIterations=void 0,n._lastWrapInfo=null,n._lastWrapInfoEvent=null,n._wrappedInfo=new gc,n._blendStateBuffer=null,n._blendStateWriters=[],n._allowLastFrame=!1,n._blendStateWriterHost={weight:0,enabled:!1},n._clip=e,n._name=i||e&&e.name,n}Y(e,t),q(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){this._wrapMode=t,this.time=0,t&dc.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&dc.ShouldWrap,i=(this.wrapMode&dc.Reverse)===dc.Reverse;this._process=t!==1/0||e||i?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}}]);var i=e.prototype;return i.initialize=function(t,e){var i,r,a=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(i=null===(r=n.director.getAnimationManager())||void 0===r?void 0:r.blendState)&&void 0!==i?i:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=t;var o=this._clip;this.duration=o.duration,this.speed=o.speed,this.wrapMode=o.wrapMode,this.frameRate=o.sample,(this.wrapMode&dc.Loop)===dc.Loop?this.repeatCount=1/0:this.repeatCount=1;var s=function(t,e,i,n,r){if(!function(t){var e;if(1===t.length&&"string"==typeof t[0])e=t[0];else if(t.length>1){for(var i=0;i<t.length-1;++i)if(!(t[i]instanceof nM))return!1;e=t[t.length-1]}switch(e){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(i)||!a._blendStateBuffer)return t(e,i,n);var o=aM.apply(void 0,[e].concat(i.slice(0,i.length-1)));if(null!==o&&o instanceof wA){var s=i[i.length-1],l=function(t,e,i,n,r){var a=hD(i)?fD:dD,o=t.ref(e,i),s=!1,l=-1;return{destroy:function(){o&&(t.deRef(e,i),o=null)},forTarget:function(){return{get:function(){return e[i]},set:function(t){if(o&&n.enabled){var e=n.weight;if(r)if(1!==e||e!==l)s=!1;else if(s)return;a(t,e,o),o.weight+=e,o.markAsDirty(),s=!0,l=e}}}}}}(a._blendStateBuffer,o,s,a._blendStateWriterHost,r);return a._blendStateWriters.push(l),t(e,[],l)}return null};this._commonTargetStatuses=o.commonTargets.map((function(e){var i=s(aD,t,e.modifiers,e.valueAdapter,!1);return null===i?null:{target:i,changed:!1}})),e||(e=o.getPropertyCurves());for(var l=function(i){var n=e[i],r=a._samplerSharedGroups.find((function(t){return t.sampler===n.sampler}));r||(r={sampler:n.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},a._samplerSharedGroups.push(r));var o=void 0;if(void 0===n.commonTarget)o=t;else{var l=a._commonTargetStatuses[n.commonTarget];if(!l)return"continue";o=l.target.peek()}var c=s(rD,o,n.modifiers,n.valueAdapter,n.curve.constant());if(null===c);else{var h=new pD(n,o,c);h.commonTargetIndex=n.commonTarget,r.curves.push(h)}},c=0;c<e.length;++c)l(c)}},i.destroy=function(){this._destroyBlendStateWriters()},i.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},i.emit=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];n.director.getAnimationManager().pushDelayEvent(this._emit,this,e)},i.on=function(t,e,i){return this._target&&this._target.isValid?this._target.on(t,e,i):null},i.once=function(t,e,i){return this._target&&this._target.isValid?this._target.once(t,e,i):null},i.off=function(t,e,i){this._target&&this._target.isValid&&this._target.off(t,e,i)},i.allowLastFrameEvent=function(t){this._allowLastFrame=t},i._setEventTarget=function(t){this._target=t},i.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var e=this.getWrappedInfo(t,this._wrappedInfo),i=e.direction,n=this._clip.getEventGroupIndexAtRatio(e.ratio);n<0&&(n=~n-1,i<0&&(n+=1),this._ignoreIndex=n)},i.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},i.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.ratio),this._sampleEvents(t),t},i.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(uD.PLAY,this)},i.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(uD.STOP,this)},i.onResume=function(){this._onReplayOrResume(),this.emit(uD.RESUME,this)},i.onPause=function(){this._onPauseOrStop(),this.emit(uD.PAUSE,this)},i._sampleCurves=function(t){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var e=0;e<this._commonTargetStatuses.length;++e){var i=this._commonTargetStatuses[e];i&&(i.target.pull(),i.changed=!1)}for(var n=0,r=this._samplerSharedGroups.length;n<r;++n){var a=this._samplerSharedGroups[n],o=a.sampler,s=a.samplerResultCache,l=0,c=!1;o?(l=o.sample(t))<0&&((l=~l)<=0?l=0:l>=o.ratios.length?l=o.ratios.length-1:(c=!0,s.from=l-1,s.fromRatio=o.ratios[s.from],s.to=l,s.toRatio=o.ratios[s.to],l=s.from)):l=0;for(var h=0,u=a.curves.length;h<u;++h){var _=a.curves[h];if(_.applySample(t,l,c,s,this.weight),void 0!==_.commonTargetIndex){var f=this._commonTargetStatuses[_.commonTargetIndex];f&&(f.changed=!0)}}}for(var d=0;d<this._commonTargetStatuses.length;++d){var p=this._commonTargetStatuses[d];p&&p.changed&&p.target.push()}},i.process=function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new gc(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(uD.LASTFRAME,this),t.set(e)),e.stopped&&(this.stop(),this.emit(uD.FINISHED,this))},i.simpleProcess=function(){var t=this.duration,e=this.time%t;e<0&&(e+=t);var i=e/t;this._sampleCurves(i),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(uD.LASTFRAME,this),this._lastIterations=i)},i.cache=function(){},i._needReverse=function(t){var e=this.wrapMode,i=!1;return(e&dc.PingPong)===dc.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(i=!i)),(e&dc.Reverse)===dc.Reverse&&(i=!i),i},i.getWrappedInfo=function(t,e){e=e||new gc;var i=!1,n=this.duration,r=this.repeatCount,a=t>0?t/n:-t/n;if(a>=r){a=r,i=!0;var o=r-(0|r);0===o&&(o=1),t=o*n*(t>0?1:-1)}if(t>n){var s=t%n;t=0===s?n:s}else t<0&&0!=(t%=n)&&(t+=n);var l=!1,c=this._wrapMode&dc.ShouldWrap;c&&(l=this._needReverse(a));var h=l?-1:1;return this.speed<0&&(h*=-1),c&&l&&(t=n-t),e.ratio=t/n,e.time=t,e.direction=h,e.stopped=i,e.iterations=a,e},i._sampleEvents=function(t){var e=this._clip.eventGroups.length,i=t.direction,r=this._clip.getEventGroupIndexAtRatio(t.ratio);if(r<0&&(r=~r-1,i<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),t.frameIndex=r,!this._lastWrapInfoEvent)return this._fireEvent(r),void(this._lastWrapInfoEvent=new gc(t));var a=this.wrapMode,o=vD(t.iterations),s=this._lastWrapInfoEvent,l=vD(s.iterations),c=s.frameIndex,h=s.direction,u=-1!==l&&o!==l;if(c===r&&u&&1===e)this._fireEvent(0);else if(c!==r||u){i=h;do{if(c!==r){if(-1===i&&0===c&&r>0?((a&dc.PingPong)===dc.PingPong?i*=-1:c=e,l++):1===i&&c===e-1&&r<e-1&&((a&dc.PingPong)===dc.PingPong?i*=-1:c=-1,l++),c===r)break;if(l>o)break}c+=i,n.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[c])}while(c!==r&&c>-1&&c<e)}this._lastWrapInfoEvent.set(t)},i._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},i._fireEvent=function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._clip.eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var i,n=e[t],r=this._targetNode.components,a=Q(n.events);!(i=a()).done;)for(var o,s=i.value,l=s.functionName,c=Q(r);!(o=c()).done;){var h=o.value,u=h[l];"function"==typeof u&&u.apply(h,s.parameters)}}},i._onReplayOrResume=function(){n.director.getAnimationManager().addAnimation(this)},i._onPauseOrStop=function(){n.director.getAnimationManager().removeAnimation(this)},i._destroyBlendStateWriters=function(){for(var t=0;t<this._blendStateWriters.length;++t)this._blendStateWriters[t].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},q(e,[{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(lD));function vD(t){return t-(0|t)==0&&(t-=1),0|t}n.AnimationState=mD;var gD,yD,TD,SD,ED,AD,bD,xD,CD,wD,RD,ID,OD,PD,MD,DD,ND,LD=function(t){function e(){var e;return(e=t.call(this)||this)._managedStates=[],e._fadings=[],e}Y(e,t);var i=e.prototype;return i.update=function(t){if(!this.isMotionless){for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&(i.weight=0)}for(var n=1,r=this._fadings.length,a=0;a<this._fadings.length;++a){var o=this._fadings[a];o.easeTime+=t;var s=0===o.easeDuration?1:hi(o.easeTime/o.easeDuration),l=s*n;if(n*=1-s,o.target.state&&(o.target.state.weight+=l),o.easeTime>=o.easeDuration){r=a+1,o.easeTime=o.easeDuration;break}}if(r!==this._fadings.length){for(var c=r;c<this._fadings.length;++c){var h=this._fadings[c];--h.target.reference,h.target.reference<=0&&(h.target.state&&h.target.state.stop(),yt(this._managedStates,h.target))}this._fadings.splice(r)}for(var u=0;u<this._managedStates.length;++u){var _=this._managedStates[u].state;_&&_.isMotionless&&_.sample()}}},i.crossFade=function(t,e){var i;0===this._managedStates.length&&(e=0),0===e&&this.clear();var n=this._managedStates.find((function(e){return e.state===t}));n?(null===(i=n.state)||void 0===i?void 0:i.isMotionless)&&n.state.play():(n={state:t,reference:0},t&&t.play(),this._managedStates.push(n)),++n.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:n})},i.clear=function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0},i.onPlay=function(){t.prototype.onPlay.call(this),n.director.getAnimationManager().addCrossFade(this)},i.onPause=function(){t.prototype.onPause.call(this),n.director.getAnimationManager().removeCrossFade(this);for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&i.pause()}},i.onResume=function(){t.prototype.onResume.call(this),n.director.getAnimationManager().addCrossFade(this);for(var e=0;e<this._managedStates.length;++e){var i=this._managedStates[e].state;i&&i.resume()}},i.onStop=function(){t.prototype.onStop.call(this),n.director.getAnimationManager().removeCrossFade(this),this.clear()},e}(lD),BD=function(e){return t({AnimationComponent:e,Animation:e}),e}((gD=ru("cc.Animation"),yD=gu(),TD=ou(99),SD=du(),ED=Fu([nD]),AD=Eu(),bD=Fu(nD),xD=Eu(),CD=Eu(),wD=Fu([nD]),gD(RD=yD(RD=TD(RD=fu(RD=SD((ND=DD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"playOnLoad",OD,K(e)),e._crossFade=new LD,e._nameToState=Dt(!0),J(e,"_clips",PD,K(e)),J(e,"_defaultClip",MD,K(e)),e._hasBeenPlayed=!1,e}Y(e,t);var i=e.prototype;return i.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},i.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},i.onEnable=function(){this._crossFade.resume()},i.onDisable=function(){this._crossFade.pause()},i.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=Dt(!0)},i.play=function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},i.crossFade=function(t,e){void 0===e&&(e=.3),this._hasBeenPlayed=!0;var i=this._nameToState[t];i&&(this._crossFade.play(),this._crossFade.crossFade(i,e))},i.pause=function(){this._crossFade.pause()},i.resume=function(){this._crossFade.resume()},i.stop=function(){this._crossFade.stop()},i.getAnimationState=function(t){return this.getState(t)},i.getState=function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null},i.createState=function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)},i.removeState=function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])},i.addClip=function(t,e){return Tt(this._clips,t)||this._clips.push(t),this.createState(t,e)},i.removeClip=function(t,e){var i;for(var n in this._nameToState){var r=this._nameToState[n];if(r.clip===t){i=r;break}}if(t===this._defaultClip){if(!e)return void E(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void E(3903);i.stop()}this._clips=this._clips.filter((function(e){return e!==t})),i&&delete this._nameToState[i.name]},i.on=function(e,i,n,r){var a=t.prototype.on.call(this,e,i,n,r);return e===uD.LASTFRAME&&this._syncAllowLastFrameEvent(),a},i.once=function(e,i,n){var r=t.prototype.once.call(this,e,i,n);return e===uD.LASTFRAME&&this._syncAllowLastFrameEvent(),r},i.off=function(e,i,n){t.prototype.off.call(this,e,i,n),e===uD.LASTFRAME&&this._syncDisallowLastFrameEvent()},i._createState=function(t,e){return new mD(t,e)},i._doCreateState=function(t,e){var i=this._createState(t,e);return i._setEventTarget(this),i.allowLastFrameEvent(this.hasEventListener(uD.LASTFRAME)),this.node&&i.initialize(this.node),this._nameToState[i.name]=i,i},i._getStateByNameOrDefaultClip=function(t){if(!t){if(!this._defaultClip)return null;t=this._defaultClip.name}return this._nameToState[t]||null},i._removeStateOfAutomaticClip=function(t){for(var e in this._nameToState){var i=this._nameToState[e];FD(t,i.clip)&&(i.stop(),delete this._nameToState[e])}},i._syncAllowLastFrameEvent=function(){if(this.hasEventListener(uD.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},i._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(uD.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},q(e,[{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var i,n=Q(this._clips);!(i=n()).done;){var r=i.value;r&&this._removeStateOfAutomaticClip(r)}for(var a,o=Q(t);!(a=o()).done;){var s=a.value;s&&this.createState(s)}var l=t.find((function(t){return FD(t,e._defaultClip)}));this._defaultClip=l||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(e){return FD(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}(x_(Jf)),DD.EventType=uD,$((ID=ND).prototype,"clips",[ED,AD],Object.getOwnPropertyDescriptor(ID.prototype,"clips"),ID.prototype),$(ID.prototype,"defaultClip",[bD,xD],Object.getOwnPropertyDescriptor(ID.prototype,"defaultClip"),ID.prototype),OD=$(ID.prototype,"playOnLoad",[cu,CD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),PD=$(ID.prototype,"_clips",[wD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MD=$(ID.prototype,"_defaultClip",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RD=ID))||RD)||RD)||RD)||RD)||RD));function FD(t,e){return t===e||!(!t||!e||t.name!==e.name&&t._uuid!==e._uuid)}lt(BD.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var t=arguments.length<=0?void 0:arguments[0];return BD.prototype.removeState.call(this,t.name)}}]),n.AnimationComponent=BD,le.setClassAlias(BD,"cc.AnimationComponent");var zD,UD,kD,GD=[],HD=new Map;function VD(t,e){for(var i=0,n=Vi.IDENTITY;t;){if(t.stamp===e||t.stamp+1===e&&!t.node.hasChangedFlags){n=t.world,t.stamp=e;break}t.stamp=e,GD[i++]=t,t=t.parent}for(;i>0;){var r=(t=GD[--i]).node;Vi.fromRTS(t.local,r.rotation,r.position,r.scale),n=Vi.multiply(t.world,n,t.local)}return n}function WD(t,e){for(var i,n=null,r=0;t!==e;){var a=t.uuid;if(HD.has(a)){n=HD.get(a);break}n={node:t,local:new Vi,world:new Vi,stamp:-1,parent:null},HD.set(a,n),GD[r++]=n,t=t.parent,n=null}for(;r>0;)(i=GD[--r]).parent=n,n=i;return n}function jD(t){for(var e=HD.get(t.uuid)||null;e;)HD.delete(e.node.uuid),e=e.parent}var qD=t("AnimationManager",ru((kD=UD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._anims=new mt([]),e._delayEvents=[],e._blendStateBuffer=new cD,e._crossFades=[],e._sockets=[],e}Y(e,t);var i=e.prototype;return i.addCrossFade=function(t){this._crossFades.push(t)},i.removeCrossFade=function(t){yt(this._crossFades,t)},i.update=function(t){for(var e=this._delayEvents,i=this._crossFades,r=this._sockets,a=0,o=i.length;a<o;a++)i[a].update(t);var s=this._anims,l=s.array;for(s.i=0;s.i<l.length;++s.i){var c=l[s.i];c.isMotionless||c.update(t)}this._blendStateBuffer.apply();for(var h=n.director.getTotalFrames(),u=0,_=r.length;u<_;u++){var f=r[u],d=f.target,p=f.transform;d.matrix=VD(p,h)}for(var m=0,v=e.length;m<v;m++){var g=e[m];g.fn.apply(g.thisArg,g.args)}e.length=0},i.destruct=function(){},i.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},i.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):b(3907)},i.pushDelayEvent=function(t,e,i){this._delayEvents.push({fn:t,thisArg:e,args:i})},i.addSockets=function(t,e){for(var i=this,n=function(n){var r=e[n];if(i._sockets.find((function(t){return t.target===r.target})))return"continue";var a=t.getChildByPath(r.path),o=r.target&&a&&WD(a,t);o&&i._sockets.push({target:r.target,transform:o})},r=0;r<e.length;++r)n(r)},i.removeSockets=function(t,e){for(var i=0;i<e.length;++i)for(var n=e[i],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===n.target){jD(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},q(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(wb),UD.ID="animation",zD=kD))||zD);BR.on(LR.EVENT_INIT,(function(){var t=new qD;BR.registerSystem(qD.ID,t,Db.PRIORITY_SYSTEM)})),n.AnimationManager=qD;var XD,YD,KD,ZD,QD=new Vi;function JD(t,e,i){for(Vi.identity(i);t!==e;)Vi.fromRTS(QD,t.rotation,t.position,t.scale),Vi.multiply(i,QD,i),t=t.parent;return i}n.easing=sv;var $D=t("HierachyModifier",ru("cc.HierachyModifier")(XD=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(nM))||XD);n.HierachyModifier=$D;var tN=t("ComponentModifier",ru("cc.ComponentModifier")(YD=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(rM))||YD);n.ComponentModifier=tN;var eN=t("CurveValueAdapter",ru("cc.CurveValueAdapter")(KD=function(){function t(){}return t.prototype.forTarget=function(){return{set:function(){}}},t}())||KD);n.CurveValueAdapter=eN;var iN=t("UniformCurveValueAdapter",ru("cc.UniformCurveValueAdapter")(ZD=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(vM))||ZD);function nN(t){return"string"==typeof t}function rN(t){return"number"==typeof t}function aN(t,e){return t instanceof e}n.UniformCurveValueAdapter=iN,n.isPropertyModifier=nN,n.isElementModifier=rN,n.isCustomTargetModifier=aN,n.math=an,n.geometry=Dc;var oN=t("NodePool",function(){function t(t){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=t,this._pool=[]}var e=t.prototype;return e.size=function(){return this._pool.length},e.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},e.put=function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent();var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},e.get=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=this._pool.length-1;if(n<0)return null;var r=this._pool[n];this._pool.length=n;var a=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return a&&a.reuse&&a.reuse(arguments),r},t}());n.NodePool=oN,n.renderer=Rm;var sN,lN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuDescriptorSet=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,i=e.bindings,n=e.descriptorIndices,r=e.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var a=[];this._gpuDescriptorSet={gpuDescriptors:a,descriptorIndices:n};for(var o=0;o<i.length;++o)for(var s=i[o],l=0;l<s.count;l++)a.push({type:s.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},i.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},i.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&Ps){var i=this._buffers[e];i&&(t[e].gpuBuffer=i.gpuBuffer||i.gpuBufferView)}else t[e].type&Ms&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},q(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(Ns);function cN(t,e){switch(t){case ka.R8:return e.UNSIGNED_BYTE;case ka.R8SN:return e.BYTE;case ka.R8UI:return e.UNSIGNED_BYTE;case ka.R8I:return e.BYTE;case ka.R16F:return sN.HALF_FLOAT_OES;case ka.R16UI:return e.UNSIGNED_SHORT;case ka.R16I:return e.SHORT;case ka.R32F:return e.FLOAT;case ka.R32UI:return e.UNSIGNED_INT;case ka.R32I:return e.INT;case ka.RG8:return e.UNSIGNED_BYTE;case ka.RG8SN:return e.BYTE;case ka.RG8UI:return e.UNSIGNED_BYTE;case ka.RG8I:return e.BYTE;case ka.RG16F:return sN.HALF_FLOAT_OES;case ka.RG16UI:return e.UNSIGNED_SHORT;case ka.RG16I:return e.SHORT;case ka.RG32F:return e.FLOAT;case ka.RG32UI:return e.UNSIGNED_INT;case ka.RG32I:return e.INT;case ka.RGB8:case ka.SRGB8:return e.UNSIGNED_BYTE;case ka.RGB8SN:return e.BYTE;case ka.RGB8UI:return e.UNSIGNED_BYTE;case ka.RGB8I:return e.BYTE;case ka.RGB16F:return sN.HALF_FLOAT_OES;case ka.RGB16UI:return e.UNSIGNED_SHORT;case ka.RGB16I:return e.SHORT;case ka.RGB32F:return e.FLOAT;case ka.RGB32UI:return e.UNSIGNED_INT;case ka.RGB32I:return e.INT;case ka.BGRA8:case ka.RGBA8:case ka.SRGB8_A8:return e.UNSIGNED_BYTE;case ka.RGBA8SN:return e.BYTE;case ka.RGBA8UI:return e.UNSIGNED_BYTE;case ka.RGBA8I:return e.BYTE;case ka.RGBA16F:return sN.HALF_FLOAT_OES;case ka.RGBA16UI:return e.UNSIGNED_SHORT;case ka.RGBA16I:return e.SHORT;case ka.RGBA32F:return e.FLOAT;case ka.RGBA32UI:return e.UNSIGNED_INT;case ka.RGBA32I:return e.INT;case ka.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case ka.R11G11B10F:return e.FLOAT;case ka.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case ka.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case ka.RGB10A2:return e.UNSIGNED_BYTE;case ka.RGB10A2UI:return e.UNSIGNED_INT;case ka.RGB9E5:return e.UNSIGNED_BYTE;case ka.D16:return e.UNSIGNED_SHORT;case ka.D16S8:return sN.UNSIGNED_INT_24_8_WEBGL;case ka.D24:return e.UNSIGNED_INT;case ka.D24S8:return sN.UNSIGNED_INT_24_8_WEBGL;case ka.D32F:return e.UNSIGNED_INT;case ka.D32F_S8:return sN.UNSIGNED_INT_24_8_WEBGL;case ka.BC1:case ka.BC1_SRGB:case ka.BC2:case ka.BC2_SRGB:case ka.BC3:case ka.BC3_SRGB:case ka.BC4:return e.UNSIGNED_BYTE;case ka.BC4_SNORM:return e.BYTE;case ka.BC5:return e.UNSIGNED_BYTE;case ka.BC5_SNORM:return e.BYTE;case ka.BC6H_SF16:case ka.BC6H_UF16:return e.FLOAT;case ka.BC7:case ka.BC7_SRGB:case ka.ETC_RGB8:case ka.ETC2_RGB8:case ka.ETC2_SRGB8:case ka.ETC2_RGB8_A1:case ka.ETC2_SRGB8_A1:case ka.EAC_R11:return e.UNSIGNED_BYTE;case ka.EAC_R11SN:return e.BYTE;case ka.EAC_RG11:return e.UNSIGNED_BYTE;case ka.EAC_RG11SN:return e.BYTE;case ka.PVRTC_RGB2:case ka.PVRTC_RGBA2:case ka.PVRTC_RGB4:case ka.PVRTC_RGBA4:case ka.PVRTC2_2BPP:case ka.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case ka.ASTC_RGBA_4x4:case ka.ASTC_RGBA_5x4:case ka.ASTC_RGBA_5x5:case ka.ASTC_RGBA_6x5:case ka.ASTC_RGBA_6x6:case ka.ASTC_RGBA_8x5:case ka.ASTC_RGBA_8x6:case ka.ASTC_RGBA_8x8:case ka.ASTC_RGBA_10x5:case ka.ASTC_RGBA_10x6:case ka.ASTC_RGBA_10x8:case ka.ASTC_RGBA_10x10:case ka.ASTC_RGBA_12x10:case ka.ASTC_RGBA_12x12:case ka.ASTC_SRGBA_4x4:case ka.ASTC_SRGBA_5x4:case ka.ASTC_SRGBA_5x5:case ka.ASTC_SRGBA_6x5:case ka.ASTC_SRGBA_6x6:case ka.ASTC_SRGBA_8x5:case ka.ASTC_SRGBA_8x6:case ka.ASTC_SRGBA_8x8:case ka.ASTC_SRGBA_10x5:case ka.ASTC_SRGBA_10x6:case ka.ASTC_SRGBA_10x8:case ka.ASTC_SRGBA_10x10:case ka.ASTC_SRGBA_12x10:case ka.ASTC_SRGBA_12x12:default:return e.UNSIGNED_BYTE}}function hN(t,e){switch(t){case ka.A8:return e.ALPHA;case ka.L8:return e.LUMINANCE;case ka.LA8:return e.LUMINANCE_ALPHA;case ka.RGB8:case ka.RGB16F:case ka.RGB32F:return e.RGB;case ka.BGRA8:case ka.RGBA8:case ka.RGBA16F:case ka.RGBA32F:return e.RGBA;case ka.R5G6B5:return e.RGB565;case ka.RGB5A1:return e.RGB5_A1;case ka.RGBA4:return e.RGBA4;case ka.D16:return e.DEPTH_COMPONENT;case ka.D16S8:return e.DEPTH_STENCIL;case ka.D24:return e.DEPTH_COMPONENT;case ka.D24S8:return e.DEPTH_STENCIL;case ka.D32F:return e.DEPTH_COMPONENT;case ka.D32F_S8:return e.DEPTH_STENCIL;case ka.BC1:return sN.COMPRESSED_RGB_S3TC_DXT1_EXT;case ka.BC1_ALPHA:return sN.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ka.BC1_SRGB:return sN.COMPRESSED_SRGB_S3TC_DXT1_EXT;case ka.BC1_SRGB_ALPHA:return sN.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ka.BC2:return sN.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ka.BC2_SRGB:return sN.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ka.BC3:return sN.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ka.BC3_SRGB:return sN.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ka.ETC_RGB8:return sN.COMPRESSED_RGB_ETC1_WEBGL;case ka.ETC2_RGB8:return sN.COMPRESSED_RGB8_ETC2;case ka.ETC2_SRGB8:return sN.COMPRESSED_SRGB8_ETC2;case ka.ETC2_RGB8_A1:return sN.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ka.ETC2_SRGB8_A1:return sN.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ka.ETC2_RGBA8:return sN.COMPRESSED_RGBA8_ETC2_EAC;case ka.ETC2_SRGB8_A8:return sN.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case ka.EAC_R11:return sN.COMPRESSED_R11_EAC;case ka.EAC_R11SN:return sN.COMPRESSED_SIGNED_R11_EAC;case ka.EAC_RG11:return sN.COMPRESSED_RG11_EAC;case ka.EAC_RG11SN:return sN.COMPRESSED_SIGNED_RG11_EAC;case ka.PVRTC_RGB2:return sN.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case ka.PVRTC_RGBA2:return sN.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case ka.PVRTC_RGB4:return sN.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case ka.PVRTC_RGBA4:return sN.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case ka.ASTC_RGBA_4x4:return sN.COMPRESSED_RGBA_ASTC_4x4_KHR;case ka.ASTC_RGBA_5x4:return sN.COMPRESSED_RGBA_ASTC_5x4_KHR;case ka.ASTC_RGBA_5x5:return sN.COMPRESSED_RGBA_ASTC_5x5_KHR;case ka.ASTC_RGBA_6x5:return sN.COMPRESSED_RGBA_ASTC_6x5_KHR;case ka.ASTC_RGBA_6x6:return sN.COMPRESSED_RGBA_ASTC_6x6_KHR;case ka.ASTC_RGBA_8x5:return sN.COMPRESSED_RGBA_ASTC_8x5_KHR;case ka.ASTC_RGBA_8x6:return sN.COMPRESSED_RGBA_ASTC_8x6_KHR;case ka.ASTC_RGBA_8x8:return sN.COMPRESSED_RGBA_ASTC_8x8_KHR;case ka.ASTC_RGBA_10x5:return sN.COMPRESSED_RGBA_ASTC_10x5_KHR;case ka.ASTC_RGBA_10x6:return sN.COMPRESSED_RGBA_ASTC_10x6_KHR;case ka.ASTC_RGBA_10x8:return sN.COMPRESSED_RGBA_ASTC_10x8_KHR;case ka.ASTC_RGBA_10x10:return sN.COMPRESSED_RGBA_ASTC_10x10_KHR;case ka.ASTC_RGBA_12x10:return sN.COMPRESSED_RGBA_ASTC_12x10_KHR;case ka.ASTC_RGBA_12x12:return sN.COMPRESSED_RGBA_ASTC_12x12_KHR;case ka.ASTC_SRGBA_4x4:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case ka.ASTC_SRGBA_5x4:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case ka.ASTC_SRGBA_5x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case ka.ASTC_SRGBA_6x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case ka.ASTC_SRGBA_6x6:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case ka.ASTC_SRGBA_8x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case ka.ASTC_SRGBA_8x6:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case ka.ASTC_SRGBA_8x8:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case ka.ASTC_SRGBA_10x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case ka.ASTC_SRGBA_10x6:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case ka.ASTC_SRGBA_10x8:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case ka.ASTC_SRGBA_10x10:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case ka.ASTC_SRGBA_12x10:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case ka.ASTC_SRGBA_12x12:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}function uN(t,e){switch(t){case ka.A8:return e.ALPHA;case ka.L8:return e.LUMINANCE;case ka.LA8:return e.LUMINANCE_ALPHA;case ka.RGB8:case ka.RGB16F:case ka.RGB32F:return e.RGB;case ka.BGRA8:case ka.RGBA8:case ka.RGBA16F:case ka.RGBA32F:return e.RGBA;case ka.R5G6B5:return e.RGB;case ka.RGB5A1:case ka.RGBA4:return e.RGBA;case ka.D16:return e.DEPTH_COMPONENT;case ka.D16S8:return e.DEPTH_STENCIL;case ka.D24:return e.DEPTH_COMPONENT;case ka.D24S8:return e.DEPTH_STENCIL;case ka.D32F:return e.DEPTH_COMPONENT;case ka.D32F_S8:return e.DEPTH_STENCIL;case ka.BC1:return sN.COMPRESSED_RGB_S3TC_DXT1_EXT;case ka.BC1_ALPHA:return sN.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ka.BC1_SRGB:return sN.COMPRESSED_SRGB_S3TC_DXT1_EXT;case ka.BC1_SRGB_ALPHA:return sN.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ka.BC2:return sN.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ka.BC2_SRGB:return sN.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ka.BC3:return sN.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ka.BC3_SRGB:return sN.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ka.ETC_RGB8:return sN.COMPRESSED_RGB_ETC1_WEBGL;case ka.ETC2_RGB8:return sN.COMPRESSED_RGB8_ETC2;case ka.ETC2_SRGB8:return sN.COMPRESSED_SRGB8_ETC2;case ka.ETC2_RGB8_A1:return sN.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ka.ETC2_SRGB8_A1:return sN.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case ka.ETC2_RGBA8:return sN.COMPRESSED_RGBA8_ETC2_EAC;case ka.ETC2_SRGB8_A8:return sN.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case ka.EAC_R11:return sN.COMPRESSED_R11_EAC;case ka.EAC_R11SN:return sN.COMPRESSED_SIGNED_R11_EAC;case ka.EAC_RG11:return sN.COMPRESSED_RG11_EAC;case ka.EAC_RG11SN:return sN.COMPRESSED_SIGNED_RG11_EAC;case ka.PVRTC_RGB2:return sN.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case ka.PVRTC_RGBA2:return sN.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case ka.PVRTC_RGB4:return sN.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case ka.PVRTC_RGBA4:return sN.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case ka.ASTC_RGBA_4x4:return sN.COMPRESSED_RGBA_ASTC_4x4_KHR;case ka.ASTC_RGBA_5x4:return sN.COMPRESSED_RGBA_ASTC_5x4_KHR;case ka.ASTC_RGBA_5x5:return sN.COMPRESSED_RGBA_ASTC_5x5_KHR;case ka.ASTC_RGBA_6x5:return sN.COMPRESSED_RGBA_ASTC_6x5_KHR;case ka.ASTC_RGBA_6x6:return sN.COMPRESSED_RGBA_ASTC_6x6_KHR;case ka.ASTC_RGBA_8x5:return sN.COMPRESSED_RGBA_ASTC_8x5_KHR;case ka.ASTC_RGBA_8x6:return sN.COMPRESSED_RGBA_ASTC_8x6_KHR;case ka.ASTC_RGBA_8x8:return sN.COMPRESSED_RGBA_ASTC_8x8_KHR;case ka.ASTC_RGBA_10x5:return sN.COMPRESSED_RGBA_ASTC_10x5_KHR;case ka.ASTC_RGBA_10x6:return sN.COMPRESSED_RGBA_ASTC_10x6_KHR;case ka.ASTC_RGBA_10x8:return sN.COMPRESSED_RGBA_ASTC_10x8_KHR;case ka.ASTC_RGBA_10x10:return sN.COMPRESSED_RGBA_ASTC_10x10_KHR;case ka.ASTC_RGBA_12x10:return sN.COMPRESSED_RGBA_ASTC_12x10_KHR;case ka.ASTC_RGBA_12x12:return sN.COMPRESSED_RGBA_ASTC_12x12_KHR;case ka.ASTC_SRGBA_4x4:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case ka.ASTC_SRGBA_5x4:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case ka.ASTC_SRGBA_5x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case ka.ASTC_SRGBA_6x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case ka.ASTC_SRGBA_6x6:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case ka.ASTC_SRGBA_8x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case ka.ASTC_SRGBA_8x6:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case ka.ASTC_SRGBA_8x8:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case ka.ASTC_SRGBA_10x5:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case ka.ASTC_SRGBA_10x6:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case ka.ASTC_SRGBA_10x8:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case ka.ASTC_SRGBA_10x10:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case ka.ASTC_SRGBA_12x10:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case ka.ASTC_SRGBA_12x12:return sN.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}function _N(t,e){switch(t){case Ua.BOOL:return e.BOOL;case Ua.BOOL2:return e.BOOL_VEC2;case Ua.BOOL3:return e.BOOL_VEC3;case Ua.BOOL4:return e.BOOL_VEC4;case Ua.INT:return e.INT;case Ua.INT2:return e.INT_VEC2;case Ua.INT3:return e.INT_VEC3;case Ua.INT4:return e.INT_VEC4;case Ua.UINT:return e.UNSIGNED_INT;case Ua.FLOAT:return e.FLOAT;case Ua.FLOAT2:return e.FLOAT_VEC2;case Ua.FLOAT3:return e.FLOAT_VEC3;case Ua.FLOAT4:return e.FLOAT_VEC4;case Ua.MAT2:return e.FLOAT_MAT2;case Ua.MAT3:return e.FLOAT_MAT3;case Ua.MAT4:return e.FLOAT_MAT4;case Ua.SAMPLER2D:return e.SAMPLER_2D;case Ua.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),Ua.UNKNOWN}}function fN(t){switch(t){case Ua.BOOL:case Ua.BOOL2:case Ua.BOOL3:case Ua.BOOL4:case Ua.INT:case Ua.INT2:case Ua.INT3:case Ua.INT4:case Ua.UINT:return Int32Array;case Ua.FLOAT:case Ua.FLOAT2:case Ua.FLOAT3:case Ua.FLOAT4:case Ua.MAT2:case Ua.MAT3:case Ua.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function dN(t,e){switch(t){case e.BOOL:return Ua.BOOL;case e.BOOL_VEC2:return Ua.BOOL2;case e.BOOL_VEC3:return Ua.BOOL3;case e.BOOL_VEC4:return Ua.BOOL4;case e.INT:return Ua.INT;case e.INT_VEC2:return Ua.INT2;case e.INT_VEC3:return Ua.INT3;case e.INT_VEC4:return Ua.INT4;case e.UNSIGNED_INT:return Ua.UINT;case e.FLOAT:return Ua.FLOAT;case e.FLOAT_VEC2:return Ua.FLOAT2;case e.FLOAT_VEC3:return Ua.FLOAT3;case e.FLOAT_VEC4:return Ua.FLOAT4;case e.FLOAT_MAT2:return Ua.MAT2;case e.FLOAT_MAT3:return Ua.MAT3;case e.FLOAT_MAT4:return Ua.MAT4;case e.SAMPLER_2D:return Ua.SAMPLER2D;case e.SAMPLER_CUBE:return Ua.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),Ua.UNKNOWN}}function pN(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function mN(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(sN||(sN={}));var vN,gN=[512,513,514,515,516,517,518,519],yN=[0,7680,7681,7682,7683,5386,34055,34056],TN=[32774,32778,32779,32775,32776],SN=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(vN||(vN={}));var EN=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},AN=function(t){function e(){var e;return(e=t.call(this,vN.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new Zo,e.clearFlag=vo.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return Y(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(EN),bN=function(t){function e(){var e;return(e=t.call(this,vN.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.viewport=null,e.scissor=null,e.lineWidth=null,e.depthBias=null,e.blendConstants=[],e.depthBounds=null,e.stencilWriteMask=null,e.stencilCompareMask=null,e}return Y(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0,this.viewport=null,this.scissor=null,this.lineWidth=null,this.depthBias=null,this.blendConstants.length=0,this.depthBounds=null,this.stencilWriteMask=null,this.stencilCompareMask=null},e}(EN),xN=function(t){function e(){var e;return(e=t.call(this,vN.DRAW)||this).drawInfo=new Po,e}return Y(e,t),e.prototype.clear=function(){},e}(EN),CN=function(t){function e(){var e;return(e=t.call(this,vN.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return Y(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(EN),wN=function(t){function e(){var e;return(e=t.call(this,vN.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return Y(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(EN),RN=function(){function t(){this.cmds=new f_(1),this.beginRenderPassCmds=new f_(1),this.bindStatesCmds=new f_(1),this.drawCmds=new f_(1),this.updateBufferCmds=new f_(1),this.copyBufferToTextureCmds=new f_(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function IN(t,e,i,n,r){if(e.usage&Ga.UNIFORM)ArrayBuffer.isView(i)?e.vf32.set(i,n/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(i),n/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&Ga.INDIRECT)e.indirects.length=n,Array.prototype.push.apply(e.indirects,i.drawInfos);else{var a=i,o=t.gl,s=t.stateCache;switch(e.glTarget){case o.ARRAY_BUFFER:t.useVAO&&s.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),s.glVAO=ON.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(o.bindBuffer(o.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case o.ELEMENT_ARRAY_BUFFER:t.useVAO&&s.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),s.glVAO=ON.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}r===a.byteLength?o.bufferSubData(e.glTarget,n,a):o.bufferSubData(e.glTarget,n,a.slice(0,r))}}var ON={gpuPipelineState:null,gpuInputAssembler:null,reverseCW:!1,glPrimitive:0};function PN(t,e,i,n,r,a,o){var s=t.gl,l=t.stateCache,c=0;if(i&&e){if(l.glFramebuffer!==i.glFramebuffer){s.bindFramebuffer(s.FRAMEBUFFER,i.glFramebuffer),l.glFramebuffer=i.glFramebuffer;var h=!!i.glFramebuffer;if(h!==ON.reverseCW){ON.reverseCW=h;var u=!t.stateCache.rs.isFrontFaceCCW;s.frontFace(u?s.CCW:s.CW),t.stateCache.rs.isFrontFaceCCW=u}}l.viewport.left===n.x&&l.viewport.top===n.y&&l.viewport.width===n.width&&l.viewport.height===n.height||(s.viewport(n.x,n.y,n.width,n.height),l.viewport.left=n.x,l.viewport.top=n.y,l.viewport.width=n.width,l.viewport.height=n.height),l.scissorRect.x===n.x&&l.scissorRect.y===n.y&&l.scissorRect.width===n.width&&l.scissorRect.height===n.height||(s.scissor(n.x,n.y,n.width,n.height),l.scissorRect.x=n.x,l.scissorRect.y=n.y,l.scissorRect.width=n.width,l.scissorRect.height=n.height);var _=r.length;t.WEBGL_draw_buffers||(_=1);for(var f=0;f<_;++f){var d=e.colorAttachments[f];if(d.format!==ka.UNKNOWN)switch(d.loadOp){case co.LOAD:break;case co.CLEAR:l.bs.targets[0].blendColorMask!==$a.ALL&&s.colorMask(!0,!0,!0,!0);var p=r[0];s.clearColor(p.x,p.y,p.z,p.w),c|=s.COLOR_BUFFER_BIT;break;case co.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==ka.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case co.LOAD:break;case co.CLEAR:l.dss.depthWrite||s.depthMask(!0),s.clearDepth(a),c|=s.DEPTH_BUFFER_BIT;break;case co.DISCARD:}if(xo[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case co.LOAD:break;case co.CLEAR:l.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),l.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(o),c|=s.STENCIL_BUFFER_BIT;break;case co.DISCARD:}}if(c&&s.clear(c),c&s.COLOR_BUFFER_BIT){var m=l.bs.targets[0].blendColorMask;if(m!==$a.ALL){var v=(m&$a.R)!==$a.NONE,g=(m&$a.G)!==$a.NONE,y=(m&$a.B)!==$a.NONE,T=(m&$a.A)!==$a.NONE;s.colorMask(v,g,y,T)}}c&s.DEPTH_BUFFER_BIT&&!l.dss.depthWrite&&s.depthMask(!1),c&s.STENCIL_BUFFER_BIT&&(l.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),l.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function MN(t,e,i,n,r,a,o,s,l,c,h,u,_){var f,p,m,v=t.gl,g=t.stateCache,y=e&&e.gpuShader,T=!1;if(e&&ON.gpuPipelineState!==e){if(ON.gpuPipelineState=e,ON.glPrimitive=e.glPrimitive,e.gpuShader){var S=e.gpuShader.glProgram;g.glProgram!==S&&(v.useProgram(S),g.glProgram=S,T=!0)}var E=e.rs;if(E){if(g.rs.cullMode!==E.cullMode){switch(E.cullMode){case Ya.NONE:v.disable(v.CULL_FACE);break;case Ya.FRONT:v.enable(v.CULL_FACE),v.cullFace(v.FRONT);break;case Ya.BACK:v.enable(v.CULL_FACE),v.cullFace(v.BACK)}g.rs.cullMode=E.cullMode}var A=ON.reverseCW?!E.isFrontFaceCCW:E.isFrontFaceCCW;g.rs.isFrontFaceCCW!==A&&(v.frontFace(A?v.CCW:v.CW),g.rs.isFrontFaceCCW=A),g.rs.depthBias===E.depthBias&&g.rs.depthBiasSlop===E.depthBiasSlop||(v.polygonOffset(E.depthBias,E.depthBiasSlop),g.rs.depthBias=E.depthBias,g.rs.depthBiasSlop=E.depthBiasSlop),g.rs.lineWidth!==E.lineWidth&&(v.lineWidth(E.lineWidth),g.rs.lineWidth=E.lineWidth)}var b=e.dss;b&&(g.dss.depthTest!==b.depthTest&&(b.depthTest?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST),g.dss.depthTest=b.depthTest),g.dss.depthWrite!==b.depthWrite&&(v.depthMask(b.depthWrite),g.dss.depthWrite=b.depthWrite),g.dss.depthFunc!==b.depthFunc&&(v.depthFunc(gN[b.depthFunc]),g.dss.depthFunc=b.depthFunc),g.dss.stencilTestFront===b.stencilTestFront&&g.dss.stencilTestBack===b.stencilTestBack||(b.stencilTestFront||b.stencilTestBack?v.enable(v.STENCIL_TEST):v.disable(v.STENCIL_TEST),g.dss.stencilTestFront=b.stencilTestFront,g.dss.stencilTestBack=b.stencilTestBack),g.dss.stencilFuncFront===b.stencilFuncFront&&g.dss.stencilRefFront===b.stencilRefFront&&g.dss.stencilReadMaskFront===b.stencilReadMaskFront||(v.stencilFuncSeparate(v.FRONT,gN[b.stencilFuncFront],b.stencilRefFront,b.stencilReadMaskFront),g.dss.stencilFuncFront=b.stencilFuncFront,g.dss.stencilRefFront=b.stencilRefFront,g.dss.stencilReadMaskFront=b.stencilReadMaskFront),g.dss.stencilFailOpFront===b.stencilFailOpFront&&g.dss.stencilZFailOpFront===b.stencilZFailOpFront&&g.dss.stencilPassOpFront===b.stencilPassOpFront||(v.stencilOpSeparate(v.FRONT,yN[b.stencilFailOpFront],yN[b.stencilZFailOpFront],yN[b.stencilPassOpFront]),g.dss.stencilFailOpFront=b.stencilFailOpFront,g.dss.stencilZFailOpFront=b.stencilZFailOpFront,g.dss.stencilPassOpFront=b.stencilPassOpFront),g.dss.stencilWriteMaskFront!==b.stencilWriteMaskFront&&(v.stencilMaskSeparate(v.FRONT,b.stencilWriteMaskFront),g.dss.stencilWriteMaskFront=b.stencilWriteMaskFront),g.dss.stencilFuncBack===b.stencilFuncBack&&g.dss.stencilRefBack===b.stencilRefBack&&g.dss.stencilReadMaskBack===b.stencilReadMaskBack||(v.stencilFuncSeparate(v.BACK,gN[b.stencilFuncBack],b.stencilRefBack,b.stencilReadMaskBack),g.dss.stencilFuncBack=b.stencilFuncBack,g.dss.stencilRefBack=b.stencilRefBack,g.dss.stencilReadMaskBack=b.stencilReadMaskBack),g.dss.stencilFailOpBack===b.stencilFailOpBack&&g.dss.stencilZFailOpBack===b.stencilZFailOpBack&&g.dss.stencilPassOpBack===b.stencilPassOpBack||(v.stencilOpSeparate(v.BACK,yN[b.stencilFailOpBack],yN[b.stencilZFailOpBack],yN[b.stencilPassOpBack]),g.dss.stencilFailOpBack=b.stencilFailOpBack,g.dss.stencilZFailOpBack=b.stencilZFailOpBack,g.dss.stencilPassOpBack=b.stencilPassOpBack),g.dss.stencilWriteMaskBack!==b.stencilWriteMaskBack&&(v.stencilMaskSeparate(v.BACK,b.stencilWriteMaskBack),g.dss.stencilWriteMaskBack=b.stencilWriteMaskBack));var x=e.bs;if(x){g.bs.isA2C!==x.isA2C&&(x.isA2C?v.enable(v.SAMPLE_ALPHA_TO_COVERAGE):v.disable(v.SAMPLE_ALPHA_TO_COVERAGE),g.bs.isA2C=x.isA2C),g.bs.blendColor.x===x.blendColor.x&&g.bs.blendColor.y===x.blendColor.y&&g.bs.blendColor.z===x.blendColor.z&&g.bs.blendColor.w===x.blendColor.w||(v.blendColor(x.blendColor.x,x.blendColor.y,x.blendColor.z,x.blendColor.w),g.bs.blendColor.x=x.blendColor.x,g.bs.blendColor.y=x.blendColor.y,g.bs.blendColor.z=x.blendColor.z,g.bs.blendColor.w=x.blendColor.w);var C=x.targets[0],w=g.bs.targets[0];w.blend!==C.blend&&(C.blend?v.enable(v.BLEND):v.disable(v.BLEND),w.blend=C.blend),w.blendEq===C.blendEq&&w.blendAlphaEq===C.blendAlphaEq||(v.blendEquationSeparate(TN[C.blendEq],TN[C.blendAlphaEq]),w.blendEq=C.blendEq,w.blendAlphaEq=C.blendAlphaEq),w.blendSrc===C.blendSrc&&w.blendDst===C.blendDst&&w.blendSrcAlpha===C.blendSrcAlpha&&w.blendDstAlpha===C.blendDstAlpha||(v.blendFuncSeparate(SN[C.blendSrc],SN[C.blendDst],SN[C.blendSrcAlpha],SN[C.blendDstAlpha]),w.blendSrc=C.blendSrc,w.blendDst=C.blendDst,w.blendSrcAlpha=C.blendSrcAlpha,w.blendDstAlpha=C.blendDstAlpha),w.blendColorMask!==C.blendColorMask&&(v.colorMask((C.blendColorMask&$a.R)!==$a.NONE,(C.blendColorMask&$a.G)!==$a.NONE,(C.blendColorMask&$a.B)!==$a.NONE,(C.blendColorMask&$a.A)!==$a.NONE),w.blendColorMask=C.blendColorMask)}}if(e&&e.gpuPipelineLayout&&y){for(var R=y.glBlocks.length,I=e.gpuPipelineLayout.dynamicOffsetIndices,O=0;O<R;O++){var P=y.glBlocks[O],M=n[P.set],D=M&&M.descriptorIndices[P.binding],N=D>=0&&M.gpuDescriptors[D],L=null,B=0;if(N&&N.gpuBuffer){var F=N.gpuBuffer,z=I[P.set],U=z&&z[P.binding];U>=0&&(B=r[U]),"vf32"in F?L=F.vf32:(B+=F.offset,L=F.gpuBuffer.vf32),B>>=2}if(L)for(var k=P.glActiveUniforms.length,G=0;G<k;G++){var H=P.glActiveUniforms[G];switch(H.glType){case v.BOOL:case v.INT:for(var V=0;V<H.array.length;++V){var W=H.begin+B+V;if(L[W]!==H.array[V]){for(var j=V,q=W;j<H.array.length;++j,++q)H.array[j]=L[q];v.uniform1iv(H.glLoc,H.array);break}}break;case v.BOOL_VEC2:case v.INT_VEC2:for(var X=0;X<H.array.length;++X){var Y=H.begin+B+X;if(L[Y]!==H.array[X]){for(var K=X,Z=Y;K<H.array.length;++K,++Z)H.array[K]=L[Z];v.uniform2iv(H.glLoc,H.array);break}}break;case v.BOOL_VEC3:case v.INT_VEC3:for(var Q=0;Q<H.array.length;++Q){var J=H.begin+B+Q;if(L[J]!==H.array[Q]){for(var $=Q,tt=J;$<H.array.length;++$,++tt)H.array[$]=L[tt];v.uniform3iv(H.glLoc,H.array);break}}break;case v.BOOL_VEC4:case v.INT_VEC4:for(var et=0;et<H.array.length;++et){var it=H.begin+B+et;if(L[it]!==H.array[et]){for(var nt=et,rt=it;nt<H.array.length;++nt,++rt)H.array[nt]=L[rt];v.uniform4iv(H.glLoc,H.array);break}}break;case v.FLOAT:for(var at=0;at<H.array.length;++at){var ot=H.begin+B+at;if(L[ot]!==H.array[at]){for(var st=at,lt=ot;st<H.array.length;++st,++lt)H.array[st]=L[lt];v.uniform1fv(H.glLoc,H.array);break}}break;case v.FLOAT_VEC2:for(var ct=0;ct<H.array.length;++ct){var ht=H.begin+B+ct;if(L[ht]!==H.array[ct]){for(var ut=ct,_t=ht;ut<H.array.length;++ut,++_t)H.array[ut]=L[_t];v.uniform2fv(H.glLoc,H.array);break}}break;case v.FLOAT_VEC3:for(var ft=0;ft<H.array.length;++ft){var dt=H.begin+B+ft;if(L[dt]!==H.array[ft]){for(var pt=ft,mt=dt;pt<H.array.length;++pt,++mt)H.array[pt]=L[mt];v.uniform3fv(H.glLoc,H.array);break}}break;case v.FLOAT_VEC4:for(var vt=0;vt<H.array.length;++vt){var gt=H.begin+B+vt;if(L[gt]!==H.array[vt]){for(var yt=vt,Tt=gt;yt<H.array.length;++yt,++Tt)H.array[yt]=L[Tt];v.uniform4fv(H.glLoc,H.array);break}}break;case v.FLOAT_MAT2:for(var St=0;St<H.array.length;++St){var Et=H.begin+B+St;if(L[Et]!==H.array[St]){for(var At=St,bt=Et;At<H.array.length;++At,++bt)H.array[At]=L[bt];v.uniformMatrix2fv(H.glLoc,!1,H.array);break}}break;case v.FLOAT_MAT3:for(var xt=0;xt<H.array.length;++xt){var Ct=H.begin+B+xt;if(L[Ct]!==H.array[xt]){for(var wt=xt,Rt=Ct;wt<H.array.length;++wt,++Rt)H.array[wt]=L[Rt];v.uniformMatrix3fv(H.glLoc,!1,H.array);break}}break;case v.FLOAT_MAT4:for(var It=0;It<H.array.length;++It){var Ot=H.begin+B+It;if(L[Ot]!==H.array[It]){for(var Pt=It,Mt=Ot;Pt<H.array.length;++Pt,++Mt)H.array[Pt]=L[Mt];v.uniformMatrix4fv(H.glLoc,!1,H.array);break}}}}else d("Buffer binding '"+P.name+"' at set "+P.set+" binding "+P.binding+" is not bounded")}for(var Dt=y.glSamplers.length,Nt=0;Nt<Dt;Nt++)for(var Lt=y.glSamplers[Nt],Bt=n[Lt.set],Ft=Bt&&Bt.descriptorIndices[Lt.binding],zt=Ft>=0&&Bt.gpuDescriptors[Ft],Ut=Lt.units.length,kt=0;kt<Ut;kt++){var Gt=Lt.units[kt];if(zt&&zt.gpuSampler){if(zt.gpuTexture&&zt.gpuTexture.size>0){var Ht=zt.gpuTexture,Vt=g.glTexUnits[Gt];Vt.glTexture!==Ht.glTexture&&(g.texUnit!==Gt&&(v.activeTexture(v.TEXTURE0+Gt),g.texUnit=Gt),Ht.glTexture?v.bindTexture(Ht.glTarget,Ht.glTexture):v.bindTexture(Ht.glTarget,t.nullTex2D.gpuTexture.glTexture),Vt.glTexture=Ht.glTexture);var Wt=zt.gpuSampler;Ht.isPowerOf2?(f=Wt.glWrapS,p=Wt.glWrapT):(f=v.CLAMP_TO_EDGE,p=v.CLAMP_TO_EDGE),m=Ht.isPowerOf2?Ht.mipLevel<=1&&(Wt.glMinFilter===v.LINEAR_MIPMAP_NEAREST||Wt.glMinFilter===v.LINEAR_MIPMAP_LINEAR)?v.LINEAR:Wt.glMinFilter:Wt.glMinFilter===v.LINEAR||Wt.glMinFilter===v.LINEAR_MIPMAP_NEAREST||Wt.glMinFilter===v.LINEAR_MIPMAP_LINEAR?v.LINEAR:v.NEAREST,Ht.glWrapS!==f&&(g.texUnit!==Gt&&(v.activeTexture(v.TEXTURE0+Gt),g.texUnit=Gt),v.texParameteri(Ht.glTarget,v.TEXTURE_WRAP_S,f),Ht.glWrapS=f),Ht.glWrapT!==p&&(g.texUnit!==Gt&&(v.activeTexture(v.TEXTURE0+Gt),g.texUnit=Gt),v.texParameteri(Ht.glTarget,v.TEXTURE_WRAP_T,p),Ht.glWrapT=p),Ht.glMinFilter!==m&&(g.texUnit!==Gt&&(v.activeTexture(v.TEXTURE0+Gt),g.texUnit=Gt),v.texParameteri(Ht.glTarget,v.TEXTURE_MIN_FILTER,m),Ht.glMinFilter=m),Ht.glMagFilter!==Wt.glMagFilter&&(g.texUnit!==Gt&&(v.activeTexture(v.TEXTURE0+Gt),g.texUnit=Gt),v.texParameteri(Ht.glTarget,v.TEXTURE_MAG_FILTER,Wt.glMagFilter),Ht.glMagFilter=Wt.glMagFilter)}zt=Bt.gpuDescriptors[++Ft]}else d("Sampler binding '"+Lt.name+"' at set "+Lt.set+" binding "+Lt.binding+" index "+kt+" is not bounded")}}if(i&&y&&(T||ON.gpuInputAssembler!==i)){ON.gpuInputAssembler=i;var jt=t.ANGLE_instanced_arrays;if(t.useVAO){var qt=t.OES_vertex_array_object,Xt=i.glVAOs.get(y.glProgram);if(!Xt){var Yt;Xt=qt.createVertexArrayOES(),i.glVAOs.set(y.glProgram,Xt),qt.bindVertexArrayOES(Xt),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),g.glArrayBuffer=null,g.glElementArrayBuffer=null;for(var Kt=y.glInputs.length,Zt=0;Zt<Kt;Zt++){var Qt=y.glInputs[Zt];Yt=null;for(var Jt=i.glAttribs.length,$t=0;$t<Jt;$t++){var te=i.glAttribs[$t];if(te.name===Qt.name){Yt=te;break}}if(Yt){g.glArrayBuffer!==Yt.glBuffer&&(v.bindBuffer(v.ARRAY_BUFFER,Yt.glBuffer),g.glArrayBuffer=Yt.glBuffer);for(var ee=0;ee<Yt.componentCount;++ee){var ie=Qt.glLoc+ee,ne=Yt.offset+Yt.size*ee;v.enableVertexAttribArray(ie),g.glCurrentAttribLocs[ie]=!0,v.vertexAttribPointer(ie,Yt.count,Yt.glType,Yt.isNormalized,Yt.stride,ne),jt&&jt.vertexAttribDivisorANGLE(ie,Yt.isInstanced?1:0)}}}var re=i.gpuIndexBuffer;re&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,re.glBuffer),qt.bindVertexArrayOES(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),g.glArrayBuffer=null,g.glElementArrayBuffer=null}g.glVAO!==Xt&&(qt.bindVertexArrayOES(Xt),g.glVAO=Xt)}else{for(var ae=0;ae<t.maxVertexAttributes;++ae)g.glCurrentAttribLocs[ae]=!1;for(var oe=y.glInputs.length,se=0;se<oe;se++){for(var le=y.glInputs[se],ce=null,he=i.glAttribs.length,ue=0;ue<he;ue++){var _e=i.glAttribs[ue];if(_e.name===le.name){ce=_e;break}}if(ce){g.glArrayBuffer!==ce.glBuffer&&(v.bindBuffer(v.ARRAY_BUFFER,ce.glBuffer),g.glArrayBuffer=ce.glBuffer);for(var fe=0;fe<ce.componentCount;++fe){var de=le.glLoc+fe,pe=ce.offset+ce.size*fe;!g.glEnabledAttribLocs[de]&&de>=0&&(v.enableVertexAttribArray(de),g.glEnabledAttribLocs[de]=!0),g.glCurrentAttribLocs[de]=!0,v.vertexAttribPointer(de,ce.count,ce.glType,ce.isNormalized,ce.stride,pe),jt&&jt.vertexAttribDivisorANGLE(de,ce.isInstanced?1:0)}}}var me=i.gpuIndexBuffer;me&&g.glElementArrayBuffer!==me.glBuffer&&(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,me.glBuffer),g.glElementArrayBuffer=me.glBuffer);for(var ve=0;ve<t.maxVertexAttributes;++ve)g.glEnabledAttribLocs[ve]!==g.glCurrentAttribLocs[ve]&&(v.disableVertexAttribArray(ve),g.glEnabledAttribLocs[ve]=!1)}}if(e&&e.dynamicStates.length)for(var ge=e.dynamicStates.length,ye=0;ye<ge;ye++)switch(e.dynamicStates[ye]){case fo.VIEWPORT:a&&(g.viewport.left===a.left&&g.viewport.top===a.top&&g.viewport.width===a.width&&g.viewport.height===a.height||(v.viewport(a.left,a.top,a.width,a.height),g.viewport.left=a.left,g.viewport.top=a.top,g.viewport.width=a.width,g.viewport.height=a.height));break;case fo.SCISSOR:o&&(g.scissorRect.x===o.x&&g.scissorRect.y===o.y&&g.scissorRect.width===o.width&&g.scissorRect.height===o.height||(v.scissor(o.x,o.y,o.width,o.height),g.scissorRect.x=o.x,g.scissorRect.y=o.y,g.scissorRect.width=o.width,g.scissorRect.height=o.height));break;case fo.LINE_WIDTH:s&&g.rs.lineWidth!==s&&(v.lineWidth(s),g.rs.lineWidth=s);break;case fo.DEPTH_BIAS:l&&(g.rs.depthBias===l.constantFactor&&g.rs.depthBiasSlop===l.slopeFactor||(v.polygonOffset(l.constantFactor,l.slopeFactor),g.rs.depthBias=l.constantFactor,g.rs.depthBiasSlop=l.slopeFactor));break;case fo.BLEND_CONSTANTS:g.bs.blendColor.x===c[0]&&g.bs.blendColor.y===c[1]&&g.bs.blendColor.z===c[2]&&g.bs.blendColor.w===c[3]||(v.blendColor(c[0],c[1],c[2],c[3]),g.bs.blendColor.x=c[0],g.bs.blendColor.y=c[1],g.bs.blendColor.z=c[2],g.bs.blendColor.w=c[3]);break;case fo.STENCIL_WRITE_MASK:if(u)switch(u.face){case po.FRONT:g.dss.stencilWriteMaskFront!==u.writeMask&&(v.stencilMaskSeparate(v.FRONT,u.writeMask),g.dss.stencilWriteMaskFront=u.writeMask);break;case po.BACK:g.dss.stencilWriteMaskBack!==u.writeMask&&(v.stencilMaskSeparate(v.BACK,u.writeMask),g.dss.stencilWriteMaskBack=u.writeMask);break;case po.ALL:g.dss.stencilWriteMaskFront===u.writeMask&&g.dss.stencilWriteMaskBack===u.writeMask||(v.stencilMask(u.writeMask),g.dss.stencilWriteMaskFront=u.writeMask,g.dss.stencilWriteMaskBack=u.writeMask)}break;case fo.STENCIL_COMPARE_MASK:if(_)switch(_.face){case po.FRONT:g.dss.stencilRefFront===_.reference&&g.dss.stencilReadMaskFront===_.compareMask||(v.stencilFuncSeparate(v.FRONT,gN[g.dss.stencilFuncFront],_.reference,_.compareMask),g.dss.stencilRefFront=_.reference,g.dss.stencilReadMaskFront=_.compareMask);break;case po.BACK:g.dss.stencilRefBack===_.reference&&g.dss.stencilReadMaskBack===_.compareMask||(v.stencilFuncSeparate(v.BACK,gN[g.dss.stencilFuncBack],_.reference,_.compareMask),g.dss.stencilRefBack=_.reference,g.dss.stencilReadMaskBack=_.compareMask);break;case po.ALL:g.dss.stencilRefFront===_.reference&&g.dss.stencilReadMaskFront===_.compareMask&&g.dss.stencilRefBack===_.reference&&g.dss.stencilReadMaskBack===_.compareMask||(v.stencilFunc(gN[g.dss.stencilFuncBack],_.reference,_.compareMask),g.dss.stencilRefFront=_.reference,g.dss.stencilReadMaskFront=_.compareMask,g.dss.stencilRefBack=_.reference,g.dss.stencilReadMaskBack=_.compareMask)}}}function DN(t,e){var i=t.gl,n=t.ANGLE_instanced_arrays,r=ON.gpuInputAssembler,a=ON.glPrimitive;if(r)if(r.gpuIndirectBuffer)for(var o=r.gpuIndirectBuffer.indirects.length,s=0;s<o;s++){var l=r.gpuIndirectBuffer.indirects[s],c=r.gpuIndexBuffer;if(l.instanceCount&&n)if(c){if(l.indexCount>0){var h=l.firstIndex*c.stride;n.drawElementsInstancedANGLE(a,l.indexCount,r.glIndexType,h,l.instanceCount)}}else l.vertexCount>0&&n.drawArraysInstancedANGLE(a,l.firstVertex,l.vertexCount,l.instanceCount);else if(c){if(l.indexCount>0){var u=l.firstIndex*c.stride;i.drawElements(a,l.indexCount,r.glIndexType,u)}}else l.vertexCount>0&&i.drawArrays(a,l.firstVertex,l.vertexCount)}else{var _=r.gpuIndexBuffer;if(e.instanceCount&&n)if(_){if(e.indexCount>0){var f=e.firstIndex*_.stride;n.drawElementsInstancedANGLE(a,e.indexCount,r.glIndexType,f,e.instanceCount)}}else e.vertexCount>0&&n.drawArraysInstancedANGLE(a,e.firstVertex,e.vertexCount,e.instanceCount);else if(_){if(e.indexCount>0){var d=e.firstIndex*_.stride;i.drawElements(a,e.indexCount,r.glIndexType,d)}}else e.vertexCount>0&&i.drawArrays(a,e.firstVertex,e.vertexCount)}}var NN=new Array(vN.COUNT);function LN(t,e){NN.fill(0);for(var i=0;i<e.cmds.length;++i){var n=e.cmds.array[i],r=NN[n]++;switch(n){case vN.BEGIN_RENDER_PASS:var a=e.beginRenderPassCmds.array[r];PN(t,a.gpuRenderPass,a.gpuFramebuffer,a.renderArea,a.clearColors,a.clearDepth,a.clearStencil);break;case vN.BIND_STATES:var o=e.bindStatesCmds.array[r];MN(t,o.gpuPipelineState,o.gpuInputAssembler,o.gpuDescriptorSets,o.dynamicOffsets,o.viewport,o.scissor,o.lineWidth,o.depthBias,o.blendConstants,o.depthBounds,o.stencilWriteMask,o.stencilCompareMask);break;case vN.DRAW:DN(t,e.drawCmds.array[r].drawInfo);break;case vN.UPDATE_BUFFER:var s=e.updateBufferCmds.array[r];IN(t,s.gpuBuffer,s.buffer,s.offset,s.size);break;case vN.COPY_BUFFER_TO_TEXTURE:var l=e.copyBufferToTextureCmds.array[r];BN(t,l.buffers,l.gpuTexture,l.regions)}}}function BN(t,e,i,n){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==i.glTexture&&(r.bindTexture(i.glTarget,i.glTexture),a.glTexture=i.glTexture);var o=0,s=1,l=1,c=0,h=xo[i.format].isCompressed;switch(i.glTarget){case r.TEXTURE_2D:for(var u=0;u<n.length;u++){var _=n[u];s=_.texExtent.width,l=_.texExtent.height;var f=e[o++];h?i.glInternalFmt===sN.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,i.glInternalFmt,s,l,0,f):r.compressedTexSubImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,s,l,i.glFormat,f):r.texSubImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,s,l,i.glFormat,i.glType,f)}break;case r.TEXTURE_CUBE_MAP:for(var d=0;d<n.length;d++){var p=n[d],m=p.texSubres.baseArrayLayer+p.texSubres.layerCount;for(c=p.texSubres.baseArrayLayer;c<m;++c){s=p.texExtent.width,l=p.texExtent.height;var v=e[o++];h?i.glInternalFmt===sN.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+c,p.texSubres.mipLevel,i.glInternalFmt,s,l,0,v):r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+c,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,l,i.glFormat,v):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+c,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,l,i.glFormat,i.glType,v)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&ao.GEN_MIPMAP&&r.generateMipmap(i.glTarget)}var FN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&Ga.INDIRECT&&(this._indirectBuffer=new Do),this._usage&Ga.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:[],glTarget:0,glBuffer:null},t.usage&Ga.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),this._usage&Ga.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var i=t.gl,n=t.stateCache,r=e.memUsage&Ha.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;if(e.usage&Ga.VERTEX){e.glTarget=i.ARRAY_BUFFER;var a=i.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.useVAO&&n.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=ON.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),i.bufferData(i.ARRAY_BUFFER,e.size,r),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&Ga.INDEX){e.glTarget=i.ELEMENT_ARRAY_BUFFER;var o=i.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.useVAO&&n.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=ON.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,r),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&Ga.UNIFORM?(e.glTarget=i.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&Ga.INDIRECT||e.usage&Ga.TRANSFER_DST||e.usage&Ga.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},i.destroy=function(){var t,e;this._gpuBuffer&&(t=this._device,(e=this._gpuBuffer).glBuffer&&(t.gl.deleteBuffer(e.glBuffer),e.glBuffer=null),this._device.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},i.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;e!==t&&(this._size=t,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=t,t>0&&(function(t,e){var i=t.gl,n=t.stateCache,r=e.memUsage&Ha.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;e.usage&Ga.VERTEX?(t.useVAO&&n.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=ON.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),e.buffer?i.bufferData(i.ARRAY_BUFFER,e.buffer,r):i.bufferData(i.ARRAY_BUFFER,e.size,r),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null):e.usage&Ga.INDEX?(t.useVAO&&n.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=ON.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.buffer,r):i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,r),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&Ga.UNIFORM?e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer)):(e.usage&Ga.INDIRECT||e.usage&Ga.TRANSFER_DST||e.usage&Ga.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize-=e,this._device.memoryStatus.bufferSize+=t)))}},i.update=function(t,e){var i;this._isBufferView?console.warn("cannot update through buffer views!"):(i=void 0!==e?e:this._usage&Ga.INDIRECT?0:t.byteLength,IN(this._device,this._gpuBuffer,t,0,i))},q(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(Bo),zN=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new f_(e);for(var i=0;i<e;++i)this._frees[i]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,i=this._frees;this._frees=new Array(e);for(var n=e-i.length,r=0;r<n;++r)this._frees[r]=new t;for(var a=n,o=0;a<e;++a,++o)this._frees[a]=i[o];this._freeIdx+=n}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),UN=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new zN(AN,1),this.bindStatesCmdPool=new zN(bN,1),this.drawCmdPool=new zN(xN,1),this.updateBufferCmdPool=new zN(CN,1),this.copyBufferToTextureCmdPool=new zN(wN,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),kN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).cmdPackage=new RN,e._webGLAllocator=null,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=[],e._curViewport=null,e._curScissor=null,e._curLineWidth=null,e._curDepthBias=null,e._curBlendConstants=[],e._curDepthBounds=null,e._curStencilWriteMask=null,e._curStencilCompareMask=null,e._isStateInvalied=!1,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._type=t.type,this._queue=t.queue,this._webGLAllocator=this._device.cmdAllocator;for(var e=this._device.bindingMappingInfo.bufferOffsets.length,i=0;i<e;i++)this._curGPUDescriptorSets.push(null),this._curDynamicOffsets.push([]);return!0},i.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},i.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0;for(var t=0;t<this._curDynamicOffsets.length;t++)this._curDynamicOffsets[t].length=0;this._curViewport=null,this._curScissor=null,this._curLineWidth=null,this._curDepthBias=null,this._curBlendConstants.length=0,this._curDepthBounds=null,this._curStencilWriteMask=null,this._curStencilCompareMask=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},i.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},i.beginRenderPass=function(t,e,i,n,r,a){var o=this._webGLAllocator.beginRenderPassCmdPool.alloc(AN);o.gpuRenderPass=t.gpuRenderPass,o.gpuFramebuffer=e.gpuFramebuffer,o.renderArea=i,o.clearColors.length=n.length;for(var s=0;s<n.length;++s)o.clearColors[s]=n[s];o.clearDepth=r,o.clearStencil=a,this.cmdPackage.beginRenderPassCmds.push(o),this.cmdPackage.cmds.push(vN.BEGIN_RENDER_PASS),this._isInRenderPass=!0},i.endRenderPass=function(){this._isInRenderPass=!1},i.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},i.bindDescriptorSet=function(t,e,i){var n=e.gpuDescriptorSet;if(n!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=n,this._isStateInvalied=!0),i){for(var r=this._curDynamicOffsets[t],a=0;a<i.length;a++)r[a]=i[a];r.length=i.length,this._isStateInvalied=!0}},i.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},i.setViewport=function(t){this._curViewport?this._curViewport.left===t.left&&this._curViewport.top===t.top&&this._curViewport.width===t.width&&this._curViewport.height===t.height&&this._curViewport.minDepth===t.minDepth&&this._curViewport.maxDepth===t.maxDepth||(this._curViewport.left=t.left,this._curViewport.top=t.top,this._curViewport.width=t.width,this._curViewport.height=t.height,this._curViewport.minDepth=t.minDepth,this._curViewport.maxDepth=t.maxDepth,this._isStateInvalied=!0):this._curViewport=new Qo(t.left,t.top,t.width,t.height,t.minDepth,t.maxDepth)},i.setScissor=function(t){this._curScissor?this._curScissor.x===t.x&&this._curScissor.y===t.y&&this._curScissor.width===t.width&&this._curScissor.height===t.height||(this._curScissor.x=t.x,this._curScissor.y=t.y,this._curScissor.width=t.width,this._curScissor.height=t.height,this._isStateInvalied=!0):this._curScissor=new Zo(t.x,t.y,t.width,t.height)},i.setLineWidth=function(t){this._curLineWidth!==t&&(this._curLineWidth=t,this._isStateInvalied=!0)},i.setDepthBias=function(t,e,i){this._curDepthBias?this._curDepthBias.constantFactor===t&&this._curDepthBias.clamp===e&&this._curDepthBias.slopeFactor===i||(this._curDepthBias.constantFactor=t,this._curDepthBias.clamp=e,this._curDepthBias.slopeFactor=i,this._isStateInvalied=!0):(this._curDepthBias={constantFactor:t,clamp:e,slopeFactor:i},this._isStateInvalied=!0)},i.setBlendConstants=function(t){4!==t.length||this._curBlendConstants[0]===t[0]&&this._curBlendConstants[1]===t[1]&&this._curBlendConstants[2]===t[2]&&this._curBlendConstants[3]===t[3]||(this._curBlendConstants.length=0,Array.prototype.push.apply(this._curBlendConstants,t),this._isStateInvalied=!0)},i.setDepthBound=function(t,e){this._curDepthBounds&&this._curDepthBounds.minBounds===t&&this._curDepthBounds.maxBounds===e||(this._curDepthBounds={minBounds:t,maxBounds:e},this._isStateInvalied=!0)},i.setStencilWriteMask=function(t,e){this._curStencilWriteMask?this._curStencilWriteMask.face===t&&this._curStencilWriteMask.writeMask===e||(this._curStencilWriteMask.face=t,this._curStencilWriteMask.writeMask=e,this._isStateInvalied=!0):(this._curStencilWriteMask={face:t,writeMask:e},this._isStateInvalied=!0)},i.setStencilCompareMask=function(t,e,i){this._curStencilCompareMask?this._curStencilCompareMask.face===t&&this._curStencilCompareMask.reference===e&&this._curStencilCompareMask.compareMask===i||(this._curStencilCompareMask.face=t,this._curStencilCompareMask.reference=e,this._curStencilCompareMask.compareMask=i,this._isStateInvalied=!0):(this._curStencilCompareMask={face:t,reference:e,compareMask:i},this._isStateInvalied=!0)},i.draw=function(t){if(this._type===lo.PRIMARY&&this._isInRenderPass||this._type===lo.SECONDARY){this._isStateInvalied&&this.bindStates();var e=this._webGLAllocator.drawCmdPool.alloc(xN);e.drawInfo.vertexCount=t.vertexCount,e.drawInfo.firstVertex=t.firstVertex,e.drawInfo.indexCount=t.indexCount,e.drawInfo.firstIndex=t.firstIndex,e.drawInfo.vertexOffset=t.vertexOffset,e.drawInfo.instanceCount=t.instanceCount,e.drawInfo.firstInstance=t.firstInstance,this.cmdPackage.drawCmds.push(e),this.cmdPackage.cmds.push(vN.DRAW),++this._numDrawCalls,this._numInstances+=t.instanceCount;var i=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._type===lo.PRIMARY&&!this._isInRenderPass||this._type===lo.SECONDARY){var n=t.gpuBuffer;if(n){var r,a=this._webGLAllocator.updateBufferCmdPool.alloc(CN),o=0;t.usage&Ga.INDIRECT||(o=void 0!==i?i:e.byteLength),r=e,a.gpuBuffer=n,a.buffer=r,a.offset=0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(vN.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},i.copyBuffersToTexture=function(t,e,i){if(this._type===lo.PRIMARY&&!this._isInRenderPass||this._type===lo.SECONDARY){var n=e.gpuTexture;if(n){var r=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(wN);r&&(r.gpuTexture=n,r.regions=i,r.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(vN.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},i.execute=function(t,e){for(var i=0;i<e;++i){for(var n=t[i],r=0;r<n.cmdPackage.beginRenderPassCmds.length;++r){var a=n.cmdPackage.beginRenderPassCmds.array[r];++a.refCount,this.cmdPackage.beginRenderPassCmds.push(a)}for(var o=0;o<n.cmdPackage.bindStatesCmds.length;++o){var s=n.cmdPackage.bindStatesCmds.array[o];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var l=0;l<n.cmdPackage.drawCmds.length;++l){var c=n.cmdPackage.drawCmds.array[l];++c.refCount,this.cmdPackage.drawCmds.push(c)}for(var h=0;h<n.cmdPackage.updateBufferCmds.length;++h){var u=n.cmdPackage.updateBufferCmds.array[h];++u.refCount,this.cmdPackage.updateBufferCmds.push(u)}for(var _=0;_<n.cmdPackage.copyBufferToTextureCmds.length;++_){var f=n.cmdPackage.copyBufferToTextureCmds.array[_];++f.refCount,this.cmdPackage.copyBufferToTextureCmds.push(f)}this.cmdPackage.cmds.concat(n.cmdPackage.cmds.array),this._numDrawCalls+=n._numDrawCalls,this._numInstances+=n._numInstances,this._numTris+=n._numTris}},i.bindStates=function(){var t=this._webGLAllocator.bindStatesCmdPool.alloc(bN);if(t){t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets);for(var e=0;e<this._curDynamicOffsets.length;e++)Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets[e]);t.gpuInputAssembler=this._curGPUInputAssembler,t.viewport=this._curViewport,t.scissor=this._curScissor,t.lineWidth=this._curLineWidth,t.depthBias=this._curDepthBias,Array.prototype.push.apply(t.blendConstants,this._curBlendConstants),t.depthBounds=this._curDepthBounds,t.stencilWriteMask=this._curStencilWriteMask,t.stencilCompareMask=this._curStencilCompareMask,this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(vN.BIND_STATES),this._isStateInvalied=!1}},q(e,[{key:"webGLDevice",get:function(){return this._device}}]),e}(zo),GN=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.initialize=function(){return!0},i.destroy=function(){},i.wait=function(){},i.reset=function(){},e}(Hs),HN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuFramebuffer=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null,0!==t.depStencilMipmapLevel&&console.warn("The mipmap level of th texture image to be attached of depth stencil attachment should be 0. Convert to 0.");for(var e=0;e<t.colorMipmapLevels.length;++e)0!==t.colorMipmapLevels[e]&&console.warn("The mipmap level of th texture image to be attached of color attachment "+e+" should be 0. Convert to 0.");for(var i=[],n=0;n<t.colorTextures.length;++n){var r=t.colorTextures[n];r&&i.push(r.gpuTexture)}var a=null;return t.depthStencilTexture&&(a=t.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:i,gpuDepthStencilTexture:a,glFramebuffer:null},function(t,e){if(e.gpuColorTextures.length||e.gpuDepthStencilTexture){var i=t.gl,n=[],r=i.createFramebuffer();if(r){e.glFramebuffer=r,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var a=0;a<e.gpuColorTextures.length;++a){var o=e.gpuColorTextures[a];o&&(o.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,o.glTarget,o.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,i.RENDERBUFFER,o.glRenderbuffer),n.push(i.COLOR_ATTACHMENT0+a))}var s=e.gpuDepthStencilTexture;if(s){var l=xo[s.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;s.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,s.glTarget,s.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,s.glRenderbuffer)}t.WEBGL_draw_buffers&&t.WEBGL_draw_buffers.drawBuffersWEBGL(n);var c=i.checkFramebufferStatus(i.FRAMEBUFFER);if(c!==i.FRAMEBUFFER_COMPLETE)switch(c){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},i.destroy=function(){var t,e;this._gpuFramebuffer&&(t=this._device,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),e.glFramebuffer=null),this._gpuFramebuffer=null)},q(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(Vo),VN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuInputAssembler=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){if(0===t.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var e=this._vertexBuffers[0];this._vertexCount=e.size/e.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var i=new Array(t.vertexBuffers.length),n=0;n<t.vertexBuffers.length;++n){var r=t.vertexBuffers[n];r.gpuBuffer&&(i[n]=r.gpuBuffer)}var a=null,o=0;if(t.indexBuffer&&(a=t.indexBuffer.gpuBuffer))switch(a.stride){case 1:o=5121;break;case 2:o=5123;break;case 4:o=5125;break;default:console.error("Error index buffer stride.")}var s=null;return t.indirectBuffer&&(s=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:i,gpuIndexBuffer:a,gpuIndirectBuffer:s,glAttribs:[],glIndexType:o,glVAOs:new Map},function(t,e){var i=t.gl;e.glAttribs=new Array(e.attributes.length);for(var n=[0,0,0,0,0,0,0,0],r=0;r<e.attributes.length;++r){var a=e.attributes[r],o=void 0!==a.stream?a.stream:0,s=e.gpuVertexBuffers[o],l=cN(a.format,i),c=xo[a.format].size;e.glAttribs[r]={name:a.name,glBuffer:s.glBuffer,glType:l,size:c,count:xo[a.format].count,stride:s.stride,componentCount:mN(l,i),isNormalized:void 0!==a.isNormalized&&a.isNormalized,isInstanced:void 0!==a.isInstanced&&a.isInstanced,offset:n[o]},n[o]+=c}}(this._device,this._gpuInputAssembler),!0},i.destroy=function(){var t=this._device;this._gpuInputAssembler&&t.useVAO&&function(t,e){for(var i=e.glVAOs.values(),n=i.next();!n.done;)t.OES_vertex_array_object.deleteVertexArrayOES(n.value),n=i.next();e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},q(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(Ko),WN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuDescriptorSetLayout=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,i=-1,n=[],r=0;r<this._bindings.length;r++){var a=this._bindings[r];n.push(e),e+=a.count,a.binding>i&&(i=a.binding)}this._bindingIndices=Array(i+1).fill(-1);for(var o=this._descriptorIndices=Array(i+1).fill(-1),s=0;s<this._bindings.length;s++){var l=this._bindings[s];this._bindingIndices[l.binding]=s,o[l.binding]=n[s]}for(var c=[],h=0;h<this._bindings.length;h++){var u=this._bindings[h];if(u.descriptorType&Fs)for(var _=0;_<u.count;_++)c.push(u.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:c,descriptorIndices:o,descriptorCount:e},!0},i.destroy=function(){this._bindings.length=0},q(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(zs),jN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuPipelineLayout=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],i=[],n=0,r=0;r<this._setLayouts.length;r++){for(var a=this._setLayouts[r],o=a.gpuDescriptorSetLayout.dynamicBindings,s=Array(a.bindingIndices.length).fill(-1),l=0;l<o.length;l++){var c=o[l];s[c]<0&&(s[c]=n+l)}i.push(a.gpuDescriptorSetLayout),e.push(s),n+=o.length}return this._gpuPipelineLayout={gpuSetLayouts:i,dynamicOffsetIndices:e,dynamicOffsetCount:n},!0},i.destroy=function(){this._setLayouts.length=0},q(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(ks),qN=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],XN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuPipelineState=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var i=t.blendState,n=i.targets;n&&n.forEach((function(t,i){e.setTarget(i,t)})),void 0!==i.isA2C&&(e.isA2C=i.isA2C),void 0!==i.isIndepend&&(e.isIndepend=i.isIndepend),void 0!==i.blendColor&&(e.blendColor=i.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var r=[],a=0;a<31;a++)this._dynamicStates&1<<a&&r.push(1<<a);return this._gpuPipelineState={glPrimitive:qN[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:r},!0},i.destroy=function(){this._gpuPipelineState=null},q(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(hs),YN=[],KN=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.beginRenderPass=function(t,e,i,n,r,a){PN(this._device,t.gpuRenderPass,e.gpuFramebuffer,i,n,r,a),this._isInRenderPass=!0},i.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),DN(this._device,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var e=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=e/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(e-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var n,r=t.gpuBuffer;r&&(n=void 0!==i?i:t.usage&Ga.INDIRECT?0:e.byteLength,IN(this._device,r,e,0,n))}},i.copyBuffersToTexture=function(t,e,i){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var n=e.gpuTexture;n&&BN(this._device,t,n,i)}},i.execute=function(t,e){for(var i=0;i<e;++i){var n=t[i];LN(this._device,n.cmdPackage),this._numDrawCalls+=n._numDrawCalls,this._numInstances+=n._numInstances,this._numTris+=n._numTris}},i.bindStates=function(){YN.length=0;for(var t=0;t<this._curDynamicOffsets.length;t++)Array.prototype.push.apply(YN,this._curDynamicOffsets[t]);MN(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,YN,this._curViewport,this._curScissor,this._curLineWidth,this._curDepthBias,this._curBlendConstants,this._curDepthBounds,this._curStencilWriteMask,this._curStencilCompareMask),this._isStateInvalied=!1},e}(kN),ZN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){return this._type=t.type,!0},i.destroy=function(){},i.submit=function(t){if(!this._isAsync)for(var e=t.length,i=0;i<e;i++){var n=t[i];this.numDrawCalls+=n.numDrawCalls,this.numInstances+=n.numInstances,this.numTris+=n.numTris}},i.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(_s),QN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuRenderPass=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){return this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,t.subPasses&&(this._subPasses=t.subPasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},i.destroy=function(){this._gpuRenderPass=null},q(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(vs),JN=[10497,33648,33071,33071],$N=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuSampler=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._minFilter=t.minFilter,this._magFilter=t.magFilter,this._mipFilter=t.mipFilter,this._addressU=t.addressU,this._addressV=t.addressV,this._addressW=t.addressW,this._maxAnisotropy=t.maxAnisotropy,this._cmpFunc=t.cmpFunc,this._borderColor=t.borderColor,this._minLOD=t.minLOD,this._maxLOD=t.maxLOD,this._mipLODBias=t.mipLODBias;var e,i,n=this._minFilter,r=this._magFilter,a=this._mipFilter;e=n===to.LINEAR||n===to.ANISOTROPIC?a===to.LINEAR||a===to.ANISOTROPIC?9987:a===to.POINT?9985:9729:a===to.LINEAR||a===to.ANISOTROPIC?9986:a===to.POINT?9984:9728,i=r===to.LINEAR||r===to.ANISOTROPIC?9729:9728;var o=JN[this._addressU],s=JN[this._addressV],l=JN[this._addressW];return this._gpuSampler={glMinFilter:e,glMagFilter:i,glWrapS:o,glWrapT:s,glWrapR:l},!0},i.destroy=function(){this._gpuSampler=null},q(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(ys),tL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuShader=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks,samplers:t.samplers,gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplers:[]};for(var e=0;e<t.stages.length;++e){var i=t.stages[e];this._gpuShader.gpuStages[e]={type:i.stage,source:i.source,glShader:null}}return function(t,e){for(var i=t.gl,n=function(t){var n=e.gpuStages[t],r=0,a="",o=1;switch(n.type){case oo.VERTEX:a="VertexShader",r=i.VERTEX_SHADER;break;case oo.FRAGMENT:a="FragmentShader",r=i.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=i.createShader(r);if(s&&(n.glShader=s,i.shaderSource(n.glShader,n.source),i.compileShader(n.glShader),!i.getShaderParameter(n.glShader,i.COMPILE_STATUS))){console.error(a+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",n.source.replace(/^|\n/g,(function(){return"\n"+o+++" "}))),console.error(i.getShaderInfoLog(n.glShader));for(var l=0;l<e.gpuStages.length;l++){var c=e.gpuStages[t];c.glShader&&(i.deleteShader(c.glShader),c.glShader=null)}return{v:void 0}}},r=0;r<e.gpuStages.length;r++){var a=n(r);if("object"==typeof a)return a.v}var o=i.createProgram();if(o){e.glProgram=o;for(var s=0;s<e.gpuStages.length;s++){var l=e.gpuStages[s];i.attachShader(e.glProgram,l.glShader)}if(i.linkProgram(e.glProgram),t.destroyShadersImmediately)for(var c=0;c<e.gpuStages.length;c++){var h=e.gpuStages[c];h.glShader&&(i.detachShader(e.glProgram,h.glShader),i.deleteShader(h.glShader),h.glShader=null)}if(!i.getProgramParameter(e.glProgram,i.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(i.getProgramInfoLog(e.glProgram));console.info("Shader '"+e.name+"' compilation succeeded.");var u=i.getProgramParameter(e.glProgram,i.ACTIVE_ATTRIBUTES);e.glInputs=new Array(u);for(var _=0;_<u;++_){var f=i.getActiveAttrib(e.glProgram,_);if(f){var d,p=f.name.indexOf("[");d=-1!==p?f.name.substr(0,p):f.name;var m=i.getAttribLocation(e.glProgram,d),v=dN(f.type,i),g=pN(f.type,i);e.glInputs[_]={binding:m,name:d,type:v,stride:g,count:f.size,size:g*f.size,glType:f.type,glLoc:m}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var y=0;y<e.blocks.length;++y){var T=e.blocks[y],S={set:T.set,binding:T.binding,name:T.name,size:0,glUniforms:new Array(T.members.length),glActiveUniforms:[]};e.glBlocks[y]=S;for(var E=0;E<T.members.length;++E){var A=T.members[E],b=_N(A.type,i),x=fN(A.type),C=pN(b,i),w=C*A.count,R=S.size/4,I=new x(w/4);S.glUniforms[E]={binding:-1,name:A.name,type:A.type,stride:C,count:A.count,size:w,offset:S.size,glType:b,glLoc:-1,array:I,begin:R},S.size+=w}}}if(e.samplers.length>0){e.glSamplers=new Array(e.samplers.length);for(var O=0;O<e.samplers.length;++O){var P=e.samplers[O];e.glSamplers[O]={set:P.set,binding:P.binding,name:P.name,type:P.type,count:P.count,units:[],glUnits:null,glType:_N(P.type,i),glLoc:null}}}for(var M=i.getProgramParameter(e.glProgram,i.ACTIVE_UNIFORMS),D=0;D<M;++D){var N=i.getActiveUniform(e.glProgram,D);if(N&&N.type!==i.SAMPLER_2D&&N.type!==i.SAMPLER_CUBE){var L=i.getUniformLocation(e.glProgram,N.name);if(null!==L&&("number"==typeof L||-1!==L.id)){var B,F=N.name.indexOf("[");B=-1!==F?N.name.substr(0,F):N.name;for(var z=0;z<e.glBlocks.length;z++)for(var U=e.glBlocks[z],k=0;k<U.glUniforms.length;k++){var G=U.glUniforms[k];if(G.name===B){G.glLoc=L,U.glActiveUniforms.push(G);break}}}}}for(var H=[],V=[],W=t.bindingMappingInfo,j=t.stateCache.texUnitCacheMap,q=0,X=0;X<e.blocks.length;++X)e.blocks[X].set===W.flexibleSet&&q++;for(var Y=0,K=0;K<e.samplers.length;++K){var Z=e.samplers[K],Q=i.getUniformLocation(e.glProgram,Z.name);if(null===Q||"number"!=typeof Q&&-1===Q.id||(H.push(e.glSamplers[K]),V.push(Q)),void 0===j[Z.name]){var J=Z.binding+W.samplerOffsets[Z.set]+Y;Z.set===W.flexibleSet&&(J-=q),j[Z.name]=J%t.maxTextureUnits,Y+=Z.count-1}}if(H.length){for(var $=[],tt=0;tt<H.length;++tt){var et=H[tt],it=j[et.name];if(void 0!==it){et.glLoc=V[tt];for(var nt=0;nt<et.count;++nt){for(;$[it];)it=(it+1)%t.maxTextureUnits;et.units.push(it),$[it]=!0}}}for(var rt=0,at=0;at<H.length;++at){var ot=H[at];if(!ot.glLoc){ot.glLoc=V[at];for(var st=0;st<ot.count;++st){for(;$[rt];)rt=(rt+1)%t.maxTextureUnits;void 0===j[ot.name]&&(j[ot.name]=rt),ot.units.push(rt),$[rt]=!0}}}t.stateCache.glProgram!==e.glProgram&&i.useProgram(e.glProgram);for(var lt=0;lt<H.length;lt++){var ct=H[lt];ct.glUnits=new Int32Array(ct.units),i.uniform1iv(ct.glLoc,ct.glUnits)}t.stateCache.glProgram!==e.glProgram&&i.useProgram(t.stateCache.glProgram)}for(var ht=0;ht<e.glBlocks.length;)e.glBlocks[ht].glActiveUniforms.length?ht++:(e.glBlocks[ht]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplers=H}}(this._device,this._gpuShader),!0},i.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var i=t.gl;if(!t.destroyShadersImmediately)for(var n=0;n<e.gpuStages.length;n++){var r=e.gpuStages[n];r.glShader&&(i.detachShader(e.glProgram,r.glShader),i.deleteShader(r.glShader),r.glShader=null)}i.deleteProgram(e.glProgram),e.glProgram=null}}(this._device,this._gpuShader),this._gpuShader=null)},q(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(xs),eL=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new Qo,this.scissorRect=new Zo(0,0,0,0),this.rs=new rs,this.dss=new as,this.bs=new ss,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var i=0;i<t;++i)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),iL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._gpuTexture=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){return"texture"in t?(console.log("WebGL does not support texture view."),!1):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=Rs(this._width)&&Rs(this._height),this._size=wo(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._flags&ao.BAKUP_BUFFER&&(this._buffer=new ArrayBuffer(this._size)),this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(t,e){var i=t.gl;e.glInternalFmt=hN(e.format,i),e.glFormat=uN(e.format,i),e.glType=cN(e.format,i);var n=e.width,r=e.height;switch(e.type){case io.TEX2D:e.glTarget=i.TEXTURE_2D;var a=Math.max(n,r);if(a>t.maxTextureSize&&b(9100,a,t.maxTextureSize),!t.WEBGL_depth_texture&&xo[e.format].hasDepth){var o=i.createRenderbuffer();o&&e.size>0&&(e.glRenderbuffer=o,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),e.glInternalFmt===i.DEPTH_COMPONENT&&(e.glInternalFmt=i.DEPTH_COMPONENT16),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,n,r))}else if(e.samples===ro.X1){var s=i.createTexture();if(s&&e.size>0){e.glTexture=s;var l=t.stateCache.glTexUnits[t.stateCache.texUnit];if(l.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),l.glTexture=e.glTexture),xo[e.format].isCompressed)if(e.glInternalFmt!==sN.COMPRESSED_RGB_ETC1_WEBGL)for(var c=0;c<e.mipLevel;++c){var h=Co(e.format,n,r,1),u=new Uint8Array(h);i.compressedTexImage2D(i.TEXTURE_2D,c,e.glInternalFmt,n,r,0,u),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}else{var _=Co(e.format,2,2,1),f=new Uint8Array(_);i.compressedTexImage2D(i.TEXTURE_2D,0,e.glInternalFmt,2,2,0,f)}else for(var d=0;d<e.mipLevel;++d)i.texImage2D(i.TEXTURE_2D,d,e.glInternalFmt,n,r,0,e.glFormat,e.glType,null),n=Math.max(1,n>>1),r=Math.max(1,r>>1);e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}else i.deleteTexture(s)}break;case io.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var p=Math.max(n,r);p>t.maxCubeMapTextureSize&&b(9100,p,t.maxTextureSize);var m=i.createTexture();if(m&&e.size>0){e.glTexture=m;var v=t.stateCache.glTexUnits[t.stateCache.texUnit];if(v.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),v.glTexture=e.glTexture),xo[e.format].isCompressed)if(e.glInternalFmt!==sN.COMPRESSED_RGB_ETC1_WEBGL)for(var g=0;g<6;++g){n=e.width,r=e.height;for(var y=0;y<e.mipLevel;++y){var T=Co(e.format,n,r,1),S=new Uint8Array(T);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+g,y,e.glInternalFmt,n,r,0,S),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}}else for(var E=0;E<6;++E){var A=Co(e.format,2,2,1),x=new Uint8Array(A);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,e.glInternalFmt,2,2,0,x)}else for(var C=0;C<6;++C){n=e.width,r=e.height;for(var w=0;w<e.mipLevel;++w)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+C,w,e.glInternalFmt,n,r,0,e.glFormat,e.glType,null),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=io.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},i.destroy=function(){var t,e;this._gpuTexture&&(t=this._device,(e=this._gpuTexture).glTexture&&(t.gl.deleteTexture(e.glTexture),e.glTexture=null),e.glRenderbuffer&&(t.gl.deleteRenderbuffer(e.glRenderbuffer),e.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null),this._buffer=null},i.resize=function(t,e){var i=this._size;this._width=t,this._height=e,this._size=wo(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){var i=t.gl;e.glInternalFmt=hN(e.format,i),e.glFormat=uN(e.format,i),e.glType=cN(e.format,i);var n=e.width,r=e.height;switch(e.type){case io.TEX2D:e.glTarget=i.TEXTURE_2D;var a=Math.max(n,r);if(a>t.maxTextureSize&&b(9100,a,t.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,n,r);else if(e.glTexture){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),xo[e.format].isCompressed){if(e.glInternalFmt!==sN.COMPRESSED_RGB_ETC1_WEBGL)for(var s=0;s<e.mipLevel;++s){var l=Co(e.format,n,r,1),c=new Uint8Array(l);i.compressedTexImage2D(i.TEXTURE_2D,s,e.glInternalFmt,n,r,0,c),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}}else for(var h=0;h<e.mipLevel;++h)i.texImage2D(i.TEXTURE_2D,h,e.glInternalFmt,n,r,0,e.glFormat,e.glType,null),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}break;case io.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var u=Math.max(n,r);u>t.maxCubeMapTextureSize&&b(9100,u,t.maxTextureSize);var _=t.stateCache.glTexUnits[t.stateCache.texUnit];if(_.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),_.glTexture=e.glTexture),xo[e.format].isCompressed){if(e.glInternalFmt!==sN.COMPRESSED_RGB_ETC1_WEBGL)for(var f=0;f<6;++f){n=e.width,r=e.height;for(var d=0;d<e.mipLevel;++d){var p=Co(e.format,n,r,1),m=new Uint8Array(p);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+f,d,e.glInternalFmt,n,r,0,m),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}}}else for(var v=0;v<6;++v){n=e.width,r=e.height;for(var g=0;g<e.mipLevel;++g)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+v,g,e.glInternalFmt,n,r,0,e.glFormat,e.glType,null),n=Math.max(1,n>>1),r=Math.max(1,r>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=io.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=i,this._device.memoryStatus.textureSize+=this._size)},q(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(Is),nL=t("WebGLDevice",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).stateCache=new eL,e.cmdAllocator=new UN,e.nullTex2D=null,e.nullTexCube=null,e._webGLRC=null,e._isAntialias=!0,e._isPremultipliedAlpha=!0,e._useVAO=!1,e._destroyShadersImmediately=!0,e._noCompressedTexSubImage2D=!1,e._bindingMappingInfo=new Uo,e._webGLContextLostHandler=null,e._extensions=null,e._EXT_texture_filter_anisotropic=null,e._EXT_blend_minmax=null,e._EXT_frag_depth=null,e._EXT_shader_texture_lod=null,e._EXT_sRGB=null,e._OES_vertex_array_object=null,e._EXT_color_buffer_half_float=null,e._WEBGL_color_buffer_float=null,e._WEBGL_compressed_texture_etc1=null,e._WEBGL_compressed_texture_etc=null,e._WEBGL_compressed_texture_pvrtc=null,e._WEBGL_compressed_texture_astc=null,e._WEBGL_compressed_texture_s3tc=null,e._WEBGL_compressed_texture_s3tc_srgb=null,e._WEBGL_debug_shaders=null,e._WEBGL_draw_buffers=null,e._WEBGL_lose_context=null,e._WEBGL_depth_texture=null,e._WEBGL_debug_renderer_info=null,e._OES_texture_half_float=null,e._OES_texture_half_float_linear=null,e._OES_texture_float=null,e._OES_texture_float_linear=null,e._OES_standard_derivatives=null,e._OES_element_index_uint=null,e._ANGLE_instanced_arrays=null,e}Y(e,t);var i=e.prototype;return i.initialize=function(t){this._canvas=t.canvasElm,this._isAntialias=t.isAntialias,this._isPremultipliedAlpha=t.isPremultipliedAlpha,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var e={alpha:pe.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGLRC=this._canvas.getContext("webgl",e)}catch(t){return console.error(t),!1}if(!this._webGLRC)return console.error("This device does not support WebGL."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener("webglcontextlost",this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL device initialized."),this._gfxAPI=yo.WEBGL,this._deviceName="WebGL";var i=this._webGLRC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=i.getParameter(i.RENDERER),this._vendor=i.getParameter(i.VENDOR)),this._version=i.getParameter(i.VERSION),this._maxVertexAttributes=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._maxFragmentUniformVectors=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),this._maxTextureUnits=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextureUnits=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this._maxCubeMapTextureSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this._depthBits=i.getParameter(i.DEPTH_BITS),this._stencilBits=i.getParameter(i.STENCIL_BITS),this.stateCache.initialize(this._maxTextureUnits,this._maxVertexAttributes),this._devicePixelRatio=t.devicePixelRatio||1,this._width=this._canvas.width,this._height=this._canvas.height,this._nativeWidth=Math.max(t.nativeWidth||this._width,0),this._nativeHeight=Math.max(t.nativeHeight||this._height,0),this._colorFmt=ka.RGBA8,24===this._depthBits?8===this._stencilBits?this._depthStencilFmt=ka.D24S8:this._depthStencilFmt=ka.D24:8===this._stencilBits?this._depthStencilFmt=ka.D16S8:this._depthStencilFmt=ka.D16,this._extensions=i.getSupportedExtensions();var n="";if(this._extensions){for(var r,a=Q(this._extensions);!(r=a()).done;)n+=r.value+" ";console.debug("EXTENSIONS: "+n)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_blend_minmax=this.getExtension("EXT_blend_minmax"),this._EXT_frag_depth=this.getExtension("EXT_frag_depth"),this._EXT_shader_texture_lod=this.getExtension("EXT_shader_texture_lod"),this._EXT_sRGB=this.getExtension("EXT_sRGB"),this._OES_vertex_array_object=this.getExtension("OES_vertex_array_object"),this._EXT_color_buffer_half_float=this.getExtension("EXT_color_buffer_half_float"),this._WEBGL_color_buffer_float=this.getExtension("WEBGL_color_buffer_float"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_draw_buffers=this.getExtension("WEBGL_draw_buffers"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._WEBGL_depth_texture=this.getExtension("WEBGL_depth_texture"),this._OES_texture_half_float=this.getExtension("OES_texture_half_float"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._OES_texture_float=this.getExtension("OES_texture_float"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_standard_derivatives=this.getExtension("OES_standard_derivatives"),this._OES_element_index_uint=this.getExtension("OES_element_index_uint"),this._ANGLE_instanced_arrays=this.getExtension("ANGLE_instanced_arrays"),yv.os===yv.OS_IOS&&14===yv.osMainVersion&&yv.isBrowser||(this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc")),yv.browserType===yv.BROWSER_TYPE_UC&&(this._ANGLE_instanced_arrays=null),yv.os===yv.OS_IOS&&yv.osMainVersion<=10&&(this._destroyShadersImmediately=!1),this._features.fill(!1),this._EXT_blend_minmax&&(this._features[So.BLEND_MINMAX]=!0),this._WEBGL_color_buffer_float&&(this._features[So.COLOR_FLOAT]=!0),this._EXT_color_buffer_half_float&&(this._features[So.COLOR_HALF_FLOAT]=!0),this._OES_texture_float&&(this._features[So.TEXTURE_FLOAT]=!0),this._OES_texture_half_float&&(this._features[So.TEXTURE_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[So.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[So.TEXTURE_HALF_FLOAT_LINEAR]=!0),this._features[So.FORMAT_RGB8]=!0,this._WEBGL_depth_texture&&(this._features[So.FORMAT_D16]=!0,this._features[So.FORMAT_D24]=!0,this._features[So.FORMAT_D24S8]=!0),this._OES_element_index_uint&&(this._features[So.ELEMENT_INDEX_UINT]=!0),this._ANGLE_instanced_arrays&&(this._features[So.INSTANCED_ARRAYS]=!0),this._WEBGL_draw_buffers&&(this._features[So.MULTIPLE_RENDER_TARGETS]=!0);var o="";this._WEBGL_compressed_texture_etc1&&(this._features[So.FORMAT_ETC1]=!0,o+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[So.FORMAT_ETC2]=!0,o+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[So.FORMAT_DXT]=!0,o+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[So.FORMAT_PVRTC]=!0,o+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[So.FORMAT_ASTC]=!0,o+="astc "),this._OES_vertex_array_object&&(this._useVAO=!0),console.info("RENDERER: "+this._renderer),console.info("VENDOR: "+this._vendor),console.info("VERSION: "+this._version),console.info("DPR: "+this._devicePixelRatio),console.info("SCREEN_SIZE: "+this._width+" x "+this._height),console.info("NATIVE_SIZE: "+this._nativeWidth+" x "+this._nativeHeight),console.info("MAX_VERTEX_UNIFORM_VECTORS: "+this._maxVertexUniformVectors),console.info("DEPTH_BITS: "+this._depthBits),console.info("STENCIL_BITS: "+this._stencilBits),this._EXT_texture_filter_anisotropic&&console.info("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),console.info("USE_VAO: "+this._useVAO),console.info("COMPRESSED_FORMAT: "+o),this.initStates(i),this._queue=this.createQueue(new us(mo.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Fo(this._queue)),this.nullTex2D=this.createTexture(new Cs(io.TEX2D,no.SAMPLED,ka.RGBA8,2,2,ao.GEN_MIPMAP)),this.nullTexCube=this.createTexture(new Cs(io.TEX2D,no.SAMPLED,ka.RGBA8,2,2,ao.CUBEMAP|ao.GEN_MIPMAP,6));var s=new ns;s.texExtent.width=2,s.texExtent.height=2;var l=new Uint8Array(this.nullTex2D.size);return l.fill(0),this.copyBuffersToTexture([l],this.nullTex2D,[s]),s.texSubres.layerCount=6,this.copyBuffersToTexture([l,l,l,l,l,l],this.nullTexCube,[s]),!0},i.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener("webglcontextlost",this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGLRC=null},i.resize=function(t,e){this._width===t&&this._height===e||(console.info("Resizing device: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._width=t,this._height=e)},i.acquire=function(){this.cmdAllocator.releaseCmds()},i.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},i.createCommandBuffer=function(t){var e=new(t.type===lo.PRIMARY?KN:kN)(this);return e.initialize(t),e},i.createBuffer=function(t){var e=new FN(this);return e.initialize(t)?e:null},i.createTexture=function(t){var e=new iL(this);return e.initialize(t)?e:null},i.createSampler=function(t){var e=new $N(this);return e.initialize(t)?e:null},i.createDescriptorSet=function(t){var e=new lN(this);return e.initialize(t)?e:null},i.createShader=function(t){var e=new tL(this);return e.initialize(t)?e:null},i.createInputAssembler=function(t){var e=new VN(this);return e.initialize(t)?e:null},i.createRenderPass=function(t){var e=new QN(this);return e.initialize(t)?e:null},i.createFramebuffer=function(t){var e=new HN(this);return e.initialize(t)?e:null},i.createDescriptorSetLayout=function(t){var e=new WN(this);return e.initialize(t)?e:null},i.createPipelineLayout=function(t){var e=new jN(this);return e.initialize(t)?e:null},i.createPipelineState=function(t){var e=new XN(this);return e.initialize(t)?e:null},i.createFence=function(t){var e=new GN(this);return e.initialize(t)?e:null},i.createQueue=function(t){var e=new ZN(this);return e.initialize(t)?e:null},i.copyBuffersToTexture=function(t,e,i){BN(this,t,e.gpuTexture,i)},i.copyTexImagesToTexture=function(t,e,i){!function(t,e,i,n){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==i.glTexture&&(r.bindTexture(i.glTarget,i.glTexture),a.glTexture=i.glTexture);var o=0,s=0;switch(i.glTarget){case r.TEXTURE_2D:for(var l=0;l<n.length;l++){var c=n[l];r.texSubImage2D(r.TEXTURE_2D,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,i.glFormat,i.glType,e[o++])}break;case r.TEXTURE_CUBE_MAP:for(var h=0;h<n.length;h++){var u=n[h],_=u.texSubres.baseArrayLayer+u.texSubres.layerCount;for(s=u.texSubres.baseArrayLayer;s<_;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,u.texSubres.mipLevel,u.texOffset.x,u.texOffset.y,i.glFormat,i.glType,e[o++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&ao.GEN_MIPMAP&&i.isPowerOf2&&r.generateMipmap(i.glTarget)}(this,t,e.gpuTexture,i)},i.copyFramebufferToBuffer=function(t,e,i){var n=this._webGLRC,r=t.gpuFramebuffer,a=r.gpuColorTextures[0].format,o=uN(a,n),s=cN(a,n),l=Oo(xo[a]),c=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==r.glFramebuffer&&(n.bindFramebuffer(n.FRAMEBUFFER,r.glFramebuffer),this.stateCache.glFramebuffer=r.glFramebuffer);for(var h,u=new l(e),_=Q(i);!(h=_()).done;){var f=h.value,d=f.texExtent.width,p=f.texExtent.height;n.readPixels(f.texOffset.x,f.texOffset.y,d,p,o,s,u)}this.stateCache.glFramebuffer!==c&&(n.bindFramebuffer(n.FRAMEBUFFER,c),this.stateCache.glFramebuffer=c)},i.blitFramebuffer=function(){},i.getExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;++i){var n=this.gl.getExtension(e[i]+t);if(n)return n}return null},i.initStates=function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)},i._onWebGLContextLost=function(t){E(11e3),f(t)},q(e,[{key:"gl",get:function(){return this._webGLRC}},{key:"webGLQueue",get:function(){return this._queue}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"destroyShadersImmediately",get:function(){return this._destroyShadersImmediately}},{key:"noCompressedTexSubImage2D",get:function(){return this._noCompressedTexSubImage2D}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"EXT_blend_minmax",get:function(){return this._EXT_blend_minmax}},{key:"EXT_frag_depth",get:function(){return this._EXT_frag_depth}},{key:"EXT_shader_texture_lod",get:function(){return this._EXT_shader_texture_lod}},{key:"EXT_sRGB",get:function(){return this._EXT_sRGB}},{key:"OES_vertex_array_object",get:function(){return this._OES_vertex_array_object}},{key:"WEBGL_color_buffer_float",get:function(){return this._WEBGL_color_buffer_float}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_astc",get:function(){return this._WEBGL_compressed_texture_astc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_draw_buffers",get:function(){return this._WEBGL_draw_buffers}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}},{key:"WEBGL_depth_texture",get:function(){return this._WEBGL_depth_texture}},{key:"WEBGL_debug_renderer_info",get:function(){return this._WEBGL_debug_renderer_info}},{key:"OES_texture_half_float",get:function(){return this._OES_texture_half_float}},{key:"OES_texture_half_float_linear",get:function(){return this._OES_texture_half_float_linear}},{key:"OES_texture_float",get:function(){return this._OES_texture_float}},{key:"OES_standard_derivatives",get:function(){return this._OES_standard_derivatives}},{key:"OES_element_index_uint",get:function(){return this._OES_element_index_uint}},{key:"ANGLE_instanced_arrays",get:function(){return this._ANGLE_instanced_arrays}}]),e}(Go));n.WebGLDevice=nL;var rL=new Ri,aL=new Vi;function oL(t,e,i,n){var r=i.data,a=e.acquireBufferBatch(),o=a.byteOffset>>2,s=i.vertexCount,l=a.indicesOffset,c=a.vertexOffset;a.request(s,i.indicesCount)||(a=e.currBufferBatch,s=0,l=0,c=0);var h=a.vData,u=a.iData;t.getWorldMatrix(aL);for(var _=0;_<s;_++){var f=r[_];Ri.set(rL,f.x,f.y,0),Ri.transformMat4(rL,rL,aL),h[o++]=rL.x,h[o++]=rL.y,h[o++]=rL.z,h[o++]=f.u,h[o++]=f.v,Ci.toArray(h,n,o),o+=4}for(var d=0,p=s/4;d<p;d++){var m=c+4*d;u[l++]=m,u[l++]=m+1,u[l++]=m+2,u[l++]=m+1,u[l++]=m+3,u[l++]=m+2}}var sL=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var i=new lL;i.initWithSize(t,e),this._texture=i,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,i=t.texture,r=this._innerTextureInfos[i.getId()],a=e.x,o=e.y;if(r)a+=r.x,o+=r.y;else{var s=i.width,l=i.height;if(this._x+s+2>this._width&&(this._x=2,this._y=this._nexty),this._y+l+2>this._nexty&&(this._nexty=this._y+l+2),this._nexty>this._height)return null;n.internal.dynamicAtlasManager.textureBleeding&&((s<=8||l<=8)&&(this._texture.drawTextureAt(i.image,this._x-1,this._y-1),this._texture.drawTextureAt(i.image,this._x-1,this._y+1),this._texture.drawTextureAt(i.image,this._x+1,this._y-1),this._texture.drawTextureAt(i.image,this._x+1,this._y+1)),this._texture.drawTextureAt(i.image,this._x-1,this._y),this._texture.drawTextureAt(i.image,this._x+1,this._y),this._texture.drawTextureAt(i.image,this._x,this._y-1),this._texture.drawTextureAt(i.image,this._x,this._y+1)),this._texture.drawTextureAt(i.image,this._x,this._y),this._innerTextureInfos[i.getId()]={x:this._x,y:this._y,texture:i},this._count++,a+=this._x,o+=this._y,this._x+=s+2}var c={x:a,y:o,texture:this._texture};return this._innerSpriteFrames.push(t),c},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var n=t[e];n.isValid&&n._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),lL=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=D_.RGBA8888),this.reset({width:t,height:e,format:i}),this.loaded=!0,this.emit("load")},i.drawTextureAt=function(t,e,i){var n=this.getGFXTexture();if(t&&n){var r=this._getGFXDevice();if(r){var a=new ns;a.texOffset.x=e,a.texOffset.y=i,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],n,[a])}else console.warn("Unable to get device")}},e}(yd),cL=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new sL(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=this._atlases[this._atlasIndex];e||(e=this.newAtlas());var i=e.insertSpriteFrame(t);return i||this._atlasIndex===this._maxAtlasCount?i:(e=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){var e=t._original._texture;this.deleteAtlasTexture(e)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(!e._original&&e.packable){var i=this.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}},q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),n.director.on(n.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):n.director.off(n.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();cL.instance=void 0;var hL,uL=t("dynamicAtlasManager",cL.instance=new cL);n.internal.dynamicAtlasManager=uL;var _L,fL,dL,pL,mL=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],vL=t("SpriteFrame",ru("cc.SpriteFrame")(hL=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.uvHash=0,e.unbiasUV=[],e.uvSliced=[],e._rect=new nn,e._offset=new Xi,e._originalSize=new tn,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}Y(e,t),e.createWithImage=function(t){var i=t instanceof V_?t:new V_(t),n=new yd;n.image=i;var r=new e;return r.texture=n,r},q(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?this.reset({texture:t},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]);var i=e.prototype;return i.textureLoaded=function(){return this.texture&&this.texture.loaded},i.isRotated=function(){return this._rotated},i.setRotated=function(t){this.rotated=t},i.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},i.setRect=function(t){this.rect=t},i.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},i.setOriginalSize=function(t){this.originalSize=t},i.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},i.setOffset=function(t){this.offset=t},i.getGFXTexture=function(){return this._texture.getGFXTexture()},i.getGFXSampler=function(){return this._texture.getGFXSampler()},i.getHash=function(){return this._texture.getHash()},i.getSamplerHash=function(){return this._texture.getSamplerHash()},i.reset=function(t,e){void 0===e&&(e=!1);var i=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,i=!0),t&&(t.texture&&(this.loaded=!1,this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),i=!0),i&&this.texture&&this._calculateUV()},i.checkRect=function(t){var e=this._rect,i=e.x,n=e.y;return this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.width?(b(3300,this.name+"/"+t.name,i,t.width),!1):!(n>t.height&&(b(3301,this.name+"/"+t.name,n,t.height),1))},i.onLoaded=function(){this.loaded=!0,this.emit("load")},i.destroy=function(){return this._packable&&uL&&uL.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},i._calculateSlicedUV=function(){var t=this._rect,e=this.texture,i=e.width,n=e.height,r=this._capInsets[0],a=this._capInsets[2],o=t.width-r-a,s=this._capInsets[1],l=this._capInsets[3],c=t.height-s-l,h=this.uvSliced;if(h.length=0,this._rotated){mL[0].u=t.x/i,mL[1].u=(t.x+l)/i,mL[2].u=(t.x+l+c)/i,mL[3].u=(t.x+t.height)/i,mL[3].v=t.y/n,mL[2].v=(t.y+r)/n,mL[1].v=(t.y+r+o)/n,mL[0].v=(t.y+t.width)/n;for(var u=0;u<4;++u)for(var _=mL[u],f=0;f<4;++f){var d=mL[3-f];h.push({u:_.u,v:d.v})}}else{mL[0].u=t.x/i,mL[1].u=(t.x+r)/i,mL[2].u=(t.x+r+o)/i,mL[3].u=(t.x+t.width)/i,mL[3].v=t.y/n,mL[2].v=(t.y+s)/n,mL[1].v=(t.y+s+c)/n,mL[0].v=(t.y+t.height)/n;for(var p=0;p<4;++p)for(var m=mL[p],v=0;v<4;++v){var g=mL[v];h.push({u:g.u,v:m.v})}}},i._calculateUV=function(){var t=this._rect,e=this.uv,i=this.unbiasUV,n=this.texture,r=n.width,a=n.height;if(this._rotated){var o=0===r?0:t.x/r,s=0===r?0:(t.x+t.height)/r,l=0===a?0:t.y/a,c=0===a?0:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=s,e[1]=c,e[2]=s,e[3]=l,e[4]=o,e[5]=c,e[6]=o,e[7]=l):this._isFlipUVX?(e[0]=s,e[1]=l,e[2]=s,e[3]=c,e[4]=o,e[5]=l,e[6]=o,e[7]=c):this._isFlipUVY?(e[0]=o,e[1]=c,e[2]=o,e[3]=l,e[4]=s,e[5]=c,e[6]=s,e[7]=l):(e[0]=o,e[1]=l,e[2]=o,e[3]=c,e[4]=s,e[5]=l,e[6]=s,e[7]=c);var h=0===r?0:t.x/r,u=0===r?0:(t.x+t.height)/r,_=0===a?0:t.y/a,f=0===a?0:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(i[0]=u,i[1]=f,i[2]=u,i[3]=_,i[4]=h,i[5]=f,i[6]=h,i[7]=_):this._isFlipUVX?(i[0]=u,i[1]=_,i[2]=u,i[3]=f,i[4]=h,i[5]=_,i[6]=h,i[7]=f):this._isFlipUVY?(i[0]=h,i[1]=f,i[2]=h,i[3]=_,i[4]=u,i[5]=f,i[6]=u,i[7]=_):(i[0]=h,i[1]=_,i[2]=h,i[3]=f,i[4]=u,i[5]=_,i[6]=u,i[7]=f)}else{var d=0===r?0:t.x/r,p=0===r?0:(t.x+t.width)/r,m=0===a?0:(t.y+t.height)/a,v=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=p,e[1]=v,e[2]=d,e[3]=v,e[4]=p,e[5]=m,e[6]=d,e[7]=m):this._isFlipUVX?(e[0]=p,e[1]=m,e[2]=d,e[3]=m,e[4]=p,e[5]=v,e[6]=d,e[7]=v):this._isFlipUVY?(e[0]=d,e[1]=v,e[2]=p,e[3]=v,e[4]=d,e[5]=m,e[6]=p,e[7]=m):(e[0]=d,e[1]=m,e[2]=p,e[3]=m,e[4]=d,e[5]=v,e[6]=p,e[7]=v);var g=0===r?0:t.x/r,y=0===r?0:(t.x+t.width)/r,T=0===a?0:(t.y+t.height)/a,S=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(i[0]=y,i[1]=S,i[2]=g,i[3]=S,i[4]=y,i[5]=T,i[6]=g,i[7]=T):this._isFlipUVX?(i[0]=y,i[1]=T,i[2]=g,i[3]=T,i[4]=y,i[5]=S,i[6]=g,i[7]=S):this._isFlipUVY?(i[0]=g,i[1]=S,i[2]=y,i[3]=S,i[4]=g,i[5]=T,i[6]=y,i[7]=T):(i[0]=g,i[1]=T,i[2]=y,i[3]=T,i[4]=g,i[5]=S,i[6]=y,i[7]=S)}for(var E="",A=0;A<e.length;A++)E+=e[A];this.uvHash=qo(E,666);var b=this.vertices;if(b){b.nu.length=0,b.nv.length=0;for(var x=0;x<b.u.length;x++)b.nu[x]=b.u[x]/r,b.nv[x]=b.v[x]/a}this._calculateSlicedUV()},i._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},i._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},i._checkPackable=function(){var t=uL;if(t){var e=this._texture;if(e instanceof yd&&!e.isCompressed){var i=this.width,n=this.height;!e.image||i>t.maxFrameSize||n>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},i._serialize=function(){return null},i._deserialize=function(t){var e=t,i=e.rect;i&&(this._rect=new nn(i.x,i.y,i.width,i.height));var n=e.offset;e.offset&&(this._offset=new Xi(n.x,n.y));var r=e.originalSize;e.originalSize&&(this._originalSize=new tn(r.width,r.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var a=e.capInsets;a&&(this._capInsets[0]=a[0],this._capInsets[1]=a[1],this._capInsets[2]=a[2],this._capInsets[3]=a[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},i.clone=function(){var t,i,n,r,a,o,s,l,c=new e,h=this.vertices;return c.vertices=h?{x:h.x,y:h.y,triangles:h.triangles,nu:null===(t=h.nu)||void 0===t?void 0:t.slice(0),u:null===(i=h.u)||void 0===i?void 0:i.slice(0),nv:null===(n=h.nv)||void 0===n?void 0:n.slice(0),v:null===(r=h.v)||void 0===r?void 0:r.slice(0)}:null,(a=c.uv).splice.apply(a,[0,c.uv.length].concat(this.uv)),c.uvHash=this.uvHash,(o=c.unbiasUV).splice.apply(o,[0,c.unbiasUV.length].concat(this.unbiasUV)),(s=c.uvSliced).splice.apply(s,[0,c.uvSliced.length].concat(this.uvSliced)),c._rect.set(this._rect),c._offset.set(this._offset),c._originalSize.set(this._originalSize),c._rotated=this._rotated,(l=c._capInsets).splice.apply(l,[0,c._capInsets.length].concat(this._capInsets)),c._atlasUuid=this._atlasUuid,c._texture=this._texture,c._isFlipUVX=this._isFlipUVX,c._isFlipUVY=this._isFlipUVY,c},i._textureLoaded=function(){var t=this._texture,e={},i=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(t)||(e.rect=new nn(0,0,t.width,t.height),i=!0),(0===this._originalSize.width||0===this._originalSize.height||i)&&(e.originalSize=new tn(t.width,t.height),i=!0),i&&(this.reset(e),this.onLoaded()),this._checkPackable()},i._refreshTexture=function(t){this._texture=t,t.loaded?this._textureLoaded():t.once("load",this._textureLoaded,this)},e}(M_))||hL);n.SpriteFrame=vL;var gL,yL=t("SpriteAtlas",ru("cc.SpriteAtlas")((pL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"spriteFrames",dL,K(e)),e}Y(e,t);var i=e.prototype;return i.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},i.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},i.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,i=0,n=Object.keys(e);i<n.length;i++){var r=n[i];t.push(e[r])}return t},i._serialize=function(){},i._deserialize=function(t,e){var i=t;this._name=i.name;var n=i.spriteFrames;this.spriteFrames=Dt();for(var r=0;r<n.length;r+=2)e.result.push(this.spriteFrames,n[r],n[r+1])},e}(M_),dL=$((fL=pL).prototype,"spriteFrames",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dt()}}),_L=fL))||_L);n.SpriteAtlas=yL;var TL,SL,EL,AL,bL=t("Font",ru("cc.Font")(gL=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(M_))||gL);n.Font=bL;var xL,CL,wL,RL,IL,OL,PL,ML,DL,NL=t("TTFFont",ru("cc.TTFFont")((AL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_fontFamily",EL,K(e)),e}return Y(e,t),q(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:B(this._native),__isNative__:!0}}}]),e}(bL),EL=$((SL=AL).prototype,"_fontFamily",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(SL.prototype,"_nativeAsset",[zu,Bu],Object.getOwnPropertyDescriptor(SL.prototype,"_nativeAsset"),SL.prototype),$(SL.prototype,"_nativeDep",[zu],Object.getOwnPropertyDescriptor(SL.prototype,"_nativeDep"),SL.prototype),TL=SL))||TL);n.TTFFont=NL;var LL,BL=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},FL=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,i=Object.keys(this.letterDefinitions);e<i.length;e++){var n=i[e],r=new BL;Wt(r,this.letterDefinitions[n]),t[n]=r}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),zL=t("BitmapFont",(xL=ru("cc.BitmapFont"),CL=Fu(vL),xL((DL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"fntDataStr",IL,K(e)),J(e,"spriteFrame",OL,K(e)),J(e,"fontSize",PL,K(e)),J(e,"fntConfig",ML,K(e)),e}return Y(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new FL(t.texture));var e=this.fntConfig;if(e){var i=e.fontDefDictionary;for(var n in i){var r=new BL,a=i[n].rect;r.offsetX=i[n].xOffset,r.offsetY=i[n].yOffset,r.w=a.width,r.h=a.height,r.u=a.x,r.v=a.y,r.textureID=0,r.valid=!0,r.xAdvance=i[n].xAdvance,this.fontDefDictionary.addLetterDefinitions(n,r)}}else f("The fnt config is not exists!")},e}(bL),IL=$((RL=DL).prototype,"fntDataStr",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),OL=$(RL.prototype,"spriteFrame",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PL=$(RL.prototype,"fontSize",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),ML=$(RL.prototype,"fntConfig",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wL=RL))||wL));n.BitmapFont=zL;var UL=t("LabelAtlas",ru("cc.LabelAtlas")(LL=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(zL))||LL);n.LabelAtlas=UL;var kL=t("BASELINE_RATIO",.26),GL=t("MIDDLE_RATIO",(kL+1)/2-kL);var HL=new oe(2);HL.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var VL,WL=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var i=HL.get();if(i.key=t,i.value=e,this.count>=this.limit){var n=this.tail;delete this.datas[n.key],this.count--,this.tail=n.prev,this.tail.next=null,n.prev=null,n.next=null,HL.put(n)}this.moveToHead(i)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),jL=/([a-zA-Z0-9--]+|\S)/,qL=/^[!,.:;'}\]%\?>]/,XL=/([a-zA-Z0-9--]+|\S)$/,YL=/[a-zA-Z0-9--]+$/,KL=/^[a-zA-Z0-9--]/;function ZL(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function QL(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function JL(t,e,i){var n=(i||t.font)+""+e,r=WL.get(n);if(null!==r)return r;var a=t.measureText(e),o=a&&a.width||0;return WL.put(n,o),o}function $L(t,e,i){var n=e,r=i,a=t[e];if(a>="\udc00"&&a<="\udfff"&&n--,void 0!==i)if(i-1!==e){var o=t[i-1];o>="\ud800"&&o<="\udbff"&&r--}else a>="\ud800"&&a<="\udbff"&&r++;return t.substring(n,r)}function tB(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var a=t;e>i&&a.length>1;){for(var o=a.length*(i/e)|0,s=$L(a,o),l=e-n(s),c=s,h=0,u=0;l>i&&u++<10;)o*=i/l,l=e-n(s=$L(a,o|=0));for(u=0;l<=i&&u++<10;){if(s){var _=jL.exec(s);h=_?_[0].length:1,c=s}l=e-n(s=$L(a,o+=h))}0==(o-=h)?(o=1,c=$L(a,1)):1===o&&a[0]>="\ud800"&&a[0]<="\udbff"&&(o=2,c=$L(a,2));var f=$L(a,0,o),d=void 0;qL.test(c||s)&&(0==(o-=(d=XL.exec(f))?d[0].length:0)&&(o=1),c=$L(a,o),f=$L(a,0,o)),KL.test(c)&&(d=YL.exec(f))&&f!==d[0]&&(c=$L(a,o-=d[0].length),f=$L(a,0,o)),(0===r.length||(f=f.trim()).length>0)&&r.push(f),e=n(a=c||s)}return(0===r.length||(a=a.trim()).length>0)&&r.push(a),r}var eB,iB,nB,rB,aB,oB,sB,lB,cB,hB,uB,_B,fB,dB,pB,mB,vB,gB=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return VL||(VL=new t),VL};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i}}return t},e.put=function(t){this.pool.length>=pe.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),yB=Ci.WHITE.clone(),TB=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},SB="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",EB=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=gB.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=JL(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+kL)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*kL/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new V_),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,i=this.canvas.width,n=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,n),t.fillStyle=SB,t.fillRect(0,0,i,n),t.font=e.fontDesc;var r=e.fontSize,a=i/2,o=n/2+r*GL+0*r,s=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1)",e.isOutlined){var l=e.out||yB;t.strokeStyle="rgba("+l.r+", "+l.g+", "+l.b+", "+l.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,a,o)}t.fillText(this.char,a,o)}},t}(),AB=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=D_.RGBA8888),this.reset({width:t,height:e,format:i}),this.loaded=!0,this.emit("load")},i.drawTextureAt=function(t,e,i){var n=this.getGFXTexture();if(t&&n){var r=this._getGFXDevice();if(r){var a=new ns;a.texOffset.x=e,a.texOffset.y=i,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],n,[a])}else console.warn("Unable to get device")}},e}(yd),bB=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var i=new AB;i.initWithSize(t,e),this.fontDefDictionary=new FL(i),this._halfBleed=1,this._width=t,this._height=e,BR.on(LR.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,i=BR.root.device;if(!e||!this.fontDefDictionary||!i)return null;var n=e.width,r=e.height;if(this._x+n+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var a=new TB;return a.u=this._x+this._halfBleed,a.v=this._y+this._halfBleed,a.texture=this.fontDefDictionary.texture,a.valid=!0,a.w=t.width-2,a.h=t.height-2,a.xAdvance=a.w,a.offsetY=t.offsetY,this._x+=n+0,this.fontDefDictionary.addLetterDefinitions(t.hash,a),a},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new AB;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var i=t.charCodeAt(0)+e.hash,n=this.fontDefDictionary.letterDefinitions[i];if(!n){var r=new EB(t,e);r.updateRenderData(),n=this.insertLetterTexture(r),r.destroy()}return n},t}(),xB={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Ci.WHITE.clone(),isOutlined:!1,out:Ci.WHITE.clone(),margin:0},CB=function(){this.material=null,this.vertexCount=0,this.indicesCount=0},wB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).vData=null,e.uvDirty=!0,e.vertDirty=!0,e._data=[],e._indices=[],e._pivotX=0,e._pivotY=0,e._width=0,e._height=0,e}Y(e,t),e.add=function(){return OB.add()},e.remove=function(t){var e=OB.data.indexOf(t);-1!==e&&(OB.data[e].clear(),OB.removeAt(e))};var i=e.prototype;return i.updateSizeNPivot=function(t,e,i,n){t===this._width&&e===this._height&&i===this._pivotX&&n===this._pivotY||(this._width=t,this._height=e,this._pivotX=i,this._pivotY=n,this.vertDirty=!0)},i.clear=function(){this._data.length=0,this._indices.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.uvDirty=!0,this.vertDirty=!0,this.material=null,this.vertexCount=0,this.indicesCount=0},q(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var i=e.length,n=0;for(n=t;n<i;n++)IB.free(e[n]);for(n=i;n<t;n++)e[n]=IB.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(CB),RB=function(t){function e(e){var i;return void 0===e&&(e=9),(i=t.call(this)||this).vData=void 0,i.iData=void 0,i.vertexStart=0,i.indicesStart=0,i.byteStart=0,i.byteCount=0,i.lastFilledIndices=0,i.lastFilledVertex=0,i._formatByte=void 0,i._formatByte=e*Float32Array.BYTES_PER_ELEMENT,i.vData=new Float32Array(256*e*Float32Array.BYTES_PER_ELEMENT),i.iData=new Uint16Array(1536),i}Y(e,t),e.add=function(){return PB.add()},e.remove=function(t){var e=PB.data.indexOf(t);-1!==e&&(PB.data[e].reset(),PB.removeAt(e))};var i=e.prototype;return i.request=function(t,e){var i=this.byteCount+t*this._formatByte;return this.reserve(t,e),this.vertexCount+=t,this.indicesCount+=e,this.byteCount=i,!0},i.reserve=function(t,e){var i=this.byteCount+t*this._formatByte,n=this.indicesCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,a=this.iData.length,o=this.vData.length,s=this.iData.length;if(i>r||n>a){for(;r<i||a<n;)r=4*(o*=2),a=s*=2;this._reallocBuffer(o,s)}return!0},i.advance=function(t,e){this.vertexCount+=t,this.indicesCount+=e,this.byteCount+=t*this._formatByte},i.reset=function(){this.vertexCount=0,this.indicesCount=0,this.byteCount=0,this.vertexStart=0,this.indicesStart=0,this.byteStart=0,this.lastFilledIndices=0,this.lastFilledVertex=0},i._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),this.vData.set(i,0);var n=this.iData;this.iData=new Uint16Array(e),this.iData.set(n,0)},q(e,[{key:"formatByte",set:function(t){this._formatByte=t},get:function(){return this._formatByte}},{key:"floatStride",get:function(){return this._formatByte>>2}},{key:"vDataOffset",get:function(){return this.byteCount>>>2}}]),e}(CB),IB=(function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;i._fillQuadBuffer=function(){for(var t=this.iData.length/6,e=this.iData,i=0,n=0;i<t;i++){var r=4*i;e[n++]=r,e[n++]=r+1,e[n++]=r+2,e[n++]=r+1,e[n++]=r+3,e[n++]=r+2}},i._reallocBuffer=function(e,i){t.prototype._reallocBuffer.call(this,e,i),this._fillQuadBuffer()}}(RB),new u_((function(){return{x:0,y:0,z:0,u:0,v:0,color:Ci.WHITE.clone()}}),128)),OB=new __((function(){return new wB}),32),PB=new __((function(){return new RB}),32),MB=new Xi,DB=new Xi,NB=new Vi,LB=new Vi,BB=new Vi,FB=new Vi(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),zB=new nn,UB=function(e){return t({UITransform:e,UITransformComponent:e}),e}((eB=ru("cc.UITransform"),iB=gu(),nB=ou(110),rB=du(),aB=Ru(),oB=Eu(),sB=Ru(),lB=Eu(),cB=Eu(),eB(hB=iB(hB=nB(hB=rB(hB=su(hB=fu((mB=pB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_priority",_B,K(e)),J(e,"_contentSize",fB,K(e)),J(e,"_anchorPoint",dB,K(e)),e}Y(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiTransformComp=this},i.onEnable=function(){this.node.on(vS.PARENT_CHANGED,this._parentChanged,this),this._checkAndSortSiblings()&&this.node.parent._updateSiblingIndex()},i.onDisable=function(){this.node.off(vS.PARENT_CHANGED,this._parentChanged,this)},i.onDestroy=function(){this.node._uiProps.uiTransformComp=null},i.setContentSize=function(t,e){var i=this._contentSize;if(void 0===e){if((t=t).width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this.node.emit(vS.SIZE_CHANGED)},i.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if((t=t).x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(vS.ANCHOR_CHANGED,this._anchorPoint)},i.isHit=function(t,e){for(var i=this._contentSize.width,r=this._contentSize.height,a=MB,o=DB,s=this._getRenderScene().cameras,l=0;l<s.length;l++){var c=s[l];if(c.visibility&this.node.layer){c.node.getWorldRT(NB);var h=NB.m12,u=NB.m13,_=n.visibleRect.center;if(NB.m12=_.x-(NB.m00*h+NB.m04*u),NB.m13=_.y-(NB.m01*h+NB.m05*u),Vi.invert(NB,NB),Xi.transformMat4(a,t,NB),this.node.getWorldMatrix(BB),Vi.invert(NB,BB),!Vi.strictEquals(NB,FB)){Xi.transformMat4(o,a,NB),o.x+=this._anchorPoint.x*i,o.y+=this._anchorPoint.y*r;var f=!1;if(o.x>=0&&o.y>=0&&o.x<=i&&o.y<=r&&(f=!0,e&&e.mask))for(var d=e.mask,p=this.node,m=d?d.length:0,v=0,g=0;p&&g<m;++v,p=p.parent){var y=d[g];if(v===y.index){if(p!==y.comp.node){d.length=g;break}var T=y.comp;if(T&&T._enabled&&!T.isHit(a)){f=!1;break}g++}else if(v>y.index){d.length=g;break}}if(f)return!0}}}return!1},i.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(BB),Vi.invert(NB,BB),e||(e=new Ri),Ri.transformMat4(e,t,NB)},i.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(BB),e||(e=new Ri),Ri.transformMat4(e,t,BB)},i.getBoundingBox=function(){Vi.fromRTS(LB,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,i=new nn(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return i.transformMat4(LB),i},i.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(BB),this.getBoundingBoxTo(BB)):this.getBoundingBox()},i.getBoundingBoxTo=function(t){Vi.fromRTS(LB,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var i=this._contentSize.width,n=this._contentSize.height,r=new nn(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n);if(Vi.multiply(BB,t,LB),r.transformMat4(BB),!this.node.children)return r;for(var a,o=Q(this.node.children);!(a=o()).done;){var s=a.value;if(s&&s.active){var l=s.getComponent(e);if(l){var c=l.getBoundingBoxTo(t);c&&nn.union(r,r,c)}}}return r},i.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;zB.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),zB.transformMat4(this.node.worldMatrix);var n=zB.x+.5*zB.width,r=zB.y+.5*zB.height,a=this.node.worldPosition.z,o=zB.width/2,s=zB.height/2;return null!=t?(sc.set(t,n,r,a,o,s,.001),t):new sc(n,r,a,o,s,.001)},i._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this._checkAndSortSiblings()},i._checkAndSortSiblings=function(){var t=this.node.parent&&this.node.parent.children,e=!1;return t&&t.sort((function(t,i){var n=t._uiProps.uiTransformComp,r=i._uiProps.uiTransformComp,a=(n?n.priority:0)-(r?r.priority:0);return 0===a&&(a=t.getSiblingIndex()-i.getSiblingIndex()),e=a>0,a})),e},q(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(vS.SIZE_CHANGED))}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(vS.SIZE_CHANGED))}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(vS.SIZE_CHANGED))}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(vS.ANCHOR_CHANGED,this._anchorPoint))}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(vS.ANCHOR_CHANGED,this._anchorPoint))}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(vS.ANCHOR_CHANGED,this._anchorPoint))}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?E(6706):(this._priority=t,this._checkAndSortSiblings(),this.node.parent._updateSiblingIndex()))}},{key:"visibility",get:function(){var t=BR.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=BR.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}(Jf),pB.EventType=vS,$((uB=mB).prototype,"contentSize",[aB,oB],Object.getOwnPropertyDescriptor(uB.prototype,"contentSize"),uB.prototype),$(uB.prototype,"anchorPoint",[sB,lB],Object.getOwnPropertyDescriptor(uB.prototype,"anchorPoint"),uB.prototype),$(uB.prototype,"priority",[cB],Object.getOwnPropertyDescriptor(uB.prototype,"priority"),uB.prototype),_B=$(uB.prototype,"_priority",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fB=$(uB.prototype,"_contentSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tn(100,100)}}),dB=$(uB.prototype,"_anchorPoint",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(.5,.5)}}),hB=uB))||hB)||hB)||hB)||hB)||hB)||hB));!function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(vB||(vB={}));var kB,GB,HB,VB,WB,jB,qB,XB,YB,KB,ZB,QB,JB,$B,tF,eF,iF,nF,rF,aF,oF,sF,lF,cF,hF,uF,_F,fF=t("StencilManager",function(){function t(){this.stage=vB.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Ka.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Za.KEEP,zFailOp:Za.KEEP,passOp:Za.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){t.stencilStage=t.inverted?vB.CLEAR_INVERTED:vB.CLEAR},e.enterLevel=function(t){t.graphics.stencilStage=t.inverted?vB.ENTER_LEVEL_INVERTED:vB.ENTER_LEVEL},e.enableMask=function(){this.stage=vB.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=vB.DISABLED:this.stage=vB.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=vB.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var i=0,n=!1,r=!1,a=Ka.LESS,o=this.stencilStateMap;if(e&&e.passes[0]){var s=e.passes[0].depthStencilState,l=0,c=0;s.depthTest&&(l=1),s.depthWrite&&(c=1),i=l|c<<1|s.depthFunc<<2|t<<6|this._maskStack.length<<9,n=s.depthTest,r=s.depthWrite,a=s.depthFunc,o=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(o&&o.has(i))return o.get(i);this.setStateFromStage(t);var h=new as(n,r,a,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return o.set(i,h),h},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===vB.DISABLED?(e.stencilTest=!1,e.func=Ka.ALWAYS,e.failOp=Za.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===vB.ENABLED?(e.func=Ka.EQUAL,e.failOp=Za.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===vB.CLEAR?(e.func=Ka.NEVER,e.failOp=Za.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===vB.CLEAR_INVERTED||t===vB.ENTER_LEVEL?(e.func=Ka.NEVER,e.failOp=Za.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===vB.ENTER_LEVEL_INVERTED&&(e.func=Ka.NEVER,e.failOp=Za.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},q(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());fF.sharedManager=null,fF.sharedManager=new fF,fe(Ja),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(_F||(_F=t("InstanceMaterialType",{})));var dF,pF,mF,vF,gF,yF,TF,SF,EF,AF,bF,xF,CF,wF,RF,IF,OF,PF,MF,DF,NF,LF,BF,FF,zF,UF,kF,GF,HF,VF,WF,jF,qF,XF,YF,KF,ZF,QF,JF,$F,tz,ez,iz,nz,rz,az,oz,sz,lz,cz,hz,uz,_z,fz,dz,pz,mz,vz,gz,yz,Tz,Sz,Ez,Az,bz=function(e){return t({Renderable2D:e,RenderComponent:e,UIRenderable:e}),e}((kB=ru("cc.Renderable2D"),GB=au(UB),HB=Tu(),VB=Fu(nm),WB=Fu(nm),jB=Ru(),qB=Su(),XB=Tu(),YB=Fu(Ja),KB=Ru(),ZB=Eu(),QB=Tu(),JB=Fu(Ja),$B=Ru(),tF=Eu(),eF=Ru(),iF=Eu(),kB(nF=GB(nF=su(nF=fu((uF=hF=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_materials",aF,K(e)),J(e,"_customMaterial",oF,K(e)),e.stencilStage=vB.DISABLED,J(e,"_srcBlendFactor",sF,K(e)),J(e,"_dstBlendFactor",lF,K(e)),J(e,"_color",cF,K(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=_F.ADD_COLOR_AND_TEXTURE,e._blendState=new ss,e._blendHash=0,e._lastParent=null,e}Y(e,t);var i=e.prototype;return i.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc()},i.updateBlendHash=function(){var t=this._blendState.targets[0].blendDst<<4;this._blendHash=t|this._blendState.targets[0].blendSrc},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(vS.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(vS.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender()},i.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender()},i.onDisable=function(){this.node.off(vS.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(vS.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},i.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++)this._materialInstances[t].destroy();this._renderData=null,this._blendState&&this._blendState.destroy()},i.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t&&this._renderFlag){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else t||(this._renderDataFlag=t)},i.requestRenderData=function(){var t=wB.add();return this._renderData=t,t},i.destroyRenderData=function(){this._renderData&&(wB.remove(this._renderData),this._renderData=null)},i.updateAssembler=function(t){this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(t))},i.postUpdateAssembler=function(t){this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},i._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},i._postCanRender=function(){},i._updateColor=function(){this._assembler&&this._assembler.updateColor&&this._assembler.updateColor(this)},i._updateBlendFunc=function(){var t=this._blendState.targets[0];t||(t=new os,this._blendState.setTarget(0,t)),t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(t.blend=!0,t.blendDstAlpha=Ja.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor),this.updateBlendHash()},i.getBlendState=function(){return this._blendState},i._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i.markForUpdateRenderData()}},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case _F.ADD_COLOR:t=Zd.get("ui-base-material");break;case _F.GRAYSCALE:t=Zd.get("ui-sprite-gray-material");break;case _F.USE_ALPHA_SEPARATED:t=Zd.get("ui-sprite-alpha-sep-material");break;case _F.USE_ALPHA_SEPARATED_AND_GRAY:t=Zd.get("ui-sprite-gray-alpha-sep-material");break;default:t=Zd.get("ui-sprite-material")}return t},q(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&E(12001),this._srcBlendFactor},set:function(t){this._customMaterial?E(12001):this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&E(12001),this._dstBlendFactor},set:function(t){this._customMaterial?E(12001):this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"blendHash",get:function(){return this._blendHash}}]),e}(YP),hF.BlendState=Ja,hF.Assembler=null,hF.PostAssembler=null,aF=$((rF=uF).prototype,"_materials",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$(rF.prototype,"sharedMaterials",[zu,HB],Object.getOwnPropertyDescriptor(rF.prototype,"sharedMaterials"),rF.prototype),oF=$(rF.prototype,"_customMaterial",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(rF.prototype,"customMaterial",[WB,jB,qB],Object.getOwnPropertyDescriptor(rF.prototype,"customMaterial"),rF.prototype),$(rF.prototype,"srcBlendFactor",[XB,YB,KB,ZB],Object.getOwnPropertyDescriptor(rF.prototype,"srcBlendFactor"),rF.prototype),$(rF.prototype,"dstBlendFactor",[QB,JB,$B,tF],Object.getOwnPropertyDescriptor(rF.prototype,"dstBlendFactor"),rF.prototype),$(rF.prototype,"color",[eF,iF],Object.getOwnPropertyDescriptor(rF.prototype,"color"),rF.prototype),sF=$(rF.prototype,"_srcBlendFactor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ja.SRC_ALPHA}}),lF=$(rF.prototype,"_dstBlendFactor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ja.ONE_MINUS_SRC_ALPHA}}),cF=$(rF.prototype,"_color",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),nF=rF))||nF)||nF)||nF)||nF));n.internal.Renderable2D=bz,function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(Tz||(Tz=t("HorizontalTextAlignment",{}))),fe(Tz),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(Sz||(Sz=t("VerticalTextAlignment",{}))),fe(Sz),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(Ez||(Ez=t("Overflow",{}))),fe(Ez),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(Az||(Az=t("CacheMode",{}))),fe(Az);var xz,Cz,wz,Rz=function(e){return t({Label:e,LabelComponent:e}),e}((dF=ru("cc.Label"),pF=gu(),mF=ou(110),vF=du(),gF=Ru(),yF=Eu(),TF=Fu(Tz),SF=Ru(),EF=Eu(),AF=Fu(Sz),bF=Ru(),xF=Eu(),CF=Ru(),wF=Eu(),RF=Ru(),IF=Tu(),OF=Eu(),PF=Ru(),MF=Eu(),DF=Fu(Ez),NF=Ru(),LF=Eu(),BF=Ru(),FF=Eu(),zF=Fu(bL),UF=Ru(),kF=Tu(),GF=Eu(),HF=Ru(),VF=Eu(),WF=Fu(Az),jF=Ru(),qF=Eu(),XF=Ru(),YF=Eu(),KF=Ru(),ZF=Eu(),QF=Ru(),JF=Eu(),$F=Tu(),dF(tz=pF(tz=mF(tz=vF((yz=gz=function(t){function e(){var e;return J(e=t.call(this)||this,"_string",iz,K(e)),J(e,"_horizontalAlign",nz,K(e)),J(e,"_verticalAlign",rz,K(e)),J(e,"_actualFontSize",az,K(e)),J(e,"_fontSize",oz,K(e)),J(e,"_fontFamily",sz,K(e)),J(e,"_lineHeight",lz,K(e)),J(e,"_overflow",cz,K(e)),J(e,"_enableWrapText",hz,K(e)),J(e,"_font",uz,K(e)),J(e,"_isSystemFontUsed",_z,K(e)),e._spacingX=0,J(e,"_isItalic",fz,K(e)),J(e,"_isBold",dz,K(e)),J(e,"_isUnderline",pz,K(e)),J(e,"_underlineHeight",mz,K(e)),J(e,"_cacheMode",vz,K(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}Y(e,t),q(e,[{key:"string",get:function(){return this._string},set:function(t){t+="",this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode!==Az.BITMAP||this._font instanceof zL||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===Az.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof zL?this._font.fontSize:-1}}]);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this.updateRenderData(!0)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){var e=this._ttfSpriteFrame.texture;if(e&&null===this._ttfSpriteFrame.original){var i=e;i.image&&i.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},i.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture())},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},i._updateColor=function(){this._font instanceof zL?t.prototype._updateColor.call(this):this.updateRenderData(!1)},i._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof zL){var i=e.spriteFrame;if(!i||!i.textureLoaded())return!1}return!0},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i._applyFontTexture=function(){var t=this,e=this._font;if(e instanceof zL){var i=e.spriteFrame,n=function(){t._texture=i,t.changeMaterialForDefine(),t._assembler&&t._assembler.updateRenderData(t)};i&&(i.loaded||i.textureLoaded?n():i.once("load",n,this))}else{if(this.cacheMode===Az.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new vL,this._assemblerData=this._assembler.getAssemblerData();var r=new V_(this._assemblerData.canvas)._texture;this._ttfSpriteFrame.texture=r}this.cacheMode!==Az.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this)}},i.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==Az.CHAR){var e=this._texture.texture;if(e instanceof hf){var i=e.getPixelFormat();t=i===D_.RGBA_ETC1||i===D_.RGB_A_PVRTC_4BPPV1||i===D_.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?_F.USE_ALPHA_SEPARATED:_F.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},e}(bz),gz.HorizontalAlign=Tz,gz.VerticalAlign=Sz,gz.Overflow=Ez,gz.CacheMode=Az,gz._canvasPool=gB.getInstance(),$((ez=yz).prototype,"string",[gF,yF,Pu],Object.getOwnPropertyDescriptor(ez.prototype,"string"),ez.prototype),$(ez.prototype,"horizontalAlign",[TF,SF,EF],Object.getOwnPropertyDescriptor(ez.prototype,"horizontalAlign"),ez.prototype),$(ez.prototype,"verticalAlign",[AF,bF,xF],Object.getOwnPropertyDescriptor(ez.prototype,"verticalAlign"),ez.prototype),$(ez.prototype,"fontSize",[CF,wF],Object.getOwnPropertyDescriptor(ez.prototype,"fontSize"),ez.prototype),$(ez.prototype,"fontFamily",[RF,IF,OF],Object.getOwnPropertyDescriptor(ez.prototype,"fontFamily"),ez.prototype),$(ez.prototype,"lineHeight",[PF,MF],Object.getOwnPropertyDescriptor(ez.prototype,"lineHeight"),ez.prototype),$(ez.prototype,"overflow",[DF,NF,LF],Object.getOwnPropertyDescriptor(ez.prototype,"overflow"),ez.prototype),$(ez.prototype,"enableWrapText",[BF,FF],Object.getOwnPropertyDescriptor(ez.prototype,"enableWrapText"),ez.prototype),$(ez.prototype,"font",[zF,UF,kF,GF],Object.getOwnPropertyDescriptor(ez.prototype,"font"),ez.prototype),$(ez.prototype,"useSystemFont",[HF,VF],Object.getOwnPropertyDescriptor(ez.prototype,"useSystemFont"),ez.prototype),$(ez.prototype,"cacheMode",[WF,jF,qF],Object.getOwnPropertyDescriptor(ez.prototype,"cacheMode"),ez.prototype),$(ez.prototype,"isBold",[XF,YF],Object.getOwnPropertyDescriptor(ez.prototype,"isBold"),ez.prototype),$(ez.prototype,"isItalic",[KF,ZF],Object.getOwnPropertyDescriptor(ez.prototype,"isItalic"),ez.prototype),$(ez.prototype,"isUnderline",[QF,JF],Object.getOwnPropertyDescriptor(ez.prototype,"isUnderline"),ez.prototype),$(ez.prototype,"underlineHeight",[$F,yu],Object.getOwnPropertyDescriptor(ez.prototype,"underlineHeight"),ez.prototype),iz=$(ez.prototype,"_string",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),nz=$(ez.prototype,"_horizontalAlign",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tz.CENTER}}),rz=$(ez.prototype,"_verticalAlign",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sz.CENTER}}),az=$(ez.prototype,"_actualFontSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oz=$(ez.prototype,"_fontSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),sz=$(ez.prototype,"_fontFamily",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),lz=$(ez.prototype,"_lineHeight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),cz=$(ez.prototype,"_overflow",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ez.NONE}}),hz=$(ez.prototype,"_enableWrapText",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uz=$(ez.prototype,"_font",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_z=$(ez.prototype,"_isSystemFontUsed",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fz=$(ez.prototype,"_isItalic",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dz=$(ez.prototype,"_isBold",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pz=$(ez.prototype,"_isUnderline",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mz=$(ez.prototype,"_underlineHeight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),vz=$(ez.prototype,"_cacheMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Az.NONE}}),tz=ez))||tz)||tz)||tz)||tz));!function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(xz||(xz={})),fe(xz),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(Cz||(Cz={})),fe(Cz),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(wz||(wz={})),fe(wz);var Iz=Math.PI,Oz=Math.min,Pz=Math.max,Mz=Math.cos,Dz=Math.sin,Nz=Math.abs,Lz=Math.sign,Bz=.5522847493;function Fz(t,e,i,n,r){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+r*Bz,e-n*Bz,i+r,e,i+r),t.bezierCurveTo(e+n*Bz,i+r,e+n,i+r*Bz,e+n,i),t.bezierCurveTo(e+n,i-r*Bz,e+n*Bz,i-r,e,i-r),t.bezierCurveTo(e-n*Bz,i-r,e-n,i-r*Bz,e-n,i),t.close()}var zz,Uz,kz,Gz,Hz,Vz,Wz,jz,qz,Xz,Yz,Kz,Zz,Qz,Jz,$z,tU,eU,iU,nU,rU,aU,oU,sU,lU=function(t){function e(e,i){var n;return(n=t.call(this,e,i)||this).dx=0,n.dy=0,n.dmx=0,n.dmy=0,n.flags=0,n.len=0,n.reset(),n}return Y(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(Xi),cU=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),hU=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=Ci.WHITE.clone(),this.lineCap=xz.BUTT,this.strokeColor=Ci.BLACK.clone(),this.lineJoin=Cz.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,wz.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,wz.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,n,r,a){var o=this._curPath,s=o.points[o.points.length-1];s&&(s.x!==t||s.y!==e||i!==r||n!==a?(function t(e,i,n,r,a,o,s,l,c,h,u){var _,f,d,p,m,v,g,y,T,S,E,A,b,x,C,w;h>10||(m=.5*(o+l),v=.5*(s+c),g=.5*((_=.5*(i+r))+(d=.5*(r+o))),y=.5*((f=.5*(n+a))+(p=.5*(a+s))),((C=Nz((r-l)*(x=c-n)-(a-c)*(b=l-i)))+(w=Nz((o-l)*x-(s-c)*b)))*(C+w)<e.tessTol*(b*b+x*x)?e.addPoint(l,c,0===u?u|wz.PT_BEVEL:u):(t(e,i,n,_,f,g,y,E=.5*(g+(T=.5*(d+m))),A=.5*(y+(S=.5*(p+v))),h+1,0),t(e,E,A,T,S,m,v,l,c,h+1,u)))}(this,s.x,s.y,t,e,i,n,r,a,0,wz.PT_CORNER),this._commandX=r,this._commandY=a):this.lineTo(r,a))},e.quadraticCurveTo=function(t,e,i,n){var r=this._commandX,a=this._commandY;this.bezierCurveTo(r+2/3*(t-r),a+2/3*(e-a),i+2/3*(t-i),n+2/3*(e-n),i,n)},e.arc=function(t,e,i,n,r,a){!function(t,e,i,n,r,a,o){var s,l,c=0,h=0,u=0,_=0,f=0,d=0,p=0,m=0,v=0,g=0,y=0,T=0,S=0,E=0;if(h=a-r,o=o||!1)if(Nz(h)>=2*Iz)h=2*Iz;else for(;h<0;)h+=2*Iz;else if(Nz(h)>=2*Iz)h=2*-Iz;else for(;h>0;)h-=2*Iz;for(l=0|Pz(1,Oz(Nz(h)/(.5*Iz)+.5,5)),u=Nz(4/3*(1-Mz(s=h/l/2))/Dz(s)),o||(u=-u),E=0;E<=l;E++)d=e+(_=Mz(c=r+h*(E/l)))*n,p=i+(f=Dz(c))*n,m=-f*n*u,v=_*n*u,0===E?t.moveTo(d,p):t.bezierCurveTo(g+T,y+S,d-m,p-v,d,p),g=d,y=p,T=m,S=v}(this,t,e,i,n,r,a)},e.ellipse=function(t,e,i,n){Fz(this,t,e,i,n),this._curPath.complex=!1},e.circle=function(t,e,i){Fz(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,n,r){!function(t,e,i,n,r,a){if(a<.1)t.rect(e,i,n,r);else{var o=Oz(a,.5*Nz(n))*Lz(n),s=Oz(a,.5*Nz(r))*Lz(r);t.moveTo(e,i+s),t.lineTo(e,i+r-s),t.bezierCurveTo(e,i+r-s*(1-Bz),e+o*(1-Bz),i+r,e+o,i+r),t.lineTo(e+n-o,i+r),t.bezierCurveTo(e+n-o*(1-Bz),i+r,e+n,i+r-s*(1-Bz),e+n,i+r-s),t.lineTo(e+n,i+s),t.bezierCurveTo(e+n,i+s*(1-Bz),e+n-o*(1-Bz),i,e+n-o,i),t.lineTo(e+o,i),t.bezierCurveTo(e+o*(1-Bz),i,e,i+s*(1-Bz),e,i+s),t.close()}}(this,t,e,i,n,r),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var n=t[e];n&&RB.remove(n)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=RB.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var n=this._curPath;if(n){var r=this._points,a=n.points,o=r[this.pointsOffset++];o?(o.x=t,o.y=e):(o=new lU(t,e),r.push(o)),o.flags=i,a.push(o)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new cU,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),uU=[new Xo(za.ATTR_POSITION,ka.RGB32F)],_U=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_COLOR,ka.RGBA32F)],fU=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RG32F),new Xo(za.ATTR_COLOR,ka.RGBA32F)],dU=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RG32F),new Xo(za.ATTR_COLOR,ka.RGBA32F),new Xo(za.ATTR_COLOR2,ka.RGBA32F)];function pU(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=xo[n.format].count}return e}function mU(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=xo[n.format].size}return e}n.internal.vfmtPosUvColor=fU,n.internal.vfmtPosUvTwoColor=dU,t("UIVertexFormat",Object.freeze({__proto__:null,vfmt:uU,vfmtPosColor:_U,vfmtPosUvColor:fU,vfmtPosUvTwoColor:dU,getComponentPerVertex:pU,getAttributeStride:mU}));var vU,gU,yU,TU,SU,EU,AU,bU,xU,CU,wU,RU,IU,OU,PU,MU,DU,NU,LU,BU,FU,zU,UU,kU,GU,HU,VU,WU,jU=_U.concat([new Xo("a_dist",ka.R32F)]),qU=pU(jU),XU=mU(jU),YU=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((zz=ru("cc.Graphics"),Uz=gu(),kz=ou(110),Gz=du(),Hz=Fu(Cz),Vz=Eu(),Wz=Fu(xz),jz=Eu(),qz=Eu(),Xz=Eu(),Yz=Eu(),Kz=Tu(),Zz=Tu(),Qz=Tu(),zz(Jz=Uz(Jz=kz(Jz=Gz((sU=oU=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,J(e,"_lineWidth",tU,K(e)),J(e,"_strokeColor",eU,K(e)),J(e,"_lineJoin",iU,K(e)),J(e,"_lineCap",nU,K(e)),J(e,"_fillColor",rU,K(e)),J(e,"_miterLimit",aU,K(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._instanceMaterialType=_F.ADD_COLOR,e.impl=new hU,e}Y(e,t),q(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]);var i=e.prototype;return i.onRestore=function(){this.impl||this._flushAssembler()},i.onLoad=function(){this.model=BR.root.createModel(Up),this.model.node=this.model.transform=this.node,this._flushAssembler()},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._sceneGetter=null,this.model&&(BR.root.destroyModel(this.model),this.model=null),this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null)},i.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},i.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},i.bezierCurveTo=function(t,e,i,n,r,a){this.impl&&this.impl.bezierCurveTo(t,e,i,n,r,a)},i.quadraticCurveTo=function(t,e,i,n){this.impl&&this.impl.quadraticCurveTo(t,e,i,n)},i.arc=function(t,e,i,n,r,a){this.impl&&this.impl.arc(t,e,i,n,r,a)},i.ellipse=function(t,e,i,n){this.impl&&this.impl.ellipse(t,e,i,n)},i.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},i.rect=function(t,e,i,n){this.impl&&this.impl.rect(t,e,i,n)},i.roundRect=function(t,e,i,n,r){this.impl&&this.impl.roundRect(t,e,i,n,r)},i.fillRect=function(t,e,i,n){this.rect(t,e,i,n),this.fill()},i.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},i.close=function(){this.impl&&this.impl.close()},i.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},i.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},i._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=Zd.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},i.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=n.director.root.device,i=e.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.DEVICE,65535*XU,XU)),r=e.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),a=new xx([i],jU,ja.TRIANGLE_LIST,r);a.subMeshIdx=0,this.model.initSubModel(t,a,this.getMaterialInstance(0))}}else E(4500,this.node.name)},i._uploadData=function(t){var e=this.impl;if(e){var i=e&&e.getRenderDataList();if(!(i.length<=0)&&this.model){for(var n=this.model.subModels,r=0;r<i.length;r++){var a=i[r],o=n[r].inputAssembler;if(a.lastFilledVertex!==a.vertexStart){var s=new Float32Array(a.vData.buffer,0,a.vertexStart*qU);o.vertexBuffers[0].update(s),o.vertexCount=a.vertexStart;var l=new Uint16Array(a.iData.buffer,0,a.indicesStart);o.indexBuffer.update(l),o.indexCount=a.indicesStart,a.lastFilledVertex=a.vertexStart,a.lastFilledIndices=a.indicesStart}}t.removeUploadBuffersFunc(this),this._isNeedUploadData=!1}}},i._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),i=this.model.subModels.length;if(e.length>i)for(var n=i;n<e.length;n++)this.activeSubModel(n)}t.addUploadBuffersFunc(this,this._uploadData)}t.commitModel(this,this.model,this.getMaterialInstance(0))},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},i._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},e}(bz),oU.LineJoin=Cz,oU.LineCap=xz,$(($z=sU).prototype,"lineWidth",[yu],Object.getOwnPropertyDescriptor($z.prototype,"lineWidth"),$z.prototype),$($z.prototype,"lineJoin",[Hz,Vz],Object.getOwnPropertyDescriptor($z.prototype,"lineJoin"),$z.prototype),$($z.prototype,"lineCap",[Wz,jz],Object.getOwnPropertyDescriptor($z.prototype,"lineCap"),$z.prototype),$($z.prototype,"strokeColor",[qz],Object.getOwnPropertyDescriptor($z.prototype,"strokeColor"),$z.prototype),$($z.prototype,"fillColor",[Xz],Object.getOwnPropertyDescriptor($z.prototype,"fillColor"),$z.prototype),$($z.prototype,"miterLimit",[Yz],Object.getOwnPropertyDescriptor($z.prototype,"miterLimit"),$z.prototype),$($z.prototype,"color",[zu,Kz],Object.getOwnPropertyDescriptor($z.prototype,"color"),$z.prototype),$($z.prototype,"srcBlendFactor",[zu,Zz],Object.getOwnPropertyDescriptor($z.prototype,"srcBlendFactor"),$z.prototype),$($z.prototype,"dstBlendFactor",[zu,Qz],Object.getOwnPropertyDescriptor($z.prototype,"dstBlendFactor"),$z.prototype),tU=$($z.prototype,"_lineWidth",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),eU=$($z.prototype,"_strokeColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.BLACK.clone()}}),iU=$($z.prototype,"_lineJoin",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cz.MITER}}),nU=$($z.prototype,"_lineCap",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xz.BUTT}}),rU=$($z.prototype,"_fillColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),aU=$($z.prototype,"_miterLimit",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Jz=$z))||Jz)||Jz)||Jz)||Jz)),KU=new Vi,ZU=new Xi,QU=new Vi,JU=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(WU||(WU={})),fe(WU);var $U=function(e){return t({Mask:e,MaskComponent:e}),e}((vU=ru("cc.Mask"),gU=gu(),yU=ou(110),TU=du(),SU=Fu(WU),EU=Ru(),AU=Eu(),bU=Ru(),xU=Eu(),CU=Tu(),wU=Fu(vL),RU=Tu(),IU=Tu(),OU=Au(),PU=Tu(),MU=Tu(),DU=Tu(),NU=Tu(),vU(LU=gU(LU=yU(LU=TU((VU=HU=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,J(e,"_type",FU,K(e)),J(e,"_inverted",zU,K(e)),J(e,"_segments",UU,K(e)),J(e,"_spriteFrame",kU,K(e)),J(e,"_alphaThreshold",GU,K(e)),e._graphics=null,e._instanceMaterialType=_F.ADD_COLOR,e}Y(e,t),q(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==WU.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){n.game.renderType!==hb.RENDER_TYPE_CANVAS?(this._inverted=t,this.stencilStage=vB.DISABLED,this._graphics&&(this._graphics.stencilStage=vB.DISABLED)):E(4202)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=ci(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===WU.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===WU.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]);var i=e.prototype;return i.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics()},i.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},i.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&BR.root.destroyModel(this._clearModel),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},i.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,n=i.width,r=i.height,a=ZU;this.node.getWorldMatrix(KU),Vi.invert(QU,KU),Xi.transformMat4(a,t,QU);var o=e.anchorPoint;a.x+=o.x*n,a.y+=o.y*r;var s=!1;if(this.type===WU.RECT||this.type===WU.GRAPHICS_STENCIL)s=a.x>=0&&a.y>=0&&a.x<=n&&a.y<=r;else if(this.type===WU.ELLIPSE){var l=n/2,c=r/2,h=a.x-.5*n,u=a.y-.5*r;s=h*h/(l*l)+u*u/(c*c)<1}return this._inverted&&(s=!s),s},i._render=function(t){t.commitComp(this,null,this._assembler,null)},i._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},i._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},i._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==WU.IMAGE_STENCIL||null!==this._spriteFrame)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this),i=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==i&&(this._postAssembler=i),this._useRenderData()},i._createGraphics=function(){if(!this._graphics){var t=this._graphics=new YU;t._objFlags|=p_.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=Ci.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},i._updateGraphics=function(){if(this._graphics&&(this._type===WU.RECT||this._type===WU.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,r=i.height,a=t.anchorPoint,o=-n*a.x,s=-r*a.y;if(this._type===WU.RECT)e.rect(o,s,n,r);else if(this._type===WU.ELLIPSE){for(var l=function(t,e,i){JU.length=0;for(var n=2*Math.PI/i,r=0;r<i;++r)JU.push(new Ri(e.x*Math.cos(n*r)+t.x,e.y*Math.sin(n*r)+t.y,0));return JU}(new Ri(o+n/2,s+r/2,0),new Ri(n/2,r/2,0),this._segments),c=0;c<l.length;++c){var h=l[c];0===c?e.moveTo(h.x,h.y):e.lineTo(h.x,h.y)}e.close()}e.fill()}},i._createClearModel=function(){if(!this._clearModel){var t=Zd.get("default-clear-stencil");this._clearStencilMtl=new cm({parent:t,owner:this,subModelIdx:0}),this._clearModel=BR.root.createModel(Up),this._clearModel.node=this._clearModel.transform=this.node;var e=mU(uU),i=n.director.root.device,r=i.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.DEVICE,4*e,e)),a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);r.update(a);var o=i.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new Uint16Array([0,1,2,2,1,3]);o.update(s);var l=new xx([r],uU,ja.TRIANGLE_LIST,o);l.subMeshIdx=0,this._clearModel.initSubModel(0,l,this._clearStencilMtl)}},i._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=vB.DISABLED,this._type===WU.IMAGE_STENCIL?(t=Zd.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=Zd.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},i._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},i._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},i._useRenderData=function(){this._type!==WU.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},e}(bz),HU.Type=WU,$((BU=VU).prototype,"type",[SU,EU,AU],Object.getOwnPropertyDescriptor(BU.prototype,"type"),BU.prototype),$(BU.prototype,"inverted",[bU,xU],Object.getOwnPropertyDescriptor(BU.prototype,"inverted"),BU.prototype),$(BU.prototype,"segments",[CU],Object.getOwnPropertyDescriptor(BU.prototype,"segments"),BU.prototype),$(BU.prototype,"spriteFrame",[wU,RU],Object.getOwnPropertyDescriptor(BU.prototype,"spriteFrame"),BU.prototype),$(BU.prototype,"alphaThreshold",[IU,OU,wu],Object.getOwnPropertyDescriptor(BU.prototype,"alphaThreshold"),BU.prototype),$(BU.prototype,"dstBlendFactor",[zu,PU],Object.getOwnPropertyDescriptor(BU.prototype,"dstBlendFactor"),BU.prototype),$(BU.prototype,"srcBlendFactor",[zu,MU],Object.getOwnPropertyDescriptor(BU.prototype,"srcBlendFactor"),BU.prototype),$(BU.prototype,"color",[zu,DU],Object.getOwnPropertyDescriptor(BU.prototype,"color"),BU.prototype),$(BU.prototype,"customMaterial",[zu,NU],Object.getOwnPropertyDescriptor(BU.prototype,"customMaterial"),BU.prototype),FU=$(BU.prototype,"_type",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WU.RECT}}),zU=$(BU.prototype,"_inverted",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),UU=$(BU.prototype,"_segments",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),kU=$(BU.prototype,"_spriteFrame",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GU=$(BU.prototype,"_alphaThreshold",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),LU=BU))||LU)||LU)||LU)||LU));Xw._comp=$U,n.Mask=$U;var tk,ek,ik,nk,rk,ak,ok,sk,lk,ck,hk,uk,_k,fk,dk,pk,mk,vk,gk,yk,Tk,Sk,Ek,Ak,bk,xk,Ck,wk,Rk,Ik,Ok,Pk,Mk,Dk,Nk,Lk,Bk,Fk,zk,Uk,kk,Gk,Hk,Vk,Wk,jk,qk,Xk,Yk,Kk,Zk,Qk,Jk,$k,tG,eG=/^(click)(\s)*=|(param)(\s)*=/,iG=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,nG=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),r=-1;if(n>=0&&(r=t.lastIndexOf("<",n))<e-1&&(r=t.indexOf("<",n+1),n=t.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var a=t.substring(e,r),o=t.substring(r+1,n);""===o&&(a=t.substring(e,n+1)),this._processResult(a),-1===n?n=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(o),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",r=0,a="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(r=t.indexOf(" "),n[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(a=t.substring(r+1).trim(),e.event=this._processEventHandler(a)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="";if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var s;i=iG.exec(t);for(var l=!1;i;){if(n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),s=(r=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),s.endsWith("/")&&(s=s.slice(0,-1)),"src"===n){switch(s.charCodeAt(0)){case 34:case 39:l=!0,s=s.slice(1,-1)}e.isImage=!0,e.src=s}else if("height"===n)e.imageHeight=parseInt(s);else if("width"===n)e.imageWidth=parseInt(s);else if("align"===n){switch(s.charCodeAt(0)){case 34:case 39:s=s.slice(1,-1)}e.imageAlign=s.toLowerCase()}else"offset"===n?e.imageOffset=s:"click"===n&&(e.event=this._processEventHandler(n+"="+s));e.event&&"param"===n&&(e.event[n]=s.replace(/^"|"$/g,"")),i=iG.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var c={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var h,u=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=u.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),h=(r=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),"click"===n?e.event=this._processEventHandler(n+"="+h):"color"===n?c.color=h:"width"===n&&(c.width=parseInt(h)),e.event&&"param"===n&&(e.event[n]=h.replace(/^"|"$/g,"")),i=u.exec(t)}e.outline=c}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},i=0,n=!1,r=eG.exec(t);r;){var a=r[0],o="";if(n=!1,'"'===(t=t.substring(a.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else{var s=/(\S)+/.exec(t);i=(o=s?s[0]:"").length}n&&(e[a=a.substring(0,a.length-1).trim()]=o),t=t.substring(i).trim(),r=eG.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=Q(this._specialSymbolArray);!(e=i()).done;){var n=e.value,r=n[0],a=n[1];t=t.replace(r,a)}return t},t}()),rG=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((tk=ru("cc.LabelOutline"),ek=gu(),ik=ou(110),nk=du(),rk=au(Rz),ak=Eu(),ok=Eu(),tk(sk=ek(sk=ik(sk=nk(sk=rk(sk=fu((uk=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_color",ck,K(e)),J(e,"_width",hk,K(e)),e}Y(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(Rz);t&&t.updateRenderData(!0)},q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(Jf),ck=$((lk=uk).prototype,"_color",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(0,0,0,255)}}),hk=$(lk.prototype,"_width",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),$(lk.prototype,"color",[ak],Object.getOwnPropertyDescriptor(lk.prototype,"color"),lk.prototype),$(lk.prototype,"width",[ok],Object.getOwnPropertyDescriptor(lk.prototype,"width"),lk.prototype),sk=lk))||sk)||sk)||sk)||sk)||sk)||sk));!function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(Qk||(Qk={})),fe(Qk),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(Jk||(Jk={})),fe(Jk),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}($k||($k={})),fe($k),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(tG||(tG={}));var aG,oG,sG,lG,cG,hG,uG,_G,fG,dG,pG,mG,vG,gG,yG=function(e){return t({Sprite:e,SpriteComponent:e}),e}((_k=ru("cc.Sprite"),fk=gu(),dk=ou(110),pk=du(),mk=Fu(yL),vk=Ru(),gk=Eu(),yk=Fu(vL),Tk=Ru(),Sk=Eu(),Ek=Fu(Qk),Ak=Ru(),bk=Eu(),xk=Fu(Jk),Ck=Eu(),wk=Eu(),Rk=Au(),Ik=Eu(),Ok=Au(),Pk=Eu(),Mk=Ru(),Dk=Eu(),Nk=Fu($k),Lk=Ru(),Bk=Eu(),_k(Fk=fk(Fk=dk(Fk=pk((Zk=Kk=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_spriteFrame",Uk,K(e)),J(e,"_type",kk,K(e)),J(e,"_fillType",Gk,K(e)),J(e,"_sizeMode",Hk,K(e)),J(e,"_fillCenter",Vk,K(e)),J(e,"_fillStart",Wk,K(e)),J(e,"_fillRange",jk,K(e)),J(e,"_isTrimmedMode",qk,K(e)),J(e,"_useGrayscale",Xk,K(e)),J(e,"_atlas",Yk,K(e)),e}Y(e,t);var i=e.prototype;return i.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this),this._spriteFrame&&(this._spriteFrame.on("load",this._markForUpdateUvDirty,this),this._markForUpdateUvDirty())},i.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial()},i.onDestroy=function(){this.destroyRenderData(),this._spriteFrame&&this._spriteFrame.off("load"),t.prototype.onDestroy.call(this)},i.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},i.changeMaterialForDefine=function(){var t;this._spriteFrame&&(t=this._spriteFrame.texture);var e=!1;if(t instanceof hf){var i=t.getPixelFormat();e=i===D_.RGBA_ETC1||i===D_.RGB_A_PVRTC_4BPPV1||i===D_.RGB_A_PVRTC_2BPPV1}e&&this.grayscale?this._instanceMaterialType=_F.USE_ALPHA_SEPARATED_AND_GRAY:e?this._instanceMaterialType=_F.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=_F.GRAYSCALE:this._instanceMaterialType=_F.ADD_COLOR_AND_TEXTURE,this.updateMaterial()},i._render=function(t){t.commitComp(this,this._spriteFrame,this._assembler,null)},i._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.textureLoaded())},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this._updateColor())},i._applySpriteSize=function(){if(this._spriteFrame){if($k.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if($k.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},i._resized=function(){},i._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);n.game.renderType!==n.game.RENDER_TYPE_CANVAS?(t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)):this.markForUpdateRenderData()},i._onTextureLoaded=function(){this.isValid&&(this.changeMaterialForDefine(),this._applySpriteSize())},i._applySpriteFrame=function(t){var e=this._spriteFrame;this._renderData&&(t&&t.off("load",this._markForUpdateUvDirty),e&&e.on("load",this._markForUpdateUvDirty,this),this._renderData.uvDirty||(this._renderData.uvDirty=!t||!e||t.uvHash!==e.uvHash),this._renderDataFlag=this._renderData.uvDirty),e&&(t&&e===t||(e.loaded?this._onTextureLoaded():e.once("load",this._onTextureLoaded,this)))},i._markForUpdateUvDirty=function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderDataFlag=!0)},q(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===Jk.RADIAL||this._fillType===Jk.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===Qk.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=ci(t,-1,1),this._type===Qk.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=ci(t,-1,1),this._type===Qk.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===Qk.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this._instanceMaterialType=!0===t?_F.GRAYSCALE:_F.ADD_COLOR_AND_TEXTURE,this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==$k.CUSTOM&&this._applySpriteSize())}}]),e}(bz),Kk.FillType=Jk,Kk.Type=Qk,Kk.SizeMode=$k,Kk.EventType=tG,$((zk=Zk).prototype,"spriteAtlas",[mk,vk,gk],Object.getOwnPropertyDescriptor(zk.prototype,"spriteAtlas"),zk.prototype),$(zk.prototype,"spriteFrame",[yk,Tk,Sk],Object.getOwnPropertyDescriptor(zk.prototype,"spriteFrame"),zk.prototype),$(zk.prototype,"type",[Ek,Ak,bk],Object.getOwnPropertyDescriptor(zk.prototype,"type"),zk.prototype),$(zk.prototype,"fillType",[xk,Ck],Object.getOwnPropertyDescriptor(zk.prototype,"fillType"),zk.prototype),$(zk.prototype,"fillCenter",[wk],Object.getOwnPropertyDescriptor(zk.prototype,"fillCenter"),zk.prototype),$(zk.prototype,"fillStart",[Rk,Ik],Object.getOwnPropertyDescriptor(zk.prototype,"fillStart"),zk.prototype),$(zk.prototype,"fillRange",[Ok,Pk],Object.getOwnPropertyDescriptor(zk.prototype,"fillRange"),zk.prototype),$(zk.prototype,"trim",[Mk,Dk],Object.getOwnPropertyDescriptor(zk.prototype,"trim"),zk.prototype),$(zk.prototype,"grayscale",[yu],Object.getOwnPropertyDescriptor(zk.prototype,"grayscale"),zk.prototype),$(zk.prototype,"sizeMode",[Nk,Lk,Bk],Object.getOwnPropertyDescriptor(zk.prototype,"sizeMode"),zk.prototype),Uk=$(zk.prototype,"_spriteFrame",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kk=$(zk.prototype,"_type",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qk.SIMPLE}}),Gk=$(zk.prototype,"_fillType",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jk.HORIZONTAL}}),Hk=$(zk.prototype,"_sizeMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $k.TRIMMED}}),Vk=$(zk.prototype,"_fillCenter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(0,0)}}),Wk=$(zk.prototype,"_fillStart",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jk=$(zk.prototype,"_fillRange",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qk=$(zk.prototype,"_isTrimmedMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xk=$(zk.prototype,"_useGrayscale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yk=$(zk.prototype,"_atlas",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fk=zk))||Fk)||Fk)||Fk)||Fk)),TG=t("RenderRoot2D",ru("cc.RenderRoot2D")(aG=ou(100)(aG=du()(aG=au(UB)(aG=su(aG=fu(aG=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.onEnable=function(){n.director.root.batcher2D.addScreen(this)},i.onDisable=function(){n.director.root.batcher2D.removeScreen(this)},i.onDestroy=function(){n.director.root.batcher2D.removeScreen(this)},e}(Jf))||aG)||aG)||aG)||aG)||aG)||aG),SG=new Ri,EG=he({OVERLAY:0,INTERSPERSE:1}),AG=function(e){return t({Canvas:e,CanvasComponent:e}),e}((oG=ru("cc.Canvas"),sG=gu(),lG=ou(100),cG=du(),hG=Fu(zP),uG=Eu(),_G=Eu(),fG=Fu(zP),oG(dG=sG(dG=lG(dG=cG(dG=fu(dG=su(($((pG=function(t){function e(){var e;return J(e=t.call(this)||this,"_cameraComponent",mG,K(e)),J(e,"_alignCanvasWithScreen",vG,K(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._pos=new Ri,e._renderMode=EG.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(K(e)),e}Y(e,t),q(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]);var i=e.prototype;return i.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&this._cameraComponent._createCamera(),this._onResizeCamera(),this.node.on(vS.TRANSFORM_CHANGED,this._thisOnCameraResized)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(vS.TRANSFORM_CHANGED,this._thisOnCameraResized)},i._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture){var t=this._cameraComponent.targetTexture.window;this._cameraComponent.camera&&this._cameraComponent.camera.setFixedSize(t.width,t.height),this._cameraComponent.orthoHeight=_b.height/2}else if(ub.canvas){var e=ub.canvas;this._cameraComponent.camera&&this._cameraComponent.camera.resize(e.width,e.height),this._cameraComponent.orthoHeight=ub.canvas.height/gb.getScaleY()/2}this.node.getWorldPosition(SG),this._cameraComponent.node.setWorldPosition(SG.x,SG.y,1e3)}},i._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===EG.OVERLAY?e|1<<30:e&~(1<<30)}return 0},e}(TG)).prototype,"cameraComponent",[hG,uG],Object.getOwnPropertyDescriptor(pG.prototype,"cameraComponent"),pG.prototype),$(pG.prototype,"alignCanvasWithScreen",[_G],Object.getOwnPropertyDescriptor(pG.prototype,"alignCanvasWithScreen"),pG.prototype),mG=$(pG.prototype,"_cameraComponent",[fG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vG=$(pG.prototype,"_alignCanvasWithScreen",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dG=pG))||dG)||dG)||dG)||dG)||dG)||dG));n.Canvas=AG;var bG,xG,CG,wG,RG,IG,OG,PG,MG,DG,NG,LG,BG,FG,zG,UG,kG,GG,HG,VG,WG,jG,qG,XG,YG,KG,ZG,QG,JG,$G,tH,eH,iH,nH,rH,aH=t("UIComponent",ru("cc.UIComponent")(gG=au(UB)(gG=ou(110)(gG=su(gG=fu(gG=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._lastParent=null,e.stencilStage=vB.DISABLED,e}Y(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiComp=this},i.onEnable=function(){},i.onDisable=function(){},i.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},i.updateAssembler=function(){},i.postUpdateAssembler=function(){},e}(Jf))||gG)||gG)||gG)||gG)||gG);ct(aH.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),lt(AG.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:Ci.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),n.UITransformComponent=UB,le.setClassAlias(UB,"cc.UITransformComponent"),le.setClassAlias(bz,"cc.RenderComponent"),n.CanvasComponent=AG,le.setClassAlias(AG,"cc.CanvasComponent");var oH=new nG,sH=new oe((function(t){if(!n.isValid(t.node))return!1;var e=t.node.getComponent(rG);return e&&(e.width=0),!0}),20),lH=new oe((function(t){return n.isValid(t.node)}),10);function cH(t){return{node:new cR(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function hH(t,e){var i;"RICHTEXT_CHILD"===t?i=sH._get():"RICHTEXT_Image_CHILD"===t&&(i=lH._get());var n=(i=i||cH(t)).node;return n||(n=new cR(t)),"RICHTEXT_Image_CHILD"===t?(i.comp=n.getComponent(yG)||n.addComponent(yG),i.comp.spriteFrame=e,i.comp.type=yG.Type.SLICED,i.comp.sizeMode=yG.SizeMode.CUSTOM):(i.comp=n.getComponent(Rz)||n.addComponent(Rz),i.comp.string=e,i.comp.horizontalAlign=Tz.LEFT,i.comp.verticalAlign=Sz.TOP),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var uH,_H=function(e){return t({RichText:e,RichTextComponent:e}),e}((bG=ru("cc.RichText"),xG=gu(),CG=ou(110),wG=du(),RG=Eu(),IG=Fu(Tz),OG=Eu(),PG=Eu(),MG=Eu(),DG=Fu(bL),NG=Eu(),LG=Eu(),BG=Fu(Az),FG=Eu(),zG=Eu(),UG=Eu(),kG=Fu(yL),GG=Eu(),HG=Eu(),bG(VG=xG(VG=CG(VG=wG(VG=fu((rH=nH=function(t){function e(){var e;return J(e=t.call(this)||this,"_lineHeight",jG,K(e)),J(e,"_string",qG,K(e)),J(e,"_horizontalAlign",XG,K(e)),J(e,"_fontSize",YG,K(e)),J(e,"_maxWidth",KG,K(e)),J(e,"_fontFamily",ZG,K(e)),J(e,"_font",QG,K(e)),J(e,"_isSystemFontUsed",JG,K(e)),J(e,"_userDefinedFont",$G,K(e)),J(e,"_cacheMode",tH,K(e)),J(e,"_imageAtlas",eH,K(e)),J(e,"_handleTouchEvent",iH,K(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}Y(e,t),q(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]);var i=e.prototype;return i.onLoad=function(){this.node.on(vS.LAYER_CHANGED,this._applyLayer,this)},i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(wA.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=Q(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),"RICHTEXT_CHILD"===i.type?sH.put(i):"RICHTEXT_Image_CHILD"===i.type&&lH.put(i)}this.node.off(wA.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(vS.LAYER_CHANGED,this._applyLayer,this)},i._addEventListeners=function(){this.node.on(wA.EventType.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(wA.EventType.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return hH("RICHTEXT_CHILD",t)},i._createImage=function(t){return hH("RICHTEXT_Image_CHILD",t)},i._onTTFLoaded=function(){var t=this;this._font instanceof NL?this._font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):BI.postLoadNative(this._font,(function(){t.isValid&&(t._layoutDirty=!0,t._updateRichText())})):(this._layoutDirty=!0,this._updateRichText())},i._measureText=function(t,e){var i=this,n=function(e){var n;return 0===i._labelSegmentsCache.length?(n=i._createFontLabel(e),i._labelSegmentsCache.push(n)):(n=i._labelSegmentsCache[0]).node.getComponent(Rz).string=e,n.styleIndex=t,i._applyTextAttribute(n),n.node._uiProps.uiTransformComp.contentSize.width};return e?n(e):n},i._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(Jf),r=function(){var r=e.value,a=r.clickHandler,o=r.clickParam;a&&i._containsTouchLocation(r,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[a];e.enabledInHierarchy&&i&&i.call(e,t,o)})),t.propagationStopped=!0)},a=Q(this._segments);!(e=a()).done;)r()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(UB);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if("RICHTEXT_CHILD"===i.name||"RICHTEXT_Image_CHILD"===i.name){i.parent===this.node?i.parent=null:t.splice(e,1);var n=cH(i.name);n.node=i,"RICHTEXT_CHILD"===i.name?(n.comp=i.getComponent(Rz),sH.put(n)):(n.comp=i.getComponent(yG),lH.put(n))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(Rz);n&&(n.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this._applyTextAttribute(i),this.node.addChild(i.node),this._segments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var a=this._getFirstWordLen(t,r,t.length),o=t.substr(r,a),s=this._measureText(i,o);if(!(this._lineOffsetX+s<=this._maxWidth)){if(r>0){var l=t.substr(0,r);this._addLabelSegment(l,i),t=t.substr(r,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=s,r+=a}if(n>this._maxWidth)for(var c=tB(t,n,this._maxWidth,this._measureText(i)),h=0;h<c.length;++h){var u=c[h],_=this._addLabelSegment(u,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=_.width,c.length>1&&h<c.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var r=i.style,a=n.style;if(r){if(a){if(!!a.outline!=!!r.outline)return!0;if(r.size!==a.size||r.italic!==a.italic||r.isImage!==a.isImage)return!0;if(r.src!==a.src||r.imageAlign!==a.imageAlign||r.imageHeight!==a.imageHeight||r.imageWidth!==a.imageWidth||r.imageOffset!==a.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(a&&(a.size||a.italic||a.isImage||a.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var r=this._createImage(n);switch(r.comp,e.imageAlign){case"top":r.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":r.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:r.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}r.node.layer=this.node.layer,this.node.addChild(r.node),this._segments.push(r);var a=n.rect.clone(),o=1,s=a.width,l=a.height,c=e.imageWidth||0,h=e.imageHeight||0;h>0?(s*=o=h/l,l*=o):(s*=o=this._lineHeight/l,l*=o),c>0&&(s=c),this._maxWidth>0?(this._lineOffsetX+s>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node._uiProps.uiTransformComp.setContentSize(s,l),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var u=e.event;u&&(r.clickHandler=u.click,r.clickParam=u.param)}else E(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=oH.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var r=this._textArray[n],a=r.text;if(void 0!==a){if(""===a){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var o=a.split("\n"),s=0;s<o.length;++s){var l=o[s];if(""!==l)if(i=!1,this._maxWidth>0){var c=this._measureText(n,l);this._updateRichTextWithMaxWidth(l,c,n),o.length>1&&s<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(l,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&s<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(a)&&s===o.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+kL)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(ZL(n)||QL(n))return 1;for(var r=1,a=e+1;a<i&&!QL(n=t.charAt(a))&&!ZL(n);++a)r++;return r},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,r=n.anchorX,a=n.anchorY,o=0;o<this._segments.length;++o){var s=this._segments[o],l=s.lineCount;l>e&&(t=0,e=l);var c=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case Tz.LEFT:break;case Tz.CENTER:c-=this._linesWidth[l-1]/2;break;case Tz.RIGHT:c-=this._linesWidth[l-1]}var h=s.node.position;if(s.node.setPosition(t+c,this._lineHeight*(i-l)-this._labelHeight*a,h.z),l===e&&(t+=s.node._uiProps.uiTransformComp.width),s.node.getComponent(yG)){var u=s.node.position.clone(),_=this._lineHeight,f=this._lineHeight*(1+kL);switch(s.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=_+(f-_)/2;break;case.5:u.y+=f/2;break;default:u.y+=(f-_)/2}if(s.imageOffset){var d=s.imageOffset.split(",");if(1===d.length&&d[0]){var p=parseFloat(d[0]);Number.isInteger(p)&&(u.y+=p)}else if(2===d.length){var m=parseFloat(d[0]),v=parseFloat(d[1]);Number.isInteger(m)&&(u.x+=m),Number.isInteger(v)&&(u.y+=v)}}s.node.position=u}var g=s.node.getComponent(rG);if(g){var y=s.node.position.clone();y.y-=g.width,s.node.position=y}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return Ci[e]?Ci[e]:(new Ci).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent(Rz);if(e){var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var r=t.node.getComponent(rG);r||(r=t.node.addComponent(rG)),r.color=this._convertLiteralColorValue(i.outline.color),r.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var a=i.event;a&&(t.clickHandler=a.click||"",t.clickParam=a.param||"")}else e.fontSize=this._fontSize;e.cacheMode=this._cacheMode,this._font instanceof bL&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},i._applyLayer=function(){for(var t,e=Q(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},e}(aH),nH.HorizontalAlign=Tz,nH.VerticalAlign=Sz,$((WG=rH).prototype,"string",[Pu,RG],Object.getOwnPropertyDescriptor(WG.prototype,"string"),WG.prototype),$(WG.prototype,"horizontalAlign",[IG,OG],Object.getOwnPropertyDescriptor(WG.prototype,"horizontalAlign"),WG.prototype),$(WG.prototype,"fontSize",[PG],Object.getOwnPropertyDescriptor(WG.prototype,"fontSize"),WG.prototype),$(WG.prototype,"fontFamily",[MG],Object.getOwnPropertyDescriptor(WG.prototype,"fontFamily"),WG.prototype),$(WG.prototype,"font",[DG,NG],Object.getOwnPropertyDescriptor(WG.prototype,"font"),WG.prototype),$(WG.prototype,"useSystemFont",[LG],Object.getOwnPropertyDescriptor(WG.prototype,"useSystemFont"),WG.prototype),$(WG.prototype,"cacheMode",[BG,FG],Object.getOwnPropertyDescriptor(WG.prototype,"cacheMode"),WG.prototype),$(WG.prototype,"maxWidth",[zG],Object.getOwnPropertyDescriptor(WG.prototype,"maxWidth"),WG.prototype),$(WG.prototype,"lineHeight",[UG],Object.getOwnPropertyDescriptor(WG.prototype,"lineHeight"),WG.prototype),$(WG.prototype,"imageAtlas",[kG,GG],Object.getOwnPropertyDescriptor(WG.prototype,"imageAtlas"),WG.prototype),$(WG.prototype,"handleTouchEvent",[HG],Object.getOwnPropertyDescriptor(WG.prototype,"handleTouchEvent"),WG.prototype),jG=$(WG.prototype,"_lineHeight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),qG=$(WG.prototype,"_string",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),XG=$(WG.prototype,"_horizontalAlign",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tz.LEFT}}),YG=$(WG.prototype,"_fontSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),KG=$(WG.prototype,"_maxWidth",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZG=$(WG.prototype,"_fontFamily",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),QG=$(WG.prototype,"_font",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JG=$(WG.prototype,"_isSystemFontUsed",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$G=$(WG.prototype,"_userDefinedFont",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tH=$(WG.prototype,"_cacheMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Az.NONE}}),eH=$(WG.prototype,"_imageAtlas",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iH=$(WG.prototype,"_handleTouchEvent",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),VG=WG))||VG)||VG)||VG)||VG)||VG)),fH=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(ru("cc.UIMeshRenderer")(uH=gu()(uH=ou(110)(uH=du()(uH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._models=null,e._modelComponent=null,e}Y(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},i.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,i=Q(this._models);!(e=i()).done;){var n=e.value;t.commitModel.call(t,this,n,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,r=n.length,a=0;a<r;a++){var o=n[a];o._priority=Lc.MAX-11,o.blendState.targets[0].blend||i.overridePipelineStates({blendState:{targets:[{blend:!0}]}},a)}}},q(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(aH))||uH)||uH)||uH)||uH),dH=t("MeshBuffer",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}q(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}}]);var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=pU(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var n=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,n,n)));var r=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,r,r))),this._attributes=t,this._iaInfo=new Yo(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,n=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var r=this.vData.byteLength,a=this.iData.length;if(i>r||n>a){for(;r<i||a<n;)this._initVDataCount*=2,this._initIDataCount*=2,r=4*this._initVDataCount,a=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)Hn.free(this._hInputAssemblers[t]);this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return 0;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(Hn.alloc(this._batcher.device,this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++],i=Hn.get(e);return i.firstIndex=this.indicesStart,i.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e),this._dirty=!1}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),n=0,r=e.length;n<r;n++)i[n]=e[n]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,n=0,r=e.length;n<r;n++)i[n]=e[n]},q(t,[{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());dH.OPACITY_OFFSET=8;var pH,mH,vH,gH,yH,TH,SH,EH,AH,bH,xH,CH,wH,RH,IH,OH,PH,MH,DH,NH,LH,BH,FH,zH,UH,kH,GH=Fc.Enum.NONE|Fc.Enum.UI_3D,HH=t("UIDrawBatch",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._handle=0,this._passes=[],this._handle=ur.alloc(),ur.set(this._handle,or.VIS_FLAGS,GH),ur.set(this._handle,or.INPUT_ASSEMBLER,0),ur.set(this._handle,or.DESCRIPTOR_SET,0)}q(t,[{key:"handle",get:function(){return this._handle}},{key:"hInputAssembler",get:function(){return ur.get(this._handle,or.INPUT_ASSEMBLER)},set:function(t){ur.set(this._handle,or.INPUT_ASSEMBLER,t)}},{key:"hDescriptorSet",get:function(){return ur.get(this._handle,or.DESCRIPTOR_SET)},set:function(t){ur.set(this._handle,or.DESCRIPTOR_SET,t)}},{key:"visFlags",get:function(){return ur.get(this._handle,or.VIS_FLAGS)},set:function(t){ur.set(this._handle,or.VIS_FLAGS,t)}},{key:"passes",get:function(){return this._passes}}]);var e=t.prototype;return e.destroy=function(){if(this._handle){for(var t=this.passes.length,e=0;e<t;e++)this.passes[e]._destroyHandle();this._passes=[],ur.free(this._handle),this._handle=0}},e.clear=function(){this.bufferBatch=null,this.hInputAssembler=0,this.hDescriptorSet=0,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=GH},e.fillPasses=function(t,e,i,r,a,o){if(t){var s=t.passes;if(!s)return;ur.set(this._handle,or.PASS_COUNT,s.length);for(var l=or.PASS_0,c=or.SHADER_0,h=0,u=0;u<s.length;u++,l++,c++){this._passes[u]||(this._passes[u]=new ep(n.director.root),this._passes[u]._handle=ir.alloc());var _=s[u],f=this._passes[u];e||(e=_.depthStencilState,i=0),r||(r=_.blendState,a=0),-1===a&&(a=0),h=i<<16|a,_.update(),f._initPassFromTarget(_,e,r,h),ur.set(this._handle,l,f.handle),ur.set(this._handle,c,f.getShaderVariant(o))}}},t}()),VH=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}((pH=ru("cc.UIStaticBatch"),mH=gu(),vH=du(),gH=ou(110),yH=Tu(),TH=Tu(),SH=Tu(),pH(EH=mH(EH=vH(EH=gH(($((AH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}Y(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getBatcher();if(t){var e=fU,i=new dH(t);i.initialize(e,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){t.currIsStatic=!0,this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers()),t.currIsStatic=!1},i.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new HH;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getBatcher=function(){return BR.root&&BR.root.batcher2D?BR.root.batcher2D:(E(9301),null)},i._arrivalMaxBuffer=function(){var t=this._getBatcher();t&&t.autoMergeBatches(),E(9300)},q(e,[{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateColor(),this.markForUpdateRenderData())}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(bz)).prototype,"dstBlendFactor",[zu,yH],Object.getOwnPropertyDescriptor(AH.prototype,"dstBlendFactor"),AH.prototype),$(AH.prototype,"srcBlendFactor",[zu,TH],Object.getOwnPropertyDescriptor(AH.prototype,"srcBlendFactor"),AH.prototype),$(AH.prototype,"color",[zu,SH],Object.getOwnPropertyDescriptor(AH.prototype,"color"),AH.prototype),EH=AH))||EH)||EH)||EH)||EH)),WH=t("LabelShadow",(bH=ru("cc.LabelShadow"),xH=gu(),CH=ou(110),wH=du(),RH=au(Rz),IH=Eu(),OH=Eu(),PH=Eu(),bH(MH=xH(MH=CH(MH=wH(MH=RH(MH=fu((FH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_color",NH,K(e)),J(e,"_offset",LH,K(e)),J(e,"_blur",BH,K(e)),e}Y(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(Rz);t&&t.updateRenderData(!0)},q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(Jf),NH=$((DH=FH).prototype,"_color",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(0,0,0,255)}}),LH=$(DH.prototype,"_offset",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(2,2)}}),BH=$(DH.prototype,"_blur",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),$(DH.prototype,"color",[IH],Object.getOwnPropertyDescriptor(DH.prototype,"color"),DH.prototype),$(DH.prototype,"offset",[OH],Object.getOwnPropertyDescriptor(DH.prototype,"offset"),DH.prototype),$(DH.prototype,"blur",[PH],Object.getOwnPropertyDescriptor(DH.prototype,"blur"),DH.prototype),MH=DH))||MH)||MH)||MH)||MH)||MH)||MH)),jH=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}(ru("cc.UIOpacity")(zH=gu()(zH=ou(110)(zH=du()(zH=fu(($((UH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_opacity",kH,K(e)),e}Y(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.opacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.opacity=1},q(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=we(t,0,255),this._opacity=t,this.node._uiProps.opacity=t/255)}}]),e}(Jf)).prototype,"opacity",[yu],Object.getOwnPropertyDescriptor(UH.prototype,"opacity"),UH.prototype),kH=$(UH.prototype,"_opacity",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),zH=UH))||zH)||zH)||zH)||zH)||zH);n.MaskComponent=$U,le.setClassAlias($U,"cc.MaskComponent"),n.LabelComponent=Rz,le.setClassAlias(Rz,"cc.LabelComponent"),n.LabelOutlineComponent=rG,le.setClassAlias(rG,"cc.LabelOutlineComponent"),n.RichTextComponent=_H,le.setClassAlias(_H,"cc.RichTextComponent"),n.SpriteComponent=yG,le.setClassAlias(yG,"cc.SpriteComponent"),n.UIModelComponent=fH,le.setClassAlias(fH,"cc.UIModelComponent"),n.GraphicsComponent=YU,le.setClassAlias(YU,"cc.GraphicsComponent"),le.setClassAlias(VH,"cc.UIStaticBatchComponent"),le.setClassAlias(jH,"cc.UIOpacityComponent");var qH=function(t,e,i){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i};function XH(t,e,i,n,r){var a=0,o=null;if(r===function(t,e,i,n){for(var r=0,a=e,o=i-n;a<i;a+=n)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,i,n)>0)for(a=e;a<i;a+=n)o=uV(a,t[a],t[a+1],o);else for(a=i-n;a>=e;a-=n)o=uV(a,t[a],t[a+1],o);return o&&sV(o,o.next)&&(_V(o),o=o.next),o}function YH(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var i=t,n=!1;do{if(n=!1,i.steiner||!sV(i,i.next)&&0!==oV(i.prev,i,i.next))i=i.next;else{if(_V(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function KH(t,e,i,n,r,a,o){if(void 0===o&&(o=0),t){!o&&a&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=iV(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e=0,i=null,n=null,r=null,a=null,o=0,s=0,l=0,c=1;do{for(i=t,t=null,a=null,o=0;i;){for(o++,n=i,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0===s?(r=n,n=n.nextZ,l--):0!==l&&n?i.z<=n.z?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--):(r=i,i=i.nextZ,s--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,a);for(var s=t,l=null,c=null;t.prev!==t.next;)if(l=t.prev,c=t.next,a?QH(t,n,r,a):ZH(t))e.push(l.i/i),e.push(t.i/i),e.push(c.i/i),_V(t),t=c.next,s=c.next;else if((t=c)===s){o?1===o?KH(t=JH(t,e,i),e,i,n,r,a,2):2===o&&$H(t,e,i,n,r,a):KH(YH(t),e,i,n,r,a,1);break}}}function ZH(t){var e=t.prev,i=t,n=t.next;if(oV(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(rV(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&oV(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function QH(t,e,i,n){var r=t.prev,a=t,o=t.next;if(oV(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,c=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,h=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,u=iV(s,l,e,i,n),_=iV(c,h,e,i,n),f=t.nextZ;f&&f.z<=_;){if(f!==t.prev&&f!==t.next&&rV(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&oV(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&rV(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&oV(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function JH(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!sV(r,a)&&lV(r,n,n.next,a)&&cV(r,a)&&cV(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),_V(n),_V(n.next),n=t=a),n=n.next}while(n!==t);return n}function $H(t,e,i,n,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&aV(o,s)){var l=hV(o,s);return o=YH(o,o.next),l=YH(l,l.next),KH(o,e,i,n,r,a),void KH(l,e,i,n,r,a)}s=s.next}o=o.next}while(o!==t)}function tV(t,e){return t.x-e.x}function eV(t,e){if(e=function(t,e){var i=e,n=t.x,r=t.y,a=-1/0,o=null;do{if(r<=i.y&&r>=i.next.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(r===i.y)return i;if(r===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!o)return null;if(n===a)return o.prev;var l,c=o,h=o.x,u=o.y,_=1/0;for(i=o.next;i!==c;)n>=i.x&&i.x>=h&&rV(r<u?n:a,r,h,u,r<u?a:n,r,i.x,i.y)&&((l=Math.abs(r-i.y)/(n-i.x))<_||l===_&&i.x>o.x)&&cV(i,t)&&(o=i,_=l),i=i.next;return o}(t,e)){var i=hV(e,t);YH(i,i.next)}}function iV(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nV(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function rV(t,e,i,n,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(i-o)*(e-s)>=0&&(i-o)*(a-s)-(r-o)*(n-s)>=0}function aV(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&lV(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&cV(t,e)&&cV(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function oV(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function sV(t,e){return t.x===e.x&&t.y===e.y}function lV(t,e,i,n){return!!(sV(t,e)&&sV(i,n)||sV(t,n)&&sV(i,e))||oV(t,e,i)>0!=oV(t,e,n)>0&&oV(i,n,t)>0!=oV(i,n,e)>0}function cV(t,e){return oV(t.prev,t,t.next)<0?oV(t,e,t.next)>=0&&oV(t,t.prev,e)>=0:oV(t,e,t.prev)<0||oV(t,t.next,e)<0}function hV(t,e){var i=new qH(t.i,t.x,t.y),n=new qH(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function uV(t,e,i,n){var r=new qH(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function _V(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fV(t,e,i){i=i||3;var n=e?e.length:0,r=n?e[0]*i:t.length,a=XH(t,0,r,i,!0),o=[];if(!a)return o;var s=0,l=0,c=0,h=0,u=0,_=0,f=0;if(n&&(a=function(t,e,i,n){var r,a=[],o=0,s=null;for(o=0,r=e.length;o<r;o++)(s=XH(t,e[o]*n,o<r-1?e[o+1]*n:t.length,n,!1))&&(s===s.next&&(s.steiner=!0),a.push(nV(s)));if(a.sort(tV),!i)return i;for(o=0;o<a.length;o++)eV(a[o],i),i=YH(i,i.next);return i}(t,e,a,i)),t.length>80*i){s=c=t[0],l=h=t[1];for(var d=i;d<r;d+=i)(u=t[d])<s&&(s=u),(_=t[d+1])<l&&(l=_),u>c&&(c=u),_>h&&(h=_);f=Math.max(c-s,h-l)}return KH(a,o,i,s,l,f),o}for(var dV=Math.PI,pV=Math.min,mV=Math.max,vV=Math.ceil,gV=Math.acos,yV=Math.cos,TV=Math.sin,SV=Math.atan2,EV=null,AV=null,bV=new Ci,xV=[],CV=0;CV<4;CV++)xV.push(new Ri);function wV(t,e,i){return t<e?e:t>i?i:t}var RV={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!AV)return null;var i=AV.getRenderDataList(),n=i[AV.dataOffset];if(!n)return null;var r=n,a=r?r.vertexStart+e:0;return(a>65535||3*a>131070)&&(++AV.dataOffset,AV.dataOffset<i.length?n=i[AV.dataOffset]:(n=AV.requestRenderData(),i[AV.dataOffset]=n),r=n),r&&r.vertexCount<a&&r.request(e,3*e),n},stroke:function(t){Ci.copy(bV,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){Ci.copy(bV,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e,i,n,r,a=.5*t.lineWidth,o=t.lineCap,s=t.lineJoin,l=t.miterLimit;if(AV=t.impl){var c=(e=a,i=dV,n=AV.tessTol,r=2*gV(e/(e+n)),mV(2,vV(i/r)));this._calculateJoins(AV,a,s,l);for(var h=AV.paths,u=0,_=AV.pathOffset,f=AV.pathLength;_<f;_++){var d=h[_],p=d.points.length;s===Cz.ROUND?u+=2*(p+d.bevel*(c+2)+1):u+=2*(p+5*d.bevel+1),d.closed||(o===xz.ROUND?u+=2*(2*c+2):u+=12)}var m=EV=this.getRenderData(t,u);if(m){for(var v=m.vData,g=m.iData,y=AV.pathOffset,T=AV.pathLength;y<T;y++){var S=h[y],E=S.points,A=E.length,b=m.vertexStart,x=void 0,C=void 0,w=0,R=0,I=S.closed;if(I?(x=E[A-1],C=E[0],w=0,R=A):(x=E[0],C=E[1],w=1,R=A-1),C=C||x,!I){var O=new lU(C.x,C.y);O.subtract(x),O.normalize();var P=O.x,M=O.y;o===xz.BUTT?this._buttCapStart(x,P,M,a,0):o===xz.SQUARE?this._buttCapStart(x,P,M,a,a):o===xz.ROUND&&this._roundCapStart(x,P,M,a,c)}for(var D=w;D<R;++D)s===Cz.ROUND?this._roundJoin(x,C,a,a,c):0!=(C.flags&(wz.PT_BEVEL|wz.PT_INNERBEVEL))?this._bevelJoin(x,C,a,a):(this._vSet(C.x+C.dmx*a,C.y+C.dmy*a,1),this._vSet(C.x-C.dmx*a,C.y-C.dmy*a,-1)),x=C,C=E[D+1];if(I){var N=8*b;this._vSet(v[N],v[N+1],1),this._vSet(v[N+8],v[N+8+1],-1)}else{var L=new lU(C.x,C.y);L.subtract(x),L.normalize();var B=L.x,F=L.y;o===xz.BUTT?this._buttCapEnd(C,B,F,a,0):o===xz.SQUARE?this._buttCapEnd(C,B,F,a,a):o===xz.ROUND&&this._roundCapEnd(C,B,F,a,c)}for(var z=m.indicesStart,U=b+2,k=m.vertexStart;U<k;U++)g[z++]=U-2,g[z++]=U-1,g[z++]=U;m.indicesStart=z}EV=null,AV=null}}},_expandFill:function(t){if(AV=t.impl){for(var e=AV.paths,i=0,n=AV.pathOffset,r=AV.pathLength;n<r;n++)i+=e[n].points.length;var a=EV=this.getRenderData(t,i);if(a){for(var o=a,s=o.vData,l=o.iData,c=AV.pathOffset,h=AV.pathLength;c<h;c++){var u=e[c],_=u.points,f=_.length;if(0!==f){for(var d=a.vertexStart,p=0;p<f;++p)this._vSet(_[p].x,_[p].y);var m=a.indicesStart;if(u.complex){for(var v=[],g=d,y=a.vertexStart;g<y;g++){var T=8*g;v.push(s[T++]),v.push(s[T++]),v.push(s[T++])}var S=fV(v,null,3);if(!S||0===S.length)continue;for(var E=0,A=S.length;E<A;E++)l[m++]=S[E]+d}else for(var b=d,x=d+2,C=o.vertexStart;x<C;x++)l[m++]=b,l[m++]=x-1,l[m++]=x;o.indicesStart=m}}EV=null,AV=null}}},_calculateJoins:function(t,e,i,n){var r=0;e>0&&(r=1/e);for(var a=t.paths,o=t.pathOffset,s=t.pathLength;o<s;o++){var l=a[o],c=l.points,h=c.length,u=c[h-1],_=c[0];l.bevel=0;for(var f=0;f<h;f++){var d,p,m=u.dy,v=-u.dx,g=_.dy,y=-_.dx;if(_.dmx=.5*(m+g),_.dmy=.5*(v+y),(d=_.dmx*_.dmx+_.dmy*_.dmy)>1e-6){var T=1/d;T>600&&(T=600),_.dmx*=T,_.dmy*=T}_.dx*u.dy-u.dx*_.dy>0&&(_.flags|=wz.PT_LEFT),d*(p=mV(11,pV(u.len,_.len)*r))*p<1&&(_.flags|=wz.PT_INNERBEVEL),_.flags&wz.PT_CORNER&&(d*n*n<1||i===Cz.BEVEL||i===Cz.ROUND)&&(_.flags|=wz.PT_BEVEL),0!=(_.flags&(wz.PT_BEVEL|wz.PT_INNERBEVEL))&&l.bevel++,u=_,_=c[f+1]}}},_flattenPaths:function(t){for(var e=t.paths,i=t.pathOffset,n=t.pathLength;i<n;i++){var r=e[i],a=r.points,o=a[a.length-1],s=a[0];a.length>2&&o.equals(s)&&(r.closed=!0,a.pop(),o=a[a.length-1]);for(var l=0,c=a.length;l<c;l++){var h=new lU(s.x,s.y);h.subtract(o),o.len=h.length(),(h.x||h.y)&&h.normalize(),o.dx=h.x,o.dy=h.y,o=s,s=a[l+1]}}},_chooseBevel:function(t,e,i,n){var r=i.x,a=i.y,o=0,s=0,l=0,c=0;return 0!==t?(o=r+e.dy*n,s=a-e.dx*n,l=r+i.dy*n,c=a-i.dx*n):(o=l=r+i.dmx*n,s=c=a+i.dmy*n),[o,s,l,c]},_buttCapStart:function(t,e,i,n,r){var a=t.x-e*r,o=t.y-i*r,s=i,l=-e;this._vSet(a+s*n,o+l*n,1),this._vSet(a-s*n,o-l*n,-1)},_buttCapEnd:function(t,e,i,n,r){var a=t.x+e*r,o=t.y+i*r,s=i,l=-e;this._vSet(a+s*n,o+l*n,1),this._vSet(a-s*n,o-l*n,-1)},_roundCapStart:function(t,e,i,n,r){for(var a=t.x,o=t.y,s=i,l=-e,c=0;c<r;c++){var h=c/(r-1)*dV,u=yV(h)*n,_=TV(h)*n;this._vSet(a-s*u-e*_,o-l*u-i*_,1),this._vSet(a,o,0)}this._vSet(a+s*n,o+l*n,1),this._vSet(a-s*n,o-l*n,-1)},_roundCapEnd:function(t,e,i,n,r){var a=t.x,o=t.y,s=i,l=-e;this._vSet(a+s*n,o+l*n,1),this._vSet(a-s*n,o-l*n,-1);for(var c=0;c<r;c++){var h=c/(r-1)*dV,u=yV(h)*n,_=TV(h)*n;this._vSet(a,o,0),this._vSet(a-s*u+e*_,o-l*u+i*_,1)}},_roundJoin:function(t,e,i,n,r){var a=t.dy,o=-t.dx,s=e.dy,l=-e.dx,c=e.x,h=e.y;if(0!=(e.flags&wz.PT_LEFT)){var u=this._chooseBevel(e.flags&wz.PT_INNERBEVEL,t,e,i),_=u[0],f=u[1],d=u[2],p=u[3],m=SV(-o,-a),v=SV(-l,-s);v>m&&(v-=2*dV),this._vSet(_,f,1),this._vSet(c-a*n,e.y-o*n,-1);for(var g=wV(vV((m-v)/dV)*r,2,r),y=0;y<g;y++){var T=m+y/(g-1)*(v-m),S=c+yV(T)*n,E=h+TV(T)*n;this._vSet(c,h,0),this._vSet(S,E,-1)}this._vSet(d,p,1),this._vSet(c-s*n,h-l*n,-1)}else{var A=this._chooseBevel(e.flags&wz.PT_INNERBEVEL,t,e,-n),b=A[0],x=A[1],C=A[2],w=A[3],R=SV(o,a),I=SV(l,s);I<R&&(I+=2*dV),this._vSet(c+a*n,h+o*n,1),this._vSet(b,x,-1);for(var O=wV(vV((I-R)/dV)*r,2,r),P=0;P<O;P++){var M=R+P/(O-1)*(I-R),D=c+yV(M)*i,N=h+TV(M)*i;this._vSet(D,N,1),this._vSet(c,h,0)}this._vSet(c+s*n,h+l*n,1),this._vSet(C,w,-1)}},_bevelJoin:function(t,e,i,n){var r=0,a=0,o=0,s=0,l=0,c=0,h=0,u=0,_=t.dy,f=-t.dx,d=e.dy,p=-e.dx;if(e.flags&wz.PT_LEFT){var m=this._chooseBevel(e.flags&wz.PT_INNERBEVEL,t,e,i);l=m[0],c=m[1],h=m[2],u=m[3],this._vSet(l,c,1),this._vSet(e.x-_*n,e.y-f*n,-1),this._vSet(h,u,1),this._vSet(e.x-d*n,e.y-p*n,-1)}else{var v=this._chooseBevel(e.flags&wz.PT_INNERBEVEL,t,e,-n);r=v[0],a=v[1],o=v[2],s=v[3],this._vSet(e.x+_*i,e.y+f*i,1),this._vSet(r,a,-1),this._vSet(e.x+d*i,e.y+p*i,1),this._vSet(o,s,-1)}},_vSet:function(t,e,i){if(void 0===i&&(i=0),EV){var n=EV,r=8*n.vertexStart,a=n.vData;a[r++]=t,a[r++]=e,a[r++]=0,Ci.toArray(a,bV,r),r+=4,a[r++]=i,n.vertexStart++}}},IV=t("graphicsAssembler",{getAssembler:function(){return RV}});YU.Assembler=IV;var OV=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},PV=new nn,MV=null,DV=null,NV=[],LV=[],BV=[],FV=[],zV=new tn,UV=new tn,kV=new Xi,GV=null,HV=0,VV=0,WV=0,jV=0,qV=0,XV=1,YV=null,KV="",ZV=0,QV=0,JV=0,$V=0,tW=0,eW=0,iW=0,nW=!1,rW=0,aW=0,oW=0,sW={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&MV!==t&&(DV=(MV=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),MV.actualFontSize=ZV,DV.setContentSize(UV),MV.renderData.vertDirty=MV.renderData.uvDirty=!1,MV.markForUpdateRenderData(!1),MV=null,this._resetProperties())},_updateFontScale:function(){XV=ZV/QV},_updateFontFamily:function(t){var e=t.font;YV=e.spriteFrame,GV=e.fntConfig,xB.fontAtlas=e.fontDefDictionary,uL.packToDynamicAtlas(t,YV)},_updateLabelInfo:function(){xB.hash="",xB.margin=0},_updateProperties:function(t){KV=t.string.toString(),ZV=t.fontSize,QV=GV?GV.fontSize:t.fontSize,JV=t.horizontalAlign,$V=t.verticalAlign,tW=t.spacingX,iW=t.overflow,eW=t._lineHeight;var e=DV.contentSize;UV.width=e.width,UV.height=e.height,iW===Ez.NONE?(nW=!1,UV.width+=2*xB.margin,UV.height+=2*xB.margin):iW===Ez.RESIZE_HEIGHT?(nW=!0,UV.height+=2*xB.margin):nW=t.enableWrapText,xB.lineHeight=eW,xB.fontSize=ZV,this._setupBMFontOverflowMetrics()},_resetProperties:function(){GV=null,YV=null,xB.hash="",xB.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=KV,e=t.length,i=GV.kerningDict,n=NV,r=-1,a=0;a<e;++a){var o=t.charCodeAt(a),s=i[r<<16|65535&o]||0;n[a]=a<e-1?s:0,r=o}},_multilineTextWrap:function(t){for(var e=KV.length,i=0,n=0,r=0,a=0,o=0,s=0,l=0,c=null,h=0;h<e;){var u=KV.charAt(h);if("\n"!==u){for(var _=t(KV,h,e),f=s,d=l,p=o,m=n,v=!1,g=0;g<_;++g){var y=h+g;if("\r"!==(u=KV.charAt(y)))if(c=xB.fontAtlas.getLetterDefinitionForChar(u,xB)){var T=m+c.offsetX*XV-xB.margin;if(nW&&oW>0&&n>0&&T+c.w*XV>oW&&!QL(u)){BV.push(o),o=0,i++,n=0,r-=eW*this._getFontScale()+0,v=!0;break}kV.x=T,kV.y=r-c.offsetY*XV,this._recordLetterInfo(kV,u,y,i),y+1<NV.length&&y<e-1&&(m+=NV[y+1]),m+=c.xAdvance*XV+tW,p=kV.x+c.w*XV,f<kV.y&&(f=kV.y),d>kV.y-c.h*XV&&(d=kV.y-c.h*XV)}else this._recordPlaceholderInfo(y,u),console.log("Can't find letter definition in texture atlas "+GV.atlasName+" for letter:"+u);else this._recordPlaceholderInfo(y,u)}v||(n=m,s<f&&(s=f),l>d&&(l=d),a<(o=p)&&(a=o),h+=_)}else BV.push(o),o=0,i++,n=0,r-=eW*this._getFontScale()+0,this._recordPlaceholderInfo(h,u),h++}return BV.push(o),VV=(HV=i+1)*eW*this._getFontScale(),HV>1&&(VV+=0*(HV-1)),UV.width=rW,UV.height=aW,rW<=0&&(UV.width=parseFloat(a.toFixed(2))+2*xB.margin),aW<=0&&(UV.height=parseFloat(VV.toFixed(2))+2*xB.margin),jV=UV.height,qV=0,s>0&&(jV=UV.height+s),l<-VV&&(qV=VV+l),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return iW===Ez.SHRINK?XV:1},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(ZL(n)||"\n"===n||QL(n))return 1;var r=1,a=xB.fontAtlas.getLetterDefinitionForChar(n,xB);if(!a)return r;for(var o=a.xAdvance*XV+tW,s=e+1;s<i&&(n=t.charAt(s),a=xB.fontAtlas.getLetterDefinitionForChar(n,xB));++s){if(o+a.offsetX*XV+a.w*XV>oW&&!QL(n)&&oW>0)return r;if(o+=a.xAdvance*XV+tW,"\n"===n||QL(n)||ZL(n))break;r++}return r},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=LV.length){var i=new OV;LV.push(i)}LV[t].char=e,LV[t].hash=e.charCodeAt(0)+xB.hash,LV[t].valid=!1},_recordLetterInfo:function(t,e,i,n){if(i>=LV.length){var r=new OV;LV.push(r)}var a=e.charCodeAt(0)+xB.hash;LV[i].line=n,LV[i].char=e,LV[i].hash=a,LV[i].valid=xB.fontAtlas.getLetter(a).valid,LV[i].x=t.x,LV[i].y=t.y},_alignText:function(){VV=0,BV.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),iW===Ez.SHRINK&&ZV>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||iW===Ez.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),ZV=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,i=0|ZV,n=0;e<i;){var r=n=e+i+1>>1;if(r<=0)break;XV=r/QV,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?i=n-1:e=n}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return VV>UV.height},_isHorizontalClamp:function(){for(var t=!1,e=0,i=KV.length;e<i;++e){var n=LV[e];if(n.valid){var r=xB.fontAtlas.getLetterDefinitionForChar(n.char,xB);if(!r)continue;var a=n.x+r.w/2*XV,o=n.line;if(rW>0)if(nW){if(BV[o]>UV.width&&(a>UV.width||a<0)){t=!0;break}}else if(a>UV.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var i=BV[e],n=t>UV.width||t<0;return nW?i>UV.width&&n:n},_updateQuads:function(){if(!MV)return!1;var t=YV?YV.texture:xB.fontAtlas.getTexture(),e=MV.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var i=DV.anchorPoint,n=UV,r=i.x*n.width,a=i.y*n.height,o=!0,s=0,l=KV.length;s<l;++s){var c=LV[s];if(c.valid){var h=xB.fontAtlas.getLetter(c.hash);if(h){PV.height=h.h,PV.width=h.w,PV.x=h.u,PV.y=h.v;var u=c.y+WV;if(aW>0){if(u>jV){var _=u-jV;PV.y+=_,PV.height-=_,u-=_}u-h.h*XV<qV&&iW===Ez.CLAMP&&(PV.height=u<qV?0:(u-qV)/XV)}var f=c.line,d=c.x+h.w/2*XV+FV[f];if(rW>0&&this._isHorizontalClamped(d,f))if(iW===Ez.CLAMP)PV.width=0;else if(iW===Ez.SHRINK){if(UV.width>h.w){o=!1;break}PV.width=0}if(PV.height>0&&PV.width>0){var p=this._determineRect(),m=c.x+FV[c.line];this.appendQuad(MV,t,PV,p,m-r,u-a,XV)}}else console.warn("Can't find letter in this bitmap-font")}}return o},appendQuad:function(){},_determineRect:function(){var t=YV.isRotated(),e=YV.getOriginalSize(),i=YV.getRect(),n=YV.getOffset(),r=n.x+(e.width-i.width)/2,a=n.y-(e.height-i.height)/2;if(t){var o=PV.x;PV.x=i.x+i.height-PV.y-PV.height-a,PV.y=o+i.y-r,PV.y<0&&(PV.height+=a)}else PV.x+=i.x-r,PV.y+=i.y+a;return t},_computeAlignmentOffset:function(){switch(FV.length=0,JV){case Tz.LEFT:for(var t=0;t<HV;++t)FV.push(0);break;case Tz.CENTER:for(var e=0,i=BV.length;e<i;e++)FV.push((UV.width-BV[e])/2);break;case Tz.RIGHT:for(var n=0,r=BV.length;n<r;n++)FV.push(UV.width-BV[n])}if(WV=UV.height,$V!==Sz.TOP){var a=UV.height-VV+eW*this._getFontScale()-QV*XV;$V===Sz.BOTTOM?WV-=a:WV-=a/2}},_setupBMFontOverflowMetrics:function(){var t=UV.width,e=UV.height;iW===Ez.RESIZE_HEIGHT&&(e=0),iW===Ez.NONE&&(t=0,e=0),rW=t,aW=e,zV.width=t,zV.height=e,oW=t}},lW={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){oL(t.node,e,t.renderData,t.color)},appendQuad:function(t,e,i,n,r,a,o){var s=t.renderData;if(s){var l=s.dataLength;s.dataLength+=4,s.vertexCount=s.dataLength,s.indicesCount=s.dataLength/2*3;var c=s.data,h=e.width,u=e.height,_=i.width,f=i.height,d=0,p=0,m=0,v=0;n?(d=i.x/h,v=(i.x+f)/h,p=(i.y+_)/u,m=i.y/u,c[l].u=d,c[l].v=m,c[l+1].u=d,c[l+1].v=p,c[l+2].u=v,c[l+2].v=m,c[l+3].u=v,c[l+3].v=p):(d=i.x/h,v=(i.x+_)/h,p=(i.y+f)/u,m=i.y/u,c[l].u=d,c[l].v=p,c[l+1].u=v,c[l+1].v=p,c[l+2].u=d,c[l+2].v=m,c[l+3].u=v,c[l+3].v=m),c[l].x=r,c[l].y=a-f*o,c[l+1].x=r+_*o,c[l+1].y=a-f*o,c[l+2].x=r,c[l+2].y=a,c[l+3].x=r+_*o,c[l+3].y=a}}};Vt(lW,sW);var cW=null,hW=Wt(sW,{getAssemblerData:function(){return cW||(cW=new bB(1024,1024)),cW.getTexture()},_updateFontFamily:function(t){xB.fontAtlas=cW,xB.fontFamily=this._getFontFamily(t);var e=t.getComponent(rG);e&&e.enabled?(xB.isOutlined=!0,xB.margin=e.width,xB.out=e.color.clone(),xB.out.a=e.color.a*t.color.a/255):(xB.isOutlined=!1,xB.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(t.font._nativeAsset?e=t.font._nativeAsset:BI.postLoadNative(t.font,(function(){t.isValid&&(e=t.font._nativeAsset||"Arial",t.updateRenderData(!0))}))),e},_updateLabelInfo:function(t){xB.fontDesc=this._getFontDesc(),xB.color=t.color,xB.hash=function(t){var e=t.color.toHEX(),i="";return t.isOutlined&&t.margin>0&&(i=i+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+i}(xB)},_getFontDesc:function(){return xB.fontSize.toString()+"px "+xB.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),uW=new Ci(255,255,255,255),_W={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var i=t.node;uW.a=t.color.a,oL(i,e,t.renderData,uW)}},appendQuad:lW.appendQuad};Vt(_W,hW);var fW=Rz.Overflow,dW=null,pW=null,mW=null,vW="",gW="",yW=0,TW=0,SW=[],EW=new tn,AW=0,bW=0,xW=0,CW=new Ci,wW="",RW=fW.NONE,IW=!1,OW=null,PW=Ci.BLACK.clone(),MW=null,DW=Ci.BLACK.clone(),NW=new nn,LW=tn.ZERO.clone(),BW=tn.ZERO.clone(),FW=Xi.ZERO.clone(),zW=Xi.ZERO.clone(),UW=0,kW=0,GW=!1,HW=!1,VW=!1,WW=["left","center","right"],jW={getAssemblerData:function(){return Rz._canvasPool.get()},resetAssemblerData:function(t){t&&Rz._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(t),this._updateTexture(),this._calDynamicAtlas(t),t.actualFontSize=yW,e.setContentSize(EW),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),dW=null,pW=null,mW=null}},updateVertexData:function(){},updateUvs:function(){},_updateFontFamily:function(t){t.useSystemFont?wW=t.fontFamily||"Arial":t.font?t.font._nativeAsset?wW=t.font._nativeAsset:(BI.postLoadNative(t.font,(function(){t.isValid&&(wW=t.font._nativeAsset||"Arial",t.updateRenderData(!0))})),wW="Arial"):wW="Arial"},_updateProperties:function(t,e){var i=t.assemblerData;i&&(dW=i.context,pW=i.canvas,mW=t.spriteFrame,gW=t.string.toString(),yW=t.fontSize,TW=yW,RW=t.overflow,BW.width=EW.width=e.width,BW.height=EW.height=e.height,kW=t.underlineHeight,AW=t.lineHeight,bW=t.horizontalAlign,xW=t.verticalAlign,CW=t.color,GW=t.isBold,HW=t.isItalic,VW=t.isUnderline,IW=RW!==fW.NONE&&(RW===fW.RESIZE_HEIGHT||t.enableWrapText),(OW=(OW=rG&&t.getComponent(rG))&&OW.enabled&&OW.width>0?OW:null)&&PW.set(OW.color),(MW=(MW=WH&&t.getComponent(WH))&&MW.enabled?MW:null)&&DW.set(MW.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,i=0,n=0,r=0;if(LW.width=LW.height=0,OW&&(t=e=i=n=r=OW.width,LW.width=LW.height=2*r),MW){var a=MW.blur+r,o=MW.offset.x,s=MW.offset.y;i=Math.max(i,-o+a),n=Math.max(n,o+a),t=Math.max(t,s+a),e=Math.max(e,-s+a)}if(HW){var l=TW*Math.tan(.20943951);n+=l,LW.width+=l}NW.x=i,NW.y=t,NW.width=i+n,NW.height=t+e},_calculateFillTextStartPosition:function(){var t=0;bW===Tz.RIGHT?t=EW.width-NW.width:bW===Tz.CENTER&&(t=(EW.width-NW.width)/2);var e=this._getLineHeight()*(SW.length-1),i=yW*(1-kL/2);if(xW!==Sz.TOP){var n=e+NW.height+yW-EW.height;xW===Sz.BOTTOM?i-=n+=kL/2*yW:i-=n/2}i+=0*yW,FW.set(t+NW.x,i+NW.y)},_updateTexture:function(){if(dW&&pW){dW.clearRect(0,0,pW.width,pW.height),dW.font=vW,this._calculateFillTextStartPosition();var t=this._getLineHeight();dW.lineJoin="round",dW.fillStyle="rgba("+CW.r+", "+CW.g+", "+CW.b+", 1)";var e,i=FW.x,r=0;this._drawTextEffect(FW,t);for(var a=0;a<SW.length;++a)r=FW.y+a*t,OW&&dW.strokeText(SW[a],i,r),dW.fillText(SW[a],i,r);MW&&(dW.shadowColor="transparent"),mW&&(e=mW instanceof vL?mW.texture:mW,0!==pW.width&&0!==pW.height&&(e.reset({width:pW.width,height:pW.height,mipmapLevel:1}),e.uploadData(pW),mW instanceof vL&&(mW.rect=new nn(0,0,pW.width,pW.height),mW._calculateUV()),n.director.root&&n.director.root.batcher2D&&n.director.root.batcher2D._releaseDescriptorSetCache(e.getHash())))}},_resetDynamicAtlas:function(t){if(t.cacheMode===Rz.CacheMode.BITMAP){var e=t.ttfSpriteFrame;uL.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(t){if(t.cacheMode===Rz.CacheMode.BITMAP){var e=t.ttfSpriteFrame;uL.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){dW.strokeStyle="rgba("+PW.r+", "+PW.g+", "+PW.b+", "+PW.a/255+")",dW.lineWidth=2*OW.width},_setupShadow:function(){dW.shadowColor="rgba("+DW.r+", "+DW.g+", "+DW.b+", "+DW.a/255+")",dW.shadowBlur=MW.blur,dW.shadowOffsetX=MW.offset.x,dW.shadowOffsetY=-MW.offset.y},_drawTextEffect:function(t,e){if(MW||OW||VW){var i=SW.length>1&&MW,n=this._measureText(dW,vW),r=0,a=0;MW&&this._setupShadow(),OW&&this._setupOutline();for(var o=0;o<SW.length;++o)r=t.x,a=t.y+o*e,i&&(OW&&dW.strokeText(SW[o],r,a),dW.fillText(SW[o],r,a)),VW&&(UW=n(SW[o]),bW===Tz.RIGHT?zW.x=t.x-UW:bW===Tz.CENTER?zW.x=t.x-UW/2:zW.x=t.x,zW.y=a+TW/8,dW.fillRect(zW.x,zW.y,UW,kW));i&&(dW.shadowColor="transparent")}},_updateLabelDimensions:function(){EW.width=Math.min(EW.width,2048),EW.height=Math.min(EW.height,2048);var t=!1;pW.width!==EW.width&&(pW.width=EW.width,t=!0),pW.height!==EW.height&&(pW.height=EW.height,t=!0),t&&(dW.font=vW),dW.textAlign=WW[bW],dW.textBaseline="alphabetic"},_getFontDesc:function(){var t=yW.toString()+"px ";return t+=wW,GW&&(t="bold "+t),HW&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===AW?yW:AW*yW/TW)},_calculateParagraphLength:function(t,e){for(var i,n=[],r=Q(t);!(i=r()).done;){var a=JL(e,i.value,vW);n.push(a)}return n},_measureText:function(t,e){return function(i){return JL(t,i,e)}},_calculateShrinkFont:function(t){if(dW){var e=this._calculateParagraphLength(t,dW),i=0,n=0,r=0;if(IW){var a=BW.width,o=BW.height;if(a<0||o<0)return;n=o+1;for(var s=0,l=0|yW+1,c=0;s<l;){if((c=s+l+1>>1)<=0){T(4003);break}yW=c,vW=this._getFontDesc(),dW.font=vW;var h=this._getLineHeight();for(n=0,i=0;i<t.length;++i){var u=JL(dW,t[i],vW);n+=tB(t[i],u,a,this._measureText(dW,vW)).length*h}n>o?l=c-1:s=c}0===s?T(4003):(yW=s,vW=this._getFontDesc(),dW.font=vW)}else{for(n=t.length*this._getLineHeight(),i=0;i<t.length;++i)r<e[i]&&(r=e[i]);var _=(EW.width-NW.width)/r,f=EW.height/n;yW=TW*Math.min(1,_,f)|0,vW=this._getFontDesc(),dW.font=vW}}},_calculateWrapText:function(t){if(IW&&dW){SW=[];for(var e=BW.width,i=0;i<t.length;++i){var n=JL(dW,t[i],vW),r=tB(t[i],n,e,this._measureText(dW,vW));SW=SW.concat(r)}}},_calculateLabelFont:function(){if(dW){var t=gW.split("\n");switch(SW=t,vW=this._getFontDesc(),dW.font=vW,RW){case fW.NONE:for(var e=0,i=0,n=0;n<t.length;++n){var r=JL(dW,t[n],vW);e=e>r?e:r}i=(SW.length+kL)*this._getLineHeight();var a=parseFloat(e.toFixed(2)),o=parseFloat(i.toFixed(2));EW.width=a+NW.width,EW.height=o+NW.height,BW.width=a+LW.width,BW.height=o+LW.height;break;case fW.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case fW.CLAMP:this._calculateWrapText(t);break;case fW.RESIZE_HEIGHT:this._calculateWrapText(t);var s=(SW.length+kL)*this._getLineHeight();EW.height=s+NW.height,BW.height=s+LW.height}}}},qW=Ci.WHITE.clone(),XW={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var i=e.vData=new Float32Array(36);i[3]=i[21]=i[22]=i[31]=0,i[4]=i[12]=i[13]=i[30]=1;for(var n=5,r=0;r<4;r++)Ci.toArray(i,qW,n),n+=9;return e},fillBuffers:function(t,e){var i=t.renderData,n=i.data,r=t.node,a=e.acquireBufferBatch(),o=a.byteOffset>>2,s=a.indicesOffset,l=a.vertexOffset;a.request()||(a=e.currBufferBatch,s=0,l=0,o=0);var c=a.vData,h=a.iData,u=i.vData,_=n[0],f=n[3];r.updateWorldTransform();var d=r._pos,p=r._rot,m=r._scale,v=_.x*m.x,g=f.x*m.x,y=_.y*m.y,T=f.y*m.y,S=p.x,E=p.y,A=p.z,b=p.w,x=S*E,C=A*b,w=S*S-E*E,R=b*b-A*A,I=R+w,O=2*(x-C),P=R-w,M=2*(x+C),D=d.x,N=d.y;u[0]=I*v+O*y+D,u[1]=P*y+M*v+N,u[9]=I*g+O*y+D,u[10]=P*y+M*g+N,u[18]=I*v+O*T+D,u[19]=P*T+M*v+N,u[27]=I*g+O*T+D,u[28]=P*T+M*g+N,c.set(u,o),h[s++]=l,h[s++]=l+1,h[s++]=l+2,h[s++]=l+2,h[s++]=l+1,h[s++]=l+3},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,n=i.width,r=i.height,a=i.anchorX*n,o=i.anchorY*r,s=e.data;s[0].x=-a,s[0].y=-o,s[3].x=n-a,s[3].y=r-o}},updateUvs:function(t){var e=t.renderData;if(e){var i=e.vData;if(i&&e.uvDirty){var n=t.ttfSpriteFrame.uv;i[3]=n[0],i[4]=n[1],i[12]=n[2],i[13]=n[3],i[21]=n[4],i[22]=n[5],i[30]=n[6],i[31]=n[7],e.uvDirty=!1}}}};Vt(XW,jW);var YW=t("labelAssembler",{getAssembler:function(t){var e=XW;return t.font instanceof zL?e=lW:t.cacheMode===Rz.CacheMode.CHAR&&(e=_W),e}});Rz.Assembler=YW;var KW=yG.FillType,ZW=new Vi,QW={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;uL.packToDynamicAtlas(t,e);var i=t.renderData;if(i&&e){var n=i.uvDirty,r=i.vertDirty;if(!n&&!r)return;var a=t.fillStart,o=t.fillRange;o<0&&(a+=o,o=-o),o=(o=(o=a+o)>1?1:o)<0?0:o;var s=(a=(a=a>1?1:a)<0?0:a)+(o=(o-=a)<0?0:o);s=s>1?1:s,n&&this.updateUVs(t,a,s),r&&(this.updateVertexData&&this.updateVertexData(t,a,s),this.updateWorldVertexData(t))}},updateUVs:function(t,e,i){var n=t.spriteFrame,r=t.renderData,a=r.data,o=n.width,s=n.height,l=n.getRect(),c=0,h=0,u=0,_=0,f=0,d=0,p=0,m=0,v=0,g=0;switch(n.isRotated()?(c=l.x/o,h=(l.y+l.width)/s,u=f=c,p=v=(l.x+l.height)/o,d=g=h,_=m=l.y/s):(c=l.x/o,h=(l.y+l.height)/s,u=p=c,f=v=(l.x+l.width)/o,_=d=h,m=g=l.y/s),t.fillType){case KW.HORIZONTAL:a[0].u=u+(f-u)*e,a[0].v=_+(d-_)*e,a[1].u=u+(f-u)*i,a[1].v=_+(d-_)*i,a[2].u=p+(v-p)*e,a[2].v=m+(g-m)*e,a[3].u=p+(v-p)*i,a[3].v=m+(g-m)*i;break;case KW.VERTICAL:a[0].u=u+(p-u)*e,a[0].v=_+(m-_)*e,a[1].u=f+(v-f)*e,a[1].v=d+(g-d)*e,a[2].u=u+(p-u)*i,a[2].v=_+(m-_)*i,a[3].u=f+(v-f)*i,a[3].v=d+(g-d)*i;break;default:b(2626)}r.uvDirty=!1},updateVertexData:function(t,e,i){var n=t.renderData,r=n.data,a=t.node._uiProps.uiTransformComp,o=a.width,s=a.height,l=a.anchorX*o,c=a.anchorY*s,h=-l,u=-c,_=o-l,f=s-c,d=0;switch(t.fillType){case KW.HORIZONTAL:d=h+(_-h)*i,h+=(_-h)*e,_=d;break;case KW.VERTICAL:d=u+(f-u)*i,u+=(f-u)*e,f=d;break;default:b(2626)}r[4].x=h,r[4].y=u,r[5].x=_,r[5].y=u,r[6].x=h,r[6].y=f,r[7].x=_,r[7].y=f,n.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var i,n=Q(e.data);!(i=n()).done;)i.value.z=0;return e},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(ZW);for(var n=0;n<4;n++){var r=i[n+4],a=i[n];Ri.transformMat4(a,r,ZW)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t),t.node,function(t,e,i,n){var r=i.data,a=e.acquireBufferBatch(),o=a.byteOffset>>2,s=i.vertexCount,l=a.indicesOffset,c=a.vertexOffset;a.request(s,i.indicesCount)||(a=e.currBufferBatch,s=0,l=0,c=0);for(var h=a.vData,u=0;u<s;u++){var _=r[u];h[o++]=_.x,h[o++]=_.y,h[o++]=_.z,h[o++]=_.u,h[o++]=_.v,Ci.toArray(h,n,o),o+=4}var f=a.iData;f[l++]=c,f[l++]=c+1,f[l++]=c+2,f[l++]=c+1,f[l++]=c+3,f[l++]=c+2}(0,e,t.renderData,t.color)}},JW=2*Math.PI,$W=[new Xi,new Xi,new Xi,new Xi],tj=new Array(4),ej=new Array(8),ij=[new Xi,new Xi,new Xi,new Xi],nj=[new Xi,new Xi,new Xi,new Xi],rj=new Xi,aj=[new Xi,new Xi,new Xi,new Xi];function oj(t,e,i,n,r,a,o){var s=Math.sin(a);s=Math.abs(s)>1e-6?s:0;var l=Math.cos(a),c=0,h=0;if(0!==(l=Math.abs(l)>1e-6?l:0)){if(c=s/l,(t-r.x)*l>0){var u=r.y+c*(t-r.x);o[0].x=t,o[0].y=u}if((e-r.x)*l>0){var _=r.y+c*(e-r.x);o[2].x=e,o[2].y=_}}if(0!==s){if(h=l/s,(n-r.y)*s>0){var f=r.x+h*(n-r.y);o[3].x=f,o[3].y=n}if((i-r.y)*s>0){var d=r.x+h*(i-r.y);o[1].x=d,o[1].y=i}}}function sj(t,e){var i=e.x-t.x,n=e.y-t.y;if(0===i&&0===n)return 0;if(0===i)return n>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(n/i);return i<0&&(r+=Math.PI),r}function lj(t,e,i,n,r){var a=tj,o=a[0],s=a[1],l=a[2],c=a[3];t[e].x=i.x,t[e].y=i.y,t[e+1].x=n.x,t[e+1].y=n.y,t[e+2].x=r.x,t[e+2].y=r.y,cj((i.x-o)/(l-o),(i.y-s)/(c-s),t,e),cj((n.x-o)/(l-o),(n.y-s)/(c-s),t,e+1),cj((r.x-o)/(l-o),(r.y-s)/(c-s),t,e+2)}function cj(t,e,i,n){var r=ej,a=r[0]+(r[2]-r[0])*t,o=r[4]+(r[6]-r[4])*t,s=r[1]+(r[3]-r[1])*t,l=r[5]+(r[7]-r[5])*t,c=i[n];c.u=a+(o-a)*e,c.v=s+(l-s)*e}for(var hj={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;uL.packToDynamicAtlas(t,e);var i=t.renderData;if(i&&e&&(i.vertDirty||i.uvDirty)){var n=i.data,r=t.fillStart,a=t.fillRange;for(a<0&&(r+=a,a=-a);r>=1;)r-=1;for(;r<0;)r+=1;var o=(r*=JW)+(a*=JW);!function(t){var e=t.node._uiProps.uiTransformComp,i=e.width,n=e.height,r=e.anchorX*i,a=e.anchorY*n,o=-r,s=-a,l=i-r,c=n-a,h=tj;h[0]=o,h[1]=s,h[2]=l,h[3]=c;var u=t.fillCenter,_=rj.x=Math.min(Math.max(0,u.x),1)*(l-o)+o,f=rj.y=Math.min(Math.max(0,u.y),1)*(c-s)+s;$W[0].x=$W[3].x=o,$W[1].x=$W[2].x=l,$W[0].y=$W[1].y=s,$W[2].y=$W[3].y=c;for(var d,p=Q(aj);!(d=p()).done;){var m=d.value;Xi.set(m,0,0)}_!==h[0]&&Xi.set(aj[0],3,0),_!==h[2]&&Xi.set(aj[2],1,2),f!==h[1]&&Xi.set(aj[1],0,1),f!==h[3]&&Xi.set(aj[3],2,3)}(t),function(t){var e=t.width,i=t.height,n=t.getRect(),r=0,a=0,o=0,s=0,l=ej;t.isRotated()?(r=n.x/e,a=(n.x+n.height)/e,o=n.y/i,s=(n.y+n.width)/i,l[0]=l[2]=r,l[4]=l[6]=a,l[3]=l[7]=s,l[1]=l[5]=o):(r=n.x/e,a=(n.x+n.width)/e,o=n.y/i,s=(n.y+n.height)/i,l[0]=l[4]=r,l[2]=l[6]=a,l[1]=l[3]=s,l[5]=l[7]=o)}(e),oj(tj[0],tj[2],tj[1],tj[3],rj,r,ij),oj(tj[0],tj[2],tj[1],tj[3],rj,r+a,nj);for(var s=0,l=0;l<4;++l){var c=aj[l];if(c)if(a>=JW)i.dataLength=s+3,lj(n,s,rj,$W[c.x],$W[c.y]),s+=3;else{var h=sj(rj,$W[c.x]),u=sj(rj,$W[c.y]);u<h&&(u+=JW),h-=JW,u-=JW;for(var _=0;_<3;++_)h>=o||(h>=r?(i.dataLength=s+3,lj(n,s,rj,$W[c.x],u>=o?nj[l]:$W[c.y]),s+=3):u>r&&(u<=o?(i.dataLength=s+3,lj(n,s,rj,ij[l],$W[c.y]),s+=3):(i.dataLength=s+3,lj(n,s,rj,ij[l],nj[l]),s+=3))),h+=JW,u+=JW}}i.indicesCount=i.vertexCount=s,i.vertDirty=i.uvDirty=!1}},fillBuffers:function(t,e){!function(t,e,i,n){var r=i.data,a=e.acquireBufferBatch(),o=a.byteOffset>>2,s=i.vertexCount,l=a.indicesOffset,c=a.vertexOffset;a.request(s,i.indicesCount)||(a=e.currBufferBatch,s=0,l=0,c=0);var h=a.vData;t.getWorldMatrix(aL);for(var u=0;u<s;u++){var _=r[u];Ri.set(rL,_.x,_.y,0),Ri.transformMat4(rL,rL,aL),h[o++]=rL.x,h[o++]=rL.y,h[o++]=rL.z,h[o++]=_.u,h[o++]=_.v,Ci.toArray(h,n,o),o+=4}for(var f=a.iData,d=0;d<i.dataLength;d++)f[l+d]=c+d}(t.node,e,t.renderData,t.color)}},uj=[],_j=0;_j<4;_j++)uj.push(new Ri);for(var fj={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;uL.packToDynamicAtlas(t,e);var i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.uvDirty&&this.updateUvs(t))},fillBuffers:function(t,e){if(null!==t){var i=t.renderData.data,n=t.node,r=e.acquireBufferBatch(),a=r.byteOffset>>2,o=r.indicesOffset,s=r.vertexOffset;r.request()||(r=e.currBufferBatch,a=0,o=0,s=0);var l=r.vData,c=r.iData,h=t.renderData.vData,u=i[0],_=i[3],f=n.worldMatrix,d=f.m00,p=f.m01,m=f.m04,v=f.m05,g=f.m12,y=f.m13,T=u.x,S=_.x,E=u.y,A=_.y,b=d*T,x=d*S,C=p*T,w=p*S,R=m*E,I=m*A,O=v*E,P=v*A;h[0]=b+R+g,h[1]=C+O+y,h[9]=x+R+g,h[10]=w+O+y,h[18]=b+I+g,h[19]=C+P+y,h[27]=x+I+g,h[28]=w+P+y,l.set(h,a),c[o++]=s,c[o++]=s+1,c[o++]=s+2,c[o++]=s+2,c[o++]=s+1,c[o++]=s+3}},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,n=e.data,r=i.width,a=i.height,o=i.anchorX*r,s=i.anchorY*a,l=0,c=0,h=0,u=0;if(t.trim)l=-o,c=-s,h=r-o,u=a-s;else{var _=t.spriteFrame,f=_.getOriginalSize(),d=_.getRect(),p=f.width,m=f.height,v=d.width,g=d.height,y=_.getOffset(),T=r/p,S=a/m,E=y.x+(p-v)/2,A=y.x-(p-v)/2;l=E*T-o,c=(y.y+(m-g)/2)*S-s,h=r+A*T-o,u=a+(y.y-(m-g)/2)*S-s}n[0].x=l,n[0].y=c,n[0].z=0,n[3].x=h,n[3].y=u,n[3].z=0,e.vertDirty=!1}},updateUvs:function(t){var e=t.renderData,i=e.vData,n=t.spriteFrame.uv;i[3]=n[0],i[4]=n[1],i[12]=n[2],i[13]=n[3],i[21]=n[4],i[22]=n[5],i[30]=n[6],i[31]=n[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,i=5,n=t.color,r=n.r/255,a=n.g/255,o=n.b/255,s=n.a/255,l=0;l<4;l++)e[i]=r,e[i+1]=a,e[i+2]=o,e[i+3]=s,i+=9}},dj=new Ri,pj=new Vi,mj={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;uL.packToDynamicAtlas(t,e);var i=t.renderData;i&&e&&i.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,i=e.data,n=t.node._uiProps.uiTransformComp,r=n.width,a=n.height,o=n.anchorX*r,s=n.anchorY*a,l=t.spriteFrame,c=l.insetLeft,h=l.insetRight,u=l.insetTop,_=l.insetBottom,f=r-c-h,d=a-u-_,p=r/(c+h),m=a/(u+_);p=Number.isNaN(p)||p>1?1:p,m=Number.isNaN(m)||m>1?1:m,f=f<0?0:f,d=d<0?0:d,i[0].x=-o,i[0].y=-s,i[1].x=c*p-o,i[1].y=_*m-s,i[2].x=i[1].x+f,i[2].y=i[1].y+d,i[3].x=r-o,i[3].y=a-s,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var i=e.acquireBufferBatch(),n=t.renderData,r=n.data,a=i.byteOffset>>2,o=n.vertexCount,s=i.indicesOffset,l=i.vertexOffset,c=t.spriteFrame.uvSliced;i.request(o,n.indicesCount)||(i=e.currBufferBatch,a=0,s=0,l=0);for(var h=i.vData,u=i.iData,_=4;_<20;++_){var f=r[_],d=c[_-4];h[a++]=f.x,h[a++]=f.y,h[a++]=f.z,h[a++]=d.u,h[a++]=d.v,Ci.toArray(h,t.color,a),a+=4}for(var p=0;p<3;++p)for(var m=0;m<3;++m){var v=l+4*p+m;u[s++]=v,u[s++]=v+1,u[s++]=v+4,u[s++]=v+1,u[s++]=v+5,u[s++]=v+4}},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(pj);for(var n=0;n<4;++n)for(var r=i[n],a=0;a<4;++a){var o=i[a],s=i[4+4*n+a];Ri.set(dj,o.x,r.y,0),Ri.transformMat4(s,dj,pj)}}},vj=[],gj=0;gj<4;gj++)vj.push(new Ri);var yj={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,i=t.spriteFrame;if(i&&e&&(e.uvDirty||e.vertDirty)){var n=t.node._uiProps.uiTransformComp,r=Math.abs(n.width),a=Math.abs(n.height),o=i.getRect(),s=i.insetLeft,l=i.insetRight,c=o.width-s-l,h=i.insetTop,u=i.insetBottom,_=o.height-h-u,f=r-s-l,d=a-h-u;f=f>0?f:0,d=d>0?d:0;var p=0===c?f:f/c,m=0===_?d:d/_,v=Math.ceil(m+2),g=Math.ceil(p+2);e.dataLength=Math.max(8,v+1,g+1),this.updateVerts(t,f,d,v,g),e.vertexCount=v*g*4,e.indicesCount=v*g*6,e.uvDirty=!1,e.vertDirty=!1}},fillBuffers:function(t,e){var i=t.node,n=t.node._uiProps.uiTransformComp,r=Math.abs(n.width),a=Math.abs(n.height),o=t.renderData,s=e.acquireBufferBatch(),l=s.indicesOffset,c=s.byteOffset>>2,h=s.vertexOffset,u=o.vertexCount,_=o.indicesCount,f=s.vData,d=s.iData;s.request(u,_)||(s=e.currBufferBatch,c=0,l=0,h=0);var p=t.spriteFrame,m=p.isRotated(),v=p.uv,g=t.spriteFrame.uvSliced,y=p.getRect(),T=p.insetLeft,S=p.insetRight,E=y.width-T-S,A=p.insetTop,b=p.insetBottom,x=y.height-A-b,C=r-T-S,w=a-A-b;C=C>0?C:0,w=w>0?w:0;var R=0===E?C:C/E,I=0===x?w:w/x,O=Math.ceil(I+2),P=Math.ceil(R+2),M=i.worldMatrix;this.fillVertices(f,c,M,O,P,o.data);for(var D=0,N=0,L=[],B=[],F=0,z=O;F<z;++F){N=w>x?w>=F*x?1:I%1:I;for(var U=0,k=P;U<k;++U){D=C>E?C>=U*E?1:R%1:R;var G=c+3,H=G+1;m?(0===F?(L[0]=g[0].u,L[1]=g[0].u,L[2]=g[4].u+(g[8].u-g[4].u)*N):F<O-1?(L[0]=g[4].u,L[1]=g[4].u,L[2]=g[4].u+(g[8].u-g[4].u)*N):F===O-1&&(L[0]=g[8].u,L[1]=g[8].u,L[2]=g[12].u),0===U?(B[0]=g[0].v,B[1]=g[1].v+(g[2].v-g[1].v)*D,B[2]=g[0].v):U<P-1?(B[0]=g[1].v,B[1]=g[1].v+(g[2].v-g[1].v)*D,B[2]=g[1].v):U===P-1&&(B[0]=g[2].v,B[1]=g[3].v,B[2]=g[2].v),L[3]=L[2],B[3]=B[1]):(0===U?(L[0]=g[0].u,L[1]=g[1].u+(g[2].u-g[1].u)*D,L[2]=v[0]):U<P-1?(L[0]=g[1].u,L[1]=g[1].u+(g[2].u-g[1].u)*D,L[2]=g[1].u):U===P-1&&(L[0]=g[2].u,L[1]=g[3].u,L[2]=g[2].u),0===F?(B[0]=g[0].v,B[1]=g[0].v,B[2]=g[4].v+(g[8].v-g[4].v)*N):F<O-1?(B[0]=g[4].v,B[1]=g[4].v,B[2]=g[4].v+(g[8].v-g[4].v)*N):F===O-1&&(B[0]=g[8].v,B[1]=g[8].v,B[2]=g[12].v),L[3]=L[1],B[3]=B[2]),f[G]=L[0],f[H]=B[0],f[G+9]=L[1],f[H+9]=B[1],f[G+18]=L[2],f[H+18]=B[2],f[G+27]=L[3],f[H+27]=B[3],Ci.toArray(f,t.color,H+1),Ci.toArray(f,t.color,H+9+1),Ci.toArray(f,t.color,H+18+1),Ci.toArray(f,t.color,H+27+1),c+=36}}for(var V=0;V<_;V+=6)d[l++]=h,d[l++]=h+1,d[l++]=h+2,d[l++]=h+1,d[l++]=h+3,d[l++]=h+2,h+=4},fillVertices:function(t,e,i,n,r,a){for(var o=0,s=0,l=0,c=0,h=0,u=n;h<u;++h){l=a[h].y,c=a[h+1].y;for(var _=0,f=r;_<f;++_){o=a[_].x,s=a[_+1].x,Ri.set(vj[0],o,l,0),Ri.set(vj[1],s,l,0),Ri.set(vj[2],o,c,0),Ri.set(vj[3],s,c,0);for(var d=0;d<4;d++){var p=vj[d];Ri.transformMat4(p,p,i);var m=9*d;t[e+m]=p.x,t[e+m+1]=p.y,t[e+m+2]=p.z}e+=36}}},updateVerts:function(t,e,i,n,r){var a,o,s=t.node._uiProps.uiTransformComp,l=t.renderData.data,c=t.spriteFrame,h=c.getRect(),u=Math.abs(s.width),_=Math.abs(s.height),f=s.anchorX*u,d=s.anchorY*_,p=c.insetLeft,m=c.insetRight,v=h.width-p-m,g=c.insetTop,y=c.insetBottom,T=h.height-g-y,S=s.width/(p+m)>1?1:s.width/(p+m),E=s.height/(g+y)>1?1:s.height/(g+y);a=v>0?Math.floor(1e3*e)/1e3%v==0?v:e%v:e,o=T>0?Math.floor(1e3*i)/1e3%T==0?T:i%T:i;for(var A=0;A<=r;A++)0===A?l[A].x=-f:A>0&&A<r?l[A].x=1===A?p*S+Math.min(v,e)-f:v>0?A===r-1?p+a+v*(A-2)-f:p+Math.min(v,e)+v*(A-2)-f:p+e-f:A===r&&(l[A].x=Math.min(p+e+m,u)-f);for(var b=0;b<=n;b++)0===b?l[b].y=-d:b>0&&b<n?l[b].y=1===b?y*E+Math.min(T,i)-d:T>0?b===n-1?y+o+(b-2)*T-d:y+Math.min(T,i)+(b-2)*T-d:y+i-d:b===n&&(l[b].y=Math.min(y+i+g,_)-d)}},Tj=yG.Type,Sj=yG.FillType,Ej=t("spriteAssembler",{getAssembler:function(t){var e=fj,i=t;switch(i.type){case Tj.SLICED:e=mj;break;case Tj.TILED:e=yj;break;case Tj.FILLED:e=i.fillType===Sj.RADIAL?hj:QW}return e}});yG.Assembler=Ej;var Aj=fF.sharedManager,bj={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===WU.IMAGE_STENCIL&&(fj.updateRenderData(t),fj.updateColor(t))},fillBuffers:function(t,e){(t.type!==WU.IMAGE_STENCIL||t.spriteFrame)&&(Aj.pushMask(t),e.finishMergeBatches(),function(t,e){Aj.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(Aj.enterLevel(t),t.type===WU.IMAGE_STENCIL){fj.fillBuffers(t,e);var i=t.graphics.getMaterialInstance(0);e.forceMergeBatches(i,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),Aj.enableMask())}},xj={fillBuffers:function(){Aj.exitMask()}},Cj={getAssembler:function(){return bj}},wj={getAssembler:function(){return xj}};$U.Assembler=Cj,$U.PostAssembler=wj;var Rj=new Ds(null),Ij=new Vi,Oj=t("UI",function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new __((function(){return new dH(e)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new nm,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._parentOpacity=1,this._descriptorSetCache=new Mj,this._root=t,this.device=t.device,this._batches=new f_(64),this._drawBatchPool=new u_((function(){return new HH}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=fU);var e=t===fU?36:mU(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var i;t instanceof dH?i=t:(i=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var n=i.vertexFormatBytes,r=this._customMeshBuffers.get(n);return r||(r=[],this._customMeshBuffers.set(n,r)),r.push(i),i},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var i=0;i<e.length;i++)if(e[i]===t){e.splice(i,1);break}},q(e,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var i,n=Q(this._meshBuffers.keys());!(i=n()).done;){var r=i.value,a=this._meshBuffers.get(r);a&&a.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),fF.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,i=0;i<e.length;i++){var n=e[i];if(n.visibility&t.layer)return n}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var i=t[e];i.enabledInHierarchy&&this._recursiveScreenNode(i.node)}var n=0;if(this._batches.length)for(var r=0;r<this._batches.length;++r){var a=this._batches.array[r];if(a.renderScene){if(a.model)for(var o=a.model.subModels,s=0;s<o.length;s++)o[s].priority=n++;else a.hDescriptorSet=this._descriptorSetCache.getDescriptorSet(a);a.renderScene.addBatch(a)}}},t.uploadBuffers=function(){if(this._batches.length>0){for(var t,e=this._doUploadBuffersCall,i=Q(e.keys());!(t=i()).done;){var n=t.value;e.get(n).call(n,this)}for(var r,a=this._meshBuffers,o=Q(a.keys());!(r=o()).done;){var s=r.value,l=a.get(s);l&&l.forEach((function(t){t.uploadBuffers(),t.reset()}))}for(var c,h=this._customMeshBuffers,u=Q(h.keys());!(c=u()).done;){var _=c.value,f=h.get(_);f&&f.forEach((function(t){t.uploadBuffers(),t.reset()}))}this._descriptorSetCache.update()}},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._parentOpacity=1,this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._meshBufferUseCount.clear(),this._batches.clear(),fF.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,i,n){var r,a,o=t,s=0,l=0;e?(r=e.getGFXTexture(),a=e.getGFXSampler(),s=e.getHash(),l=e.getSamplerHash()):(r=null,a=null);var c=o._getRenderScene(),h=o.getRenderMaterial(0);o.stencilStage=fF.sharedManager.stage;var u=o.blendHash,_=o.stencilStage;this._currScene===c&&this._currLayer===t.node.layer&&this._currMaterial===h&&this._currBlendTargetHash===u&&this._currDepthStencilStateStage===_&&this._currTextureHash===s&&this._currSamplerHash===l&&this._currTransform===n||(this.autoMergeBatches(this._currComponent),this._currScene=c,this._currComponent=o,this._currTransform=n,this._currMaterial=h,this._currTexture=r,this._currSampler=a,this._currTextureHash=s,this._currSamplerHash=l,this._currBlendTargetHash=u,this._currDepthStencilStateStage=_,this._currLayer=t.node.layer),i&&(i.fillBuffers(o,this),this._applyOpacity(o))},t.commitModel=function(t,e,i){var r;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var a=0;i&&(t.stencilStage!==vB.ENABLED&&t.stencilStage!==vB.DISABLED||(t.stencilStage=fF.sharedManager.stage),r=fF.sharedManager.getStencilStage(t.stencilStage,i),a=fF.sharedManager.getStencilHash(t.stencilStage));var o=n.director.getTotalFrames();e&&(e.updateTransform(o),e.updateUBOs(o));for(var s=0;s<e.subModels.length;s++){var l=this._drawBatchPool.alloc(),c=e.subModels[s];l.renderScene=t._getRenderScene(),l.visFlags=t.node.layer,l.model=e,l.bufferBatch=null,l.texture=null,l.sampler=null,l.useLocalData=null,r||(r=null),l.fillPasses(i,r,a,null,0,c.patches),l.hDescriptorSet=ar.get(c.handle,tr.DESCRIPTOR_SET),l.hInputAssembler=ar.get(c.handle,tr.INPUT_ASSEMBLER),l.model.visFlags=l.visFlags,this._batches.push(l)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,i=null==e?void 0:e.recordBatch(),n=this._currMaterial;if(i&&n&&e){var r,a,o=0,s=0;t&&(r=-1===t.blendHash?null:t.getBlendState(),s=t.blendHash,a=null!==t.customMaterial?fF.sharedManager.getStencilStage(t.stencilStage,n):fF.sharedManager.getStencilStage(t.stencilStage),o=fF.sharedManager.getStencilHash(t.stencilStage));var l=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();l.renderScene=this._currScene,l.visFlags=this._currLayer,l.bufferBatch=e,l.texture=this._currTexture,l.sampler=this._currSampler,l.hInputAssembler=i,l.useLocalData=this._currTransform,l.textureHash=this._currTextureHash,l.samplerHash=this._currSamplerHash,l.fillPasses(n,a,o,r,s,null),this._batches.push(l),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,yv.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,i){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=i.node.layer,this._currScene=i._getRenderScene(),this.autoMergeBatches(i)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var i=t.children.length,n=this._parentOpacity;if(this._parentOpacity*=t._uiProps.opacity,this._preProcess(t),i>0&&!t._static)for(var r=t.children,a=0;a<r.length;++a){var o=r[a];this.walk(o,e)}this._postProcess(t),this._parentOpacity=n,e+=1},t._preProcess=function(t){if(t._uiProps.uiTransformComp){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.updateAssembler(this)}},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var i=mU(t),n=this._meshBuffers.get(i);return n||(n=[],this._meshBuffers.set(i,n)),n.push(e),e},t._recreateMeshBuffer=function(t,e,i){this.autoMergeBatches(),this._requireBufferBatch(t,e,i)},t._requireBufferBatch=function(t,e,i){var n=mU(t),r=this._meshBuffers.get(n);r||(r=[],this._meshBuffers.set(n,r));var a=this._meshBufferUseCount.get(n)||0;a>=r.length?this._currMeshBuffer=this._createMeshBuffer(t):this._currMeshBuffer=r[a],this._meshBufferUseCount.set(n,a+1),e&&i&&this._currMeshBuffer.request(e,i)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._applyOpacity=function(t){for(var e=t.color.a/255,i=this._parentOpacity*=e,n=this.currBufferBatch,r=n.byteOffset>>2,a=n.vData,o=n.lastByteOffset>>2,s=n.vertexFormatBytes/4,l=o;l<r;l+=s)a[l+dH.OPACITY_OFFSET]*=i;n.lastByteOffset=n.byteOffset},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},e}()),Pj=function(){function t(){this._handle=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=n.director.root.device;this._localData=new Float32Array(oh.COUNT),this._localBuffer=t.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,oh.SIZE,oh.SIZE))}q(t,[{key:"handle",get:function(){return this._handle}}]);var e=t.prototype;return e.initialize=function(t){var e=n.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,Rj.layout=t.passes[0].localSetLayout,this._handle&&(Gn.free(this._handle),this._handle=null),this._handle=Gn.alloc(e,Rj),this._descriptorSet=Gn.get(this._handle),this._descriptorSet.bindBuffer(oh.BINDING,this._localBuffer);var i=Gc.SAMPLER_SPRITE;this._descriptorSet.bindTexture(i,t.texture),this._descriptorSet.bindSampler(i,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,i){return this._transform===t&&this._textureHash===e&&this._samplerHash===i},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._handle&&(Gn.free(this._handle),this._handle=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;Vi.toArray(this._localData,e,oh.MAT_WORLD_OFFSET),Vi.inverseTranspose(Ij,e),Vi.toArray(this._localData,Ij,oh.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},t}(),Mj=function(){function t(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new u_((function(){return new Pj}),16)}var e=t.prototype;return e.getDescriptorSet=function(t){var e=n.director.root;if(t.useLocalData){for(var i=this._localDescriptorSetCache,r=0,a=i.length;r<a;r++){var o=i[r];if(o.equals(t.useLocalData,t.textureHash,t.samplerHash))return o.handle}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.handle}var l=this._descriptorSetCache.get(t.textureHash);if(l&&l.has(t.samplerHash))return l.get(t.samplerHash);Rj.layout=t.passes[0].localSetLayout;var c=Gn.alloc(e.device,Rj),h=Gn.get(c),u=Gc.SAMPLER_SPRITE;return h.bindTexture(u,t.texture),h.bindSampler(u,t.sampler),h.update(),l?this._descriptorSetCache.get(t.textureHash).set(t.samplerHash,c):this._descriptorSetCache.set(t.textureHash,new Map([[t.samplerHash,c]])),c},e.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){this._descriptorSetCache.has(t)&&(this._descriptorSetCache.get(t).forEach((function(t){Gn.free(t)})),this._descriptorSetCache.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.forEach((function(t){Gn.free(t)}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(t){t.destroy()}))},t}();n.internal.Batcher2D=Oj;var Dj,Nj,Lj,Bj,Fj,zj,Uj,kj,Gj,Hj,Vj,Wj,jj,qj,Xj,Yj,Kj,Zj,Qj,Jj,$j,tq,eq,iq,nq,rq,aq,oq,sq,lq,cq,hq,uq,_q,fq,dq,pq,mq,vq,gq,yq,Tq,Sq,Eq,Aq,bq,xq,Cq,wq,Rq,Iq,Oq=null,Pq=-1,Mq=Object.create(null),Dq=[];function Nq(){for(var t=!0,e=Date.now(),i=Dq.length-1;i>=0;i--){var n=Dq[i],r=n.fontFamilyName;if(e-n.startTime>3e3)E(4933,r),n.onComplete(null,r),Dq.splice(i,1);else{var a=n.refWidth,o="40px "+r;Oq.font=o,a!==JL(Oq,"BES bswy:->@123",o)?(Dq.splice(i,1),n.onComplete(null,r)):t=!1}}t&&(clearInterval(Pq),Pq=-1)}function Lq(t,e,i){var n=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,n=t.lastIndexOf("/");return-1!==(i=-1===n?t.substring(0,e)+"_LABEL":t.substring(n+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}(t);if(Mq[n])i(null,n);else{if(!Oq){var r=document.createElement("canvas");r.width=100,r.height=100,Oq=r.getContext("2d")}var a=JL(Oq,"BES bswy:->@123","40px "+n),o=document.createElement("style");o.type="text/css";var s="";Number.isNaN(n)?s+="@font-face { font-family:"+n+"; src:":s+='@font-face { font-family:"'+n+'"; src:',s+='url("'+t+'");',o.textContent=s+"}",document.body.appendChild(o);var l=document.createElement("div"),c=l.style;if(c.fontFamily=n,l.innerHTML=".",c.position="absolute",c.left="-100px",c.top="-100px",document.body.appendChild(l),function(){if(void 0===Dj)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Dj=t?parseInt(t[1],10)>42:!e}else Dj=!1;return Dj}())!function(t,e,i){var n=new Promise((function(i,n){!function r(){Date.now()-t>=3e3?n():document.fonts.load("40px "+e).then((function(t){t.length>=1?i():setTimeout(r,100)}),(function(){n()}))}()})),r=null,a=new Promise((function(t,e){r=setTimeout(e,3e3)}));Promise.race([a,n]).then((function(){r&&(clearTimeout(r),r=null),i(null,e)}),(function(){E(4933,e),i(null,e)}))}(Date.now(),n,i);else{var h={fontFamilyName:n,refWidth:a,onComplete:i,startTime:Date.now()};Dq.push(h),-1===Pq&&(Pq=setInterval(Nq,100))}Mq[n]=o}}function Bq(t,e,i,n){var r=new NL;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}_I.register({".font":Lq,".eot":Lq,".ttf":Lq,".woff":Lq,".svg":Lq,".ttc":Lq}),yI.register({".font":Bq,".eot":Bq,".ttf":Bq,".woff":Bq,".svg":Bq,".ttc":Bq}),n.UI={MeshBuffer:dH,spriteAssembler:Ej,graphicsAssembler:IV,labelAssembler:YW};var Fq,zq,Uq,kq=new Ci;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(Fq||(Fq={})),fe(Fq),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(zq||(zq={})),function(t){t.CLICK="click"}(Uq||(Uq={}));var Gq,Hq,Vq,Wq=function(e){return t({Button:e,ButtonComponent:e}),e}((Nj=ru("cc.Button"),Lj=gu(),Bj=ou(110),Fj=du(),zj=au(UB),Uj=Fu(wA),kj=Ru(),Gj=Eu(),Hj=Ru(),Vj=Eu(),Wj=Fu(Fq),jj=Ru(),qj=Eu(),Xj=Eu(),Yj=Eu(),Kj=Eu(),Zj=Eu(),Qj=bu(),Jj=xu(),$j=Eu(),tq=Eu(),eq=Fu(vL),iq=Eu(),nq=Fu(vL),rq=Eu(),aq=Fu(vL),oq=Eu(),sq=Fu(vL),lq=Eu(),cq=Fu([yP]),hq=Ru(),uq=Eu(),Nj(_q=Lj(_q=Bj(_q=Fj(_q=zj(_q=fu((Iq=Rq=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"clickEvents",dq,K(e)),J(e,"_interactable",pq,K(e)),J(e,"_transition",mq,K(e)),J(e,"_normalColor",vq,K(e)),J(e,"_hoverColor",gq,K(e)),J(e,"_pressedColor",yq,K(e)),J(e,"_disabledColor",Tq,K(e)),J(e,"_normalSprite",Sq,K(e)),J(e,"_hoverSprite",Eq,K(e)),J(e,"_pressedSprite",Aq,K(e)),J(e,"_disabledSprite",bq,K(e)),J(e,"_duration",xq,K(e)),J(e,"_zoomScale",Cq,K(e)),J(e,"_target",wq,K(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new Ci,e._toColor=new Ci,e._time=0,e._transitionFinished=!0,e._fromScale=new Ri,e._toScale=new Ri,e._originalScale=null,e._sprite=null,e._targetScale=new Ri,e}Y(e,t);var i=e.prototype;return i.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(yG);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},i.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===Fq.COLOR||this._transition===Fq.SCALE)){this._time+=t;var i=1;if(this._duration>0&&(i=this._time/this._duration),i>=1&&(i=1),this._transition===Fq.COLOR){var n=e._uiProps.uiComp;Ci.lerp(kq,this._fromColor,this._toColor,i),n&&(n.color=kq)}else this.transition===Fq.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=ui(this._fromScale.x,this._toScale.x,i),this._targetScale.y=ui(this._fromScale.y,this._toScale.y,i),e.setScale(this._targetScale));1===i&&(this._transitionFinished=!0)}},i._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},i._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=t.getComponent(bz);if(e){var i=this._transition;i===Fq.COLOR&&this._interactable?e.color=this._normalColor:i===Fq.SCALE&&this._originalScale&&t.setScale(this._originalScale),this._transitionFinished=!0}}},i._registerNodeEvent=function(){this.node.on(vS.TOUCH_START,this._onTouchBegan,this),this.node.on(vS.TOUCH_MOVE,this._onTouchMove,this),this.node.on(vS.TOUCH_END,this._onTouchEnded,this),this.node.on(vS.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(vS.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(vS.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._registerTargetEvent=function(t){t.on(vS.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},i._unregisterNodeEvent=function(){this.node.off(vS.TOUCH_START,this._onTouchBegan,this),this.node.off(vS.TOUCH_MOVE,this._onTouchMove,this),this.node.off(vS.TOUCH_END,this._onTouchEnded,this),this.node.off(vS.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(vS.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(vS.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._unregisterTargetEvent=function(t){t.off(vS.TRANSFORM_CHANGED)},i._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(yG)),e},i._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new Ri),Ri.copy(this._originalScale,this.target.getScale()))},i._onTargetSpriteFrameChanged=function(t){this._transition===Fq.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},i._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case zq.NORMAL:this._normalSprite=t;break;case zq.HOVER:this._hoverSprite=t;break;case zq.PRESSED:this._pressedSprite=t;break;case zq.DISABLED:this._disabledSprite=t}},i._onTargetColorChanged=function(t){this._transition===Fq.COLOR&&this._setCurrentStateColor(t)},i._setCurrentStateColor=function(t){switch(this._getButtonState()){case zq.NORMAL:this._normalColor=t;break;case zq.HOVER:this._hoverColor=t;break;case zq.PRESSED:this._pressedColor=t;break;case zq.DISABLED:this._disabledColor=t}},i._onTargetTransformChanged=function(t){t|kh.SCALE&&this._originalScale&&this._transition===Fq.SCALE&&this._transitionFinished&&Ri.copy(this._originalScale,this.target.getScale())},i._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var i,n=this.node._uiProps.uiTransformComp.isHit(e.getUILocation());this._transition===Fq.SCALE&&this.target&&this._originalScale?n?(Ri.copy(this._fromScale,this._originalScale),Ri.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(i=n?zq.PRESSED:zq.NORMAL,this._applyTransition(i)),t&&(t.propagationStopped=!0)}}},i._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(yP.emitEvents(this.clickEvents,t),this.node.emit(Uq.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},i._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==Fq.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},i._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},i._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},i._getButtonState=function(){var t=zq.NORMAL;return this._interactable?this._pressed?t=zq.PRESSED:this._hovered&&(t=zq.HOVER):t=zq.DISABLED,t.toString()},i._updateColorTransition=function(t){var e,i=this[t+"Color"],n=null===(e=this.target)||void 0===e?void 0:e.getComponent(bz);n&&(t===zq.DISABLED?n.color=i:(this._fromColor=n.color.clone(),this._toColor=i,this._time=0,this._transitionFinished=!1))},i._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},i._updateScaleTransition=function(t){this._interactable&&(t===zq.PRESSED?this._zoomUp():this._zoomBack())},i._zoomUp=function(){this._originalScale&&(Ri.copy(this._fromScale,this._originalScale),Ri.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},i._zoomBack=function(){this.target&&this._originalScale&&(Ri.copy(this._fromScale,this.target.getScale()),Ri.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},i._applyTransition=function(t){var e=this._transition;e===Fq.COLOR?this._updateColorTransition(t):e===Fq.SPRITE?this._updateSpriteTransition(t):e===Fq.SCALE&&this._updateScaleTransition(t)},q(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable=t,this._updateState(),this._interactable||this._resetState()}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===Fq.COLOR?this._updateColorTransition(zq.NORMAL):this._transition===Fq.SPRITE&&this._updateSpriteTransition(zq.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(yG);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}(Jf),Rq.Transition=Fq,Rq.EventType=Uq,$((fq=Iq).prototype,"target",[Uj,kj,Gj],Object.getOwnPropertyDescriptor(fq.prototype,"target"),fq.prototype),$(fq.prototype,"interactable",[Hj,Vj],Object.getOwnPropertyDescriptor(fq.prototype,"interactable"),fq.prototype),$(fq.prototype,"transition",[Wj,jj,qj],Object.getOwnPropertyDescriptor(fq.prototype,"transition"),fq.prototype),$(fq.prototype,"normalColor",[Xj],Object.getOwnPropertyDescriptor(fq.prototype,"normalColor"),fq.prototype),$(fq.prototype,"pressedColor",[Yj],Object.getOwnPropertyDescriptor(fq.prototype,"pressedColor"),fq.prototype),$(fq.prototype,"hoverColor",[Kj],Object.getOwnPropertyDescriptor(fq.prototype,"hoverColor"),fq.prototype),$(fq.prototype,"disabledColor",[Zj],Object.getOwnPropertyDescriptor(fq.prototype,"disabledColor"),fq.prototype),$(fq.prototype,"duration",[Qj,Jj,$j],Object.getOwnPropertyDescriptor(fq.prototype,"duration"),fq.prototype),$(fq.prototype,"zoomScale",[tq],Object.getOwnPropertyDescriptor(fq.prototype,"zoomScale"),fq.prototype),$(fq.prototype,"normalSprite",[eq,iq],Object.getOwnPropertyDescriptor(fq.prototype,"normalSprite"),fq.prototype),$(fq.prototype,"pressedSprite",[nq,rq],Object.getOwnPropertyDescriptor(fq.prototype,"pressedSprite"),fq.prototype),$(fq.prototype,"hoverSprite",[aq,oq],Object.getOwnPropertyDescriptor(fq.prototype,"hoverSprite"),fq.prototype),$(fq.prototype,"disabledSprite",[sq,lq],Object.getOwnPropertyDescriptor(fq.prototype,"disabledSprite"),fq.prototype),dq=$(fq.prototype,"clickEvents",[cq,cu,hq,uq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pq=$(fq.prototype,"_interactable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mq=$(fq.prototype,"_transition",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fq.NONE}}),vq=$(fq.prototype,"_normalColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),gq=$(fq.prototype,"_hoverColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(211,211,211,255)}}),yq=$(fq.prototype,"_pressedColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),Tq=$(fq.prototype,"_disabledColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(124,124,124,255)}}),Sq=$(fq.prototype,"_normalSprite",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Eq=$(fq.prototype,"_hoverSprite",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Aq=$(fq.prototype,"_pressedSprite",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bq=$(fq.prototype,"_disabledSprite",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xq=$(fq.prototype,"_duration",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Cq=$(fq.prototype,"_zoomScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),wq=$(fq.prototype,"_target",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_q=fq))||_q)||_q)||_q)||_q)||_q)||_q)),jq=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,i=e.indexOf(t);-1!==i&&e.splice(i,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,i=e.indexOf(t);if(t.setFocus(!1),-1!==i){var n=e[i+1];n&&n._delegate.tabIndex>=0&&n.setFocus(!0)}},t}();jq._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(Gq||(Gq={})),he(Gq),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(Hq||(Hq={})),he(Hq),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(Vq||(Vq={})),he(Vq);var qq,Xq,Yq,Kq,Zq,Qq,Jq,$q,tX,eX,iX,nX,rX,aX,oX,sX,lX,cX,hX,uX,_X,fX,dX,pX,mX,vX,gX,yX,TX,SX,EX,AX,bX,xX,CX,wX,RX,IX,OX,PX,MX,DX,NX,LX,BX,FX,zX,UX,kX,GX,HX,VX,WX,jX,qX,XX,YX,KX,ZX,QX,JX,$X=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),tY=new Vi,eY=new Vi,iY=new Ri,nY=null,rY=0,aY=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__fullscreen=!1,e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++rY,e}Y(e,t);var i=e.prototype;return i.init=function(t){t&&(this._delegate=t,t.inputMode===Hq.ANY?this._createTextArea():this._createInput(),jq.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),this.__fullscreen=gb.isAutoFullScreenEnabled(),this.__autoResize=gb._resizeWithBrowserSize)},i.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),jq.remove(this),nY===this&&(nY=null),this._delegate=null},i.update=function(){this._updateMatrix()},i.setTabIndex=function(t){this._edTxt.tabIndex=t,jq.resort()},i.setSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px")},i.beginEditing=function(){nY&&nY!==this&&nY.setFocus(!1),this._editing=!0,nY=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},i.endEditing=function(){this._edTxt.blur()},i._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},i._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},i._addDomToGameContainer=function(){n.GAME_VIEW&&this._edTxt?(n.gameView.container.appendChild(this._edTxt),n.gameView.head.appendChild(this._placeholderStyleSheet)):ub.container&&this._edTxt&&(ub.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},i._removeDomFromGameContainer=function(){(n.GAME_VIEW?Ae(n.gameView.container,this._edTxt):Ae(ub.container,this._edTxt))&&this._edTxt&&(n.GAME_VIEW?n.gameView.container.removeChild(this._edTxt):ub.container.removeChild(this._edTxt)),(n.GAME_VIEW?Ae(n.gameView.head,this._placeholderStyleSheet):Ae(document.head,this._placeholderStyleSheet))&&(n.GAME_VIEW?n.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},i._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),yv.isMobile&&this._showDomOnMobile()},i._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),yv.isMobile&&this._hideDomOnMobile()},i._showDomOnMobile=function(){yv.os===yv.OS_ANDROID&&(this.__fullscreen&&(gb.enableAutoFullScreen(!1),xb.exitFullScreen()),this.__autoResize&&gb.resizeWithBrowserSize(!1),this._adjustWindowScroll())},i._hideDomOnMobile=function(){var t=this;yv.os===yv.OS_ANDROID&&(this.__autoResize&&gb.resizeWithBrowserSize(!0),setTimeout((function(){nY||t.__fullscreen&&gb.enableAutoFullScreen(!0)}),400)),this._scrollBackWindow()},i._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},i._scrollBackWindow=function(){setTimeout((function(){yv.browserType!==yv.BROWSER_TYPE_WECHAT||yv.os!==yv.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},i._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=gb.getScaleX(),i=gb.getScaleY(),r=1,a=1;n.GAME_VIEW&&(r=n.gameView.canvas.width/n.game.canvas.width,a=n.gameView.canvas.height/n.game.canvas.height),e*=r,i*=a;var o=gb.getViewportRect(),s=gb.getDevicePixelRatio();t.getWorldMatrix(tY);var l=t._uiProps.uiTransformComp;if(l&&Ri.set(iY,-l.anchorX*l.width,-l.anchorY*l.height,iY.z),Vi.transform(tY,tY,iY),t._uiProps.uiTransformComp){var c=BR.root.batcher2D.getFirstRenderCamera(t);if(c){c.node.getWorldRT(eY);var h=eY.m12,u=eY.m13,_=_b.center;eY.m12=_.x-(eY.m00*h+eY.m04*u),eY.m13=_.y-(eY.m01*h+eY.m05*u),Vi.multiply(eY,eY,tY),e/=s,i/=s;var f=n.GAME_VIEW?n.gameView.container:ub.container,d=eY.m00*e,p=tY.m01,m=tY.m04,v=eY.m05*i,g=parseInt(f&&f.style.paddingLeft||"0");g+=o.x*r/s;var y=parseInt(f&&f.style.paddingBottom||"0");y+=o.y/s;var T="matrix("+d+","+-p+","+-m+","+v+","+(eY.m12*e+g)+","+-(eY.m13*i+y)+")";this._edTxt.style.transform=T,this._edTxt.style["-webkit-transform"]=T,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},i._updateInputType=function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,n=t.returnType,r=this._edTxt;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==n){if(this._inputMode=e,this._inputFlag=i,this._returnType=n,this._isTextArea){var a="none";return i===Vq.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":i===Vq.INITIAL_CAPS_WORD&&(a="capitalize"),void(r.style.textTransform=a)}if(r=r,i===Vq.PASSWORD)return r.type="password",void(r.style.textTransform="none");var o=r.type;e===Hq.EMAIL_ADDR?o="email":e===Hq.NUMERIC||e===Hq.DECIMAL?o="number":e===Hq.PHONE_NUMBER?(o="number",r.pattern="[0-9]*"):e===Hq.URL?o="url":(o="text",n===Gq.SEARCH&&(o="search")),r.type=o;var s="none";i===Vq.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":i===Vq.INITIAL_CAPS_WORD&&(s="capitalize"),r.style.textTransform=s}},i._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},i._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},i._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel))},i._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof zL?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var n=this._edTxt;switch(n.style.fontSize=i+"px",n.style.color=t.color.toCSS(),n.style.fontFamily=e,t.horizontalAlign){case Rz.HorizontalAlign.LEFT:n.style.textAlign="left";break;case Rz.HorizontalAlign.CENTER:n.style.textAlign="center";break;case Rz.HorizontalAlign.RIGHT:n.style.textAlign="right"}}}},i._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof zL?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var r=this._placeholderStyleSheet,a=t.color.toCSS(),o=t.fontSize,s="";switch(t.horizontalAlign){case Rz.HorizontalAlign.LEFT:s="left";break;case Rz.HorizontalAlign.CENTER:s="center";break;case Rz.HorizontalAlign.RIGHT:s="right"}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+a+";line-height: "+o+"px;text-align: "+s+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+a+";line-height: "+o+"px;text-align: "+s+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+a+";line-height: "+o+"px;text-align: "+s+";}",n.sys.browserType===n.sys.BROWSER_TYPE_EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},i._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,i=!1,n=this.__eventListeners;n.compositionStart=function(){i=!0},n.compositionEnd=function(){i=!1,t._delegate._editBoxTextChanged(e.value)},n.onInput=function(){if(!i){var n=t._delegate,r=n.maxLength;r>=0&&(e.value=e.value.slice(0,r)),n._editBoxTextChanged(e.value)}},n.onClick=function(){t._editing&&yv.isMobile&&t._adjustWindowScroll()},n.onKeydown=function(i){i.keyCode===pe.KEY.enter?(i.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):i.keyCode===pe.KEY.tab&&(i.propagationStopped=!0,i.preventDefault(),jq.next(t))},n.onBlur=function(){yv.isMobile&&i&&n.compositionEnd(),t._editing=!1,nY=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",n.compositionStart),e.addEventListener("compositionend",n.compositionEnd),e.addEventListener("input",n.onInput),e.addEventListener("keydown",n.onKeydown),e.addEventListener("blur",n.onBlur),e.addEventListener("touchstart",n.onClick)}},i._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}($X);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(JX||(JX={}));var oY,sY,lY,cY,hY,uY,_Y,fY,dY,pY,mY,vY,gY,yY,TY,SY,EY,AY,bY,xY,CY,wY,RY,IY,OY,PY,MY,DY,NY,LY,BY,FY,zY,UY,kY,GY,HY,VY,WY,jY,qY,XY,YY,KY,ZY,QY,JY,$Y,tK,eK,iK,nK,rK,aK,oK=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((qq=ru("cc.EditBox"),Xq=gu(),Yq=ou(110),Kq=du(),Zq=au(UB),Qq=Ru(),Jq=Eu(),$q=Ru(),tX=Eu(),eX=Fu(Rz),iX=Ru(),nX=Eu(),rX=Fu(Rz),aX=Ru(),oX=Eu(),sX=Fu(vL),lX=Ru(),cX=Eu(),hX=Fu(Vq),uX=Ru(),_X=Eu(),fX=Fu(Hq),dX=Ru(),pX=Eu(),mX=Fu(Gq),vX=Ru(),gX=Eu(),yX=Ru(),TX=Eu(),SX=Ru(),EX=Eu(),AX=Fu([yP]),bX=Ru(),xX=Eu(),CX=Fu([yP]),wX=Ru(),RX=Eu(),IX=Fu([yP]),OX=Ru(),PX=Eu(),MX=Fu([yP]),DX=Ru(),NX=Eu(),qq(LX=Xq(LX=Yq(LX=Kq(LX=Zq(LX=fu((QX=ZX=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"editingDidBegan",FX,K(e)),J(e,"textChanged",zX,K(e)),J(e,"editingDidEnded",UX,K(e)),J(e,"editingReturn",kX,K(e)),e._impl=null,e._background=null,J(e,"_textLabel",GX,K(e)),J(e,"_placeholderLabel",HX,K(e)),J(e,"_returnType",VX,K(e)),J(e,"_string",WX,K(e)),J(e,"_tabIndex",jX,K(e)),J(e,"_backgroundImage",qX,K(e)),J(e,"_inputFlag",XX,K(e)),J(e,"_inputMode",YX,K(e)),J(e,"_maxLength",KX,K(e)),e._isLabelVisible=!1,e}Y(e,t);var i=e.prototype;return i.__preload=function(){this._init()},i.onEnable=function(){this._registerEvent(),this._impl&&this._impl.onEnable()},i.update=function(){this._impl&&this._impl.update()},i.onDisable=function(){this._unregisterEvent(),this._impl&&this._impl.onDisable()},i.onDestroy=function(){this._impl&&this._impl.clear()},i.setFocus=function(){this._impl&&this._impl.setFocus(!0)},i.focus=function(){this._impl&&this._impl.setFocus(!0)},i.blur=function(){this._impl&&this._impl.setFocus(!1)},i.isFocused=function(){return!!this._impl&&this._impl.isFocused()},i._editBoxEditingDidBegan=function(){yP.emitEvents(this.editingDidBegan,this),this.node.emit(JX.EDITING_DID_BEGAN,this)},i._editBoxEditingDidEnded=function(){yP.emitEvents(this.editingDidEnded,this),this.node.emit(JX.EDITING_DID_ENDED,this)},i._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,yP.emitEvents(this.textChanged,t,this),this.node.emit(JX.TEXT_CHANGED,this)},i._editBoxEditingReturn=function(){yP.emitEvents(this.editingReturn,this),this.node.emit(JX.EDITING_RETURN,this)},i._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},i._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},i._onTouchBegan=function(t){t.propagationStopped=!0},i._onTouchCancel=function(t){t.propagationStopped=!0},i._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},i._init=function(){this._createBackgroundSprite(),this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(vS.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},i._createBackgroundSprite=function(){this._background||(this._background=this.node.getComponent(yG),this._background||(this._background=this.node.addComponent(yG))),this._background.type=yG.Type.SLICED,this._background.spriteFrame=this._backgroundImage},i._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||(e=new wA("TEXT_LABEL")),(t=e.getComponent(Rz))||(t=e.addComponent(Rz)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Rz.Overflow.CLAMP,this._inputMode===Hq.ANY?(t.verticalAlign=Sz.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},i._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||(e=new wA("PLACEHOLDER_LABEL")),(t=e.getComponent(Rz))||(t=e.addComponent(Rz)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Rz.Overflow.CLAMP,this._inputMode===Hq.ANY?(t.verticalAlign=Sz.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this.placeholder},i._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var i=this._background.node._uiProps.uiTransformComp;i.anchorPoint=t.anchorPoint,i.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},i._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},i._updateString=function(t){var e=this._textLabel;if(e){var i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}},i._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var i=this._inputFlag;if(e||i!==Vq.PASSWORD)i===Vq.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===Vq.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):i===Vq.INITIAL_CAPS_SENTENCE&&(t=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(t));else{for(var n="",r=t.length,a=0;a<r;++a)n+="";t=n}return t},i._registerEvent=function(){this.node.on(vS.TOUCH_START,this._onTouchBegan,this),this.node.on(vS.TOUCH_END,this._onTouchEnded,this)},i._unregisterEvent=function(){this.node.off(vS.TOUCH_START,this._onTouchBegan,this),this.node.off(vS.TOUCH_END,this._onTouchEnded,this)},i._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,i=-e.anchorX*e.width,n=-e.anchorY*e.height,r=this._placeholderLabel,a=this._textLabel;a&&(a.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),a.node.position=new Ri(i+2,n+t.height,a.node.position.z),this._inputMode===Hq.ANY&&(a.verticalAlign=Sz.TOP),a.enableWrapText=this._inputMode===Hq.ANY),r&&(r.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),r.lineHeight=t.height,r.node.position=new Ri(i+2,n+t.height,r.node.position.z),this._inputMode===Hq.ANY&&(r.verticalAlign=Sz.TOP),r.enableWrapText=this._inputMode===Hq.ANY)},i._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.position=new Ri(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._placeholderLabel&&this._placeholderLabel.node;i&&(i.position=new Ri(-t.width/2,t.height/2,i.position.z),i._uiProps.uiTransformComp.setContentSize(t.contentSize));var n=this._background&&this._background.node;n&&n._uiProps.uiTransformComp.setContentSize(t.contentSize)},q(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string=t,this._updateString(t)}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._createBackgroundSprite())}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag=t,this._updateString(this._string)}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}(Jf),ZX._EditBoxImpl=$X,ZX.KeyboardReturnType=Gq,ZX.InputFlag=Vq,ZX.InputMode=Hq,ZX.EventType=JX,$((BX=QX).prototype,"string",[Qq,Jq],Object.getOwnPropertyDescriptor(BX.prototype,"string"),BX.prototype),$(BX.prototype,"placeholder",[$q,tX],Object.getOwnPropertyDescriptor(BX.prototype,"placeholder"),BX.prototype),$(BX.prototype,"textLabel",[eX,iX,nX],Object.getOwnPropertyDescriptor(BX.prototype,"textLabel"),BX.prototype),$(BX.prototype,"placeholderLabel",[rX,aX,oX],Object.getOwnPropertyDescriptor(BX.prototype,"placeholderLabel"),BX.prototype),$(BX.prototype,"backgroundImage",[sX,lX,cX],Object.getOwnPropertyDescriptor(BX.prototype,"backgroundImage"),BX.prototype),$(BX.prototype,"inputFlag",[hX,uX,_X],Object.getOwnPropertyDescriptor(BX.prototype,"inputFlag"),BX.prototype),$(BX.prototype,"inputMode",[fX,dX,pX],Object.getOwnPropertyDescriptor(BX.prototype,"inputMode"),BX.prototype),$(BX.prototype,"returnType",[mX,vX,gX],Object.getOwnPropertyDescriptor(BX.prototype,"returnType"),BX.prototype),$(BX.prototype,"maxLength",[yX,TX],Object.getOwnPropertyDescriptor(BX.prototype,"maxLength"),BX.prototype),$(BX.prototype,"tabIndex",[SX,EX],Object.getOwnPropertyDescriptor(BX.prototype,"tabIndex"),BX.prototype),FX=$(BX.prototype,"editingDidBegan",[AX,cu,bX,xX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zX=$(BX.prototype,"textChanged",[CX,cu,wX,RX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UX=$(BX.prototype,"editingDidEnded",[IX,cu,OX,PX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kX=$(BX.prototype,"editingReturn",[MX,cu,DX,NX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GX=$(BX.prototype,"_textLabel",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HX=$(BX.prototype,"_placeholderLabel",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VX=$(BX.prototype,"_returnType",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gq.DEFAULT}}),WX=$(BX.prototype,"_string",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jX=$(BX.prototype,"_tabIndex",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qX=$(BX.prototype,"_backgroundImage",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XX=$(BX.prototype,"_inputFlag",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vq.DEFAULT}}),YX=$(BX.prototype,"_inputMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hq.ANY}}),KX=$(BX.prototype,"_maxLength",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),LX=BX))||LX)||LX)||LX)||LX)||LX)||LX));"object"==typeof window&&"object"==typeof document&&(oK._EditBoxImpl=aY);var sK,lK,cK,hK,uK,_K,fK=vS;!function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(sK||(sK={})),fe(sK),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(lK||(lK={})),fe(lK),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(cK||(cK={})),fe(cK),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(hK||(hK={})),fe(hK),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(uK||(uK={})),fe(uK),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(_K||(_K={})),fe(_K);var dK,pK,mK,vK,gK,yK,TK,SK,EK,AK,bK,xK,CK,wK,RK,IK,OK,PK,MK,DK,NK,LK,BK,FK=new Ri,zK=function(e){return t({Layout:e,LayoutComponent:e}),e}((oY=ru("cc.Layout"),sY=gu(),lY=ou(110),cY=du(),hY=au(UB),uY=Tu(),_Y=Eu(),fY=Tu(),dY=Eu(),pY=Fu(sK),mY=Eu(),vY=Fu(lK),gY=Tu(),yY=Eu(),TY=Tu(),SY=Eu(),EY=Fu(cK),AY=Eu(),bY=Eu(),xY=Eu(),CY=Eu(),wY=Eu(),RY=Eu(),IY=Eu(),OY=Fu(hK),PY=Eu(),MY=Fu(uK),DY=Eu(),NY=Fu(_K),LY=Tu(),BY=Eu(),FY=Tu(),zY=Eu(),UY=Eu(),oY(kY=sY(kY=lY(kY=cY(kY=hY(kY=fu((aK=rK=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_resizeMode",HY,K(e)),J(e,"_layoutType",VY,K(e)),J(e,"_cellSize",WY,K(e)),J(e,"_startAxis",jY,K(e)),J(e,"_paddingLeft",qY,K(e)),J(e,"_paddingRight",XY,K(e)),J(e,"_paddingTop",YY,K(e)),J(e,"_paddingBottom",KY,K(e)),J(e,"_spacingX",ZY,K(e)),J(e,"_spacingY",QY,K(e)),J(e,"_verticalDirection",JY,K(e)),J(e,"_horizontalDirection",$Y,K(e)),J(e,"_constraint",tK,K(e)),J(e,"_constraintNum",eK,K(e)),J(e,"_affectedByScale",iK,K(e)),J(e,"_isAlign",nK,K(e)),e._layoutSize=new tn(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}Y(e,t);var i=e.prototype;return i.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},i.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(tn.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},i.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},i._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e],n=i._uiProps.uiTransformComp;i.activeInHierarchy&&n&&this._usefulLayoutObj.push(n)}},i._addEventListeners=function(){BR.on(LR.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(fK.SIZE_CHANGED,this._resized,this),this.node.on(fK.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(fK.CHILD_ADDED,this._childAdded,this),this.node.on(fK.CHILD_REMOVED,this._childRemoved,this),this.node.on(fK.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this._addChildrenEventListeners()},i._removeEventListeners=function(){BR.off(LR.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(fK.SIZE_CHANGED,this._resized,this),this.node.off(fK.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(fK.CHILD_ADDED,this._childAdded,this),this.node.off(fK.CHILD_REMOVED,this._childRemoved,this),this.node.off(fK.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this._removeChildrenEventListeners()},i._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(fK.SIZE_CHANGED,this._doLayoutDirty,this),i.on(fK.TRANSFORM_CHANGED,this._transformDirty,this),i.on(fK.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._childrenChanged,this)}},i._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(fK.SIZE_CHANGED,this._doLayoutDirty,this),i.off(fK.TRANSFORM_CHANGED,this._transformDirty,this),i.off(fK.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._childrenChanged,this)}},i._childAdded=function(t){t.on(fK.SIZE_CHANGED,this._doLayoutDirty,this),t.on(fK.TRANSFORM_CHANGED,this._transformDirty,this),t.on(fK.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},i._childRemoved=function(t){t.off(fK.SIZE_CHANGED,this._doLayoutDirty,this),t.off(fK.TRANSFORM_CHANGED,this._transformDirty,this),t.off(fK.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},i._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},i._doLayoutHorizontally=function(t,e,i,n){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingLeft;this._horizontalDirection===uK.RIGHT_TO_LEFT&&(o=-1,s=this._paddingRight);var l=(this._horizontalDirection-r.x)*t+o*s,c=l-o*this._spacingX,h=0,u=0,_=0,f=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.width,v=this._getPaddingH();this._layoutType!==sK.GRID&&this._resizeMode===lK.CHILDREN&&(m=(t-v-(p-1)*this._spacingX)/p);for(var g=this._usefulLayoutObj,y=0;y<g.length;++y){var T=g[y],S=T.node,E=S.scale,A=this._getUsedScaleValue(E.x),b=this._getUsedScaleValue(E.y);this._resizeMode===lK.CHILDREN&&(T.width=m/A,this._layoutType===sK.GRID&&(T.height=this._cellSize.height/b));var x=Math.abs(this._horizontalDirection-T.anchorX),C=T.width*A,w=T.height*b;w>_&&(f=Math.max(_,f),u=_||w,_=w),c+=o*(x*C+this._spacingX);var R=o*(1-x)*C;if(e){if(a>0)(d=y/a>0&&y%a==0)&&(u=_>w?_:u);else if(C>t-v)c>l+o*x*C&&(d=!0);else{var I=(1-this._horizontalDirection-r.x)*t,O=c+R+o*(o>0?this._paddingRight:this._paddingLeft);d=Math.abs(O)>Math.abs(I)}d&&(c=l+o*x*C,w!==_&&(u=_),h+=u+this._spacingY,u=_=w)}var P=i(S,T,h);n&&S.setPosition(c,P),c+=R}return u=Math.max(u,_),Math.max(f,h+u)+this._getPaddingV()},i._doLayoutVertically=function(t,e,i,n){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingBottom;this._verticalDirection===hK.TOP_TO_BOTTOM&&(o=-1,s=this._paddingTop);var l=(this._verticalDirection-r.y)*t+o*s,c=l-o*this._spacingY,h=0,u=0,_=0,f=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.height,v=this._getPaddingV();this._layoutType!==sK.GRID&&this._resizeMode===lK.CHILDREN&&(m=(t-v-(p-1)*this._spacingY)/p);for(var g=this._usefulLayoutObj,y=0;y<g.length;++y){var T=g[y],S=T.node,E=S.scale,A=this._getUsedScaleValue(E.x),b=this._getUsedScaleValue(E.y);this._resizeMode===lK.CHILDREN&&(T.height=m/b,this._layoutType===sK.GRID&&(T.width=this._cellSize.width/A));var x=Math.abs(this._verticalDirection-T.anchorY),C=T.width*A,w=T.height*b;C>h&&(u=Math.max(h,u),_=h||C,h=C),c+=o*(x*w+this._spacingY);var R=o*(1-x)*w;if(e){if(a>0)(d=y/a>0&&y%a==0)&&(_=h>w?h:_);else if(w>t-v)c>l+o*x*w&&(d=!0);else{var I=(1-this._verticalDirection-r.y)*t,O=c+R+o*(o>0?this._paddingTop:this._paddingBottom);d=Math.abs(O)>Math.abs(I)}d&&(c=l+o*x*w,C!==h&&(_=h),f+=_+this._spacingX,_=h=C)}var P=i(S,T,f);n&&(S.getPosition(FK),S.setPosition(P,c,FK.z)),c+=R}return _=Math.max(_,h),Math.max(u,f+_)+this._getPaddingH()},i._doLayoutGridAxisHorizontal=function(t,e){var i=this,n=e.width,r=1,a=-t.y*e.height,o=this._paddingBottom;this._verticalDirection===hK.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*e.height,o=this._paddingTop);var s=function(t,e,n){return a+r*(n+(1-e.anchorY)*e.height*i._getUsedScaleValue(t.scale.y)+o)},l=0;this._resizeMode===lK.CONTAINER&&(l=this._doLayoutHorizontally(n,!0,s,!1),a=-t.y*l,this._verticalDirection===hK.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*l)),this._doLayoutHorizontally(n,!0,s,!0),this._resizeMode===lK.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(n,l)},i._doLayoutGridAxisVertical=function(t,e){var i=this,n=e.height,r=1,a=-t.x*e.width,o=this._paddingLeft;this._horizontalDirection===uK.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*e.width,o=this._paddingRight);var s=function(t,e,n){return a+r*(n+(1-e.anchorX)*e.width*i._getUsedScaleValue(t.scale.x)+o)},l=0;this._resizeMode===lK.CONTAINER&&(l=this._doLayoutVertically(n,!0,s,!1),a=-t.x*l,this._horizontalDirection===uK.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*l)),this._doLayoutVertically(n,!0,s,!0),this._resizeMode===lK.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(l,n)},i._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,i=t.contentSize;this.startAxis===cK.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,i):this.startAxis===cK.VERTICAL&&this._doLayoutGridAxisVertical(e,i)},i._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===lK.CONTAINER){for(var n=0;n<t.length;++n){var r=t[n],a=r.node.scale;e+=r.width*this._getUsedScaleValue(a.x)}e+=(i-1)*this._spacingX+this._getPaddingH()}else e=this.node._uiProps.uiTransformComp.width;return e},i._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===lK.CONTAINER){for(var n=0;n<t.length;++n){var r=t[n],a=r.node.scale;e+=r.height*this._getUsedScaleValue(a.y)}e+=(i-1)*this._spacingY+this._getPaddingV()}else e=this.node._uiProps.uiTransformComp.height;return e},i._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===sK.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?Ri.ZERO:e.position).y}),!0),this.node._uiProps.uiTransformComp.width=e}else if(this._layoutType===sK.VERTICAL){var i=this._getVerticalBaseHeight();this._doLayoutVertically(i,!1,(function(e){return(t._isAlign?Ri.ZERO:e.position).x}),!0),this.node._uiProps.uiTransformComp.height=i}else this._layoutType===sK.GRID&&this._doLayoutGrid()},i._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},i._transformDirty=function(t){t&kh.SCALE&&t&kh.POSITION&&this._affectedByScale&&this._doLayoutDirty()},i._doLayoutDirty=function(){this._layoutDirty=!0},i._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},i._getPaddingH=function(){return this._paddingLeft+this._paddingRight},i._getPaddingV=function(){return this._paddingTop+this._paddingBottom},i._getFixedBreakingNum=function(){if(this._layoutType!==sK.GRID||this._constraint===_K.NONE||this._constraintNum<=0)return 0;var t=this._constraint===_K.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===cK.VERTICAL&&(t=this._constraint===_K.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},q(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===sK.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===sK.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==sK.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==sK.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==_K.NONE&&this._constraintNum!==t&&(t<=0&&f("Limit values to be greater than 0"),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}(Jf),rK.Type=sK,rK.VerticalDirection=hK,rK.HorizontalDirection=uK,rK.ResizeMode=lK,rK.AxisDirection=cK,rK.Constraint=_K,$((GY=aK).prototype,"alignHorizontal",[uY,_Y],Object.getOwnPropertyDescriptor(GY.prototype,"alignHorizontal"),GY.prototype),$(GY.prototype,"alignVertical",[fY,dY],Object.getOwnPropertyDescriptor(GY.prototype,"alignVertical"),GY.prototype),$(GY.prototype,"type",[pY,mY],Object.getOwnPropertyDescriptor(GY.prototype,"type"),GY.prototype),$(GY.prototype,"resizeMode",[vY,gY,yY],Object.getOwnPropertyDescriptor(GY.prototype,"resizeMode"),GY.prototype),$(GY.prototype,"cellSize",[TY,SY],Object.getOwnPropertyDescriptor(GY.prototype,"cellSize"),GY.prototype),$(GY.prototype,"startAxis",[EY,AY],Object.getOwnPropertyDescriptor(GY.prototype,"startAxis"),GY.prototype),$(GY.prototype,"paddingLeft",[bY],Object.getOwnPropertyDescriptor(GY.prototype,"paddingLeft"),GY.prototype),$(GY.prototype,"paddingRight",[xY],Object.getOwnPropertyDescriptor(GY.prototype,"paddingRight"),GY.prototype),$(GY.prototype,"paddingTop",[CY],Object.getOwnPropertyDescriptor(GY.prototype,"paddingTop"),GY.prototype),$(GY.prototype,"paddingBottom",[wY],Object.getOwnPropertyDescriptor(GY.prototype,"paddingBottom"),GY.prototype),$(GY.prototype,"spacingX",[RY],Object.getOwnPropertyDescriptor(GY.prototype,"spacingX"),GY.prototype),$(GY.prototype,"spacingY",[IY],Object.getOwnPropertyDescriptor(GY.prototype,"spacingY"),GY.prototype),$(GY.prototype,"verticalDirection",[OY,PY],Object.getOwnPropertyDescriptor(GY.prototype,"verticalDirection"),GY.prototype),$(GY.prototype,"horizontalDirection",[MY,DY],Object.getOwnPropertyDescriptor(GY.prototype,"horizontalDirection"),GY.prototype),$(GY.prototype,"constraint",[NY,LY,BY],Object.getOwnPropertyDescriptor(GY.prototype,"constraint"),GY.prototype),$(GY.prototype,"constraintNum",[FY,zY],Object.getOwnPropertyDescriptor(GY.prototype,"constraintNum"),GY.prototype),$(GY.prototype,"affectedByScale",[UY],Object.getOwnPropertyDescriptor(GY.prototype,"affectedByScale"),GY.prototype),HY=$(GY.prototype,"_resizeMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return lK.NONE}}),VY=$(GY.prototype,"_layoutType",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sK.NONE}}),WY=$(GY.prototype,"_cellSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tn(40,40)}}),jY=$(GY.prototype,"_startAxis",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cK.HORIZONTAL}}),qY=$(GY.prototype,"_paddingLeft",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XY=$(GY.prototype,"_paddingRight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YY=$(GY.prototype,"_paddingTop",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KY=$(GY.prototype,"_paddingBottom",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZY=$(GY.prototype,"_spacingX",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QY=$(GY.prototype,"_spacingY",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JY=$(GY.prototype,"_verticalDirection",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hK.TOP_TO_BOTTOM}}),$Y=$(GY.prototype,"_horizontalDirection",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uK.LEFT_TO_RIGHT}}),tK=$(GY.prototype,"_constraint",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _K.NONE}}),eK=$(GY.prototype,"_constraintNum",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),iK=$(GY.prototype,"_affectedByScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nK=$(GY.prototype,"_isAlign",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kY=GY))||kY)||kY)||kY)||kY)||kY)||kY));!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(BK||(BK={})),he(BK);var UK,kK,GK,HK,VK,WK,jK,qK,XK,YK,KK,ZK,QK,JK,$K,tZ,eZ,iZ,nZ,rZ,aZ,oZ,sZ,lZ,cZ,hZ=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((dK=ru("cc.ProgressBar"),pK=gu(),mK=ou(110),vK=du(),gK=au(UB),yK=Fu(yG),TK=Eu(),SK=Fu(BK),EK=Eu(),AK=Eu(),bK=Au(),xK=Eu(),CK=Eu(),dK(wK=pK(wK=mK(wK=vK(wK=gK((LK=NK=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_barSprite",IK,K(e)),J(e,"_mode",OK,K(e)),J(e,"_totalLength",PK,K(e)),J(e,"_progress",MK,K(e)),J(e,"_reverse",DK,K(e)),e}Y(e,t);var i=e.prototype;return i._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,i=e.contentSize,n=e.anchorPoint,r=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===yG.FillType.RADIAL&&(this._mode=BK.FILLED),this._mode===BK.HORIZONTAL?this.totalLength=r.width:this._mode===BK.VERTICAL?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var a=-i.width*n.x;t.setPosition(a,0,0)}}},i._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,i=e.anchorPoint,n=e.contentSize,r=t.getPosition(),a=new Xi(0,.5),o=hi(this._progress),s=this._totalLength*o,l=n,c=0,h=0;switch(this._mode){case BK.HORIZONTAL:this._reverse&&(a=new Xi(1,.5)),l=new tn(s,n.height),c=this._totalLength,h=n.height;break;case BK.VERTICAL:a=this._reverse?new Xi(.5,1):new Xi(.5,0),l=new tn(n.width,s),c=n.width,h=this._totalLength}if(this._mode===BK.FILLED)this._barSprite.type!==yG.Type.FILLED?f("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(s*=-1),this._barSprite.fillRange=s);else if(this._barSprite.type!==yG.Type.FILLED){var u=a.x-i.x,_=a.y-i.y,d=new Ri(c*u,h*_,0);t.setPosition(r.x+d.x,r.y+d.y,r.z),e.setAnchorPoint(a),e.setContentSize(l)}else f("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},q(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var i=e._uiProps.uiTransformComp.contentSize;this._mode===BK.HORIZONTAL?this.totalLength=i.width:this._mode===BK.VERTICAL?this.totalLength=i.height:this._mode===BK.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===BK.FILLED&&(t=hi(t)),this._totalLength=t,this._updateBarStatus()}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(Jf),NK.Mode=BK,$((RK=LK).prototype,"barSprite",[yK,TK],Object.getOwnPropertyDescriptor(RK.prototype,"barSprite"),RK.prototype),$(RK.prototype,"mode",[SK,EK],Object.getOwnPropertyDescriptor(RK.prototype,"mode"),RK.prototype),$(RK.prototype,"totalLength",[AK],Object.getOwnPropertyDescriptor(RK.prototype,"totalLength"),RK.prototype),$(RK.prototype,"progress",[bK,wu,xK],Object.getOwnPropertyDescriptor(RK.prototype,"progress"),RK.prototype),$(RK.prototype,"reverse",[CK],Object.getOwnPropertyDescriptor(RK.prototype,"reverse"),RK.prototype),IK=$(RK.prototype,"_barSprite",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OK=$(RK.prototype,"_mode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return BK.HORIZONTAL}}),PK=$(RK.prototype,"_totalLength",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),MK=$(RK.prototype,"_progress",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),DK=$(RK.prototype,"_reverse",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wK=RK))||wK)||wK)||wK)||wK)||wK)),uZ=new Ri,_Z=new Ri,fZ=new Ri,dZ=new Xi,pZ=new Ci;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(cZ||(cZ={})),fe(cZ);var mZ,vZ,gZ,yZ,TZ,SZ,EZ,AZ,bZ,xZ,CZ,wZ,RZ,IZ,OZ,PZ,MZ,DZ,NZ,LZ,BZ,FZ,zZ,UZ,kZ,GZ,HZ,VZ,WZ,jZ,qZ,XZ,YZ,KZ,ZZ,QZ,JZ,$Z,tQ,eQ,iQ,nQ,rQ,aQ,oQ,sQ,lQ,cQ,hQ,uQ=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((UK=ru("cc.ScrollBar"),kK=gu(),GK=ou(110),HK=du(),VK=au(UB),WK=Fu(yG),jK=Ru(),qK=Eu(),XK=Fu(cZ),YK=Ru(),KK=Eu(),ZK=Ru(),QK=Eu(),JK=Ru(),$K=Eu(),UK(tZ=kK(tZ=GK(tZ=HK(tZ=VK((lZ=sZ=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_scrollView",iZ,K(e)),J(e,"_handle",nZ,K(e)),J(e,"_direction",rZ,K(e)),J(e,"_enableAutoHide",aZ,K(e)),J(e,"_autoHideTime",oZ,K(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}Y(e,t);var i=e.prototype;return i.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},i.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},i.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e._uiProps.uiTransformComp.contentSize,n=this._scrollView.node._uiProps.uiTransformComp.contentSize,r=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(i,n)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var a=0,o=0,s=0,l=0,c=0;this._direction===cZ.HORIZONTAL?(a=i.width,o=n.width,c=r.width,s=t.x,l=-this._convertToScrollViewSpace(e).x):this._direction===cZ.VERTICAL&&(a=i.height,o=n.height,c=r.height,s=t.y,l=-this._convertToScrollViewSpace(e).y);var h=this._calculateLength(a,o,c,s),u=this._calculatePosition(a,o,c,l,s,h);this._updateLength(h),this._updateHandlerPosition(u)}}}},i.setScrollView=function(t){this._scrollView=t},i.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},i.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this._autoHideTime}},i.onEnable=function(){var t=this.node.getComponent(yG);t&&(this._opacity=t.color.a)},i.start=function(){this._enableAutoHide&&this._setOpacity(0)},i.update=function(t){this._processAutoHide(t)},i._convertToScrollViewSpace=function(t){var e=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,i=t._uiProps.uiTransformComp;if(!e||!i)return uZ;_Z.set(-i.anchorX*i.width,-i.anchorY*i.height,0),i.convertToWorldSpaceAR(_Z,fZ);var n=e.convertToNodeSpaceAR(fZ);return n.x+=e.anchorX*e.width,n.y+=e.anchorY*e.height,n},i._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(yG);e&&(pZ.set(e.color),pZ.a=t,e.color=pZ),(e=this._handle.getComponent(yG))&&(pZ.set(e.color),pZ.a=t,e.color=pZ)}},i._updateHandlerPosition=function(t){if(this._handle){var e=this._fixupHandlerPosition();this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},i._fixupHandlerPosition=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize,i=t.anchorPoint,n=this.handle.node._uiProps.uiTransformComp.contentSize,r=this.handle.node.parent;Ri.set(_Z,-e.width*i.x,-e.height*i.y,0);var a=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(_Z,fZ),o=new Ri;return r._uiProps.uiTransformComp.convertToNodeSpaceAR(a,o),this.direction===cZ.HORIZONTAL?o=new Ri(o.x,o.y+(e.height-n.height)/2,0):this.direction===cZ.VERTICAL&&(o=new Ri(o.x+(e.width-n.width)/2,o.y,0)),this.handle.node.setPosition(o),o},i._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===cZ.HORIZONTAL||t.height<=e.height&&this._direction===cZ.VERTICAL},i._calculateLength=function(t,e,i,n){var r=t;return n&&(r+=20*(n>0?n:-n)),i*(e/r)},i._calculatePosition=function(t,e,i,n,r,a){var o=t-e;r&&(o+=Math.abs(r));var s=0;o&&(s=hi(s=n/o));var l=(i-a)*s;return this._direction===cZ.VERTICAL?new Ri(0,l,0):new Ri(l,0,0)},i._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,i=e.contentSize,n=e.anchorPoint;n.x===dZ.x&&n.y===dZ.y||e.setAnchorPoint(dZ),this._direction===cZ.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},i._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},q(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(uZ))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(new Ri))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}(Jf),sZ.Direction=cZ,$((eZ=lZ).prototype,"handle",[WK,jK,qK],Object.getOwnPropertyDescriptor(eZ.prototype,"handle"),eZ.prototype),$(eZ.prototype,"direction",[XK,YK,KK],Object.getOwnPropertyDescriptor(eZ.prototype,"direction"),eZ.prototype),$(eZ.prototype,"enableAutoHide",[ZK,QK],Object.getOwnPropertyDescriptor(eZ.prototype,"enableAutoHide"),eZ.prototype),$(eZ.prototype,"autoHideTime",[JK,$K],Object.getOwnPropertyDescriptor(eZ.prototype,"autoHideTime"),eZ.prototype),iZ=$(eZ.prototype,"_scrollView",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nZ=$(eZ.prototype,"_handle",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rZ=$(eZ.prototype,"_direction",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cZ.HORIZONTAL}}),aZ=$(eZ.prototype,"_enableAutoHide",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oZ=$(eZ.prototype,"_autoHideTime",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tZ=eZ))||tZ)||tZ)||tZ)||tZ)||tZ)),_Q=t("ViewGroup",ru("cc.ViewGroup")(mZ=ou(110)(mZ=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e}(Jf))||mZ)||mZ);n.ViewGroup=_Q;var fQ,dQ=new Ri,pQ=new Ri,mQ=new Ri,vQ=new Xi,gQ=new Xi,yQ=function(){return(new Date).getMilliseconds()},TQ={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(fQ||(fQ={}));var SQ,EQ,AQ,bQ,xQ,CQ,wQ,RQ,IQ,OQ,PQ,MQ,DQ,NQ,LQ,BQ,FQ,zQ,UQ,kQ,GQ,HQ,VQ=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((vZ=ru("cc.ScrollView"),gZ=gu(),yZ=ou(110),TZ=du(),SZ=au(UB),EZ=Au(),AZ=Ru(),bZ=Eu(),xZ=Au(),CZ=Ru(),wZ=Eu(),RZ=Ru(),IZ=Eu(),OZ=Ru(),PZ=Eu(),MZ=Fu(wA),DZ=Ru(),NZ=Eu(),LZ=Ru(),BZ=Eu(),FZ=Fu(uQ),zZ=Ru(),UZ=Eu(),kZ=Ru(),GZ=Eu(),HZ=Fu(uQ),VZ=Ru(),WZ=Eu(),jZ=Ru(),qZ=Eu(),XZ=Fu([yP]),YZ=Ru(),KZ=Eu(),vZ(ZZ=gZ(ZZ=yZ(ZZ=TZ(ZZ=SZ((hQ=cQ=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"bounceDuration",JZ,K(e)),J(e,"brake",$Z,K(e)),J(e,"elastic",tQ,K(e)),J(e,"inertia",eQ,K(e)),J(e,"horizontal",iQ,K(e)),J(e,"vertical",nQ,K(e)),J(e,"cancelInnerEvents",rQ,K(e)),J(e,"scrollEvents",aQ,K(e)),e._autoScrolling=!1,e._scrolling=!1,J(e,"_content",oQ,K(e)),J(e,"_horizontalScrollBar",sQ,K(e)),J(e,"_verticalScrollBar",lQ,K(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new Ri,e._autoScrollTargetDelta=new Ri,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new Ri,e._outOfBoundaryAmount=new Ri,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new Ri,e._deltaPos=new Ri,e}Y(e,t);var i=e.prototype;return i.scrollToBottom=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},i.scrollToTop=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Xi(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToOffset=function(t,e,i){void 0===i&&(i=!0);var n=this.getMaxScrollOffset(),r=new Xi(0,0);0===n.x?r.x=0:r.x=t.x/n.x,0===n.y?r.y=1:r.y=(n.y-t.y)/n.y,this.scrollTo(r,e,i)},i.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new Ri(e,t,0)},i.getMaxScrollOffset=function(){if(!this._content||!this.view)return dQ;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,i=t.height-this.view.height;return new Ri(e=e>=0?e:0,i=i>=0?i:0,0)},i.scrollToPercentHorizontal=function(t,e,i){var n=this._calculateMovePercentDelta({anchor:new Xi(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(n,e,!1!==i):this._moveContent(n)},i.scrollTo=function(t,e,i){var n=this._calculateMovePercentDelta({anchor:new Xi(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,i):this._moveContent(n)},i.scrollToPercentVertical=function(t,e,i){var n=this._calculateMovePercentDelta({anchor:new Xi(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(n,e,i):this._moveContent(n)},i.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},i.setContentPosition=function(t){if(this._content){var e=this.getContentPosition();Math.abs(t.x-e.x)<1e-4&&Math.abs(t.y-e.y)<1e-4||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},i.getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):dQ},i.isScrolling=function(){return this._scrolling},i.isAutoScrolling=function(){return this._autoScrolling},i.getScrollEndedEventTiming=function(){return 1e-4},i.start=function(){this._calculateBoundary(),this._content&&BR.once(LR.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},i.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(wA.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(wA.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(wA.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(wA.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},i.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},i.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(wA.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(wA.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(wA.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(wA.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},i._registerEvent=function(){this.node.on(wA.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(wA.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(wA.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(wA.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(wA.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._unregisterEvent=function(){this.node.off(wA.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(wA.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(wA.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(wA.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(wA.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._onMouseWheel=function(t,e){if(!this.horizontal&&this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=new Ri,n=t.getScrollY();this.vertical?i.set(0,-.1*n,0):this.horizontal&&i.set(-.1*n,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},i._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},i._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var i=t.touch;if(this._handleMoveLogic(i),this.cancelInnerEvents){var n=i.getUILocation(vQ);if(n.subtract(i.getUIStartLocation(gQ)),n.length()>7&&!this._touchMoved&&t.target!==this.node){var r=new SS(t.getTouches(),t.bubbles);r.type=wA.EventType.TOUCH_CANCEL,r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},i._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(fQ.TOUCH_UP);var i=t.touch;this._handleReleaseLogic(i),this._stopPropagationIfTargetIsMe(t)}},i._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var i=t.touch;this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},i._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(zK);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,i=e.width*e.anchorX,n=e.height*e.anchorY;this._leftBoundary=-i,this._bottomBoundary=-n,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},i._hasNestedViewGroup=function(t,e){if(t&&t.eventPhase===h_.CAPTURING_PHASE){if(e)for(var i,n=Q(e);!(i=n()).done;){var r=i.value;if(this.node===r)return t.target&&t.target.getComponent(_Q),!1;if(r.getComponent(_Q))return!1}return!1}},i._startInertiaScroll=function(t){var e=new Ri(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},i._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},i._startAttenuatingAutoScroll=function(t,e){var i=new Ri(t);if(i.normalize(),this._content&&this.view){var n=this._content._uiProps.uiTransformComp.contentSize,r=this.view.contentSize,a=n.width-r.width,o=n.height-r.height,s=this._calculateAttenuatedFactor(a),l=this._calculateAttenuatedFactor(o);i.x=i.x*a*(1-this.brake)*s,i.y=i.y*o*l*(1-this.brake),i.z=0}var c=t.length(),h=i.length()/c;if(i.add(t),this.brake>0&&h>7){h=Math.sqrt(h);var u=new Ri(t);u.multiplyScalar(h),i.set(u),i.add(t)}var _=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&h>3&&(_*=h=3),0===this.brake&&h>1&&(_*=h),this._startAutoScroll(i,_,!0)},i._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},i._startAutoScroll=function(t,e,i){void 0===i&&(i=!1);var n=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=n,this._autoScrollAttenuate=i,Ri.copy(this._autoScrollStartPosition,this.getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=new Ri,this._getHowMuchOutOfBoundary().equals(dQ,1e-4)||(this._autoScrollCurrentlyOutOfBoundary=!0)},i._calculateTouchMoveVelocity=function(){var t=0;if((t=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),t))<=0||t>=.5)return new Ri;var e=new Ri;return e=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),e),new Ri(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t,0)},i._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},i._moveContent=function(t,e){var i=this._flattenVectorByDirection(t);pQ.set(this.getContentPosition()),pQ.add(i),pQ.set(1e-4*Math.floor(1e4*pQ.x),1e-4*Math.floor(1e4*pQ.y),pQ.z),this.setContentPosition(pQ);var n=this._getHowMuchOutOfBoundary();this._updateScrollBar(n),this.elastic&&e&&this._startBounceBackIfNeeded()},i._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this.getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},i._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},i._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},i._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this.getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},i._getHowMuchOutOfBoundary=function(t){if((t=t||new Ri).equals(dQ,1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new Ri;return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.equals(dQ,1e-4)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e)},i._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},i._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},i._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},i._dispatchEvent=function(t){if(t===fQ.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===fQ.SCROLL_TO_TOP||t===fQ.SCROLL_TO_BOTTOM||t===fQ.SCROLL_TO_LEFT||t===fQ.SCROLL_TO_RIGHT){var e=1<<TQ[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}yP.emitEvents(this.scrollEvents,this,TQ[t]),this.node.emit(t,this)},i._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();pQ.set(this.getContentPosition()),pQ.add(t),this._content.setPosition(pQ),this._updateScrollBar(dQ)}},i._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},i._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},i._stopPropagationIfTargetIsMe=function(t){t.eventPhase===h_.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},i._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},i._handleMoveLogic=function(t){this._deltaPos.set(this._getLocalAxisAlignDelta(t)),this._processDeltaMove(this._deltaPos)},i._handleReleaseLogic=function(t){this._deltaPos.set(this._getLocalAxisAlignDelta(t)),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(fQ.SCROLL_ENDED))},i._getLocalAxisAlignDelta=function(t){var e=this.node._uiProps.uiTransformComp,i=new Ri;return e&&(t.getUILocation(vQ),t.getUIPreviousLocation(gQ),pQ.set(vQ.x,vQ.y,0),mQ.set(gQ.x,gQ.y,0),e.convertToNodeSpaceAR(pQ,pQ),e.convertToNodeSpaceAR(mQ,mQ),Ri.subtract(i,pQ,mQ)),i},i._scrollChildren=function(t){var e,i,n=t=this._clampDelta(t);if(this.elastic&&(e=this._getHowMuchOutOfBoundary(),n.x*=0===e.x?1:.5,n.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(n),n.add(e)),this._content){var r=this._content._uiProps.uiTransformComp,a=r.anchorX,o=r.anchorY,s=r.width,l=r.height,c=this._content.position||dQ;n.y>0?c.y-o*l+n.y>=this._bottomBoundary&&(i=fQ.SCROLL_TO_BOTTOM):n.y<0&&c.y-o*l+l+n.y<=this._topBoundary&&(i=fQ.SCROLL_TO_TOP),n.x<0?c.x-a*s+s+n.x<=this._rightBoundary&&(i=fQ.SCROLL_TO_RIGHT):n.x>0&&c.x-a*s+n.x>=this._leftBoundary&&(i=fQ.SCROLL_TO_LEFT)}this._moveContent(n,!1),0===n.x&&0===n.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent(fQ.SCROLL_BEGAN)),this._dispatchEvent(fQ.SCROLLING)),i&&i.length>0&&this._dispatchEvent(i)},i._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(fQ.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=yQ(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},i._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,i=this._content._uiProps.uiTransformComp;i.width<e.width&&(t.x=0),i.height<e.height&&(t.y=0)}return t},i._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var i=yQ();this._touchMoveTimeDeltas.push((i-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=i},i._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).equals(dQ,1e-4))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(fQ.BOUNCE_TOP),t.y<0&&this._dispatchEvent(fQ.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(fQ.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(fQ.BOUNCE_LEFT),this._isBouncing=!0),!0},i._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(pQ,1e-4)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},i._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(dQ,1e-4)},i._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},i._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);var n,r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(n=r,r=(n-=1)*n*n*n*n+1);var a=new Ri(this._autoScrollTargetDelta);a.multiplyScalar(r);var o=new Ri(this._autoScrollStartPosition);o.add(a);var s=Math.abs(r-1)<=1e-4;if(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(fQ.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var l=new Ri(o);l.subtract(this._autoScrollBrakingStartPosition),e&&l.multiplyScalar(i),o.set(this._autoScrollBrakingStartPosition),o.add(l)}else{var c=new Ri(o);c.subtract(this.getContentPosition());var h=this._getHowMuchOutOfBoundary(c);h.equals(dQ,1e-4)||(o.add(h),s=!0)}s&&(this._autoScrolling=!1);var u=new Ri(o);u.subtract(this.getContentPosition()),this._moveContent(this._clampDelta(u),s),this._dispatchEvent(fQ.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(fQ.SCROLL_ENDED))},i._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals(dQ,1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(fQ.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(fQ.SCROLL_ENDED),this._stopMouseWheel=!1)},i._calculateMovePercentDelta=function(t){var e=t.anchor,i=t.applyToHorizontal,n=t.applyToVertical;this._calculateBoundary(),e.clampf(new Xi(0,0),new Xi(1,1));var r=this._getContentBottomBoundary()-this._bottomBoundary;r=-r;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var o=new Ri;if(this._content&&this.view){var s=0,l=this._content._uiProps.uiTransformComp.contentSize,c=this.view.contentSize;i&&(s=l.width-c.width,o.x=a-s*e.x),n&&(s=l.height-c.height,o.y=r-s*e.y)}return o},i._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var i=new Ri,n=0,r=this._getContentLeftBoundary()-this._leftBoundary;if(r=-r,this._content){var a=this._content._uiProps.uiTransformComp.contentSize;a.height<t.height&&(n=a.height-t.height,i.y=e-n),a.width<t.width&&(n=a.width-t.width,i.x=r)}this._updateScrollBarState(),this._moveContent(i),this._adjustContentOutOfBoundary()},i._scaleChanged=function(t){t===kh.SCALE&&this._calculateBoundary()},q(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):T(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(dQ)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(dQ)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(_Q),cQ.EventType=fQ,JZ=$((QZ=hQ).prototype,"bounceDuration",[cu,EZ,AZ,bZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$Z=$(QZ.prototype,"brake",[cu,xZ,CZ,wZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),tQ=$(QZ.prototype,"elastic",[cu,RZ,IZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),eQ=$(QZ.prototype,"inertia",[cu,OZ,PZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$(QZ.prototype,"content",[MZ,DZ,NZ],Object.getOwnPropertyDescriptor(QZ.prototype,"content"),QZ.prototype),iQ=$(QZ.prototype,"horizontal",[cu,LZ,BZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$(QZ.prototype,"horizontalScrollBar",[FZ,zZ,UZ],Object.getOwnPropertyDescriptor(QZ.prototype,"horizontalScrollBar"),QZ.prototype),nQ=$(QZ.prototype,"vertical",[cu,kZ,GZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$(QZ.prototype,"verticalScrollBar",[HZ,VZ,WZ],Object.getOwnPropertyDescriptor(QZ.prototype,"verticalScrollBar"),QZ.prototype),rQ=$(QZ.prototype,"cancelInnerEvents",[cu,jZ,qZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aQ=$(QZ.prototype,"scrollEvents",[XZ,cu,YZ,KZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oQ=$(QZ.prototype,"_content",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sQ=$(QZ.prototype,"_horizontalScrollBar",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lQ=$(QZ.prototype,"_verticalScrollBar",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZZ=QZ))||ZZ)||ZZ)||ZZ)||ZZ)||ZZ)),WQ=new Ri;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(HQ||(HQ={})),fe(HQ);var jQ,qQ,XQ,YQ,KQ,ZQ,QQ,JQ,$Q,tJ,eJ,iJ,nJ,rJ,aJ,oJ,sJ,lJ,cJ,hJ,uJ=function(e){return t({Slider:e,SliderComponent:e}),e}((SQ=ru("cc.Slider"),EQ=gu(),AQ=ou(110),bQ=du(),xQ=au(UB),CQ=Fu(yG),wQ=Eu(),RQ=Fu(HQ),IQ=Eu(),OQ=Au(),PQ=Eu(),MQ=Fu([yP]),DQ=Eu(),SQ(NQ=EQ(NQ=AQ(NQ=bQ(NQ=xQ((GQ=kQ=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"slideEvents",BQ,K(e)),J(e,"_handle",FQ,K(e)),J(e,"_direction",zQ,K(e)),J(e,"_progress",UQ,K(e)),e._offset=new Ri,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new Ri,e._touchPos=new Ri,e}Y(e,t);var i=e.prototype;return i.__preload=function(){this._updateHandlePosition()},i.onEnable=function(){this._updateHandlePosition(),this.node.on(vS.TOUCH_START,this._onTouchBegan,this),this.node.on(vS.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(vS.TOUCH_END,this._onTouchEnded,this),this.node.on(vS.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(vS.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(vS.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(vS.TOUCH_END,this._onTouchEnded,this))},i.onDisable=function(){this.node.off(vS.TOUCH_START,this._onTouchBegan,this),this.node.off(vS.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(vS.TOUCH_END,this._onTouchEnded,this),this.node.off(vS.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(vS.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(vS.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(vS.TOUCH_END,this._onTouchEnded,this))},i._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();Ri.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},i._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new Ri,t&&(t.propagationStopped=!0)},i._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},i._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},i._emitSlideEvent=function(){yP.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},i._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();Ri.set(this._touchPos,e.x,e.y,0);var i=this.node._uiProps.uiTransformComp,n=i.convertToNodeSpaceAR(this._touchPos,WQ);this.direction===HQ.Horizontal?this.progress=hi(.5+(n.x-this._offset.x)/i.width):this.progress=hi(.5+(n.y-this._offset.y)/i.height)}},i._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===HQ.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},i._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var i=this._handle.node.position;this._direction===HQ.Horizontal?this._handle.node.setPosition(i.x,0,i.z):this._handle.node.setPosition(0,i.y,i.z),this._updateHandlePosition()}},q(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}(Jf),kQ.Direction=HQ,$((LQ=GQ).prototype,"handle",[CQ,wQ],Object.getOwnPropertyDescriptor(LQ.prototype,"handle"),LQ.prototype),$(LQ.prototype,"direction",[RQ,IQ],Object.getOwnPropertyDescriptor(LQ.prototype,"direction"),LQ.prototype),$(LQ.prototype,"progress",[wu,OQ,PQ],Object.getOwnPropertyDescriptor(LQ.prototype,"progress"),LQ.prototype),BQ=$(LQ.prototype,"slideEvents",[MQ,cu,DQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FQ=$(LQ.prototype,"_handle",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zQ=$(LQ.prototype,"_direction",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return HQ.Horizontal}}),UQ=$(LQ.prototype,"_progress",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),NQ=LQ))||NQ)||NQ)||NQ)||NQ)||NQ));function _J(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Object.assign.apply(Object,[{}].concat(e))}!function(t){t.TOGGLE="toggle"}(hJ||(hJ={}));var fJ,dJ,pJ,mJ,vJ,gJ,yJ,TJ,SJ,EJ,AJ,bJ,xJ,CJ,wJ,RJ,IJ,OJ,PJ,MJ,DJ,NJ,LJ,BJ,FJ,zJ,UJ,kJ,GJ,HJ,VJ,WJ,jJ,qJ,XJ,YJ,KJ,ZJ,QJ,JJ,$J,t$,e$,i$,n$,r$,a$,o$,s$,l$,c$,h$,u$,_$,f$,d$,p$,m$,v$,g$=function(e){return t({Toggle:e,ToggleComponent:e}),e}((jQ=ru("cc.Toggle"),qQ=gu(),XQ=ou(110),YQ=du(),KQ=au(UB),ZQ=Ru(),QQ=Eu(),JQ=Fu(yG),$Q=Ru(),tJ=Eu(),eJ=Fu([yP]),iJ=Eu(),jQ(nJ=qQ(nJ=XQ(nJ=YQ(nJ=KQ((cJ=lJ=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"checkEvents",aJ,K(e)),J(e,"_isChecked",oJ,K(e)),J(e,"_checkMark",sJ,K(e)),e}Y(e,t);var i=e.prototype;return i._internalToggle=function(){this.isChecked=!this.isChecked},i._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var i=this._toggleContainer;i&&i.enabled&&this.enabled&&(t||!i.anyTogglesChecked()&&!i.allowSwitchOff)&&(this._isChecked=!0,i.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},i.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},i.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},i.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},i.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},i._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&yP.emitEvents(this.checkEvents,this)},q(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return n.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(Wq),lJ.EventType=_J(hJ,Uq),$((rJ=cJ).prototype,"isChecked",[ZQ,QQ],Object.getOwnPropertyDescriptor(rJ.prototype,"isChecked"),rJ.prototype),$(rJ.prototype,"checkMark",[JQ,$Q,tJ],Object.getOwnPropertyDescriptor(rJ.prototype,"checkMark"),rJ.prototype),aJ=$(rJ.prototype,"checkEvents",[eJ,cu,iJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oJ=$(rJ.prototype,"_isChecked",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sJ=$(rJ.prototype,"_checkMark",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nJ=rJ))||nJ)||nJ)||nJ)||nJ)||nJ)),y$=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((fJ=ru("cc.ToggleContainer"),dJ=gu(),pJ=ou(110),mJ=du(),vJ=Eu(),gJ=Fu([yP]),yJ=Eu(),fJ(TJ=dJ(TJ=pJ(TJ=mJ(TJ=fu((bJ=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_allowSwitchOff",EJ,K(e)),J(e,"checkEvents",AJ,K(e)),e}Y(e,t);var i=e.prototype;return i.onEnable=function(){this.ensureValidState(),this.node.on(vS.CHILD_ADDED,this.ensureValidState,this),this.node.on(vS.CHILD_REMOVED,this.ensureValidState,this)},i.onDisable=function(){this.node.off(vS.CHILD_ADDED,this.ensureValidState,this),this.node.off(vS.CHILD_REMOVED,this.ensureValidState,this)},i.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},i.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},i.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var i=0;i<this.toggleItems.length;i++){var r=this.toggleItems[i];r!==t&&(e?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&n.Component.EventHandler.emitEvents(this.checkEvents,t)}},i.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var i=this.activeToggles();if(i.length>1)for(var n=i[0],r=0;r<i.length;++r){var a=i[r];a!==n&&(a.isChecked=!1)}},q(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");if(e&&e.enabled)return e})).filter(Boolean)}}]),e}(Jf),EJ=$((SJ=bJ).prototype,"_allowSwitchOff",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(SJ.prototype,"allowSwitchOff",[vJ],Object.getOwnPropertyDescriptor(SJ.prototype,"allowSwitchOff"),SJ.prototype),AJ=$(SJ.prototype,"checkEvents",[gJ,cu,yJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TJ=SJ))||TJ)||TJ)||TJ)||TJ)||TJ)),T$=new Ri;function S$(t){return t instanceof sR?_b:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:tn.ZERO}function E$(t,e,i,n){for(var r=t.parent?t.parent.getScale():T$,a=r.x,o=r.y,s=0,l=0,c=t.parent;;){if(!c)return i.x=i.y=0,void(n.x=n.y=1);var h=c.getPosition();if(s+=h.x,l+=h.y,(c=c.parent)===e)break;var u=(r=c?c.getScale():T$).x,_=r.y;s*=u,l*=_,a*=u,o*=_}n.x=0!==a?1/a:1,n.y=0!==o?1/o:1,i.x=-s,i.y=-l}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(m$||(m$={})),fe(m$),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(v$||(v$={}));var A$,b$,x$,C$,w$,R$,I$,O$,P$,M$,D$,N$,L$,B$,F$,z$,U$,k$,G$,H$=v$.TOP|v$.BOT,V$=v$.LEFT|v$.RIGHT,W$=function(e){return t({Widget:e,WidgetComponent:e}),e}((xJ=ru("cc.Widget"),CJ=gu(),wJ=ou(110),RJ=du(),IJ=au(UB),OJ=Fu(wA),PJ=Eu(),MJ=Eu(),DJ=Eu(),NJ=Eu(),LJ=Eu(),BJ=Eu(),FJ=Eu(),zJ=Tu(),UJ=Tu(),kJ=Eu(),GJ=Eu(),HJ=Eu(),VJ=Eu(),WJ=Eu(),jJ=Eu(),qJ=Fu(m$),XJ=Eu(),xJ(YJ=CJ(YJ=wJ(YJ=RJ(YJ=IJ(YJ=fu((p$=d$=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._lastPos=new Ri,e._lastSize=new tn,e._dirty=!0,e._hadAlignOnce=!1,J(e,"_alignFlags",ZJ,K(e)),J(e,"_target",QJ,K(e)),J(e,"_left",JJ,K(e)),J(e,"_right",$J,K(e)),J(e,"_top",t$,K(e)),J(e,"_bottom",e$,K(e)),J(e,"_horizontalCenter",i$,K(e)),J(e,"_verticalCenter",n$,K(e)),J(e,"_isAbsLeft",r$,K(e)),J(e,"_isAbsRight",a$,K(e)),J(e,"_isAbsTop",o$,K(e)),J(e,"_isAbsBottom",s$,K(e)),J(e,"_isAbsHorizontalCenter",l$,K(e)),J(e,"_isAbsVerticalCenter",c$,K(e)),J(e,"_originalWidth",h$,K(e)),J(e,"_originalHeight",u$,K(e)),J(e,"_alignMode",_$,K(e)),J(e,"_lockFlags",f$,K(e)),e}Y(e,t);var i=e.prototype;return i.updateAlignment=function(){n._widgetManager.updateAlignment(this.node)},i._validateTargetInDEV=function(){},i.setDirty=function(){this._recursiveDirty()},i.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),n._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},i.onDisable=function(){n._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},i.onDestroy=function(){this._removeParentEvent()},i._adjustWidgetToAllowMovingInEditor=function(){},i._adjustWidgetToAllowResizingInEditor=function(){},i._adjustWidgetToAnchorChanged=function(){this.setDirty()},i._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},i._registerEvent=function(){this.node.on(vS.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(vS.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(vS.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(vS.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._unregisterEvent=function(){this.node.off(vS.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(vS.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(vS.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},i._removeParentEvent=function(){this.node.off(vS.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var i=this.node.parent&&this.node.parent._uiProps,n=i&&i.uiTransformComp,r=n?n.contentSize:_b;this.isAlignLeft&&t===v$.LEFT?this._left=e?this._left*r.width:this._left/r.width:this.isAlignRight&&t===v$.RIGHT?this._right=e?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&t===v$.CENTER?this._horizontalCenter=e?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&t===v$.TOP?this._top=e?this._top*r.height:this._top/r.height:this.isAlignBottom&&t===v$.BOT?this._bottom=e?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&t===v$.MID&&(this._verticalCenter=this._verticalCenter/r.height),this._recursiveDirty()}},i._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(UB)&&(t.on(vS.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(vS.SIZE_CHANGED,this._setDirtyByMode,this))},i._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(vS.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(vS.SIZE_CHANGED,this._setDirtyByMode,this))},i._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(vS.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(vS.SIZE_CHANGED,this._setDirtyByMode,this))},i._setDirtyByMode=function(){this.alignMode===m$.ALWAYS&&this._recursiveDirty()},i._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&V$)>0,n=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=n.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=n.height))):(i?this.isStretchWidth&&(n.width=this._originalWidth):this.isStretchHeight&&(n.height=this._originalHeight),this._alignFlags&=~t)}},i._recursiveDirty=function(){this._dirty||(this._dirty=!0)},q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&v$.TOP)>0},set:function(t){this._setAlign(v$.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&v$.BOT)>0},set:function(t){this._setAlign(v$.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&v$.LEFT)>0},set:function(t){this._setAlign(v$.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&v$.RIGHT)>0},set:function(t){this._setAlign(v$.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&v$.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=v$.MID):this._alignFlags&=~v$.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&v$.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=v$.CENTER):this._alignFlags&=~v$.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&V$)===V$}},{key:"isStretchHeight",get:function(){return(this._alignFlags&H$)===H$}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(v$.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(v$.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(v$.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(v$.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(v$.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(v$.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(Jf),d$.AlignMode=m$,$((KJ=p$).prototype,"target",[OJ,PJ],Object.getOwnPropertyDescriptor(KJ.prototype,"target"),KJ.prototype),$(KJ.prototype,"isAlignTop",[MJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isAlignTop"),KJ.prototype),$(KJ.prototype,"isAlignBottom",[DJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isAlignBottom"),KJ.prototype),$(KJ.prototype,"isAlignLeft",[NJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isAlignLeft"),KJ.prototype),$(KJ.prototype,"isAlignRight",[LJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isAlignRight"),KJ.prototype),$(KJ.prototype,"isAlignVerticalCenter",[BJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isAlignVerticalCenter"),KJ.prototype),$(KJ.prototype,"isAlignHorizontalCenter",[FJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isAlignHorizontalCenter"),KJ.prototype),$(KJ.prototype,"isStretchWidth",[zJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isStretchWidth"),KJ.prototype),$(KJ.prototype,"isStretchHeight",[UJ],Object.getOwnPropertyDescriptor(KJ.prototype,"isStretchHeight"),KJ.prototype),$(KJ.prototype,"top",[kJ],Object.getOwnPropertyDescriptor(KJ.prototype,"top"),KJ.prototype),$(KJ.prototype,"editorTop",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"editorTop"),KJ.prototype),$(KJ.prototype,"bottom",[GJ],Object.getOwnPropertyDescriptor(KJ.prototype,"bottom"),KJ.prototype),$(KJ.prototype,"editorBottom",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"editorBottom"),KJ.prototype),$(KJ.prototype,"left",[HJ],Object.getOwnPropertyDescriptor(KJ.prototype,"left"),KJ.prototype),$(KJ.prototype,"editorLeft",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"editorLeft"),KJ.prototype),$(KJ.prototype,"right",[VJ],Object.getOwnPropertyDescriptor(KJ.prototype,"right"),KJ.prototype),$(KJ.prototype,"editorRight",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"editorRight"),KJ.prototype),$(KJ.prototype,"horizontalCenter",[WJ],Object.getOwnPropertyDescriptor(KJ.prototype,"horizontalCenter"),KJ.prototype),$(KJ.prototype,"editorHorizontalCenter",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"editorHorizontalCenter"),KJ.prototype),$(KJ.prototype,"verticalCenter",[jJ],Object.getOwnPropertyDescriptor(KJ.prototype,"verticalCenter"),KJ.prototype),$(KJ.prototype,"editorVerticalCenter",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"editorVerticalCenter"),KJ.prototype),$(KJ.prototype,"isAbsoluteTop",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"isAbsoluteTop"),KJ.prototype),$(KJ.prototype,"isAbsoluteBottom",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"isAbsoluteBottom"),KJ.prototype),$(KJ.prototype,"isAbsoluteLeft",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"isAbsoluteLeft"),KJ.prototype),$(KJ.prototype,"isAbsoluteRight",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"isAbsoluteRight"),KJ.prototype),$(KJ.prototype,"isAbsoluteHorizontalCenter",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"isAbsoluteHorizontalCenter"),KJ.prototype),$(KJ.prototype,"isAbsoluteVerticalCenter",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"isAbsoluteVerticalCenter"),KJ.prototype),$(KJ.prototype,"alignMode",[qJ,XJ],Object.getOwnPropertyDescriptor(KJ.prototype,"alignMode"),KJ.prototype),$(KJ.prototype,"alignFlags",[yu],Object.getOwnPropertyDescriptor(KJ.prototype,"alignFlags"),KJ.prototype),ZJ=$(KJ.prototype,"_alignFlags",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QJ=$(KJ.prototype,"_target",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JJ=$(KJ.prototype,"_left",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$J=$(KJ.prototype,"_right",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),t$=$(KJ.prototype,"_top",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e$=$(KJ.prototype,"_bottom",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),i$=$(KJ.prototype,"_horizontalCenter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n$=$(KJ.prototype,"_verticalCenter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),r$=$(KJ.prototype,"_isAbsLeft",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a$=$(KJ.prototype,"_isAbsRight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),o$=$(KJ.prototype,"_isAbsTop",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),s$=$(KJ.prototype,"_isAbsBottom",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),l$=$(KJ.prototype,"_isAbsHorizontalCenter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),c$=$(KJ.prototype,"_isAbsVerticalCenter",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),h$=$(KJ.prototype,"_originalWidth",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u$=$(KJ.prototype,"_originalHeight",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_$=$(KJ.prototype,"_alignMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m$.ON_WINDOW_RESIZE}}),f$=$(KJ.prototype,"_lockFlags",[cu,uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YJ=KJ))||YJ)||YJ)||YJ)||YJ)||YJ)||YJ));n.internal.computeInverseTransForTarget=E$,n.internal.getReadonlyNodeSize=S$;var j$,q$=new Ci;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(j$||(j$={})),fe(j$);var X$,Y$,K$,Z$,Q$,J$,$$,t0,e0,i0,n0,r0,a0,o0,s0,l0,c0,h0,u0,_0,f0,d0,p0,m0,v0,g0,y0,T0,S0,E0,A0,b0,x0,C0,w0,R0,I0,O0,P0,M0,D0,N0,L0,B0,F0,z0=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((A$=ru("cc.PageViewIndicator"),b$=gu(),x$=ou(110),C$=du(),w$=Fu(vL),R$=Eu(),I$=Fu(j$),O$=Eu(),P$=Fu(tn),M$=Eu(),D$=Eu(),A$(N$=b$(N$=x$(N$=C$((G$=k$=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"spacing",B$,K(e)),J(e,"_spriteFrame",F$,K(e)),J(e,"_direction",z$,K(e)),J(e,"_cellSize",U$,K(e)),e._layout=null,e._pageView=null,e._indicators=[],e}Y(e,t);var i=e.prototype;return i.onLoad=function(){this._updateLayout()},i.setPageView=function(t){this._pageView=t,this._refresh()},i._updateLayout=function(){this._layout=this.getComponent(zK),this._layout||(this._layout=this.addComponent(zK));var t=this._layout;this.direction===j$.HORIZONTAL?(t.type=zK.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===j$.VERTICAL&&(t.type=zK.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=zK.ResizeMode.CONTAINER},i._createIndicator=function(){var t=new wA,e=t.addComponent(yG);return e.spriteFrame=this.spriteFrame,e.sizeMode=yG.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},i._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var n=t[i];if(n._uiProps.uiComp){var r=n._uiProps.uiComp;q$.set(r.color),q$.a=127.5,r.color=q$}}if(t[e]._uiProps.uiComp){var a=t[e]._uiProps.uiComp;q$.set(a.color),q$.a=255,a.color=q$}}}},i._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){var n=t[i-1];this.node.removeChild(n),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},q(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}(Jf),k$.Direction=j$,$((L$=G$).prototype,"spriteFrame",[w$,R$],Object.getOwnPropertyDescriptor(L$.prototype,"spriteFrame"),L$.prototype),$(L$.prototype,"direction",[I$,O$],Object.getOwnPropertyDescriptor(L$.prototype,"direction"),L$.prototype),$(L$.prototype,"cellSize",[P$,M$],Object.getOwnPropertyDescriptor(L$.prototype,"cellSize"),L$.prototype),B$=$(L$.prototype,"spacing",[cu,D$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F$=$(L$.prototype,"_spriteFrame",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z$=$(L$.prototype,"_direction",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j$.HORIZONTAL}}),U$=$(L$.prototype,"_cellSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tn(20,20)}}),N$=L$))||N$)||N$)||N$)||N$)),U0=new Xi;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(L0||(L0={})),fe(L0),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(B0||(B0={})),fe(B0),function(t){t.PAGE_TURNING="page-turning"}(F0||(F0={}));var k0=function(e){return t({PageView:e,PageViewComponent:e}),e}((X$=ru("cc.PageView"),Y$=gu(),K$=ou(110),Z$=du(),Q$=Fu(L0),J$=Eu(),$$=Fu(B0),t0=Eu(),e0=Au(),i0=Eu(),n0=Au(),r0=Eu(),a0=Fu(z0),o0=Eu(),s0=Eu(),l0=Fu(uQ),c0=Tu(),h0=Fu(uQ),u0=Tu(),_0=Tu(),f0=Tu(),d0=Tu(),p0=Fu([yP]),m0=Tu(),v0=Fu([yP]),g0=Eu(),X$(y0=Y$(y0=K$(y0=Z$((N0=D0=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"autoPageTurningThreshold",S0,K(e)),J(e,"horizontal",E0,K(e)),J(e,"vertical",A0,K(e)),J(e,"cancelInnerEvents",b0,K(e)),J(e,"scrollEvents",x0,K(e)),J(e,"pageTurningSpeed",C0,K(e)),J(e,"pageEvents",w0,K(e)),J(e,"_sizeMode",R0,K(e)),J(e,"_direction",I0,K(e)),J(e,"_scrollThreshold",O0,K(e)),J(e,"_pageTurningEventTiming",P0,K(e)),J(e,"_indicator",M0,K(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new Ri,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new Ri,e._touchEndPosition=new Ri,e}Y(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(vS.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(vS.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},i.getCurrentPageIndex=function(){return this._curPageIdx},i.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},i.getPages=function(){return this._pages},i.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):T(4301))},i.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void T(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},i.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):E(4300,t.name)}},i.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&this.content&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},i.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},i.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},i.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},i._updatePageView=function(){if(this.content){var t=this.content.getComponent(zK);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,n=0;n<e;++n){var r=this._pages[n].position;this.direction===B0.Horizontal?this._scrollCenterOffsetX[n]=Math.abs(i.x+r.x):this._scrollCenterOffsetY[n]=Math.abs(i.y+r.y)}this.indicator&&this.indicator._refresh()}},i._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===L0.Unified)for(var e=this._pages,i=t.contentSize,n=0,r=e.length;n<r;n++)e[n]._uiProps.uiTransformComp.setContentSize(i)},i._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},i._onTouchBegan=function(e,i){e.touch.getUILocation(U0),Ri.set(this._touchBeganPosition,U0.x,U0.y,0),t.prototype._onTouchBegan.call(this,e,i)},i._onTouchMoved=function(e,i){t.prototype._onTouchMoved.call(this,e,i)},i._onTouchEnded=function(e,i){e.touch.getUILocation(U0),Ri.set(this._touchEndPosition,U0.x,U0.y,0),t.prototype._onTouchEnded.call(this,e,i)},i._onTouchCancelled=function(e,i){e.touch.getUILocation(U0),Ri.set(this._touchEndPosition,U0.x,U0.y,0),t.prototype._onTouchCancelled.call(this,e,i)},i._onMouseWheel=function(){},i._syncScrollDirection=function(){this.horizontal=this.direction===B0.Horizontal,this.vertical=this.direction===B0.Vertical},i._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(zK);if(e){if(this._sizeMode===L0.Free&&this._pages.length>0){var i=this._pages[0]._uiProps.uiTransformComp,n=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===B0.Horizontal?(e.paddingLeft=(t.width-i.width)/2,e.paddingRight=(t.width-n.width)/2):this.direction===B0.Vertical&&(e.paddingTop=(t.height-i.height)/2,e.paddingBottom=(t.height-n.height)/2)}e.updateLayout()}}},i._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},i._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,yP.emitEvents(this.pageEvents,this,F0.PAGE_TURNING),this.node.emit(F0.PAGE_TURNING,this))},i._isQuicklyScrollable=function(t){if(this.direction===B0.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===B0.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},i._moveOffsetValue=function(t){var e=new Ri;if(this._sizeMode===L0.Free)this.direction===B0.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===B0.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var i=this.view;if(!i)return e;this.direction===B0.Horizontal?e.x=t*i.width:this.direction===B0.Vertical&&(e.y=t*i.height)}return e},i._getDragDirection=function(t){return this._direction===B0.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},i._isScrollable=function(t,e,i){if(this._sizeMode===L0.Free){var n=0,r=0;if(this.direction===B0.Horizontal)return n=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(n-r)*this.scrollThreshold;if(this.direction===B0.Vertical)return n=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(n-r)*this.scrollThreshold}else{var a=this.view;if(!a)return;if(this.direction===B0.Horizontal)return Math.abs(t.x)>=a.width*this.scrollThreshold;if(this.direction===B0.Vertical)return Math.abs(t.y)>=a.height*this.scrollThreshold}},i._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();((t=this._clampDelta(t)).x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new Ri;Ri.subtract(e,this._touchBeganPosition,this._touchEndPosition);var i=this._curPageIdx,n=i+this._getDragDirection(e),r=this.pageTurningSpeed*Math.abs(i-n);if(n<this._pages.length){if(this._isScrollable(e,i,n))return void this.scrollToPage(n,r);var a=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(a))return void this.scrollToPage(n,r)}this.scrollToPage(i,r)}},q(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(VQ),D0.SizeMode=L0,D0.Direction=B0,D0.EventType=_J(F0,fQ),$((T0=N0).prototype,"sizeMode",[Q$,J$],Object.getOwnPropertyDescriptor(T0.prototype,"sizeMode"),T0.prototype),$(T0.prototype,"direction",[$$,t0],Object.getOwnPropertyDescriptor(T0.prototype,"direction"),T0.prototype),$(T0.prototype,"scrollThreshold",[wu,e0,i0],Object.getOwnPropertyDescriptor(T0.prototype,"scrollThreshold"),T0.prototype),$(T0.prototype,"pageTurningEventTiming",[wu,n0,r0],Object.getOwnPropertyDescriptor(T0.prototype,"pageTurningEventTiming"),T0.prototype),$(T0.prototype,"indicator",[a0,o0],Object.getOwnPropertyDescriptor(T0.prototype,"indicator"),T0.prototype),S0=$(T0.prototype,"autoPageTurningThreshold",[cu,s0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),$(T0.prototype,"verticalScrollBar",[l0,zu,c0],Object.getOwnPropertyDescriptor(T0.prototype,"verticalScrollBar"),T0.prototype),$(T0.prototype,"horizontalScrollBar",[h0,zu,u0],Object.getOwnPropertyDescriptor(T0.prototype,"horizontalScrollBar"),T0.prototype),E0=$(T0.prototype,"horizontal",[zu,cu,_0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),A0=$(T0.prototype,"vertical",[zu,cu,f0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),b0=$(T0.prototype,"cancelInnerEvents",[zu,cu,d0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),x0=$(T0.prototype,"scrollEvents",[p0,cu,zu,m0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C0=$(T0.prototype,"pageTurningSpeed",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),w0=$(T0.prototype,"pageEvents",[v0,cu,g0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R0=$(T0.prototype,"_sizeMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L0.Unified}}),I0=$(T0.prototype,"_direction",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B0.Horizontal}}),O0=$(T0.prototype,"_scrollThreshold",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),P0=$(T0.prototype,"_pageTurningEventTiming",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),M0=$(T0.prototype,"_indicator",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y0=T0))||y0)||y0)||y0)||y0)),G0=new Ri,H0=new Xi,V0=new Ri,W0=new Ri(1,1,1);function j0(t,e){if(!e._hadAlignOnce){e.alignMode===m$.ONCE&&(e._hadAlignOnce=!0);var i,n=e.target,r=V0,a=W0;n?E$(t,i=n,r,a):i=t.parent;var o=S$(i),s=i instanceof sR||!i.getComponent(UB),l=s?H0:i.getComponent(UB).anchorPoint,c=s;t.getPosition(G0);var h=t._uiProps.uiTransformComp,u=G0.x,_=G0.y,f=h.anchorPoint,d=t.getScale();if(e.alignFlags&v$.HORIZONTAL){var p=0,m=0,v=o.width;c?(p=_b.left.x,m=_b.right.x):m=(p=-l.x*v)+v,p+=e.isAbsoluteLeft?e.left:e.left*v,m-=e.isAbsoluteRight?e.right:e.right*v,n&&(p+=r.x,p*=a.x,m+=r.x,m*=a.x);var g=0,y=f.x,T=d.x;if(T<0&&(y=1-y,T=-T),e.isStretchWidth)g=m-p,0!==T&&(h.width=g/T),u=p+y*g;else if(g=h.width*T,e.isAlignHorizontalCenter){var S=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*v,E=(.5-l.x)*o.width;n&&(S*=a.x,E+=r.x,E*=a.x),u=E+(y-.5)*g+S}else u=e.isAlignLeft?p+y*g:m+(y-1)*g;e._lastSize.width=g}if(e.alignFlags&v$.VERTICAL){var A=0,b=0,x=o.height;c?(b=_b.bottom.y,A=_b.top.y):A=(b=-l.y*x)+x,b+=e.isAbsoluteBottom?e.bottom:e.bottom*x,A-=e.isAbsoluteTop?e.top:e.top*x,n&&(b+=r.y,b*=a.y,A+=r.y,A*=a.y);var C=0,w=f.y,R=d.y;if(R<0&&(w=1-w,R=-R),e.isStretchHeight)C=A-b,0!==R&&(h.height=C/R),_=b+w*C;else if(C=h.height*R,e.isAlignVerticalCenter){var I=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*x,O=(.5-l.y)*o.height;n&&(I*=a.y,O+=r.y,O*=a.y),_=O+(w-.5)*C+I}else _=e.isAlignBottom?b+w*C:A+(w-1)*C;e._lastSize.height=C}t.setPosition(u,_,G0.z),Ri.set(e._lastPos,u,_,G0.z)}}function q0(){var t=BR.getScene();if(t){K0.isAligning=!0,K0._nodesOrderDirty&&(Y0.length=0,function t(e){var i=e.getComponent(W$);if(i&&i.enabled){if(!n.isValid(e,!0))return;Y0.push(i)}for(var r,a=Q(e.children);!(r=a()).done;){var o=r.value;o.active&&t(o)}}(t),K0._nodesOrderDirty=!1);var e=null,i=K0._activeWidgetsIterator;for(i.i=0;i.i<Y0.length;++i.i)(e=Y0[i.i])._dirty&&(j0(e.node,e),e._dirty=!1);K0.isAligning=!1}}var X0,Y0=[],K0=t("widgetManager",n._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new se.MutableForwardIterator(Y0),animationState:null,init:function(){BR.on(LR.EVENT_AFTER_UPDATE,q0),db.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);db.instance.on("canvas-resize",t),window.addEventListener("orientationchange",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=BR.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=wA.isNode(t)&&t.getComponent(W$);e&&e.enabled&&(e.alignMode===m$.ON_WINDOW_RESIZE||e.alignMode===m$.ALWAYS)&&e.setDirty();for(var i,n=Q(t.children);!(i=n()).done;){var r=i.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(t,e){function i(t,e){return Math.abs(t-e)>1e-10?e:t}var n=t.node,r=n.parent;if(r){var a=new Ri,o=new Ri(1,1,1);if(t.target&&E$(n,r=t.target,a,o),!e)return;var s=r._uiProps&&r._uiProps.uiTransformComp,l=s?s.anchorPoint:H0,c=n._uiProps.uiTransformComp,h=S$(r),u=c.anchorPoint,_=n.getPosition(),f=v$,d=n.getScale(),p=0;if(e&f.LEFT){var m=-l.x*h.width;m+=a.x,m*=o.x,p=_.x-u.x*c.width*d.x-m,t.isAbsoluteLeft||(p/=h.width),p/=o.x,t.left=i(t.left,p)}if(e&f.RIGHT){var v=(1-l.x)*h.width;v+=a.x,p=(v*=o.x)-(_.x+(1-u.x)*c.width*d.x),t.isAbsoluteRight||(p/=h.width),p/=o.x,t.right=i(t.right,p)}if(e&f.TOP){var g=(1-l.y)*h.height;g+=a.y,p=(g*=o.y)-(_.y+(1-u.y)*c.height*d.y),t.isAbsoluteTop||(p/=h.height),p/=o.y,t.top=i(t.top,p)}if(e&f.BOT){var y=-l.y*h.height;y+=a.y,y*=o.y,p=_.y-u.y*c.height*d.y-y,t.isAbsoluteBottom||(p/=h.height),p/=o.y,t.bottom=i(t.bottom,p)}}},updateAlignment:function t(e){var i=e.parent;i&&wA.isNode(i)&&t(i);var n=e.getComponent(W$);n&&i&&j0(e,n)},AlignMode:m$,AlignFlags:v$});BR.on(LR.EVENT_INIT,(function(){K0.init()}));var Z0,Q0,J0,$0,t1,e1,i1,n1,r1,a1,o1,s1,l1,c1,h1,u1,_1,f1,d1,p1,m1=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}(ru("cc.SafeArea")(X0=gu()(X0=ou(110)(X0=fu(X0=du()(X0=au(W$)(X0=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.onEnable=function(){this.updateArea(),gb.on("canvas-resize",this.updateArea,this)},i.onDisable=function(){gb.off("canvas-resize",this.updateArea,this)},i.updateArea=function(){var t=this.node.getComponent(W$),e=this.node.getComponent(UB);if(t&&e){t.updateAlignment();var i=this.node.position.clone(),r=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var a=n.winSize.width,o=n.winSize.height,s=yv.getSafeAreaRect();t.top=o-s.y-s.height,t.bottom=s.y,t.left=s.x,t.right=a-s.x-s.width,t.updateAlignment();var l=this.node.position.clone(),c=r.x-(l.x-i.x)/e.width,h=r.y-(l.y-i.y)/e.height;e.setAnchorPoint(c,h),K0.add(t)}},e}(Jf))||X0)||X0)||X0)||X0)||X0)||X0),v1=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((Z0=ru("cc.UICoordinateTracker"),Q0=gu(),J0=du(),$0=ou(110),t1=Fu(wA),e1=Eu(),i1=Fu(zP),n1=Eu(),r1=Eu(),a1=Eu(),o1=Fu([yP]),s1=Eu(),Z0(l1=Q0(l1=J0(l1=$0(($((c1=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"syncEvents",h1,K(e)),J(e,"_target",u1,K(e)),J(e,"_camera",_1,K(e)),J(e,"_useScale",f1,K(e)),J(e,"_distance",d1,K(e)),e._transformPos=new Ri,e._viewPos=new Ri,e._canMove=!0,e._lastWPos=new Ri,e._lastCameraPos=new Ri,e}Y(e,t);var i=e.prototype;return i.onEnable=function(){this._checkCanMove()},i.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&Ri.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var i=this._distance/Math.abs(this._viewPos.z);yP.emitEvents(this.syncEvents,this._transformPos,i)}},i._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}(Jf)).prototype,"target",[t1,e1],Object.getOwnPropertyDescriptor(c1.prototype,"target"),c1.prototype),$(c1.prototype,"camera",[i1,n1],Object.getOwnPropertyDescriptor(c1.prototype,"camera"),c1.prototype),$(c1.prototype,"useScale",[r1],Object.getOwnPropertyDescriptor(c1.prototype,"useScale"),c1.prototype),$(c1.prototype,"distance",[a1],Object.getOwnPropertyDescriptor(c1.prototype,"distance"),c1.prototype),h1=$(c1.prototype,"syncEvents",[o1,cu,s1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u1=$(c1.prototype,"_target",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_1=$(c1.prototype,"_camera",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f1=$(c1.prototype,"_useScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),d1=$(c1.prototype,"_distance",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),l1=c1))||l1)||l1)||l1)||l1)),g1=[vS.TOUCH_START,vS.TOUCH_END,vS.TOUCH_MOVE,vS.MOUSE_DOWN,vS.MOUSE_MOVE,vS.MOUSE_UP,vS.MOUSE_ENTER,vS.MOUSE_LEAVE,vS.MOUSE_WHEEL];function y1(t){t.propagationStopped=!0}var T1,S1,E1,A1,b1,x1,C1,w1,R1,I1,O1,P1,M1=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(ru("cc.BlockInputEvents")(p1=gu()(p1=du()(p1=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.onEnable=function(){for(var t=0;t<g1.length;t++)this.node.on(g1[t],y1,this)},i.onDisable=function(){for(var t=0;t<g1.length;t++)this.node.off(g1[t],y1,this)},e}(Jf))||p1)||p1)||p1),D1=t("SubContextView",(T1=ru("cc.SubContextView"),S1=gu(),E1=ou(110),A1=au(UB),b1=du(),x1=Eu(),C1=Eu(),T1(w1=S1(w1=E1(w1=A1(w1=b1(($((R1=function(t){function e(){var e;return J(e=t.call(this)||this,"_fps",I1,K(e)),e._sprite=void 0,e._imageAsset=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,J(e,"_designResolutionSize",O1,K(e)),e._content=new cR("content"),e._sprite=null,e._imageAsset=new V_,e._openDataContext=null,e._updatedTime=performance.now(),e}Y(e,t),q(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]);var i=e.prototype;return i.onLoad=function(){window.__globalAdapter&&__globalAdapter.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=__globalAdapter.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView()):this.enabled=!1},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._unregisterNodeEvent()},i._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas;t.width=this._designResolutionSize.width,t.height=this._designResolutionSize.height}},i._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),e._texture.create(t.width,t.height),this._sprite=this._content.getComponent(yG),this._sprite||(this._sprite=this._content.addComponent(yG)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._imageAsset._texture;else{var i=new vL;i.texture=this._imageAsset._texture,this._sprite.spriteFrame=i}this._content.parent=this.node}},i._updateSubContextView=function(){if(this._openDataContext&&__globalAdapter&&__globalAdapter.getSystemInfoSync){var t=this.node.getComponent(UB),e=this._content.getComponent(UB),i=t.width/e.width,n=t.height/e.height,r=i>n?n:i;e.width*=r,e.height*=r;var a=__globalAdapter.getSystemInfoSync(),o=e.getBoundingBoxToWorld(),s=gb.getVisibleSize(),l=a.screenWidth*(o.x/s.width),c=a.screenHeight*(o.y/s.height),h=a.screenWidth*(o.width/s.width),u=a.screenHeight*(o.height/s.height);this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:l,y:c,width:h,height:u})}},i._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._imageAsset._texture.create(e.width,e.height),this._imageAsset._texture.uploadData(e)}},i._registerNodeEvent=function(){this.node.on(wA.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(wA.EventType.SIZE_CHANGED,this._updateSubContextView,this)},i._unregisterNodeEvent=function(){this.node.off(wA.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(wA.EventType.SIZE_CHANGED,this._updateSubContextView,this)},i.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},e}(Jf)).prototype,"designResolutionSize",[x1],Object.getOwnPropertyDescriptor(R1.prototype,"designResolutionSize"),R1.prototype),$(R1.prototype,"fps",[C1],Object.getOwnPropertyDescriptor(R1.prototype,"fps"),R1.prototype),I1=$(R1.prototype,"_fps",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),O1=$(R1.prototype,"_designResolutionSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tn(640,960)}}),w1=R1))||w1)||w1)||w1)||w1)||w1));n.SubContextView=D1;var N1,L1=t("UIReorderComponent",ru("cc.UIReorderComponent")(P1=function(){E(1408,"UIReorderComponent")})||P1);n.UIReorderComponent=L1,n.ButtonComponent=Wq,le.setClassAlias(Wq,"cc.ButtonComponent"),n.EditBoxComponent=oK,le.setClassAlias(oK,"cc.EditBoxComponent"),n.LayoutComponent=zK,le.setClassAlias(zK,"cc.LayoutComponent"),n.ProgressBarComponent=hZ,le.setClassAlias(hZ,"cc.ProgressBarComponent"),n.ScrollViewComponent=VQ,le.setClassAlias(VQ,"cc.ScrollViewComponent"),n.ScrollBarComponent=uQ,le.setClassAlias(uQ,"cc.ScrollBarComponent"),n.SliderComponent=uJ,le.setClassAlias(uJ,"cc.SliderComponent"),n.ToggleComponent=g$,le.setClassAlias(g$,"cc.ToggleComponent"),n.ToggleContainerComponent=y$,le.setClassAlias(y$,"cc.ToggleContainerComponent"),n.WidgetComponent=W$,le.setClassAlias(W$,"cc.WidgetComponent"),n.PageViewComponent=k0,le.setClassAlias(k0,"cc.PageViewComponent"),n.PageViewIndicatorComponent=z0,le.setClassAlias(z0,"cc.PageViewIndicatorComponent"),n.SafeAreaComponent=m1,le.setClassAlias(m1,"cc.SafeAreaComponent"),le.setClassAlias(v1,"cc.UICoordinateTrackerComponent"),n.BlockInputEventsComponent=M1,le.setClassAlias(M1,"cc.BlockInputEventsComponent"),function(t){t[t.positions=za.ATTR_POSITION]="positions",t[t.normals=za.ATTR_NORMAL]="normals",t[t.uvs=za.ATTR_TEX_COORD]="uvs",t[t.colors=za.ATTR_COLOR]="colors"}(N1||(N1={}));var B1,F1,z1,U1,k1,G1,H1=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var i=t-e;this._arrayBufferOrPaddings.push(i),this._length+=i}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(i){"number"==typeof i?e+=i:(t.set(new Uint8Array(i),e),e+=i.byteLength)})),t.buffer},t}(),V1=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var i=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(i).fill(null);for(var n=0;n<i;++n){var r=this._mesh.struct.morph.subMeshMorphs[n];r&&(r.targets.length>_h.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[n]=new j1(this._mesh,n,this._mesh.struct.morph,e):this._subMeshRenderings[n]=new W1(this._mesh,n,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,i=new Array(e),n=0;n<e;++n){var r,a;i[n]=null!==(r=null===(a=this._subMeshRenderings[n])||void 0===a?void 0:a.createInstance())&&void 0!==r?r:null}return{setWeights:function(t,e){var n;null===(n=i[t])||void 0===n||n.setWeights(e)},requiredPatches:function(e){t._mesh.struct.morph;var n=t._mesh.struct.morph.subMeshMorphs[e],r=i[e];if(null!==r){var a=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:n.targets.length}];return n.attributes.includes(za.ATTR_POSITION)&&a.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),n.attributes.includes(za.ATTR_NORMAL)&&a.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),n.attributes.includes(za.ATTR_TANGENT)&&a.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),a.push.apply(a,r.requiredPatches()),a}},adaptPipelineState:function(t,e){var n;null===(n=i[t])||void 0===n||n.adaptPipelineState(e)},destroy:function(){for(var t,e=Q(i);!(t=e()).done;){var n=t.value;null==n||n.destroy()}}}},t}(),W1=function(){function t(t,e,i,n){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=n;var r=i.subMeshMorphs[e];this._subMeshMorph=r,K1(t,e,n);var a=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=a;var o=r.targets.length,s=Y1(n,a*o);this._textureInfo={width:s.width,height:s.height},this._attributes=r.attributes.map((function(e,i){var n=s.create(),o=n.valueView;return r.targets.forEach((function(e,n){for(var r=e.displacements[i],s=new Float32Array(t.data.buffer,t.data.byteOffset+r.offset,r.count),l=a*n*4,c=0;c<a;++c)o[l+4*c+0]=s[3*c+0],o[l+4*c+1]=s[3*c+1],o[l+4*c+2]=s[3*c+2]})),n.updatePixels(),{name:e,morphTexture:n}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=Q(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new X1(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(i){for(var n,r=Q(t._attributes);!(n=r()).done;){var a=n.value,o=void 0;switch(a.name){case za.ATTR_POSITION:o=mh;break;case za.ATTR_NORMAL:o=yh;break;case za.ATTR_TANGENT:o=Eh;break;default:f("Unexpected attribute!")}void 0!==o&&(i.bindSampler(o,a.morphTexture.sampler),i.bindTexture(o,a.morphTexture.texture))}i.bindBuffer(_h.BINDING,e.buffer),i.update()},destroy:function(){}}},t}(),j1=function(){function t(t,e,i,n){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=n;var r=i.subMeshMorphs[e];K1(t,e,n),this._attributes=r.attributes.map((function(e,i){return{name:e,targets:r.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[i].offset,e.displacements[i].count)}}))}}))}return t.prototype.createInstance=function(){return new q1(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},q(t,[{key:"data",get:function(){return this._attributes}}]),t}(),q1=function(){function t(t,e,i){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new X1(i,0);var n=Y1(i,e);this._morphUniforms.setMorphTextureInfo(n.width,n.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=n.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],n=i.morphTexture.valueView,r=this._owner.data[e];t.length,r.targets.length;for(var a=0;a<r.targets.length;++a){var o=r.targets[a].displacements,s=t[a],l=o.length/3;if(0===a)for(var c=0;c<l;++c)n[4*c+0]=o[3*c+0]*s,n[4*c+1]=o[3*c+1]*s,n[4*c+2]=o[3*c+2]*s;else if(0!==s)for(var h=0;h<l;++h)n[4*h+0]+=o[3*h+0]*s,n[4*h+1]+=o[3*h+1]*s,n[4*h+2]+=o[3*h+2]*s}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,i=Q(this._attributes);!(e=i()).done;){var n=e.value,r=void 0;switch(n.attributeName){case za.ATTR_POSITION:r=mh;break;case za.ATTR_NORMAL:r=yh;break;case za.ATTR_TANGENT:r=Eh;break;default:f("Unexpected attribute!")}void 0!==r&&(t.bindSampler(r,n.morphTexture.sampler),t.bindTexture(r,n.morphTexture.texture))}t.bindBuffer(_h.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),X1=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(_h.SIZE)),this._remoteBuffer=t.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,_h.SIZE,_h.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){t.length,this._targetCount;for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(_h.OFFSET_OF_WEIGHTS+4*e,t[e],n.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(_h.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,n.sys.isLittleEndian),this._localBuffer.setFloat32(_h.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,n.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(_h.OFFSET_OF_VERTICES_COUNT,t,n.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},q(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Y1(t,e){var i,n,r,a;t.hasFeature(So.TEXTURE_FLOAT)?(i=e,r=16,n=yd.PixelFormat.RGBA32F,a=Float32Array):(i=4*e,r=4,n=yd.PixelFormat.RGBA8888,a=Uint8Array);var o=function(t){t<5&&(t=5);var e=nt(at(t)),i=e>>1;return{width:1<<(1&e?i+1:i),height:1<<i}}(i),s=o.width,l=o.height;return{width:s,height:l,create:function(){var e=new ArrayBuffer(s*l*r),i=new Float32Array(e),o=a===Float32Array?i:new a(e),c=new V_({width:s,height:l,_data:o,_compressed:!1,format:n}),h=new yd;h.setFilters(yd.Filter.NEAREST,yd.Filter.NEAREST),h.setMipFilter(yd.Filter.NONE),h.setWrapMode(yd.WrapMode.CLAMP_TO_EDGE,yd.WrapMode.CLAMP_TO_EDGE,yd.WrapMode.CLAMP_TO_EDGE),h.image=c,h.getGFXTexture()||f("Unexpected: failed to create morph texture?");var u=lf.getSampler(t,h.getSamplerHash());return{get texture(){return h.getGFXTexture()},get sampler(){return u},get valueView(){return i},destroy:function(){h.destroy()},updatePixels:function(){h.uploadData(o)}}}}}function K1(t,e,i){t.renderingSubMeshes[e].enableVertexIdChannel(i)}function Z1(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var Q1=new Ri,J1=new Ri,$1=new Uint8Array,t2=ru("cc.Mesh")((G1=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,J(e,"_struct",z1,K(e)),J(e,"_dataLength",U1,K(e)),J(e,"_hash",k1,K(e)),e._data=$1,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e.loaded=!1,e}Y(e,t),q(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this.loaded=!0,this.emit("load")}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=qo(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]);var i=e.prototype;return i.initialize=function(){var t=this;if(!this._initialized){this._initialized=!0,this._data.byteLength!==this._dataLength&&(this._data=new Uint8Array(this._dataLength),n.assetManager.postLoadNative(this));for(var e=this._data.buffer,i=n.director.root.device,r=this._createVertexBuffers(i,e),a=[],o=function(n){var o=t._struct.primitives[n];if(0===o.vertexBundelIndices.length)return"continue";var s=null,l=null;if(o.indexView){var c=o.indexView,h=c.stride,u=c.length;if(4===h&&!i.hasFeature(So.ELEMENT_INDEX_UINT)){var _=t._struct.vertexBundles[o.vertexBundelIndices[0]].view.count;if(_>=65536)return E(10001,_,65536),"continue";h>>=1,u>>=1}s=i.createBuffer(new No(Ga.INDEX,Ha.DEVICE,u,h)),l=new(Z1(c.stride))(e,c.offset,c.count),c.stride!==h&&(l=Z1(h).from(l)),t.loaded?s.update(l):t.once("load",(function(){s.update(l)}))}var f=o.vertexBundelIndices.map((function(t){return r[t]})),d=[];if(o.vertexBundelIndices.length>0)for(var p=o.vertexBundelIndices[0],m=t._struct.vertexBundles[p].attributes,v=0;v<m.length;++v){var g=m[v];d[v]=new Xo(g.name,g.format,g.isInstanced,g.stream,g.isInstanced,g.location)}var y=new xx(f,d,o.primitiveMode,s);y.mesh=t,y.subMeshIdx=n,a.push(y)},s=0;s<this._struct.primitives.length;s++)o(s);this._renderingSubMeshes=a,this._struct.morph&&(this.morphRendering=function(t,e){return new V1(t,e)}(this,i))}},i.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},i.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},i.assign=function(t,e){this.reset({struct:t,data:e})},i.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._dataLength=this.data.byteLength,this._hash=0,this.loaded=!0,this.emit("load")},i.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var i=[],n=t.bindposes,r=0;r<n.length;r++)e.push(new sc(1/0,1/0,1/0,-1/0,-1/0,-1/0)),i.push(!1);for(var a=this._struct.primitives,o=0;o<a.length;o++){var s=this.readAttribute(o,za.ATTR_JOINTS),l=this.readAttribute(o,za.ATTR_WEIGHTS),c=this.readAttribute(o,za.ATTR_POSITION);if(s&&l&&c)for(var h=Math.min(s.length/4,l.length/4,c.length/3),u=0;u<h;u++){Ri.set(Q1,c[3*u+0],c[3*u+1],c[3*u+2]);for(var _=0;_<4;++_){var f=4*u+_,d=s[f];if(!(0===l[f]||d>=n.length)){Ri.transformMat4(J1,Q1,n[d]),i[d]=!0;var p=e[d];Ri.min(p.center,p.center,J1),Ri.max(p.halfExtents,p.halfExtents,J1)}}}}for(var m=0;m<n.length;m++){var v=e[m];i[m]?sc.fromPoints(v,v.center,v.halfExtents):e[m]=null}return e},i.merge=function(t,e,i){if(i&&(!this.loaded||!t.loaded||!this.validateMergingMesh(t)))return!1;var n=new Ri,r=e&&new Li,a=e&&new sc;if(r&&e.getRotation(r),!this._initialized){var o=JSON.parse(JSON.stringify(t._struct)),s=t._data.slice();if(e){o.maxPosition&&o.minPosition&&(Ri.add(a.center,o.maxPosition,o.minPosition),Ri.multiplyScalar(a.center,a.center,.5),Ri.subtract(a.halfExtents,o.maxPosition,o.minPosition),Ri.multiplyScalar(a.halfExtents,a.halfExtents,.5),sc.transform(a,a,e),Ri.add(o.maxPosition,a.center,a.halfExtents),Ri.subtract(o.minPosition,a.center,a.halfExtents));for(var l=0;l<o.vertexBundles.length;l++)for(var c=o.vertexBundles[l],h=0;h<c.attributes.length;h++)if(c.attributes[h].name===za.ATTR_POSITION||c.attributes[h].name===za.ATTR_NORMAL){var u=c.attributes[h].format,_=new DataView(s.buffer,c.view.offset+e2(c.attributes,h)),f=r2(_,u),d=a2(_,u);if(!f||!d)continue;for(var p=c.view.count,m=c.view.stride,v=n2(u),g=0;g<p;g++){var y=g*m,T=y+v,S=T+v;switch(n.set(f(y),f(T),f(S)),c.attributes[h].name){case za.ATTR_POSITION:n.transformMat4(e);break;case za.ATTR_NORMAL:Ri.transformQuat(n,n,r)}d(y,n.x),d(T,n.y),d(S,n.z)}}}return this.reset({struct:o,data:s}),this.initialize(),!0}for(var E,A,b,x,C,w=new H1,R=0,I=0,O=0,P=0,M=0,D=0,N=0,L=0,B=!1,F=new Array(this._struct.vertexBundles.length),z=0;z<this._struct.vertexBundles.length;++z){var U=this._struct.vertexBundles[z],k=t._struct.vertexBundles[z];O=U.view.offset,P=k.view.offset,I=U.view.stride,R=U.view.count+k.view.count,E=new ArrayBuffer(R*I),A=new Uint8Array(E),O+=(b=this._data.subarray(O,O+U.view.length)).length,P+=(x=t._data.subarray(P,P+k.view.length)).length,A.set(b),M=0;for(var G,H=Q(U.attributes);!(G=H()).done;){var V=G.value;N=0,B=!1;for(var W,j=Q(k.attributes);!(W=j()).done;){var q=W.value;if(V.name===q.name&&V.format===q.format){B=!0;break}N+=xo[q.format].size}if(B){L=xo[V.format].size,D=U.view.length+M;for(var X=0;X<k.view.count;++X){if(C=x.subarray(N,N+L),A.set(C,D),(V.name===za.ATTR_POSITION||V.name===za.ATTR_NORMAL)&&e){var Y=new Float32Array(A.buffer,D,3);switch(n.set(Y[0],Y[1],Y[2]),V.name){case za.ATTR_POSITION:n.transformMat4(e);break;case za.ATTR_NORMAL:Ri.transformQuat(n,n,r)}Y[0]=n.x,Y[1]=n.y,Y[2]=n.z}D+=U.view.stride,N+=k.view.stride}}M+=xo[V.format].size}F[z]={attributes:U.attributes,view:{offset:w.getLength(),length:E.byteLength,count:R,stride:I}},w.addBuffer(E)}for(var K,Z,J,$=0,tt=2,et=0,it=new Array(this._struct.primitives.length),nt=0;nt<this._struct.primitives.length;++nt){var rt=this._struct.primitives[nt],at=t._struct.primitives[nt];it[nt]={primitiveMode:rt.primitiveMode,vertexBundelIndices:rt.vertexBundelIndices};for(var ot,st=Q(rt.vertexBundelIndices);!(ot=st()).done;){var lt=ot.value;et=Math.max(et,this._struct.vertexBundles[lt].view.count)}if(rt.indexView&&at.indexView){$=rt.indexView.count,$+=at.indexView.count,O=rt.indexView.offset,P=at.indexView.offset,tt=$<256?1:$<65536?2:4;var ct=new ArrayBuffer($*tt);if(K=2===tt?new Uint16Array(ct):1===tt?new Uint8Array(ct):new Uint32Array(ct),Z=2===rt.indexView.stride?new Uint16Array(this._data.buffer,O,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(this._data.buffer,O,rt.indexView.count):new Uint32Array(this._data.buffer,O,rt.indexView.count),tt===rt.indexView.stride)K.set(Z);else for(var ht=0;ht<rt.indexView.count;++ht)K[ht]=Z[ht];O+=rt.indexView.length,J=2===at.indexView.stride?new Uint16Array(t._data.buffer,P,at.indexView.count):1===at.indexView.stride?new Uint8Array(t._data.buffer,P,at.indexView.count):new Uint32Array(t._data.buffer,P,at.indexView.count);for(var ut=0;ut<at.indexView.count;++ut)K[rt.indexView.count+ut]=et+J[ut];P+=at.indexView.length,it[nt].indexView={offset:w.getLength(),length:ct.byteLength,count:$,stride:tt},w.setNextAlignment(tt),w.addBuffer(ct)}}var _t={vertexBundles:F,primitives:it,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return _t.minPosition&&t._struct.minPosition&&_t.maxPosition&&t._struct.maxPosition&&(e?(Ri.add(a.center,t._struct.maxPosition,t._struct.minPosition),Ri.multiplyScalar(a.center,a.center,.5),Ri.subtract(a.halfExtents,t._struct.maxPosition,t._struct.minPosition),Ri.multiplyScalar(a.halfExtents,a.halfExtents,.5),sc.transform(a,a,e),Ri.add(n,a.center,a.halfExtents),Ri.max(_t.maxPosition,_t.maxPosition,n),Ri.subtract(n,a.center,a.halfExtents),Ri.min(_t.minPosition,_t.minPosition,n)):(Ri.min(_t.minPosition,_t.minPosition,t._struct.minPosition),Ri.max(_t.maxPosition,_t.maxPosition,t._struct.maxPosition))),this.reset({struct:_t,data:new Uint8Array(w.getCombined())}),this.initialize(),!0},i.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var i=this._struct.vertexBundles[e],n=t._struct.vertexBundles[e];if(i.attributes.length!==n.attributes.length)return!1;for(var r=0;r<i.attributes.length;++r)if(i.attributes[r].format!==n.attributes[r].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var a=0;a<this._struct.primitives.length;++a){var o=this._struct.primitives[a],s=t._struct.primitives[a];if(o.vertexBundelIndices.length!==s.vertexBundelIndices.length)return!1;for(var l=0;l<o.vertexBundelIndices.length;++l)if(o.vertexBundelIndices[l]!==s.vertexBundelIndices[l])return!1;if(o.primitiveMode!==s.primitiveMode)return!1;if(o.indexView){if(void 0===s.indexView)return!1}else if(s.indexView)return!1}return!0},i.readAttribute=function(t,e){var i=this,n=null;return this._accessAttribute(t,e,(function(t,e){var r=t.view.count,a=t.attributes[e].format,o=Oo(xo[a]);if(0!==r){var s=new DataView(i._data.buffer,t.view.offset+e2(t.attributes,e)),l=xo[a],c=r2(s,a);if(o&&c){for(var h=l.count,u=new o(r*h),_=t.view.stride,f=0;f<r;++f)for(var d=0;d<h;++d)u[h*f+d]=c(_*f+u.BYTES_PER_ELEMENT*d);n=u}}})),n},i.copyAttribute=function(t,e,i,n,r){var a=this,o=!1;return this._accessAttribute(t,e,(function(t,e){var s=t.view.count;if(0!==s){var l=t.attributes[e].format,c=new DataView(a._data.buffer,t.view.offset+e2(t.attributes,e)),h=new DataView(i,r),u=xo[l],_=r2(c,l),f=a2(h,l);if(_&&f){for(var d=u.count,p=t.view.stride,m=n2(l),v=n,g=m,y=0;y<s;++y)for(var T=0;T<d;++T)f(v*y+g*T,_(p*y+m*T));o=!0}}else o=!0})),o},i.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var i=e.indexView.stride;return new(1===i?Uint8Array:2===i?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},i.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var i=this._struct.primitives[t];if(!i.indexView)return!1;for(var n=i.indexView.count,r=1===i.indexView.stride?ka.R8UI:2===i.indexView.stride?ka.R16UI:ka.R32UI,a=r2(new DataView(this._data.buffer),r),o=0;o<n;++o)e[o]=a(i.indexView.offset+xo[r].size*o);return!0},i._accessAttribute=function(t,e,i){if(!(t>=this._struct.primitives.length))for(var n,r=Q(this._struct.primitives[t].vertexBundelIndices);!(n=r()).done;){var a=n.value,o=this._struct.vertexBundles[a],s=o.attributes.findIndex((function(t){return t.name===e}));if(!(s<0)){i(o,s);break}}},i._createVertexBuffers=function(t,e){var i=this;return this._struct.vertexBundles.map((function(n){var r=t.createBuffer(new No(Ga.VERTEX,Ha.DEVICE,n.view.length,n.view.stride)),a=new Uint8Array(e,n.view.offset,n.view.length);return i.loaded?r.update(a):i.once("load",(function(){r.update(a)})),r}))},e}(M_),z1=$((F1=G1).prototype,"_struct",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),U1=$(F1.prototype,"_dataLength",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k1=$(F1.prototype,"_hash",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B1=F1))||B1;function e2(t,e){for(var i=0,n=0;n<e;++n){var r=t[n];i+=xo[r.format].size}return i}n.Mesh=t2;var i2=yv.isLittleEndian;function n2(t){var e=xo[t];return e.size/e.count}function r2(t,e){var i=xo[e],n=i.size/i.count;switch(i.type){case go.UNORM:switch(n){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,i2)};case 4:return function(e){return t.getUint32(e,i2)}}break;case go.SNORM:case go.INT:switch(n){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,i2)};case 4:return function(e){return t.getInt32(e,i2)}}break;case go.UINT:switch(n){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,i2)};case 4:return function(e){return t.getUint32(e,i2)}}break;case go.FLOAT:return function(e){return t.getFloat32(e,i2)}}return null}function a2(t,e){var i=xo[e],n=i.size/i.count;switch(i.type){case go.UNORM:switch(n){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,i2)};case 4:return function(e,i){return t.setUint32(e,i,i2)}}break;case go.SNORM:case go.INT:switch(n){case 1:return function(e,i){return t.setInt8(e,i)};case 2:return function(e,i){return t.setInt16(e,i,i2)};case 4:return function(e,i){return t.setInt32(e,i,i2)}}break;case go.UINT:switch(n){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,i2)};case 4:return function(e,i){return t.setUint32(e,i,i2)}}break;case go.FLOAT:return function(e,i){return t.setFloat32(e,i,i2)}}return null}var o2=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_NORMAL,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RG32F),new Xo(za.ATTR_TANGENT,ka.RGBA32F),new Xo(za.ATTR_COLOR,ka.RGBA32F)],s2=new Ri;function l2(t,e,i){i=i||{};var n,r=[],a=0,o=[],s=0,l=t.positions.slice();if(l.length>0){if(n=null,t.attributes)for(var c,h=Q(t.attributes);!(c=h()).done;){var u=c.value;if(u.name===za.ATTR_POSITION){n=u;break}}n||(n=o2[0]),r.push(n);var _=xo[n.format];s=Math.max(s,Math.floor(l.length/_.count)),o.push({offset:a,data:l,attribute:n}),a+=_.size}if(t.normals&&t.normals.length>0){if(n=null,t.attributes)for(var f,d=Q(t.attributes);!(f=d()).done;){var p=f.value;if(p.name===za.ATTR_NORMAL){n=p;break}}n||(n=o2[1]);var m=xo[n.format];r.push(n),s=Math.max(s,Math.floor(t.normals.length/m.count)),o.push({offset:a,data:t.normals,attribute:n}),a+=m.size}if(t.uvs&&t.uvs.length>0){if(n=null,t.attributes)for(var v,g=Q(t.attributes);!(v=g()).done;){var y=v.value;if(y.name===za.ATTR_TEX_COORD){n=y;break}}n||(n=o2[2]);var T=xo[n.format];r.push(n),s=Math.max(s,Math.floor(t.uvs.length/T.count)),o.push({offset:a,data:t.uvs,attribute:n}),a+=T.size}if(t.tangents&&t.tangents.length>0){if(n=null,t.attributes)for(var S,E=Q(t.attributes);!(S=E()).done;){var A=S.value;if(A.name===za.ATTR_TANGENT){n=A;break}}n||(n=o2[3]);var b=xo[n.format];r.push(n),s=Math.max(s,Math.floor(t.tangents.length/b.count)),o.push({offset:a,data:t.tangents,attribute:n}),a+=b.size}if(t.colors&&t.colors.length>0){if(n=null,t.attributes)for(var x,C=Q(t.attributes);!(x=C()).done;){var w=x.value;if(w.name===za.ATTR_COLOR){n=w;break}}n||(n=o2[4]);var R=xo[n.format];r.push(n),s=Math.max(s,Math.floor(t.colors.length/R.count)),o.push({offset:a,data:t.colors,attribute:n}),a+=R.size}if(t.customAttributes)for(var I,O=Q(t.customAttributes);!(I=O()).done;){var P=I.value,M=xo[P.attr.format];r.push(P.attr),s=Math.max(s,Math.floor(P.values.length/M.count)),o.push({offset:a,data:P.values,attribute:P.attr}),a+=M.size}for(var D=new H1,N=new ArrayBuffer(s*a),L=new DataView(N),B=0,F=o;B<F.length;B++){var z=F[B];fx(L,z.data,z.attribute.format,z.offset,a)}D.setNextAlignment(0);var U={attributes:r,view:{offset:D.getLength(),length:N.byteLength,count:s,stride:a}};D.addBuffer(N);var k=null,G=0;if(t.indices){var H=t.indices;G=H.length,k=new ArrayBuffer(2*G),fx(new DataView(k),H,ka.R16UI)}var V={primitiveMode:t.primitiveMode||ja.TRIANGLE_LIST,vertexBundelIndices:[0]};k&&(D.setNextAlignment(2),V.indexView={offset:D.getLength(),length:k.byteLength,count:G,stride:2},D.addBuffer(k));var W=t.minPos;if(!W&&i.calculateBounds){W=Ri.set(new Ri,1/0,1/0,1/0);for(var j=0;j<s;++j)Ri.set(s2,l[3*j+0],l[3*j+1],l[3*j+2]),Ri.min(W,W,s2)}var q=t.maxPos;if(!q&&i.calculateBounds){q=Ri.set(new Ri,-1/0,-1/0,-1/0);for(var X=0;X<s;++X)Ri.set(s2,l[3*X+0],l[3*X+1],l[3*X+2]),Ri.max(q,q,s2)}var Y={vertexBundles:[U],primitives:[V]};return W&&(Y.minPosition=new Ri(W.x,W.y,W.z)),q&&(Y.maxPosition=new Ri(q.x,q.y,q.z)),e||(e=new t2),e.reset({struct:Y,data:new Uint8Array(D.getCombined())}),e}var c2,h2,u2,_2,f2,d2,p2,m2,v2,g2,y2,T2,S2,E2,A2,b2,x2,C2,w2,R2,I2,O2,P2,M2,D2,N2,L2,B2,F2,z2,U2,k2,G2,H2,V2,W2,j2,q2,X2,Y2,K2,Z2,Q2,J2,$2,t4,e4=Object.freeze({__proto__:null,find:lR,toPPM:function(t,e,i){return"P3 "+e+" "+i+" 255\n"+t.filter((function(t,e){return e%4<3})).toString()+"\n"},readMesh:function(t,e){void 0===e&&(e=0);for(var i,n={positions:[]},r=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),a=t.struct,o=a.primitives[e],s=Q(o.vertexBundelIndices);!(i=s()).done;)for(var l,c=i.value,h=a.vertexBundles[c],u=h.view.offset,_=h.view,f=_.length,d=_.stride,p=Q(h.attributes);!(l=p()).done;){var m=l.value,v=N1[m.name];v&&(n[v]=(n[v]||[]).concat(dx(r,m.format,u,f,d))),u+=xo[m.format].size}var g=o.indexView;return n.indices=dx(r,ka["R"+8*g.stride+"UI"],g.offset,g.length),n},createMesh:l2,readBuffer:dx,writeBuffer:fx,mapBuffer:px}),i4=function(e){return t({Billboard:e,BillboardComponent:e}),e}((c2=ru("cc.Billboard"),h2=gu(),u2=du(),_2=Fu(yd),f2=Fu(yd),d2=Eu(),p2=Eu(),m2=Eu(),v2=Eu(),c2(g2=h2(g2=u2(g2=fu((b2=function(t){function e(){var e;return J(e=t.call(this)||this,"_texture",T2,K(e)),J(e,"_height",S2,K(e)),J(e,"_width",E2,K(e)),J(e,"_rotation",A2,K(e)),e._model=null,e._mesh=null,e._material=null,e._uniform=new Qi(1,1,0,0),e}Y(e,t),q(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._material&&this._material.setProperty("mainTexture",t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._material&&(this._uniform.y=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._material&&(this._uniform.x=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"rotation",get:function(){return Math.round(100*fi(this._rotation))/100},set:function(t){this._rotation=_i(t),this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}}]);var i=e.prototype;return i.onLoad=function(){this.createModel()},i.onEnable=function(){this.attachToScene(),this._model.enabled=!0,this.width=this._width,this.height=this._height,this.rotation=this.rotation,this.texture=this.texture},i.onDisable=function(){this.detachFromScene()},i.attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.createModel=function(){this._mesh=l2({primitiveMode:ja.TRIANGLE_LIST,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[Ci.WHITE.r,Ci.WHITE.g,Ci.WHITE.b,Ci.WHITE.a,Ci.WHITE.r,Ci.WHITE.g,Ci.WHITE.b,Ci.WHITE.a,Ci.WHITE.r,Ci.WHITE.g,Ci.WHITE.b,Ci.WHITE.a,Ci.WHITE.r,Ci.WHITE.g,Ci.WHITE.b,Ci.WHITE.a],attributes:[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RG32F),new Xo(za.ATTR_COLOR,ka.RGBA8UI,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this._model=n.director.root.createModel(Up,this.node);t.node=t.transform=this.node,null==this._material&&(this._material=new nm,this._material.copy(Zd.get("default-billboard-material"))),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)},e}(Jf),T2=$((y2=b2).prototype,"_texture",[_2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(y2.prototype,"texture",[f2,d2],Object.getOwnPropertyDescriptor(y2.prototype,"texture"),y2.prototype),S2=$(y2.prototype,"_height",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$(y2.prototype,"height",[p2],Object.getOwnPropertyDescriptor(y2.prototype,"height"),y2.prototype),E2=$(y2.prototype,"_width",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$(y2.prototype,"width",[m2],Object.getOwnPropertyDescriptor(y2.prototype,"width"),y2.prototype),A2=$(y2.prototype,"_rotation",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$(y2.prototype,"rotation",[v2],Object.getOwnPropertyDescriptor(y2.prototype,"rotation"),y2.prototype),g2=y2))||g2)||g2)||g2)||g2)),n4=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RGBA32F),new Xo(za.ATTR_TEX_COORD1,ka.RGB32F),new Xo(za.ATTR_COLOR,ka.RGBA8,!0)],r4=new Ri,a4=new Ri,o4=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=null,e._vertCount=0,e._indexCount=0,e._material=null,e.type=dp.LINE,e._capacity=100,e._iaInfo=new Do([new Po]),e._iaInfoBuffer=e._device.createBuffer(new No(Ga.INDIRECT,Ha.HOST|Ha.DEVICE,Mo,Mo)),e}Y(e,t);var i=e.prototype;return i.setCapacity=function(t){this._capacity=t,this.createBuffer()},i.createBuffer=function(){this._vertSize=0;for(var t,e=Q(n4);!(t=e()).done;){var i=t.value;i.offset=this._vertSize,this._vertSize+=xo[i.format].size}this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.updateMaterial=function(e){this._material=e,t.prototype.setSubModelMaterial.call(this,0,e)},i.createSubMeshData=function(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;var t=this._device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);for(var i=new Uint16Array((this._capacity-1)*this._indexCount),n=0,r=0;r<this._capacity-1;++r){var a=2*r;i[n++]=a,i[n++]=a+1,i[n++]=a+2,i[n++]=a+3,i[n++]=a+2,i[n++]=a+1}var o=this._device.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,(this._capacity-1)*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return o.update(i),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=(this._capacity-1)*this._indexCount,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new xx([t],n4,ja.TRIANGLE_LIST,o,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.addLineVertexData=function(t,e,i){if(t.length>1){var n=0;Ri.subtract(r4,t[1],t[0]),this._vdataF32[n++]=t[0].x,this._vdataF32[n++]=t[0].y,this._vdataF32[n++]=t[0].z,this._vdataF32[n++]=0,this._vdataF32[n++]=e.evaluate(0,1),this._vdataF32[n++]=0,this._vdataF32[n++]=0,this._vdataF32[n++]=r4.x,this._vdataF32[n++]=r4.y,this._vdataF32[n++]=r4.z,this._vdataUint32[n++]=i.evaluate(0,1)._val,this._vdataF32[n++]=t[0].x,this._vdataF32[n++]=t[0].y,this._vdataF32[n++]=t[0].z,this._vdataF32[n++]=1,this._vdataF32[n++]=e.evaluate(0,1),this._vdataF32[n++]=0,this._vdataF32[n++]=1,this._vdataF32[n++]=r4.x,this._vdataF32[n++]=r4.y,this._vdataF32[n++]=r4.z,this._vdataUint32[n++]=i.evaluate(0,1)._val;for(var r=1;r<t.length-1;r++){Ri.subtract(r4,t[r-1],t[r]),Ri.subtract(a4,t[r+1],t[r]),Ri.subtract(a4,a4,r4);var a=r/t.length;this._vdataF32[n++]=t[r].x,this._vdataF32[n++]=t[r].y,this._vdataF32[n++]=t[r].z,this._vdataF32[n++]=0,this._vdataF32[n++]=e.evaluate(a,1),this._vdataF32[n++]=a,this._vdataF32[n++]=0,this._vdataF32[n++]=a4.x,this._vdataF32[n++]=a4.y,this._vdataF32[n++]=a4.z,this._vdataUint32[n++]=i.evaluate(a,1)._val,this._vdataF32[n++]=t[r].x,this._vdataF32[n++]=t[r].y,this._vdataF32[n++]=t[r].z,this._vdataF32[n++]=1,this._vdataF32[n++]=e.evaluate(a,1),this._vdataF32[n++]=a,this._vdataF32[n++]=1,this._vdataF32[n++]=a4.x,this._vdataF32[n++]=a4.y,this._vdataF32[n++]=a4.z,this._vdataUint32[n++]=i.evaluate(a,1)._val}Ri.subtract(r4,t[t.length-1],t[t.length-2]),this._vdataF32[n++]=t[t.length-1].x,this._vdataF32[n++]=t[t.length-1].y,this._vdataF32[n++]=t[t.length-1].z,this._vdataF32[n++]=0,this._vdataF32[n++]=e.evaluate(1,1),this._vdataF32[n++]=1,this._vdataF32[n++]=0,this._vdataF32[n++]=r4.x,this._vdataF32[n++]=r4.y,this._vdataF32[n++]=r4.z,this._vdataUint32[n++]=i.evaluate(1,1)._val,this._vdataF32[n++]=t[t.length-1].x,this._vdataF32[n++]=t[t.length-1].y,this._vdataF32[n++]=t[t.length-1].z,this._vdataF32[n++]=1,this._vdataF32[n++]=e.evaluate(1,1),this._vdataF32[n++]=1,this._vdataF32[n++]=1,this._vdataF32[n++]=r4.x,this._vdataF32[n++]=r4.y,this._vdataF32[n++]=r4.z,this._vdataUint32[n++]=i.evaluate(1,1)._val}this.updateIA(Math.max(0,t.length-1))},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(Up),s4=he({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),l4=t("CurveRange",(x2=ru("cc.CurveRange"),C2=Fu(s4),w2=Fu(Ec),R2=Fu(Ec),I2=Fu(Ec),x2((G2=k2=function(){function t(){J(this,"mode",M2,this),J(this,"curve",D2,this),J(this,"curveMin",N2,this),J(this,"curveMax",L2,this),J(this,"constant",B2,this),J(this,"constantMin",F2,this),J(this,"constantMax",z2,this),J(this,"multiplier",U2,this)}var e=t.prototype;return e.evaluate=function(t,e){switch(this.mode){case s4.Constant:return this.constant;case s4.Curve:return this.curve.evaluate(t)*this.multiplier;case s4.TwoCurves:return ui(this.curveMin.evaluate(t),this.curveMax.evaluate(t),e)*this.multiplier;case s4.TwoConstants:return ui(this.constantMin,this.constantMax,e)}},e.getMax=function(){switch(this.mode){case s4.Constant:return this.constant;case s4.Curve:return this.multiplier;case s4.TwoConstants:return this.constantMax;case s4.TwoCurves:return this.multiplier}return 0},e._onBeforeSerialize=function(){return(!1)[this.mode]},t}(),k2.Mode=s4,M2=$((P2=G2).prototype,"mode",[C2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s4.Constant}}),D2=$(P2.prototype,"curve",[w2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ec}}),N2=$(P2.prototype,"curveMin",[R2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ec}}),L2=$(P2.prototype,"curveMax",[I2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ec}}),B2=$(P2.prototype,"constant",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F2=$(P2.prototype,"constantMin",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),z2=$(P2.prototype,"constantMax",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U2=$(P2.prototype,"multiplier",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O2=P2))||O2));function c4(t,e,i){switch(t.mode){case s4.Constant:return t.constant;case s4.Curve:return t.curve.evaluate(e)*t.multiplier;case s4.TwoCurves:return 0===i?t.curveMin.evaluate(e)*t.multiplier:t.curveMax.evaluate(e)*t.multiplier;case s4.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function h4(t){switch(t.mode){case s4.TwoConstants:case s4.TwoCurves:return 2;default:return 1}}function u4(t,e,i){var n=new V_({width:e,height:i,_data:t,_compressed:!1,format:D_.RGBA32F}),r=new yd;return r.setFilters(L_.NEAREST,L_.NEAREST),r.setMipFilter(L_.NONE),r.setWrapMode(N_.CLAMP_TO_EDGE,N_.CLAMP_TO_EDGE,N_.CLAMP_TO_EDGE),r.image=n,r}function _4(t,e,i,n,r){for(var a=Math.max(h4(e),h4(i),h4(n)),o=new Float32Array(t*a*4),s=[e,i,n],l=1/(t-1),c=0;c<a;c++)for(var h=0;h<3;h++)for(var u=s[h],_=0,f=0,d=0;d<t;d++){var p=c4(u,l*d,c);f=r?p:(_+=p)/(d+1),o[4*d+h]=f}return u4(o,t,a)}var f4,d4,p4,m4,v4,g4,y4,T4,S4,E4,A4,b4,x4,C4,w4,R4,I4,O4,P4,M4,D4,N4,L4,B4,F4,z4,U4,k4,G4,H4,V4,W4,j4,q4,X4,Y4,K4,Z4,Q4,J4,$4,t3,e3,i3,n3,r3,a3,o3,s3,l3,c3,h3,u3,_3,f3=he({Blend:0,Fixed:1}),d3=(ru("cc.ColorKey")((V2=$((H2=function(){J(this,"color",V2,this),J(this,"time",W2,this)}).prototype,"color",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),W2=$(H2.prototype,"time",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H2)),ru("cc.AlphaKey")((q2=$((j2=function(){J(this,"alpha",q2,this),J(this,"time",X2,this)}).prototype,"alpha",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),X2=$(j2.prototype,"time",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j2)),ru("cc.Gradient")((t4=$2=function(){function t(){J(this,"colorKeys",Z2,this),J(this,"alphaKeys",Q2,this),J(this,"mode",J2,this),this._color=void 0,this._color=Ci.WHITE.clone()}var e=t.prototype;return e.setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},e.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,e){return t.time-e.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,e){return t.time-e.time}))},e.evaluate=function(t){return this.getRGB(t),this._color._set_a_unsafe(this.getAlpha(t)),this._color},e.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._set_a_unsafe(e.alpha),this._color},e.getRGB=function(t){if(!(this.colorKeys.length>1))return 1===this.colorKeys.length?(this._color.set(this.colorKeys[0].color),this._color):(this._color.set(Ci.WHITE),this._color);t=Si(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,n=this.colorKeys[e].time;if(t>=i&&t<n){if(this.mode===f3.Fixed)return this.colorKeys[e].color;var r=(t-i)/(n-i);return Ci.lerp(this._color,this.colorKeys[e-1].color,this.colorKeys[e].color,r),this._color}}var a=this.colorKeys.length-1;t<this.colorKeys[0].time?Ci.lerp(this._color,Ci.BLACK,this.colorKeys[0].color,t/this.colorKeys[0].time):t>this.colorKeys[a].time&&Ci.lerp(this._color,this.colorKeys[a].color,Ci.BLACK,(t-this.colorKeys[a].time)/(1-this.colorKeys[a].time))},e.getAlpha=function(t){if(!(this.alphaKeys.length>1))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=Si(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,n=this.alphaKeys[e].time;if(t>=i&&t<n){if(this.mode===f3.Fixed)return this.alphaKeys[e].alpha;var r=(t-i)/(n-i);return ui(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,r)}}var a=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?ui(255,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[a].time?ui(this.alphaKeys[a].alpha,255,(t-this.alphaKeys[a].time)/(1-this.alphaKeys[a].time)):void 0},t}(),$2.Mode=f3,Z2=$((K2=t4).prototype,"colorKeys",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),Q2=$(K2.prototype,"alphaKeys",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),J2=$(K2.prototype,"mode",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return f3.Blend}}),Y2=K2))||Y2),p3=he({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),m3=t("GradientRange",(f4=ru("cc.GradientRange"),d4=Fu(p3),p4=Fu(d3),m4=Fu(d3),v4=Fu(d3),g4=Fu(p3),f4((I4=R4=function(){function t(){J(this,"color",S4,this),J(this,"colorMin",E4,this),J(this,"colorMax",A4,this),J(this,"gradient",b4,this),J(this,"gradientMin",x4,this),J(this,"gradientMax",C4,this),J(this,"_mode",w4,this),this._color=Ci.WHITE.clone()}var e=t.prototype;return e.evaluate=function(t,e){switch(this._mode){case p3.Color:return this.color;case p3.TwoColors:return Ci.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case p3.RandomColor:return this.gradient.randomColor();case p3.Gradient:return this.gradient.evaluate(t);case p3.TwoGradients:return Ci.lerp(this._color,this.gradientMin.evaluate(t),this.gradientMax.evaluate(t),e),this._color;default:return this.color}},e._onBeforeSerialize=function(){return(!1)[this._mode]},q(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),R4.Mode=p3,$((T4=I4).prototype,"mode",[d4],Object.getOwnPropertyDescriptor(T4.prototype,"mode"),T4.prototype),S4=$(T4.prototype,"color",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),E4=$(T4.prototype,"colorMin",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),A4=$(T4.prototype,"colorMax",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),b4=$(T4.prototype,"gradient",[p4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d3}}),x4=$(T4.prototype,"gradientMin",[m4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d3}}),C4=$(T4.prototype,"gradientMax",[v4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d3}}),w4=$(T4.prototype,"_mode",[g4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p3.Color}}),y4=T4))||y4));function v3(t,e,i){switch(t.mode){case p3.Color:return t.color;case p3.TwoColors:return 0===i?t.colorMin:t.colorMax;case p3.RandomColor:return t.gradient.randomColor();case p3.Gradient:return t.gradient.evaluate(e);case p3.TwoGradients:return 0===i?t.gradientMin.evaluate(e):t.gradientMax.evaluate(e);default:return t.color}}var g3,y3,T3,S3,E3,A3,b3,x3,C3,w3,R3,I3,O3,P3,M3,D3,N3,L3,B3,F3,z3,U3,k3,G3,H3,V3,W3,j3,q3,X3,Y3,K3,Z3,Q3,J3={parent:null,owner:null,subModelIdx:0},$3={CC_USE_WORLD_SPACE:!1},t5=function(e){return t({Line:e,LineComponent:e}),e}((O4=ru("cc.Line"),P4=gu(),M4=du(),D4=Fu(yd),N4=Fu(yd),L4=Ru(),B4=Eu(),F4=Ru(),z4=Eu(),U4=Fu([Ri]),k4=Fu([Ri]),G4=Ru(),H4=Eu(),V4=Fu(l4),W4=Fu(l4),j4=Ru(),q4=Eu(),X4=Fu(Xi),Y4=Ru(),K4=Eu(),Z4=Fu(Xi),Q4=Ru(),J4=Eu(),$4=Fu(m3),t3=Fu(m3),e3=Ru(),i3=Eu(),O4(n3=P4(n3=M4(n3=fu((_3=function(t){function e(){var e;return J(e=t.call(this)||this,"_texture",a3,K(e)),e._material=null,e._materialInstance=null,J(e,"_worldSpace",o3,K(e)),J(e,"_positions",s3,K(e)),J(e,"_width",l3,K(e)),J(e,"_tile",c3,K(e)),J(e,"_offset",h3,K(e)),J(e,"_color",u3,K(e)),e._model=null,e._tile_offset=new Qi,e}Y(e,t),q(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._materialInstance&&this._materialInstance.setProperty("mainTexture",t)}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t,this._materialInstance&&($3.CC_USE_WORLD_SPACE=this.worldSpace,this._materialInstance.recompileShaders($3),this._model&&this._model.setSubModelMaterial(0,this._materialInstance))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this._materialInstance&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._materialInstance&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}}]);var i=e.prototype;return i.onLoad=function(){var t=this._model=n.director.root.createModel(o4);t.node=t.transform=this.node,null===this._material&&(this._material=new nm,this._material.copy(Zd.get("default-trail-material")),$3.CC_USE_WORLD_SPACE=this.worldSpace,J3.parent=this._material,J3.subModelIdx=0,this._materialInstance=new cm(J3),this._materialInstance.recompileShaders($3)),t.updateMaterial(this._materialInstance),t.setCapacity(100)},i.onEnable=function(){this._model&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._model.addLineVertexData(this._positions,this._width,this._color))},i.onDisable=function(){this._model&&this._detachFromScene()},i._attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this._detachFromScene(),this._getRenderScene().addModel(this._model))},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e}(Jf),a3=$((r3=_3).prototype,"_texture",[D4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(r3.prototype,"texture",[N4,L4,B4],Object.getOwnPropertyDescriptor(r3.prototype,"texture"),r3.prototype),o3=$(r3.prototype,"_worldSpace",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(r3.prototype,"worldSpace",[F4,z4],Object.getOwnPropertyDescriptor(r3.prototype,"worldSpace"),r3.prototype),s3=$(r3.prototype,"_positions",[U4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$(r3.prototype,"positions",[k4,G4,H4],Object.getOwnPropertyDescriptor(r3.prototype,"positions"),r3.prototype),l3=$(r3.prototype,"_width",[V4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),$(r3.prototype,"width",[W4,j4,q4],Object.getOwnPropertyDescriptor(r3.prototype,"width"),r3.prototype),c3=$(r3.prototype,"_tile",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(1,1)}}),$(r3.prototype,"tile",[X4,Y4,K4],Object.getOwnPropertyDescriptor(r3.prototype,"tile"),r3.prototype),h3=$(r3.prototype,"_offset",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(0,0)}}),$(r3.prototype,"offset",[Z4,Q4,J4],Object.getOwnPropertyDescriptor(r3.prototype,"offset"),r3.prototype),u3=$(r3.prototype,"_color",[$4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m3}}),$(r3.prototype,"color",[t3,e3,i3],Object.getOwnPropertyDescriptor(r3.prototype,"color"),r3.prototype),n3=r3))||n3)||n3)||n3)||n3)),e5=function(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new Ri(0,0,0),this.velocity=new Ri(0,0,0),this.animatedVelocity=new Ri(0,0,0),this.ultimateVelocity=new Ri(0,0,0),this.angularVelocity=new Ri(0,0,0),this.axisOfRotation=new Ri(0,0,0),this.rotation=new Ri(0,0,0),this.startSize=new Ri(0,0,0),this.size=new Ri(0,0,0),this.startColor=Ci.WHITE.clone(),this.color=Ci.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0},i5=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule"],n5=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_trailModule"],r5=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var e=t.prototype;return e.bindTarget=function(t){this.target=t},e.update=function(){},t}(),a5=he({World:0,Local:1,Custom:2}),o5=he({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4}),s5=he({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4}),l5=he({Base:0,Edge:1,Shell:2,Volume:3}),c5=he({Random:0,Loop:1,PingPong:2}),h5=he({Particles:0}),u5=he({Stretch:0}),_5=(g3=ru("cc.ColorOvertimeModule"),y3=Ru(),T3=Fu(m3),S3=Ru(),g3((C3=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_enable",b3,K(e)),J(e,"color",x3,K(e)),e.name="colorModule",e}return Y(e,t),e.prototype.animate=function(t){t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,vi(t.randomSeed+91041)))},q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(r5),b3=$((A3=C3).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(A3.prototype,"enable",[y3],Object.getOwnPropertyDescriptor(A3.prototype,"enable"),A3.prototype),x3=$(A3.prototype,"color",[T3,cu,S3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m3}}),E3=A3))||E3),f5=new Ri(0,0,-1);function d5(t,e,i,n){return e!==t?(t===a5.World||Vi.invert(i,i),Vi.getRotation(n,i),!0):(Li.set(n,0,0,0,1),!1)}function p5(t,e){Xi.set(t,Math.cos(e),Math.sin(e))}function m5(t){var e=pi(-1,1),i=pi(0,2*Math.PI),n=Math.sqrt(1-e*e),r=n*Math.cos(i),a=n*Math.sin(i);Ri.set(t,r,a,e)}function v5(t,e,i){m5(t),Ri.multiplyScalar(t,t,e+(i-e)*di())}function g5(t,e,i,n){p5(t,n),t.z=0,Ri.multiplyScalar(t,t,e+(i-e)*di())}function y5(t){for(var e=0;e<t.length;e++){var i=e+mi(0,t.length-e),n=t[i];t[i]=t[e],t[e]=n}}function T5(){var t=pi(-1,1);return 0===t&&t++,it(t)}var S5,E5,A5,b5,x5,C5,w5,R5,I5,O5,P5,M5,D5,N5,L5,B5,F5,z5,U5,k5,G5,H5,V5,W5,j5,q5,X5,Y5,K5,Z5,Q5,J5,$5,t6,e6,i6,n6,r6,a6,o6,s6,l6,c6,h6,u6,_6,f6,d6,p6,m6,v6,g6,y6,T6,S6,E6,A6,b6,x6,C6,w6=new Ri,R6=(w3=ru("cc.ForceOvertimeModule"),R3=Ru(),I3=Fu(l4),O3=Au(),P3=Ru(),M3=Eu(),D3=Fu(l4),N3=Au(),L3=Ru(),B3=Eu(),F3=Fu(l4),z3=Au(),U3=Ru(),k3=Eu(),G3=Fu(a5),H3=Ru(),V3=Eu(),w3((Q3=function(t){function e(){var e;return J(e=t.call(this)||this,"_enable",q3,K(e)),J(e,"x",X3,K(e)),J(e,"y",Y3,K(e)),J(e,"z",K3,K(e)),J(e,"space",Z3,K(e)),e.randomized=!1,e.rotation=void 0,e.needTransform=void 0,e.name="forceModule",e.rotation=new Li,e.needTransform=!1,e.needUpdate=!0,e}Y(e,t),q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=d5(t,this.space,e,this.rotation)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,n=Ri.set(w6,this.x.evaluate(i,vi(t.randomSeed+212165)),this.y.evaluate(i,vi(t.randomSeed+212165)),this.z.evaluate(i,vi(t.randomSeed+212165)));this.needTransform&&Ri.transformQuat(n,n,this.rotation),Ri.scaleAndAdd(t.velocity,t.velocity,n,e),Ri.copy(t.ultimateVelocity,t.velocity)},e}(r5),q3=$((j3=Q3).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(j3.prototype,"enable",[R3],Object.getOwnPropertyDescriptor(j3.prototype,"enable"),j3.prototype),X3=$(j3.prototype,"x",[I3,cu,O3,P3,M3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Y3=$(j3.prototype,"y",[D3,cu,N3,L3,B3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),K3=$(j3.prototype,"z",[F3,cu,z3,U3,k3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Z3=$(j3.prototype,"space",[G3,cu,H3,V3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a5.Local}}),W3=j3))||W3),I6=new Ri,O6=new Ri,P6=(S5=ru("cc.LimitVelocityOvertimeModule"),E5=Ru(),A5=Fu(l4),b5=Au(),x5=Ru(),C5=Eu(),w5=Fu(l4),R5=Au(),I5=Ru(),O5=Eu(),P5=Fu(l4),M5=Au(),D5=Ru(),N5=Eu(),L5=Fu(l4),B5=Au(),F5=Ru(),z5=Eu(),U5=Ru(),k5=Eu(),G5=Ru(),H5=Eu(),V5=Fu(a5),W5=Ru(),j5=Eu(),S5((i6=function(t){function e(){var e;return J(e=t.call(this)||this,"_enable",Y5,K(e)),J(e,"limitX",K5,K(e)),J(e,"limitY",Z5,K(e)),J(e,"limitZ",Q5,K(e)),J(e,"limit",J5,K(e)),J(e,"dampen",$5,K(e)),J(e,"separateAxes",t6,K(e)),J(e,"space",e6,K(e)),e.drag=null,e.multiplyDragByParticleSize=!1,e.multiplyDragByParticleVelocity=!1,e.name="limitModule",e.rotation=void 0,e.needTransform=void 0,e.rotation=new Li,e.needTransform=!1,e.needUpdate=!0,e}Y(e,t),q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=d5(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=I6;this.separateAxes?(Ri.set(O6,this.limitX.evaluate(e,vi(t.randomSeed+23541)),this.limitY.evaluate(e,vi(t.randomSeed+23541)),this.limitZ.evaluate(e,vi(t.randomSeed+23541))),this.needTransform&&Ri.transformQuat(O6,O6,this.rotation),Ri.set(i,M6(t.ultimateVelocity.x,O6.x,this.dampen),M6(t.ultimateVelocity.y,O6.y,this.dampen),M6(t.ultimateVelocity.z,O6.z,this.dampen))):(Ri.normalize(i,t.ultimateVelocity),Ri.multiplyScalar(i,i,M6(t.ultimateVelocity.length(),this.limit.evaluate(e,vi(t.randomSeed+23541)),this.dampen))),Ri.copy(t.ultimateVelocity,i)},e}(r5),Y5=$((X5=i6).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(X5.prototype,"enable",[E5],Object.getOwnPropertyDescriptor(X5.prototype,"enable"),X5.prototype),K5=$(X5.prototype,"limitX",[A5,cu,b5,x5,C5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Z5=$(X5.prototype,"limitY",[w5,cu,R5,I5,O5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Q5=$(X5.prototype,"limitZ",[P5,cu,M5,D5,N5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),J5=$(X5.prototype,"limit",[L5,cu,B5,F5,z5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),$5=$(X5.prototype,"dampen",[cu,U5,k5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),t6=$(X5.prototype,"separateAxes",[cu,G5,H5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e6=$(X5.prototype,"space",[V5,cu,W5,j5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a5.Local}}),q5=X5))||q5);function M6(t,e,i){var n=Math.sign(t),r=Math.abs(t);return r>e&&(r=ui(r,e,i)),r*n}var D6,N6,L6,B6,F6,z6,U6,k6,G6,H6,V6,W6,j6,q6,X6,Y6,K6,Z6,Q6,J6,$6,t8,e8,i8,n8,r8,a8,o8,s8,l8,c8,h8,u8,_8,f8,d8,p8,m8,v8,g8,y8,T8,S8,E8,A8,b8,x8,C8,w8,R8,I8,O8,P8,M8,D8,N8,L8,B8,F8,z8,U8,k8,G8,H8,V8,W8,j8,q8,X8,Y8,K8,Z8,Q8,J8,$8,t7,e7,i7,n7,r7,a7,o7,s7,l7,c7,h7,u7,_7,f7,d7,p7,m7,v7,g7,y7,T7,S7,E7,A7,b7,x7,C7,w7,R7,I7,O7,P7,M7,D7,N7,L7,B7,F7,z7,U7,k7,G7,H7,V7,W7,j7,q7,X7,Y7,K7,Z7,Q7,J7,$7,t9,e9,i9,n9,r9,a9,o9,s9,l9,c9,h9,u9,_9,f9,d9,p9,m9,v9,g9,y9,T9,S9,E9,A9,b9,x9,C9,w9,R9,I9,O9,P9,M9,D9,N9,L9,B9,F9,z9,U9,k9,G9,H9,V9=(n6=ru("cc.RotationOvertimeModule"),r6=Ru(),a6=Ru(),o6=Eu(),s6=Fu(l4),l6=Au(),c6=Ru(),h6=Eu(),u6=Fu(l4),_6=Au(),f6=Ru(),d6=Eu(),p6=Fu(l4),m6=Au(),v6=Ru(),g6=Eu(),n6((C6=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_enable",S6,K(e)),J(e,"_separateAxes",E6,K(e)),J(e,"x",A6,K(e)),J(e,"y",b6,K(e)),J(e,"z",x6,K(e)),e.name="rotationModule",e}return Y(e,t),e.prototype.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime;if(this._separateAxes){var n=vi(t.randomSeed+125292);t.rotation.x+=this.x.evaluate(i,n)*e,t.rotation.y+=this.y.evaluate(i,n)*e,t.rotation.z+=this.z.evaluate(i,n)*e}else t.rotation.z+=this.z.evaluate(i,vi(t.randomSeed+125292))*e},q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),e}(r5),S6=$((T6=C6).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(T6.prototype,"enable",[r6],Object.getOwnPropertyDescriptor(T6.prototype,"enable"),T6.prototype),E6=$(T6.prototype,"_separateAxes",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(T6.prototype,"separateAxes",[a6,o6],Object.getOwnPropertyDescriptor(T6.prototype,"separateAxes"),T6.prototype),A6=$(T6.prototype,"x",[s6,cu,l6,Ou,c6,h6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),b6=$(T6.prototype,"y",[u6,cu,_6,Ou,f6,d6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),x6=$(T6.prototype,"z",[p6,cu,m6,Ou,v6,g6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),y6=T6))||y6),W9=(D6=ru("cc.SizeOvertimeModule"),N6=Ru(),L6=Ru(),B6=Eu(),F6=Fu(l4),z6=Ru(),U6=Eu(),k6=Fu(l4),G6=Ru(),H6=Eu(),V6=Fu(l4),W6=Ru(),j6=Eu(),q6=Fu(l4),X6=Ru(),Y6=Eu(),D6((n8=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_enable",Q6,K(e)),J(e,"separateAxes",J6,K(e)),J(e,"size",$6,K(e)),J(e,"x",t8,K(e)),J(e,"y",e8,K(e)),J(e,"z",i8,K(e)),e.name="sizeModule",e}return Y(e,t),e.prototype.animate=function(t){if(this.separateAxes){var e=1-t.remainingLifetime/t.startLifetime,i=vi(t.randomSeed+39825);t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)}else Ri.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,vi(t.randomSeed+39825)))},q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(r5),Q6=$((Z6=n8).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(Z6.prototype,"enable",[N6],Object.getOwnPropertyDescriptor(Z6.prototype,"enable"),Z6.prototype),J6=$(Z6.prototype,"separateAxes",[cu,L6,B6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$6=$(Z6.prototype,"size",[F6,cu,z6,U6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),t8=$(Z6.prototype,"x",[k6,cu,G6,H6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),e8=$(Z6.prototype,"y",[V6,cu,W6,j6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),i8=$(Z6.prototype,"z",[q6,cu,X6,Y6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),K6=Z6))||K6),j9=he({Grid:0}),q9=he({WholeSheet:0,SingleRow:1}),X9=(r8=ru("cc.TextureAnimationModule"),a8=hu("numTilesX"),o8=hu("numTilesY"),s8=Ru(),l8=Fu(j9),c8=Fu(j9),h8=Ru(),u8=Eu(),_8=Ru(),f8=Eu(),d8=Ru(),p8=Eu(),m8=Fu(q9),v8=Ru(),g8=Eu(),y8=Fu(l4),T8=Ru(),S8=Eu(),E8=Fu(l4),A8=Ru(),b8=Eu(),x8=Ru(),C8=Eu(),w8=Ru(),R8=Eu(),I8=Ru(),O8=Eu(),r8((q8=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_enable",D8,K(e)),J(e,"_numTilesX",N8,K(e)),J(e,"_numTilesY",L8,K(e)),J(e,"_mode",B8,K(e)),J(e,"animation",F8,K(e)),J(e,"frameOverTime",z8,K(e)),J(e,"startFrame",U8,K(e)),J(e,"cycleCount",k8,K(e)),J(e,"_flipU",G8,K(e)),J(e,"_flipV",H8,K(e)),J(e,"_uvChannelMask",V8,K(e)),J(e,"randomRow",W8,K(e)),J(e,"rowIndex",j8,K(e)),e.name="textureModule",e}Y(e,t);var i=e.prototype;return i.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=this.startFrame.evaluate(e,vi(t.randomSeed+90794))/(this.numTilesX*this.numTilesY);if(this.animation===q9.WholeSheet)t.frameIndex=Si(this.cycleCount*(this.frameOverTime.evaluate(e,vi(t.randomSeed+90794))+i),1);else if(this.animation===q9.SingleRow){var n=1/this.numTilesY;if(this.randomRow){var r=Si(this.cycleCount*(this.frameOverTime.evaluate(e,vi(t.randomSeed+90794))+i),1),a=t.startRow*n,o=a+n;t.frameIndex=ui(a,o,r)}else{var s=this.rowIndex*n,l=s+n;t.frameIndex=ui(s,l,Si(this.cycleCount*(this.frameOverTime.evaluate(e,vi(t.randomSeed+90794))+i),1))}}},q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t!==j9.Grid&&console.error("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){console.error("particle texture animation's uvChannelMask is not supported!")}}]),e}(r5),D8=$((M8=q8).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),N8=$(M8.prototype,"_numTilesX",[a8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L8=$(M8.prototype,"_numTilesY",[o8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$(M8.prototype,"enable",[s8],Object.getOwnPropertyDescriptor(M8.prototype,"enable"),M8.prototype),B8=$(M8.prototype,"_mode",[l8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j9.Grid}}),$(M8.prototype,"mode",[c8,h8,u8],Object.getOwnPropertyDescriptor(M8.prototype,"mode"),M8.prototype),$(M8.prototype,"numTilesX",[_8,f8],Object.getOwnPropertyDescriptor(M8.prototype,"numTilesX"),M8.prototype),$(M8.prototype,"numTilesY",[d8,p8],Object.getOwnPropertyDescriptor(M8.prototype,"numTilesY"),M8.prototype),F8=$(M8.prototype,"animation",[m8,cu,v8,g8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q9.WholeSheet}}),z8=$(M8.prototype,"frameOverTime",[y8,cu,T8,S8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),U8=$(M8.prototype,"startFrame",[E8,cu,A8,b8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),k8=$(M8.prototype,"cycleCount",[cu,x8,C8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),G8=$(M8.prototype,"_flipU",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H8=$(M8.prototype,"_flipV",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),V8=$(M8.prototype,"_uvChannelMask",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),W8=$(M8.prototype,"randomRow",[cu,w8,R8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j8=$(M8.prototype,"rowIndex",[cu,I8,O8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P8=M8))||P8),Y9=new Ri,K9=(X8=ru("cc.VelocityOvertimeModule"),Y8=Ru(),K8=Fu(l4),Z8=Au(),Q8=Ru(),J8=Eu(),$8=Fu(l4),t7=Au(),e7=Ru(),i7=Eu(),n7=Fu(l4),r7=Au(),a7=Ru(),o7=Eu(),s7=Fu(l4),l7=Au(),c7=Ru(),h7=Eu(),u7=Fu(a5),_7=Ru(),f7=Eu(),X8((E7=function(t){function e(){var e;return J(e=t.call(this)||this,"_enable",m7,K(e)),J(e,"x",v7,K(e)),J(e,"y",g7,K(e)),J(e,"z",y7,K(e)),J(e,"speedModifier",T7,K(e)),J(e,"space",S7,K(e)),e.rotation=void 0,e.needTransform=void 0,e.name="velocityModule",e.rotation=new Li,e.speedModifier.constant=1,e.needTransform=!1,e.needUpdate=!0,e}Y(e,t),q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]);var i=e.prototype;return i.update=function(t,e){this.needTransform=d5(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=Ri.set(Y9,this.x.evaluate(e,vi(197866^t.randomSeed)),this.y.evaluate(e,vi(156497^t.randomSeed)),this.z.evaluate(e,vi(984136^t.randomSeed)));this.needTransform&&Ri.transformQuat(i,i,this.rotation),Ri.add(t.animatedVelocity,t.animatedVelocity,i),Ri.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),Ri.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,vi(t.randomSeed+197866)))},e}(r5),m7=$((p7=E7).prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(p7.prototype,"enable",[Y8],Object.getOwnPropertyDescriptor(p7.prototype,"enable"),p7.prototype),v7=$(p7.prototype,"x",[K8,cu,Z8,Q8,J8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),g7=$(p7.prototype,"y",[$8,cu,t7,e7,i7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),y7=$(p7.prototype,"z",[n7,cu,r7,a7,o7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),T7=$(p7.prototype,"speedModifier",[s7,cu,l7,c7,h7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),S7=$(p7.prototype,"space",[u7,cu,_7,f7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a5.Local}}),d7=p7))||d7),Z9=(A7=ru("cc.Burst"),b7=Fu(l4),A7((P7=function(){function t(){J(this,"_time",w7,this),J(this,"_repeatCount",R7,this),J(this,"repeatInterval",I7,this),J(this,"count",O7,this),this._remainingCount=void 0,this._curTime=void 0,this._remainingCount=0,this._curTime=0}q(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}]);var e=t.prototype;return e.update=function(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){var i=Si(t._time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;var n=Si(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<n&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(n-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}},e.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},t}(),w7=$((C7=P7).prototype,"_time",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$(C7.prototype,"time",[yu],Object.getOwnPropertyDescriptor(C7.prototype,"time"),C7.prototype),R7=$(C7.prototype,"_repeatCount",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$(C7.prototype,"repeatCount",[yu],Object.getOwnPropertyDescriptor(C7.prototype,"repeatCount"),C7.prototype),I7=$(C7.prototype,"repeatInterval",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O7=$(C7.prototype,"count",[b7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),x7=C7))||x7),Q9=new Ri(0,0,0),J9=[],$9=new Ri(.5,.5,.5),ttt=(M7=ru("cc.ShapeModule"),D7=Ru(),N7=Eu(),L7=Ru(),B7=Eu(),F7=Ru(),z7=Eu(),U7=Ru(),k7=Eu(),G7=Ru(),H7=Eu(),V7=Ru(),W7=Fu(s5),j7=hu("shapeType"),q7=Ru(),X7=Fu(s5),Y7=Eu(),K7=Fu(l5),Z7=Ru(),Q7=Eu(),J7=Ru(),$7=Eu(),t9=Ru(),e9=Eu(),i9=Ru(),n9=Eu(),r9=Ru(),a9=Eu(),o9=Ru(),s9=Eu(),l9=Ru(),c9=Eu(),h9=Fu(c5),u9=Ru(),_9=Eu(),f9=Ru(),d9=Eu(),p9=Fu(l4),m9=Ru(),v9=Eu(),g9=Ru(),y9=Eu(),T9=Ru(),S9=Eu(),M7(($((A9=function(){function t(){J(this,"_enable",b9,this),J(this,"_shapeType",x9,this),J(this,"emitFrom",C9,this),J(this,"alignToDirection",w9,this),J(this,"randomDirectionAmount",R9,this),J(this,"sphericalDirectionAmount",I9,this),J(this,"randomPositionAmount",O9,this),J(this,"radius",P9,this),J(this,"radiusThickness",M9,this),J(this,"arcMode",D9,this),J(this,"arcSpread",N9,this),J(this,"arcSpeed",L9,this),J(this,"length",B9,this),J(this,"boxThickness",F9,this),J(this,"_position",z9,this),J(this,"_rotation",U9,this),J(this,"_scale",k9,this),J(this,"_arc",G9,this),J(this,"_angle",H9,this),this.mat=void 0,this.quat=void 0,this.particleSystem=void 0,this.lastTime=void 0,this.totalAngle=void 0,this.mat=new Vi,this.quat=new Li,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}q(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}},{key:"arc",get:function(){return fi(this._arc)},set:function(t){this._arc=_i(t)}},{key:"angle",get:function(){return Math.round(100*fi(this._angle))/100},set:function(t){this._angle=_i(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case s5.Box:this.emitFrom===l5.Base&&(this.emitFrom=l5.Volume);break;case s5.Cone:this.emitFrom===l5.Edge&&(this.emitFrom=l5.Base);break;case s5.Sphere:case s5.Hemisphere:this.emitFrom!==l5.Base&&this.emitFrom!==l5.Edge||(this.emitFrom=l5.Volume)}}}]);var e=t.prototype;return e.onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},e.emit=function(t){switch(this.shapeType){case s5.Box:!function(t,e,i,n){switch(t){case l5.Volume:r=i,a=$9,Ri.set(r,pi(-a.x,a.x),pi(-a.y,a.y),pi(-a.z,a.z));break;case l5.Shell:J9.splice(0,J9.length),J9.push(pi(-.5,.5)),J9.push(pi(-.5,.5)),J9.push(.5*T5()),y5(J9),ett(J9,e),Ri.set(i,J9[0],J9[1],J9[2]);break;case l5.Edge:J9.splice(0,J9.length),J9.push(pi(-.5,.5)),J9.push(.5*T5()),J9.push(.5*T5()),y5(J9),ett(J9,e),Ri.set(i,J9[0],J9[1],J9[2]);break;default:console.warn(t+" is not supported for box emitter.")}var r,a;Ri.copy(n,f5)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case s5.Circle:!function(t,e,i,n,r){g5(n,t*(1-e),t,i),Ri.normalize(r,n)}(this.radius,this.radiusThickness,this.generateArcAngle(),t.position,t.velocity);break;case s5.Cone:!function(t,e,i,n,r,a,o,s){switch(t){case l5.Base:g5(o,e*(1-i),e,n),Xi.multiplyScalar(s,o,Math.sin(r)),s.z=-Math.cos(r)*e,Ri.normalize(s,s),o.z=0;break;case l5.Shell:p5(o,n),Xi.multiplyScalar(s,o,Math.sin(r)),s.z=-Math.cos(r),Ri.normalize(s,s),Xi.multiplyScalar(o,o,e),o.z=0;break;case l5.Volume:g5(o,e*(1-i),e,n),Xi.multiplyScalar(s,o,Math.sin(r)),s.z=-Math.cos(r)*e,Ri.normalize(s,s),o.z=0,Ri.add(o,o,Ri.multiplyScalar(Q9,s,a*di()/-s.z));break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case s5.Sphere:!function(t,e,i,n,r){switch(t){case l5.Volume:v5(n,e*(1-i),e),Ri.normalize(r,n);break;case l5.Shell:m5(n),Ri.multiplyScalar(n,n,e),Ri.normalize(r,n);break;default:console.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case s5.Hemisphere:!function(t,e,i,n,r){switch(t){case l5.Volume:v5(n,e*(1-i),e),n.z>0&&(n.z*=-1),Ri.normalize(r,n);break;case l5.Shell:m5(n),Ri.multiplyScalar(n,n,e),n.z>0&&(n.z*=-1),Ri.normalize(r,n);break;default:console.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}if(this.randomPositionAmount>0&&(t.position.x+=pi(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=pi(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=pi(-this.randomPositionAmount,this.randomPositionAmount)),Ri.transformQuat(t.velocity,t.velocity,this.quat),Ri.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){var e=Ri.normalize(Q9,t.position);Ri.lerp(t.velocity,t.velocity,e,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem._time},e.constructMat=function(){Li.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),Vi.fromRTS(this.mat,this.quat,this._position,this._scale)},e.generateArcAngle=function(){if(this.arcMode===c5.Random)return pi(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case c5.Loop:return Si(t,this._arc);case c5.PingPong:return Ei(t,this._arc)}},t}()).prototype,"position",[D7,N7],Object.getOwnPropertyDescriptor(A9.prototype,"position"),A9.prototype),$(A9.prototype,"rotation",[L7,B7],Object.getOwnPropertyDescriptor(A9.prototype,"rotation"),A9.prototype),$(A9.prototype,"scale",[F7,z7],Object.getOwnPropertyDescriptor(A9.prototype,"scale"),A9.prototype),$(A9.prototype,"arc",[U7,k7],Object.getOwnPropertyDescriptor(A9.prototype,"arc"),A9.prototype),$(A9.prototype,"angle",[G7,H7],Object.getOwnPropertyDescriptor(A9.prototype,"angle"),A9.prototype),b9=$(A9.prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(A9.prototype,"enable",[V7],Object.getOwnPropertyDescriptor(A9.prototype,"enable"),A9.prototype),x9=$(A9.prototype,"_shapeType",[W7,j7,q7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s5.Cone}}),$(A9.prototype,"shapeType",[X7,Y7],Object.getOwnPropertyDescriptor(A9.prototype,"shapeType"),A9.prototype),C9=$(A9.prototype,"emitFrom",[K7,cu,Z7,Q7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return l5.Volume}}),w9=$(A9.prototype,"alignToDirection",[cu,J7,$7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),R9=$(A9.prototype,"randomDirectionAmount",[cu,t9,e9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I9=$(A9.prototype,"sphericalDirectionAmount",[cu,i9,n9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O9=$(A9.prototype,"randomPositionAmount",[cu,r9,a9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P9=$(A9.prototype,"radius",[cu,o9,s9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),M9=$(A9.prototype,"radiusThickness",[cu,l9,c9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),D9=$(A9.prototype,"arcMode",[h9,cu,u9,_9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c5.Random}}),N9=$(A9.prototype,"arcSpread",[cu,f9,d9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L9=$(A9.prototype,"arcSpeed",[p9,cu,m9,v9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),B9=$(A9.prototype,"length",[cu,g9,y9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),F9=$(A9.prototype,"boxThickness",[cu,T9,S9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri(0,0,0)}}),z9=$(A9.prototype,"_position",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri(0,0,0)}}),U9=$(A9.prototype,"_rotation",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri(0,0,0)}}),k9=$(A9.prototype,"_scale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ri(1,1,1)}}),G9=$(A9.prototype,"_arc",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i(360)}}),H9=$(A9.prototype,"_angle",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i(25)}}),E9=A9))||E9);function ett(t,e){e.x>0&&(t[0]+=.5*pi(-e.x,e.x),t[0]=ci(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*pi(-e.y,e.y),t[1]=ci(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*pi(-e.z,e.z),t[2]=ci(t[2],-.5,.5))}var itt,ntt,rtt,att,ott,stt,ltt,ctt,htt,utt,_tt,ftt,dtt,ptt,mtt,vtt,gtt,ytt,Ttt,Stt,Ett,Att,btt,xtt,Ctt,wtt,Rtt,Itt,Ott,Ptt,Mtt,Dtt,Ntt,Ltt,Btt,Ftt,ztt,Utt,ktt,Gtt,Htt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}Y(e,t);var i=e.prototype;return i.getMacroPatches=function(t){return this._morphRenderingInstance?this._morphRenderingInstance.requiredPatches(t):void 0},i.initSubModel=function(e,i,n){return t.prototype.initSubModel.call(this,e,i,this._launderMaterial(n))},i.setSubModelMaterial=function(e,i){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(i))},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,i)},i._launderMaterial=function(t){return t},i.setMorphRendering=function(t){this._morphRenderingInstance=t},e}(Up),Vtt=he({OFF:0,ON:1}),Wtt=he({OFF:0,ON:1}),jtt=(itt=ru("cc.ModelLightmapSettings"),ntt=hu("_recieveShadow"),itt((_tt=function(){function t(){J(this,"texture",ott,this),J(this,"uvParam",stt,this),J(this,"_bakeable",ltt,this),J(this,"_castShadow",ctt,this),J(this,"_receiveShadow",htt,this),J(this,"_lightmapSize",utt,this)}return q(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),ott=$((att=_tt).prototype,"texture",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),stt=$(att.prototype,"uvParam",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qi}}),ltt=$(att.prototype,"_bakeable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ctt=$(att.prototype,"_castShadow",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),htt=$(att.prototype,"_receiveShadow",[ntt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),utt=$(att.prototype,"_lightmapSize",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),$(att.prototype,"bakeable",[yu],Object.getOwnPropertyDescriptor(att.prototype,"bakeable"),att.prototype),$(att.prototype,"castShadow",[yu],Object.getOwnPropertyDescriptor(att.prototype,"castShadow"),att.prototype),$(att.prototype,"receiveShadow",[yu],Object.getOwnPropertyDescriptor(att.prototype,"receiveShadow"),att.prototype),$(att.prototype,"lightmapSize",[yu],Object.getOwnPropertyDescriptor(att.prototype,"lightmapSize"),att.prototype),rtt=att))||rtt),qtt=(ftt=ru("cc.MeshRenderer"),dtt=gu(),ptt=ou(100),mtt=du(),vtt=Fu(Vtt),gtt=Eu(),ytt=Fu(Wtt),Ttt=Eu(),Stt=Fu(t2),Ett=Eu(),Att=Tu(),ftt(btt=dtt(btt=ptt(btt=mtt(btt=fu((Mtt=Ptt=function(t){function e(){var e;return J(e=t.call(this)||this,"lightmapSettings",Ctt,K(e)),J(e,"_mesh",wtt,K(e)),J(e,"_shadowCastingMode",Rtt,K(e)),J(e,"_shadowReceivingMode",Itt,K(e)),e._modelType=void 0,e._model=null,e._morphInstance=null,J(e,"_enableMorph",Ott,K(e)),e._modelType=Up,e}Y(e,t),q(e,[{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e=this._mesh;this._mesh=t,this._mesh&&this._mesh.initialize(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]);var i=e.prototype;return i.onLoad=function(){this._mesh&&this._mesh.initialize(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onRestore=function(){this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onEnable=function(){this._model||this._updateModels(),this._attachToScene()},i.onDisable=function(){this._model&&this._detachFromScene()},i.onDestroy=function(){this._model&&(n.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},i.setWeights=function(t,e){this._morphInstance&&this._morphInstance.setWeights(e,t)},i.setInstancedAttribute=function(t,e){if(this.model)for(var i=this.model.instancedAttributes,n=i.attributes,r=i.views,a=0;a<n.length;a++)if(n[a].name===t){r[a].set(e);break}},i._updateLightmap=function(t,e,i,n,r){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=i,this.lightmapSettings.uvParam.z=n,this.lightmapSettings.uvParam.w=r,this._onUpdateLightingmap()},i._updateModels=function(){if(this.enabledInHierarchy&&this._mesh){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap())}},i._createModel=function(){var t=this._morphInstance&&this._modelType===Up?Htt:this._modelType,e=this._model=n.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof Htt&&e.setMorphRendering(this._morphInstance)},i._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=kh.POSITION,this._model.transform.hasChangedFlags|=kh.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var i=0;i<t;++i){var n=this.getRenderMaterial(i);n&&!n.isValid&&(n=null);var r=e[i];r&&this._model.initSubModel(i,r,n||this._getBuiltinMaterial())}this._model.enabled=!0}},i._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},i._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},i._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap())},i._onMeshChanged=function(){},i._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},i._getBuiltinMaterial=function(){return Zd.get("missing-material")},i._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},i._updateCastShadow=function(){this._model&&(this._shadowCastingMode===Vtt.OFF?this._model.castShadow=!1:(this._shadowCastingMode,Vtt.ON,this._shadowCastingMode,this._model.castShadow=!0))},i._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===Wtt.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},i._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var i=0;i<e.passes.length;++i)if(e.passes[i].batchingScheme)return!0}return!1},i._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){var t=this._mesh.struct.morph;this._morphInstance=this._mesh.morphRendering.createInstance();for(var e=this._mesh.struct.primitives.length,i=0;i<e;++i){var n=t.subMeshMorphs[i];if(n){var r=n.weights||t.weights,a=r?r.slice():new Array(n.targets.length).fill(0);this._morphInstance.setWeights(i,a)}}this._model&&this._model instanceof Htt&&this._model.setMorphRendering(this._morphInstance)}},i._syncMorphWeights=function(t){if(this._morphInstance){var e=this._morphInstance[t];e&&e.renderResources&&e.renderResources.setWeights(e.weights)}},e}(YP),Ptt.ShadowCastingMode=Vtt,Ptt.ShadowReceivingMode=Wtt,Ctt=$((xtt=Mtt).prototype,"lightmapSettings",[cu,yu,Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new jtt}}),wtt=$(xtt.prototype,"_mesh",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rtt=$(xtt.prototype,"_shadowCastingMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vtt.OFF}}),Itt=$(xtt.prototype,"_shadowReceivingMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wtt.ON}}),$(xtt.prototype,"shadowCastingMode",[vtt,gtt,Mu],Object.getOwnPropertyDescriptor(xtt.prototype,"shadowCastingMode"),xtt.prototype),$(xtt.prototype,"receiveShadow",[ytt,Ttt,Mu],Object.getOwnPropertyDescriptor(xtt.prototype,"receiveShadow"),xtt.prototype),$(xtt.prototype,"mesh",[Stt,Ett],Object.getOwnPropertyDescriptor(xtt.prototype,"mesh"),xtt.prototype),$(xtt.prototype,"enableMorph",[Att,Mu],Object.getOwnPropertyDescriptor(xtt.prototype,"enableMorph"),xtt.prototype),Ott=$(xtt.prototype,"_enableMorph",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),btt=xtt))||btt)||btt)||btt)||btt)||btt);lt(t2.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),ct(t2.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]);var Xtt,Ytt,Ktt,Ztt,Qtt,Jtt,$tt,tet,eet,iet,net,ret,aet,oet,set,cet,het,uet,_et,fet,det,pet=(Dtt=ru("cc.Skeleton"),Ntt=Fu([Ue]),Ltt=Fu([Vi]),Dtt((Gtt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_joints",ztt,K(e)),J(e,"_bindposes",Utt,K(e)),J(e,"_hash",ktt,K(e)),e._invBindposes=null,e}return Y(e,t),e.prototype.destroy=function(){return n.director.root.dataPoolManager.releaseSkeleton(this),t.prototype.destroy.call(this)},q(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new Vi;Vi.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var i=this._bindposes[e];t+=i.m00.toPrecision(2)+" "+i.m01.toPrecision(2)+" "+i.m02.toPrecision(2)+" "+i.m03.toPrecision(2)+" "+i.m04.toPrecision(2)+" "+i.m05.toPrecision(2)+" "+i.m06.toPrecision(2)+" "+i.m07.toPrecision(2)+" "+i.m08.toPrecision(2)+" "+i.m09.toPrecision(2)+" "+i.m10.toPrecision(2)+" "+i.m11.toPrecision(2)+" "+i.m12.toPrecision(2)+" "+i.m13.toPrecision(2)+" "+i.m14.toPrecision(2)+" "+i.m15.toPrecision(2)+"\n"}this._hash=qo(t,666)}return this._hash}}]),e}(M_),ztt=$((Ftt=Gtt).prototype,"_joints",[Ntt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Utt=$(Ftt.prototype,"_bindposes",[Ltt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ktt=$(Ftt.prototype,"_hash",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Btt=Ftt))||Btt);n.Skeleton=pet,ct(qtt.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),n.ModelComponent=qtt,le.setClassAlias(qtt,"cc.ModelComponent");var met,vet,get,yet,Tet,Eet,Aet,bet,xet,Cet,wet,Ret,Iet,Oet,Pet,Met,Det,Net,Let,Bet,Fet,zet,Uet,ket,Get,Het,Vet,Wet,jet,qet,Xet,Yet,Ket,Zet,Qet,Jet,$et,tit,eit,iit,nit,rit,ait,oit,sit,lit,cit,hit,uit=he({LUMINOUS_POWER:0,LUMINANCE:1}),_it=new Ri,fit=ru("cc.StaticLightSettings")(($tt=function(){function t(){J(this,"_baked",Ktt,this),J(this,"_editorOnly",Ztt,this),J(this,"_bakeable",Qtt,this),J(this,"_castShadow",Jtt,this)}return q(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),Ktt=$((Ytt=$tt).prototype,"_baked",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ztt=$(Ytt.prototype,"_editorOnly",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qtt=$(Ytt.prototype,"_bakeable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jtt=$(Ytt.prototype,"_castShadow",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(Ytt.prototype,"editorOnly",[yu],Object.getOwnPropertyDescriptor(Ytt.prototype,"editorOnly"),Ytt.prototype),$(Ytt.prototype,"bakeable",[yu],Object.getOwnPropertyDescriptor(Ytt.prototype,"bakeable"),Ytt.prototype),$(Ytt.prototype,"castShadow",[yu],Object.getOwnPropertyDescriptor(Ytt.prototype,"castShadow"),Ytt.prototype),Xtt=Ytt))||Xtt,dit=(tet=ru("cc.Light"),eet=Eu(),iet=Eu(),net=Au(),ret=Eu(),aet=Fu(fit),tet((det=fet=function(t){function e(){var e;return J(e=t.call(this)||this,"_color",cet,K(e)),J(e,"_useColorTemperature",het,K(e)),J(e,"_colorTemperature",uet,K(e)),J(e,"_staticSettings",_et,K(e)),e._type=np.UNKNOWN,e._lightType=void 0,e._light=null,e._lightType=sp,e}Y(e,t),q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light&&(_it.x=t.r/255,_it.y=t.g/255,_it.z=t.b/255,this._light.color=_it)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}},{key:"baked",get:function(){return this.staticSettings.baked},set:function(t){this.staticSettings.baked=t,null!==this._light&&(this._light.baked=t)}}]);var i=e.prototype;return i.onLoad=function(){this._createLight()},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._detachFromScene()},i.onDestroy=function(){this._destroyLight()},i._createLight=function(){this._light||(this._light=n.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node,this._light.baked=this.baked},i._destroyLight=function(){this._light&&(n.director.root.destroyLight(this),this._light=null)},i._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case np.DIRECTIONAL:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case np.SPHERE:t.addSphereLight(this._light);break;case np.SPOT:t.addSpotLight(this._light)}}},i._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case np.DIRECTIONAL:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case np.SPHERE:t.removeSphereLight(this._light);break;case np.SPOT:t.removeSpotLight(this._light)}}},e}(Jf),fet.Type=np,fet.PhotometricTerm=uit,cet=$((set=det).prototype,"_color",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.WHITE.clone()}}),het=$(set.prototype,"_useColorTemperature",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uet=$(set.prototype,"_colorTemperature",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6550}}),_et=$(set.prototype,"_staticSettings",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fit}}),$(set.prototype,"color",[eet],Object.getOwnPropertyDescriptor(set.prototype,"color"),set.prototype),$(set.prototype,"useColorTemperature",[iet],Object.getOwnPropertyDescriptor(set.prototype,"useColorTemperature"),set.prototype),$(set.prototype,"colorTemperature",[wu,net,ret],Object.getOwnPropertyDescriptor(set.prototype,"colorTemperature"),set.prototype),$(set.prototype,"staticSettings",[aet],Object.getOwnPropertyDescriptor(set.prototype,"staticSettings"),set.prototype),oet=set))||oet),pit=(met=ru("cc.DirectionalLight"),vet=gu(),get=du(),yet=Iu(),Tet=Eu(),met(Eet=vet(Eet=get(Eet=fu((xet=function(t){function e(){var e;return J(e=t.call(this)||this,"_illuminance",bet,K(e)),e._type=np.DIRECTIONAL,e._light=null,e._lightType=hp,e}return Y(e,t),q(e,[{key:"illuminance",get:function(){return this._illuminance},set:function(t){this._illuminance=t,this._light&&(this._light.illuminance=this._illuminance)}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.illuminance=this._illuminance)},e}(dit),bet=$((Aet=xet).prototype,"_illuminance",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65e3}}),$(Aet.prototype,"illuminance",[yet,Tet],Object.getOwnPropertyDescriptor(Aet.prototype,"illuminance"),Aet.prototype),Eet=Aet))||Eet)||Eet)||Eet)||Eet),mit=(Cet=ru("cc.SphereLight"),wet=gu(),Ret=du(),Iet=Iu(),Oet=Eu(),Pet=Iu(),Met=Eu(),Det=Fu(uit),Net=Eu(),Let=Eu(),Bet=Eu(),Cet(Fet=wet(Fet=Ret(Fet=fu((Vet=function(t){function e(){var e;return J(e=t.call(this)||this,"_size",Uet,K(e)),J(e,"_luminance",ket,K(e)),J(e,"_term",Get,K(e)),J(e,"_range",Het,K(e)),e._type=np.SPHERE,e._light=null,e._lightType=pm,e}return Y(e,t),q(e,[{key:"luminousPower",get:function(){return this._luminance*op(this._size)},set:function(t){this._luminance=t/op(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range)},e}(dit),Uet=$((zet=Vet).prototype,"_size",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),ket=$(zet.prototype,"_luminance",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/op(.15)}}),Get=$(zet.prototype,"_term",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uit.LUMINOUS_POWER}}),Het=$(zet.prototype,"_range",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$(zet.prototype,"luminousPower",[Iet,Oet],Object.getOwnPropertyDescriptor(zet.prototype,"luminousPower"),zet.prototype),$(zet.prototype,"luminance",[Pet,Met],Object.getOwnPropertyDescriptor(zet.prototype,"luminance"),zet.prototype),$(zet.prototype,"term",[Det,Net],Object.getOwnPropertyDescriptor(zet.prototype,"term"),zet.prototype),$(zet.prototype,"size",[Let],Object.getOwnPropertyDescriptor(zet.prototype,"size"),zet.prototype),$(zet.prototype,"range",[Bet],Object.getOwnPropertyDescriptor(zet.prototype,"range"),zet.prototype),Fet=zet))||Fet)||Fet)||Fet)||Fet),vit=(Wet=ru("cc.SpotLight"),jet=gu(),qet=du(),Xet=Iu(),Yet=Eu(),Ket=Iu(),Zet=Eu(),Qet=Fu(uit),Jet=Eu(),$et=Eu(),tit=Eu(),eit=Au(),iit=Eu(),Wet(nit=jet(nit=qet(nit=fu((hit=function(t){function e(){var e;return J(e=t.call(this)||this,"_size",ait,K(e)),J(e,"_luminance",oit,K(e)),J(e,"_term",sit,K(e)),J(e,"_range",lit,K(e)),J(e,"_spotAngle",cit,K(e)),e._type=np.SPOT,e._light=null,e._lightType=Em,e}return Y(e,t),q(e,[{key:"luminousPower",get:function(){return this._luminance*op(this._size)},set:function(t){this._luminance=t/op(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=_i(t))}}]),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle)},e}(dit),ait=$((rit=hit).prototype,"_size",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),oit=$(rit.prototype,"_luminance",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/op(.15)}}),sit=$(rit.prototype,"_term",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uit.LUMINOUS_POWER}}),lit=$(rit.prototype,"_range",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),cit=$(rit.prototype,"_spotAngle",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),$(rit.prototype,"luminousPower",[Xet,Yet],Object.getOwnPropertyDescriptor(rit.prototype,"luminousPower"),rit.prototype),$(rit.prototype,"luminance",[Ket,Zet],Object.getOwnPropertyDescriptor(rit.prototype,"luminance"),rit.prototype),$(rit.prototype,"term",[Qet,Jet],Object.getOwnPropertyDescriptor(rit.prototype,"term"),rit.prototype),$(rit.prototype,"size",[$et],Object.getOwnPropertyDescriptor(rit.prototype,"size"),rit.prototype),$(rit.prototype,"range",[tit],Object.getOwnPropertyDescriptor(rit.prototype,"range"),rit.prototype),$(rit.prototype,"spotAngle",[wu,eit,iit],Object.getOwnPropertyDescriptor(rit.prototype,"spotAngle"),rit.prototype),nit=rit))||nit)||nit)||nit)||nit);n.LightComponent=dit,le.setClassAlias(dit,"cc.LightComponent"),n.DirectionalLightComponent=pit,le.setClassAlias(pit,"cc.DirectionalLightComponent"),n.SphereLightComponent=mit,le.setClassAlias(mit,"cc.SphereLightComponent"),n.SpotLightComponent=vit,le.setClassAlias(vit,"cc.SpotLightComponent");var git=function(t,e,i){t[e+0]=i.m00,t[e+1]=i.m01,t[e+2]=i.m02,t[e+3]=i.m12,t[e+4]=i.m04,t[e+5]=i.m05,t[e+6]=i.m06,t[e+7]=i.m13,t[e+8]=i.m08,t[e+9]=i.m09,t[e+10]=i.m10,t[e+11]=i.m14};function yit(t,e){var i=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*i,t)/12)}new Li,new Li,new Ri,new Li,new Ri;var Tit=Y_([to.POINT,to.POINT,to.NONE,eo.CLAMP,eo.CLAMP,eo.CLAMP]),Sit=new Ri,Eit=new Ri,Ait=new Ri,bit=new Ri,xit=new Vi,Cit=new Vi,wit=new sc,Rit=Number.MAX_SAFE_INTEGER,Iit=function(){function t(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;var e=function(t){return t.hasFeature(So.TEXTURE_FLOAT)?ka.RGBA32F:ka.RGBA8}(this._device);this._formatSize=xo[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new Cm(t),this._pool.initialize({format:e,roundUpFn:yit}),this._customPool=new Cm(t),this._customPool.initialize({format:e,roundUpFn:yit})}q(t,[{key:"pixelsPerJoint",get:function(){return this._pixelsPerJoint}}]);var e=t.prototype;return e.clear=function(){this._pool.destroy(),this._textureBuffers.clear()},e.registerCustomTextureLayouts=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=this._customPool.createChunk(i.textureLength),r=0;r<i.contents.length;r++){var a=i.contents[r],o=a.skeleton;this._chunkIdxMap.set(o,n);for(var s=0;s<a.clips.length;s++){var l=a.clips[s];this._chunkIdxMap.set(o^l,n)}}},e.getDefaultPoseTexture=function(t,e,i){var n=0^t.hash,r=this._textureBuffers.get(n)||null;if(r&&r.bounds.has(e.hash))return r.refCount++,r;var a=t.joints,o=t.bindposes,s=null,l=!1,c=a.length;if(r)r.refCount++;else{var h=12*c,u=this._chunkIdxMap.get(n),_=void 0!==u?this._customPool.alloc(h*Float32Array.BYTES_PER_ELEMENT,u):this._pool.alloc(h*Float32Array.BYTES_PER_ELEMENT);if(!_)return r;r={pixelOffset:_.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:_},s=new Float32Array(h),l=!0}Ri.set(Ait,Rit,Rit,Rit),Ri.set(bit,-Rit,-Rit,-Rit);for(var f=e.getBoneSpaceBounds(t),d=0,p=0;d<c;d++,p+=12){var m=i.getChildByPath(a[d]),v=m?JD(m,i,xit):t.inverseBindposes[d],g=f[d];g&&(sc.transform(wit,g,v),wit.getBoundary(Sit,Eit),Ri.min(Ait,Ait,Sit),Ri.max(bit,bit,Eit)),l&&(m&&Vi.multiply(v,v,o[d]),git(s,p,m?v:Vi.IDENTITY))}var y=[new sc];return r.bounds.set(e.hash,y),sc.fromPoints(y[0],Ait,bit),l&&(this._pool.update(r.handle,s.buffer),this._textureBuffers.set(n,r)),r},e.getSequencePoseTexture=function(t,e,i,n){var r=t.hash^e.hash,a=this._textureBuffers.get(r)||null;if(a&&a.bounds.has(i.hash))return a.refCount++,a;var o=t.joints,s=t.bindposes,l=eD.getOrExtract(e).info.frames,c=null,h=!1,u=o.length;if(a)a.refCount++;else{var _=12*u*l,f=this._chunkIdxMap.get(r),d=void 0!==f?this._customPool.alloc(_*Float32Array.BYTES_PER_ELEMENT,f):this._pool.alloc(_*Float32Array.BYTES_PER_ELEMENT);if(!d)return null;var p=this._createAnimInfos(t,e,n);a={pixelOffset:d.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:d,animInfos:p},c=new Float32Array(_),h=!0}var m=i.getBoneSpaceBounds(t),v=[];a.bounds.set(i.hash,v);for(var g=0;g<l;g++)v.push(new sc(Rit,Rit,Rit,-Rit,-Rit,-Rit));for(var y=0,T=0;y<l;y++){for(var S=v[y],E=0;E<u;E++,T+=12){var A=a.animInfos[E],b=A.curveData,x=A.downstream,C=A.bindposeIdx,w=A.bindposeCorrection,R=void 0,I=!0;b&&x?R=Vi.multiply(xit,b[y],x):b?R=b[y]:x?R=x:(R=t.inverseBindposes[C],I=!1);var O=m[E];if(O){var P=w?Vi.multiply(Cit,R,w):R;sc.transform(wit,O,P),wit.getBoundary(Sit,Eit),Ri.min(S.center,S.center,Sit),Ri.max(S.halfExtents,S.halfExtents,Eit)}h&&(I&&Vi.multiply(xit,R,s[C]),git(c,T,I?xit:Vi.IDENTITY))}sc.fromPoints(S,S.center,S.halfExtents)}return h&&(this._pool.update(a.handle,c.buffer),this._textureBuffers.set(r,a)),a},e.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}},e.releaseSkeleton=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var n=i.value;n.skeletonHash===t.hash&&(n.readyToBeDeleted=!0,n.refCount?this._textureBuffers.delete(n.skeletonHash^n.clipHash):this.releaseHandle(n)),i=e.next()}},e.releaseAnimationClip=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var n=i.value;n.clipHash===t.hash&&(n.readyToBeDeleted=!0,n.refCount?this._textureBuffers.delete(n.skeletonHash^n.clipHash):this.releaseHandle(n)),i=e.next()}},e._createAnimInfos=function(t,e,i){for(var n=[],r=t.joints,a=t.bindposes,o=r.length,s=eD.getOrExtract(e),l=0;l<o;l++){for(var c=r[l],h=s.data[c],u=i.getChildByPath(c),_=void 0,f=void 0;!h;){var d=c.lastIndexOf("/");if(c=c.substring(0,d),h=s.data[c],u?(_||(_=new Vi),Vi.fromRTS(xit,u.rotation,u.position,u.scale),Vi.multiply(_,xit,_),u=u.parent):f=c,d<0)break}var p=l,m=void 0;if(void 0!==f&&h){p=l-1;for(var v=0;v<o;v++)if(r[v]===f){p=v,m=new Vi,Vi.multiply(m,a[v],t.inverseBindposes[l]);break}}n.push({curveData:h&&h.worldMatrix.values,downstream:_,bindposeIdx:p,bindposeCorrection:m})}return n},t}(),Oit=function(){function t(t){this._pool=new Map,this._device=void 0,this._device=t}var e=t.prototype;return e.getData=function(t){void 0===t&&(t="-1");var e=this._pool.get(t);if(e)return e;var i=this._device.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,hh.SIZE,hh.SIZE)),n=new Float32Array([0,0,0,0]);i.update(n);var r={buffer:i,data:n,dirty:!1};return this._pool.set(t,r),r},e.destroy=function(t){var e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))},e.switchClip=function(t){return t.data[0]=0,t.buffer.update(t.data),t.dirty=!1,t},e.clear=function(){for(var t,e=Q(this._pool.values());!(t=e()).done;)t.value.buffer.destroy();this._pool.clear()},t}(),Pit=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new Iit(t),this.jointAnimationInfo=new Oit(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}();n.internal.DataPoolManager=Pit;var Mit=[{name:"CC_USE_SKINNING",value:!0}];function Dit(t,e,i,n){for(var r=0;r<i.length;r++){for(var a=i[r],o=-1,s=0;s<a.length;s++)if(a[s]===n){o=s;break}o>=0&&(e.push(r),t.push(o))}}var Nit,Lit,Bit,Fit,zit,Uit,kit,Git,Hit,Vit,Wit,jit,qit,Xit,Yit,Kit,Zit,Qit,Jit,$it,tnt,ent,int,nnt,rnt,ant,ont,snt,lnt,cnt,hnt,unt,_nt,fnt,dnt,pnt,mnt,vnt,gnt,ynt,Tnt,Snt,Ent,Ant,bnt,xnt=new Ri,Cnt=new Ri,wnt=new Ri,Rnt=new Ri,Int=new Vi,Ont=new sc,Pnt=function(t){function e(){var e;return(e=t.call(this)||this).uploadAnimation=null,e._buffers=[],e._dataArray=[],e._joints=[],e._bufferIndices=null,e.type=dp.SKINNING,e}Y(e,t);var i=e.prototype;return i.destroy=function(){if(this.bindSkeleton(),this._buffers.length){for(var e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers.length=0}t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null);for(var n=0;n<this._joints.length;n++)jD(this._joints[n].target);if(this._bufferIndices=null,this._joints.length=0,t&&e&&i){this.transform=e;var r=i.getBoneSpaceBounds(t),a=i.struct.jointMaps;this._ensureEnoughBuffers(a&&a.length||1),this._bufferIndices=i.jointBufferIndices;for(var o=0;o<t.joints.length;o++){var s=r[o],l=e.getChildByPath(t.joints[o]);if(s&&l){var c=WD(l,e),h=t.bindposes[o],u=[],_=[];a?Dit(u,_,a,o):(u.push(o),_.push(0)),this._joints.push({indices:u,buffers:_,bound:s,target:l,bindpose:h,transform:c})}}}},i.updateTransform=function(t){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._transformUpdated=!0),Ri.set(xnt,1/0,1/0,1/0),Ri.set(Cnt,-1/0,-1/0,-1/0);for(var i=0;i<this._joints.length;i++){var n=this._joints[i],r=n.bound,a=VD(n.transform,t);sc.transform(Ont,r,a),Ont.getBoundary(wnt,Rnt),Ri.min(xnt,xnt,wnt),Ri.max(Cnt,Cnt,Rnt)}var o=this._worldBounds;this._modelBounds&&o&&(sc.fromPoints(this._modelBounds,xnt,Cnt),this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,this._worldBounds),dr.setVec3(this._hWorldBounds,cr.CENTER,o.center),dr.setVec3(this._hWorldBounds,cr.HALF_EXTENSION,o.halfExtents))},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);for(var i=0;i<this._joints.length;i++){var n=this._joints[i],r=n.indices,a=n.buffers,o=n.transform,s=n.bindpose;Vi.multiply(Int,o.world,s);for(var l=0;l<a.length;l++)git(this._dataArray[a[l]],12*r[l],Int)}for(var c=0;c<this._buffers.length;c++)this._buffers[c].update(this._dataArray[c]);return!0},i.initSubModel=function(e,i,n){var r=i.vertexBuffers,a=i.iaInfo;a.vertexBuffers=i.jointMappedBuffers,t.prototype.initSubModel.call(this,e,i,n),a.vertexBuffers=r},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?Mit.concat(i):Mit},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var n=this._buffers[this._bufferIndices[e]];n&&i.bindBuffer(uh.BINDING,n)},i._ensureEnoughBuffers=function(t){for(var e=0;e<t;e++)this._buffers[e]||(this._buffers[e]=this._device.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,uh.SIZE,uh.SIZE))),this._dataArray[e]||(this._dataArray[e]=new Float32Array(uh.COUNT))},e}(Htt),Mnt=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],Dnt=function(t){function e(){var e;(e=t.call(this)||this).uploadedAnim=void 0,e._jointsMedium=void 0,e._skeleton=null,e._mesh=null,e._dataPoolManager=void 0,e._instAnimInfoIdx=-1,e.type=dp.BAKED_SKINNING,e._dataPoolManager=n.director.root.dataPoolManager;var i=new Float32Array(4),r=e._dataPoolManager.jointAnimationInfo.getData();return e._jointsMedium={buffer:null,jointTextureInfo:i,animInfo:r,texture:null,boundsInfo:null},e}Y(e,t);var i=e.prototype;return i.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),this._skeleton=t,this._mesh=i,t&&e&&i){this.transform=e;var n=this._dataPoolManager;this._jointsMedium.animInfo=n.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer(new No(Ga.UNIFORM|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,ch.SIZE,ch.SIZE)))}},i.updateTransform=function(e){if(t.prototype.updateTransform.call(this,e),this.uploadedAnim){var i=this._jointsMedium,n=i.animInfo,r=i.boundsInfo[n.data[0]],a=this._worldBounds;if(a&&r){var o=this.transform;r.transform(o._mat,o._pos,o._rot,o._scale,a),dr.setVec3(this._hWorldBounds,cr.CENTER,a.center),dr.setVec3(this._hWorldBounds,cr.HALF_EXTENSION,a.halfExtents)}}},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);var i=this._jointsMedium.animInfo,n=this._instAnimInfoIdx;return n>=0?this.instancedAttributes.views[n][0]=i.data[0]:i.dirty&&(i.buffer.update(i.data),i.dirty=!1),!0},i.uploadAnimation=function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,i=null;t?(i=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=i&&i.bounds.get(this._mesh.hash),this._modelBounds=null):(i=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._modelBounds=i&&i.bounds.get(this._mesh.hash)[0]),this._applyJointTexture(i)}},i._applyJointTexture=function(t){void 0===t&&(t=null);var e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var i=this._jointsMedium,n=i.buffer,r=i.jointTextureInfo;r[0]=t.handle.texture.width,r[1]=this._skeleton.joints.length,r[2]=t.pixelOffset+.1,r[3]=1/r[0],this.updateInstancedJointTextureInfo(),n&&n.update(r);for(var a=t.handle.texture,o=0;o<this._subModels.length;++o)this._subModels[o].descriptorSet.bindTexture(fh,a)}},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?i.concat(Mnt):Mnt},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var n=this._jointsMedium,r=n.buffer,a=n.texture,o=n.animInfo;if(i.bindBuffer(ch.BINDING,r),i.bindBuffer(hh.BINDING,o.buffer),a){var s=lf.getSampler(this._device,Tit);i.bindTexture(fh,a.handle.texture),i.bindSampler(fh,s)}},i._updateInstancedAttributes=function(e,i){t.prototype._updateInstancedAttributes.call(this,e,i),this._instAnimInfoIdx=this._getInstancedAttributeIndex("a_jointAnimInfo"),this.updateInstancedJointTextureInfo()},i.updateInstancedJointTextureInfo=function(){var t=this._jointsMedium,e=t.jointTextureInfo,i=t.animInfo,n=this._instAnimInfoIdx;if(n>=0){var r=this.instancedAttributes.views[n];r[0]=i.data[0],r[1]=e[1],r[2]=e[2]}},e}(Htt),Nnt=(Nit=ru("cc.SkinnedMeshRenderer"),Lit=gu(),Bit=ou(100),Fit=du(),zit=Fu(pet),Uit=Fu(wA),kit=Fu(pet),Git=Fu(wA),Hit=Eu(),Nit(Vit=Lit(Vit=Bit(Vit=fu(Vit=Fit((Xit=function(t){function e(){var e;return J(e=t.call(this)||this,"_skeleton",jit,K(e)),J(e,"_skinningRoot",qit,K(e)),e._clip=null,e._modelType=Dnt,e}Y(e,t),q(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._updateModelType(),this._update())}},{key:"model",get:function(){return this._model}}]);var i=e.prototype;return i.__preload=function(){this._updateModelType()},i.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},i.setUseBakedAnimation=function(t){void 0===t&&(t=!0);var e=t?Dnt:Pnt;this._modelType!==e&&(this._modelType=e,this._model&&(n.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))},i.setMaterial=function(e,i){t.prototype.setMaterial.call(this,e,i),this._modelType===Pnt&&this.getMaterialInstance(i)},i._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},i._updateModelType=function(){if(this._skinningRoot){var t=this._skinningRoot.getComponent("cc.SkeletalAnimation");t&&this.setUseBakedAnimation(t.useBakedAnimation)}},i._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},e}(qtt),jit=$((Wit=Xit).prototype,"_skeleton",[zit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qit=$(Wit.prototype,"_skinningRoot",[Uit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(Wit.prototype,"skeleton",[kit],Object.getOwnPropertyDescriptor(Wit.prototype,"skeleton"),Wit.prototype),$(Wit.prototype,"skinningRoot",[Git,Hit],Object.getOwnPropertyDescriptor(Wit.prototype,"skinningRoot"),Wit.prototype),Vit=Wit))||Vit)||Vit)||Vit)||Vit)||Vit),Lnt=new Xo(za.ATTR_BATCH_ID,ka.R32F),Bnt=new Xo(za.ATTR_BATCH_UV,ka.RG32F),Fnt=xo[Lnt.format].size+xo[Bnt.format].size,znt=(Yit=ru("cc.SkinnedMeshUnit"),Kit=Fu(t2),Zit=Fu(pet),Qit=Fu(nm),Jit=Fu(Nnt),Yit((snt=function(){function t(){J(this,"mesh",ent,this),J(this,"skeleton",int,this),J(this,"material",nnt,this),J(this,"_localTransform",rnt,this),J(this,"_offset",ant,this),J(this,"_size",ont,this)}return q(t,[{key:"offset",set:function(t){Xi.copy(this._offset,t)},get:function(){return this._offset}},{key:"size",set:function(t){Xi.copy(this._size,t)},get:function(){return this._size}},{key:"copyFrom",set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&JD(t.node,t.skinningRoot,this._localTransform))},get:function(){return null}}]),t}(),ent=$((tnt=snt).prototype,"mesh",[Kit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),int=$(tnt.prototype,"skeleton",[Zit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nnt=$(tnt.prototype,"material",[Qit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rnt=$(tnt.prototype,"_localTransform",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vi}}),ant=$(tnt.prototype,"_offset",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(0,0)}}),ont=$(tnt.prototype,"_size",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xi(1,1)}}),$(tnt.prototype,"offset",[yu],Object.getOwnPropertyDescriptor(tnt.prototype,"offset"),tnt.prototype),$(tnt.prototype,"size",[yu],Object.getOwnPropertyDescriptor(tnt.prototype,"size"),tnt.prototype),$(tnt.prototype,"copyFrom",[Jit],Object.getOwnPropertyDescriptor(tnt.prototype,"copyFrom"),tnt.prototype),$it=tnt))||$it),Unt=new Vi,knt=(new Vi,new Ri),Gnt=(lnt=ru("cc.SkinnedMeshBatchRenderer"),cnt=gu(),hnt=ou(100),unt=du(),_nt=Eu(),fnt=Fu([Ue]),dnt=Eu(),pnt=Fu([znt]),mnt=Eu(),vnt=Tu(),gnt=Tu(),lnt(ynt=cnt(ynt=hnt(ynt=fu(ynt=unt((bnt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"atlasSize",Snt,K(e)),J(e,"batchableTextureNames",Ent,K(e)),J(e,"units",Ant,K(e)),e._textures={},e._batchMaterial=null,e}Y(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},i.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},i._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},i.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},i.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var i=e.effectAsset.techniques[e.technique],n=function(n){var r=i.passes[n];if(!r.properties)return"continue";var a=function(i){if(r.properties[i].type>=Ua.SAMPLER1D){var a=null;t.batchableTextureNames.find((function(t){return t===i}))?((a=t._textures[i])||(a=t.createTexture(i)),t.cookTextures(a,i,n)):t.units.some((function(t){return a=t.material&&t.material.getProperty(i,n)})),a&&e.setProperty(i,a,n)}else{for(var o=[],s=0;s<t.units.length;s++){var l=t.units[s];l.material&&o.push(l.material.getProperty(i.slice(0,-3),n))}e.setProperty(i,o,n)}};for(var o in r.properties)a(o)},r=0;r<i.passes.length;r++)n(r)}else console.warn("incomplete batch material!")},i.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],i=0;i<this.units.length;i++){var n=this.units[i];if(n&&n.skeleton){var r=n.skeleton;Vi.invert(Unt,n._localTransform);for(var a=function(i){var n=r.joints[i];if(t.findIndex((function(t){return t===n}))>=0)return"continue";t.push(n),e.push(Vi.multiply(new Vi,r.bindposes[i]||Vi.IDENTITY,Unt))},o=0;o<r.joints.length;o++)a(o)}}var s=Array.from(Array(t.length).keys()).sort((function(e,i){return t[e]>t[i]?1:t[e]<t[i]?-1:0})),l=new pet;l.joints=t.map((function(t,e,i){return i[s[e]]})),l.bindposes=e.map((function(t,e,i){return i[s[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=l}else console.warn("no skinning root specified!")},i.cookMeshes=function(){for(var t=this,e=!1,i=0;i<this.units.length;i++)if(this.units[i].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new t2;for(var n=0,r=ka.UNKNOWN,a=0,o=ka.UNKNOWN,s=0,l=ka.UNKNOWN,c=0,h=ka.UNKNOWN,u=0,_=ka.UNKNOWN,f=new Array(this.units.length),d=this.units.length,p=0;p<d;p++){var m=this.units[p];m&&m.skeleton&&(f[p]=m.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var v=function(e){var i=t.units[e];if(!i||!i.mesh||!i.mesh.data)return"continue";var d=t._createUnitMesh(e,i.mesh),p=new DataView(d.data.buffer);Vi.inverseTranspose(Unt,i._localTransform);for(var m=i.offset,v=i.size,g=function(t){var g=d.struct.vertexBundles[t];n=g.view.offset,r=ka.UNKNOWN;for(var y=0;y<g.attributes.length;y++){var T=g.attributes[y];if(T.name===za.ATTR_POSITION){r=T.format;break}n+=xo[T.format].size}if(r){for(var S=dx(p,r,n,g.view.length,g.view.stride),E=0;E<S.length;E+=3)Ri.fromArray(knt,S,E),Ri.transformMat4(knt,knt,i._localTransform),Ri.toArray(S,knt,E);fx(p,S,r,n,g.view.stride)}a=g.view.offset,o=ka.UNKNOWN;for(var A=0;A<g.attributes.length;A++){var b=g.attributes[A];if(b.name===za.ATTR_NORMAL){o=b.format;break}a+=xo[b.format].size}if(o){for(var x=dx(p,o,a,g.view.length,g.view.stride),C=0;C<x.length;C+=3)Ri.fromArray(knt,x,C),Ri.transformMat4Normal(knt,knt,Unt),Ri.toArray(x,knt,C);fx(p,x,o,a,g.view.stride)}s=g.view.offset,l=ka.UNKNOWN;for(var w=0;w<g.attributes.length;w++){var R=g.attributes[w];if(R.name===za.ATTR_TANGENT){l=R.format;break}s+=xo[R.format].size}if(l){for(var I=dx(p,l,s,g.view.length,g.view.stride),O=0;O<I.length;O+=3)Ri.fromArray(knt,I,O),Ri.transformMat4Normal(knt,knt,Unt),Ri.toArray(I,knt,O);fx(p,I,l,s,g.view.stride)}c=g.view.offset,h=ka.UNKNOWN;for(var P=0;P<g.attributes.length;P++){var M=g.attributes[P];if(M.name===za.ATTR_BATCH_UV){h=M.format;break}c+=xo[M.format].size}h&&px(p,(function(t,e){var i,n=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*v[n]+m[n]}),h,c,g.view.length,g.view.stride,p);var D=f[e];if(!D)return"continue";u=g.view.offset,_=ka.UNKNOWN;for(var N=0;N<g.attributes.length;N++){var L=g.attributes[N];if(L.name===za.ATTR_JOINTS){_=L.format;break}u+=xo[L.format].size}_&&px(p,(function(t){return D[t]}),_,u,g.view.length,g.view.stride,p)},y=0;y<d.struct.vertexBundles.length;y++)g(y);t._mesh.merge(d)},g=0;g<d;g++)v(g);this._onMeshChanged(this._mesh),this._updateModels()}},i.cookTextures=function(t,e,i){for(var r=[],a=[],o=[],s=[],l=0;l<this.units.length;l++){var c=this.units[l];if(c.material){var h=c.material.getProperty(e,i);if(h&&h.image&&h.image.data){var u=new ns;u.texOffset.x=c.offset.x*this.atlasSize,u.texOffset.y=c.offset.y*this.atlasSize,u.texExtent.width=c.size.x*this.atlasSize,u.texExtent.height=c.size.y*this.atlasSize;var _=h.image.data;ArrayBuffer.isView(_)?(o.push(_),s.push(u)):(r.push(_),a.push(u))}}}var f=t.getGFXTexture(),d=n.director.root.device;o.length>0&&d.copyBuffersToTexture(o,f,s),r.length>0&&d.copyTexImagesToTexture(r,f,a)},i.createTexture=function(t){var e=new yd;return e.setFilters(L_.LINEAR,L_.LINEAR),e.setMipFilter(L_.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:D_.RGBA8888}),e.loaded=!0,this._textures[t]=e,e},i.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:D_.RGBA8888})},i._createUnitMesh=function(t,e){for(var i=JSON.parse(JSON.stringify(e.struct)),r={},a=0;a<e.struct.primitives.length;a++){for(var o=e.struct.primitives[a],s=0,l=ka.UNKNOWN,c=0;c<o.vertexBundelIndices.length;c++){var h=e.struct.vertexBundles[o.vertexBundelIndices[c]];s=h.view.offset,l=ka.UNKNOWN;for(var u=0;u<h.attributes.length;u++){var _=h.attributes[u];if(_.name===za.ATTR_TEX_COORD){l=_.format;break}s+=xo[_.format].size}if(l)break}if(void 0===r[c]){r[c]=[l,s];var f=i.vertexBundles[c];f.attributes.push(Lnt),f.attributes.push(Bnt),f.view.offset=0,f.view.length+=f.view.count*Fnt,f.view.stride+=Fnt}}for(var d=0,p=0;p<i.vertexBundles.length;p++)d+=i.vertexBundles[p].view.length;for(var m=0;m<i.primitives.length;m++){var v=i.primitives[m];v.indexView&&(v.indexView.offset=d,d+=v.indexView.length)}var g=new Uint8Array(d),y=e.data,T=new DataView(g.buffer),S=new DataView(y.buffer),E=n.sys.isLittleEndian;for(var A in r)for(var b=i.vertexBundles[A],x=e.struct.vertexBundles[A],C=r[A],w=dx(S,C[0],C[1],x.view.length,x.view.stride),R=x.view,I=b.view,O=R.stride,P=I.stride,M=R.offset,D=I.offset,N=0;N<I.count;N++){var L=y.subarray(M,M+O);g.set(L,D),T.setFloat32(D+O,t),T.setFloat32(D+O+4,w[2*N],E),T.setFloat32(D+O+8,w[2*N+1],E),D+=P,M+=O}for(var B=0;B<i.primitives.length;B++){var F=e.struct.primitives[B],z=i.primitives[B];if(F.indexView&&z.indexView)for(var U=F.indexView.stride,k=z.indexView.stride,G=F.indexView.offset,H=z.indexView.offset,V=0;V<z.indexView.count;V++){var W=y.subarray(G,G+U);g.set(W,H),H+=k,G+=U}}var j=new t2;return j.reset({struct:i,data:g}),j},q(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(Nnt),Snt=$((Tnt=bnt).prototype,"atlasSize",[cu,_nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),Ent=$(Tnt.prototype,"batchableTextureNames",[fnt,cu,dnt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ant=$(Tnt.prototype,"units",[pnt,cu,mnt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$(Tnt.prototype,"mesh",[zu,vnt],Object.getOwnPropertyDescriptor(Tnt.prototype,"mesh"),Tnt.prototype),$(Tnt.prototype,"skeleton",[zu,gnt],Object.getOwnPropertyDescriptor(Tnt.prototype,"skeleton"),Tnt.prototype),ynt=Tnt))||ynt)||ynt)||ynt)||ynt)||ynt);n.SkinningModelComponent=Nnt,le.setClassAlias(Nnt,"cc.SkinningModelComponent"),n.SkinningModelUnit=znt,le.setClassAlias(znt,"cc.SkinningModelUnit"),n.BatchedSkinningModelComponent=Gnt,le.setClassAlias(Gnt,"cc.BatchedSkinningModelComponent");var Hnt,Vnt,Wnt,jnt,qnt,Xnt,Ynt,Knt,Znt,Qnt,Jnt,$nt,trt,ert,irt,nrt,rrt,art,ort,srt,lrt=new Vi,crt=new Vi,hrt=[],urt=function(t){function e(e,i){var r;return void 0===i&&(i=""),(r=t.call(this,e,i)||this)._frames=1,r._bakedDuration=0,r._animInfo=null,r._sockets=[],r._animInfoMgr=void 0,r._comps=[],r._parent=null,r._curvesInited=!1,r._animInfoMgr=n.director.root.dataPoolManager.jointAnimationInfo,r}Y(e,t);var i=e.prototype;return i.initialize=function(e){if(!this._curveLoaded){this._comps.length=0;for(var i=e.getComponentsInChildren(Nnt),n=0;n<i.length;++n){var r=i[n];r.skinningRoot===e&&this._comps.push(r)}this._parent=e.getComponent("cc.SkeletalAnimation");var a=this._parent.useBakedAnimation;t.prototype.initialize.call(this,e,a?hrt:void 0),this._curvesInited=!a;var o=eD.getOrExtract(this.clip).info;this._frames=o.frames-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/o.sample}},i.onPlay=function(){if(t.prototype.onPlay.call(this),this._parent.useBakedAnimation){this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration,this._animInfoMgr.switchClip(this._animInfo,this.clip);for(var e=0;e<this._comps.length;++e)this._comps[e].uploadAnimation(this.clip)}else this._sampleCurves=t.prototype._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0)},i.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,i=0;i<t.length;++i){var n=t[i],r=e.getChildByPath(n.path);if(n.target){for(var a=eD.getOrExtract(this.clip),o=n.path,s=a.data[o],l=r,c=void 0;!s;){var h=o.lastIndexOf("/");if(o=o.substring(0,h),s=a.data[o],l&&(c||(c=Vi.identity(crt)),Vi.fromRTS(lrt,l.rotation,l.position,l.scale),Vi.multiply(c,lrt,c),l=l.parent),h<0)break}for(var u=s&&s.worldMatrix.values,_=a.info.frames,f=[],d=0;d<_;d++){var p;p=u&&c?Vi.multiply(lrt,u[d],c):u?u[d]:c||Vi.IDENTITY;var m={pos:new Ri,rot:new Li,scale:new Ri};Vi.toRTS(p,m.rot,m.pos,m.scale),f.push(m)}this._sockets.push({target:n.target,frames:f})}}},i._sampleCurvesBaked=function(t){var e=this._animInfo,i=t*this._frames+.5|0;if(i!==e.data[0]){e.data[0]=i,e.dirty=!0;for(var n=0;n<this._sockets.length;++n){var r=this._sockets[n],a=r.target,o=r.frames[i],s=o.pos,l=o.rot,c=o.scale;a.setRTS(l,s,c)}}},e}(mD),_rt=(Hnt=ru("cc.SkeletalAnimation.Socket"),Vnt=Fu(wA),Hnt((qnt=$((jnt=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),J(this,"path",qnt,this),J(this,"target",Xnt,this),this.path=t,this.target=e}).prototype,"path",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Xnt=$(jnt.prototype,"target",[Vnt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wnt=jnt))||Wnt);le.setClassAlias(_rt,"cc.SkeletalAnimationComponent.Socket");var frt=new Vi,drt=new Vi;function prt(t,e,i){void 0===e&&(e=""),void 0===i&&(i=[]);for(var n=0;n<t.children.length;n++){var r=t.children[n];if(r){var a=e?e+"/"+r.name:r.name;i.push(a),prt(r,a,i)}}return i}var mrt=(Ynt=ru("cc.SkeletalAnimation"),Knt=gu(),Znt=ou(99),Qnt=du(),Jnt=Fu([_rt]),$nt=Eu(),trt=Eu(),ert=Fu([_rt]),Ynt(irt=Knt(irt=Znt(irt=fu(irt=Qnt((srt=ort=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_useBakedAnimation",rrt,K(e)),J(e,"_sockets",art,K(e)),e}Y(e,t);var i=e.prototype;return i.onDestroy=function(){t.prototype.onDestroy.call(this),n.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),n.director.getAnimationManager().removeSockets(this.node,this._sockets)},i.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},i.querySockets=function(){var t=this._defaultClip&&Object.keys(eD.getOrExtract(this._defaultClip).data).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],i=0;i<t.length;i++){var n=t[i],r=this.node.getChildByPath(n);r&&(e.push(n),prt(r,n,e))}return e},i.rebuildSocketAnimations=function(){for(var t,e=Q(this._sockets);!(t=e()).done;){var i=t.value,n=this.node.getChildByPath(i.path),r=i.target;n&&r&&(r.name=i.path.substring(i.path.lastIndexOf("/")+1)+" Socket",r.parent=this.node,JD(n,this.node,frt),Vi.fromRTS(drt,r.rotation,r.position,r.scale),Vi.equals(drt,frt)||(r.matrix=frt))}for(var a=0,o=Object.keys(this._nameToState);a<o.length;a++){var s=o[a];this._nameToState[s].rebuildSocketCurves(this._sockets)}},i.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var i=new wA;return i.parent=this.node,this._sockets.push(new _rt(t,i)),this.rebuildSocketAnimations(),i},i._createState=function(t,e){return new urt(t,e)},i._doCreateState=function(e,i){var n=t.prototype._doCreateState.call(this,e,i);return n.rebuildSocketCurves(this._sockets),n},q(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=n.director.getAnimationManager();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t;for(var e=this.node.getComponentsInChildren(Nnt),i=0;i<e.length;++i){var r=e[i];r.skinningRoot===this.node&&r.setUseBakedAnimation(this._useBakedAnimation)}this._useBakedAnimation?n.director.getAnimationManager().removeSockets(this.node,this._sockets):n.director.getAnimationManager().addSockets(this.node,this._sockets)}}]),e}(BD),ort.Socket=_rt,$((nrt=srt).prototype,"sockets",[Jnt,$nt],Object.getOwnPropertyDescriptor(nrt.prototype,"sockets"),nrt.prototype),$(nrt.prototype,"useBakedAnimation",[trt],Object.getOwnPropertyDescriptor(nrt.prototype,"useBakedAnimation"),nrt.prototype),rrt=$(nrt.prototype,"_useBakedAnimation",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),art=$(nrt.prototype,"_sockets",[ert],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),irt=nrt))||irt)||irt)||irt)||irt)||irt);n.SkeletalAnimationComponent=mrt,le.setClassAlias(mrt,"cc.SkeletalAnimationComponent"),n.utils=e4;var vrt,grt,yrt,Trt,Srt,Ert,Art,brt,xrt,Crt,wrt,Rrt,Irt,Ort,Prt,Mrt,Drt,Nrt,Lrt,Brt,Frt,zrt,Urt,krt,Grt,Hrt,Vrt,Wrt,jrt=[0,0,1,0,0,1,1,1],qrt=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertAttrs=void 0,e._vertSize=void 0,e._vBuffer=void 0,e._vertAttrsFloatCount=void 0,e._vdataF32=void 0,e._vdataUint32=void 0,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=void 0,e._mesh=void 0,e._vertCount=0,e._indexCount=0,e._startTimeOffset=0,e._lifeTimeOffset=0,e._material=null,e.type=dp.PARTICLE_BATCH,e._capacity=0,e._vertAttrs=null,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=new Do([new Po]),e._iaInfoBuffer=e._device.createBuffer(new No(Ga.INDIRECT,Ha.HOST|Ha.DEVICE,Mo,Mo)),e._subMeshData=null,e._mesh=null,e}Y(e,t);var i=e.prototype;return i.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._subMeshData&&e&&this.rebuild()},i.setVertexAttributes=function(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertSize=0;for(var i,n=Q(this._vertAttrs);!(i=n()).done;){var r=i.value;r.offset=this._vertSize,this._vertSize+=xo[r.format].size}this._vertAttrsFloatCount=this._vertSize/4,this.rebuild()}},i.createSubMeshData=function(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);if(this._mesh){var i=this._vertAttrs[this._vertAttrs.findIndex((function(t){return t.name===za.ATTR_TEX_COORD}))].offset;this._mesh.copyAttribute(0,za.ATTR_TEX_COORD,e,this._vertSize,i);var n=this._vertAttrs.findIndex((function(t){return t.name===za.ATTR_TEX_COORD3}));if(i=this._vertAttrs[n++].offset,this._mesh.copyAttribute(0,za.ATTR_POSITION,e,this._vertSize,i),i=this._vertAttrs[n++].offset,this._mesh.copyAttribute(0,za.ATTR_NORMAL,e,this._vertSize,i),i=this._vertAttrs[n++].offset,!this._mesh.copyAttribute(0,za.ATTR_COLOR,e,this._vertSize,i))for(var r=new Uint32Array(e),a=0;a<this._vertCount;++a)r[a*this._vertAttrsFloatCount+i/4]=Ci.WHITE._val;for(var o=new Float32Array(e),s=1;s<this._capacity;s++)o.copyWithin(s*this._vertSize*this._vertCount/4,0,this._vertSize*this._vertCount/4)}t.update(e);var l=new Uint16Array(this._capacity*this._indexCount);if(this._mesh){this._mesh.copyIndices(0,l);for(var c=1;c<this._capacity;c++)for(var h=0;h<this._indexCount;h++)l[c*this._indexCount+h]=l[h]+c*this._vertCount}else for(var u=0,_=0;_<this._capacity;++_){var f=4*_;l[u++]=f,l[u++]=f+1,l[u++]=f+2,l[u++]=f+3,l[u++]=f+2,l[u++]=f+1}var d=this._device.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,this._capacity*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return d.update(l),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=this._capacity*this._indexCount,this._iaInfoBuffer||(this._iaInfoBuffer=this._device.createBuffer(new No(Ga.INDIRECT,Ha.HOST|Ha.DEVICE,Mo,Mo))),this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new xx([t],this._vertAttrs,ja.TRIANGLE_LIST,d,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},i.addParticleVertexData=function(t,e){if(this._mesh)for(var i=0;i<this._vertCount;i++){var n=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[n++]=e[0].x,this._vdataF32[n++]=e[0].y,this._vdataF32[n++]=e[0].z,n+=2,this._vdataF32[n++]=e[1].z,this._vdataF32[n++]=e[2].x,this._vdataF32[n++]=e[2].y,this._vdataF32[n++]=e[2].z,this._vdataF32[n++]=e[3].x,this._vdataF32[n++]=e[3].y,this._vdataF32[n++]=e[3].z,this._vdataUint32[n++]=e[4]}else{var r=t*this._vertAttrsFloatCount;this._vdataF32[r++]=e[0].x,this._vdataF32[r++]=e[0].y,this._vdataF32[r++]=e[0].z,this._vdataF32[r++]=e[1].x,this._vdataF32[r++]=e[1].y,this._vdataF32[r++]=e[1].z,this._vdataF32[r++]=e[2].x,this._vdataF32[r++]=e[2].y,this._vdataF32[r++]=e[2].z,this._vdataF32[r++]=e[3].x,this._vdataF32[r++]=e[3].y,this._vdataF32[r++]=e[3].z,this._vdataUint32[r++]=e[4],e[5]&&(this._vdataF32[r++]=e[5].x,this._vdataF32[r++]=e[5].y,this._vdataF32[r++]=e[5].z)}},i.addGPUParticleVertexData=function(t,e,i){for(var n=e*this._vertAttrsFloatCount*this._vertCount,r=0;r<this._vertCount;r++){var a=n;this._vdataF32[a++]=t.position.x,this._vdataF32[a++]=t.position.y,this._vdataF32[a++]=t.position.z,this._vdataF32[a++]=i,this._vdataF32[a++]=t.startSize.x,this._vdataF32[a++]=t.startSize.y,this._vdataF32[a++]=t.startSize.z,this._vdataF32[a++]=jrt[2*r],this._vdataF32[a++]=t.rotation.x,this._vdataF32[a++]=t.rotation.y,this._vdataF32[a++]=t.rotation.z,this._vdataF32[a++]=jrt[2*r+1],this._vdataF32[a++]=t.startColor.r/255,this._vdataF32[a++]=t.startColor.g/255,this._vdataF32[a++]=t.startColor.b/255,this._vdataF32[a++]=t.startColor.a/255,this._vdataF32[a++]=t.velocity.x,this._vdataF32[a++]=t.velocity.y,this._vdataF32[a++]=t.velocity.z,this._vdataF32[a++]=t.startLifetime,this._vdataF32[a++]=t.randomSeed,n+=this._vertAttrsFloatCount}},i.updateGPUParticles=function(t,e,i){for(var n=this._vertAttrsFloatCount*this._vertCount,r=0,a=0,o=0,s=0;s<t;++s)r=s*n,a=this._vdataF32[r+this._startTimeOffset],this._vdataF32[r+this._lifeTimeOffset]-(e-a)<i&&(o=--t*n,this._vdataF32.copyWithin(r,o,o+n),s--);return t},i.constructAttributeIndex=function(){if(this._vertAttrs){var t=this._vertAttrs.findIndex((function(t){return"a_position_starttime"===t.name})),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((function(t){return"a_dir_life"===t.name})),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.clear=function(){this._subModels[0].inputAssembler.indexCount=0},i.destroy=function(){t.prototype.destroy.call(this),this._vBuffer=null,this._vdataF32=null,this.destroySubMeshData(),this._iaInfoBuffer&&(this._iaInfoBuffer.destroy(),this._iaInfoBuffer=null)},i.rebuild=function(){this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null,this._iaInfoBuffer=null)},e}(Up),Xrt=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._renderInfo=t}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t},e.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node,t.enabled=this._particleSystem.enabledInHierarchy)}},e.onDisable=function(){this.detachFromScene()},e.onDestroy=function(){this._model&&(n.director.root.destroyModel(this._model),this._model=null)},e.attachToScene=function(){this._model&&(this._model.scene&&this.detachFromScene(),this._particleSystem._getRenderScene().addModel(this._model))},e.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e.setVertexAttributes=function(){this._model&&this._model.setVertexAttributes(this._renderInfo.renderMode===o5.Mesh?this._renderInfo.mesh:null,this._vertAttrs)},e.clear=function(){this._model&&(this._model.enabled=!1)},e._initModel=function(){this._model||(this._model=n.director.root.createModel(qrt),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},e.updateTrailMaterial=function(){},e.getDefaultTrailMaterial=function(){return null},t}(),Yrt=new Ri,Krt=new Vi,Zrt=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],Qrt=[0,0,1,0,0,1,1,1],Jrt=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RGB32F),new Xo(za.ATTR_TEX_COORD1,ka.RGB32F),new Xo(za.ATTR_TEX_COORD2,ka.RGB32F),new Xo(za.ATTR_COLOR,ka.RGBA8,!0)],$rt=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RGB32F),new Xo(za.ATTR_TEX_COORD1,ka.RGB32F),new Xo(za.ATTR_TEX_COORD2,ka.RGB32F),new Xo(za.ATTR_COLOR,ka.RGBA8,!0),new Xo(za.ATTR_COLOR1,ka.RGB32F)],tat=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RGB32F),new Xo(za.ATTR_TEX_COORD1,ka.RGB32F),new Xo(za.ATTR_TEX_COORD2,ka.RGB32F),new Xo(za.ATTR_COLOR,ka.RGBA8,!0),new Xo(za.ATTR_TEX_COORD3,ka.RGB32F),new Xo(za.ATTR_NORMAL,ka.RGB32F),new Xo(za.ATTR_COLOR1,ka.RGBA8,!0)],eat={parent:null,owner:null,subModelIdx:0},iat=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._trailDefines=void 0,i._frameTile_velLenScale=void 0,i._defaultMat=null,i._node_scale=void 0,i._attrs=void 0,i._particles=null,i._defaultTrailMat=null,i._updateList=new Map,i._animateList=new Map,i._runAnimateList=new Array,i._fillDataFunc=null,i._uScaleHandle=0,i._uLenHandle=0,i._inited=!1,i._model=null,i._frameTile_velLenScale=new Qi(1,1,0,0),i._node_scale=new Qi,i._attrs=new Array(5),i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},i._trailDefines={CC_USE_WORLD_SPACE:!0},i}Y(e,t);var i=e.prototype;return i.onInit=function(e){var i=this;t.prototype.onInit.call(this,e),this._particles=new __((function(){return new e5(i)}),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0},i.clear=function(){t.prototype.clear.call(this),this._particles.reset(),this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData(),this._model.enabled=!1},i.updateRenderMode=function(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()},i.getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},i.getDefaultTrailMaterial=function(){return this._defaultTrailMat},i.setNewParticle=function(){},i._initModuleList=function(){var t=this;Zrt.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=i5.length;e<i;e++){var n=this._animateList[i5[e]];n&&this._runAnimateList.push(n)}},i.enableModule=function(t,e,i){e?(i.needUpdate&&(this._updateList[i.name]=i),i.needAnimate&&(this._animateList[i.name]=i)):(delete this._animateList[t],delete this._updateList[t]),this._runAnimateList.length=0;for(var n=0,r=i5.length;n<r;n++){var a=this._animateList[i5[n]];a&&this._runAnimateList.push(a)}},i.updateParticles=function(t){var e=this,i=this._particleSystem;if(!i)return this._particles.length;switch(i.node.getWorldMatrix(Krt),i.scaleSpace){case a5.Local:i.node.getScale(this._node_scale);break;case a5.World:i.node.getWorldScale(this._node_scale)}(i.getMaterialInstance(0)||this._defaultMat).passes[0].setUniform(this._uScaleHandle,this._node_scale),this._updateList.forEach((function(t){t.update(i._simulationSpace,Krt)}));var n=i._trailModule,r=n&&n.enable;r&&n.update();for(var a=function(a){var s=e._particles.data[a];if(s.remainingLifetime-=t,Ri.set(s.animatedVelocity,0,0,0),s.remainingLifetime<0)return r&&n.removeParticle(s),e._particles.removeAt(a),--a,o=a,"continue";s.velocity.y-=9.8*i.gravityModifier.evaluate(1-s.remainingLifetime/s.startLifetime,vi(s.randomSeed))*t,Ri.copy(s.ultimateVelocity,s.velocity),e._runAnimateList.forEach((function(e){e.animate(s,t)})),Ri.scaleAndAdd(s.position,s.position,s.ultimateVelocity,t),r&&n.animate(s,t),o=a},o=0;o<this._particles.length;++o)a(o);return this._model.enabled=this._particles.length>0,this._particles.length},i.updateRenderData=function(){for(var t=0,e=0;e<this._particles.length;++e){var i=this._particles.data[e],n=0,r=this._particleSystem._textureAnimationModule;r&&r.enable&&(n=i.frameIndex),t=4*e,this._fillDataFunc(i,t,n)}},i.beforeRender=function(){this._model.updateIA(this._particles.length)},i.getParticleCount=function(){return this._particles.length},i.onMaterialModified=function(t){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);var i=this._particleSystem._trailModule;i&&i._trailModel&&1===t&&i._trailModel.setSubModelMaterial(0,e)},i._setFillFunc=function(){this._renderInfo.renderMode===o5.Mesh?this._fillDataFunc=this._fillMeshData:this._renderInfo.renderMode===o5.StrecthedBillboard?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData},i._fillMeshData=function(t,e,i){var n=e/4,r=0;this._attrs[r++]=t.position,Yrt.z=i,this._attrs[r++]=Yrt,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._model.addParticleVertexData(n,this._attrs)},i._fillStrecthedData=function(t,e,i){for(var n=0,r=0;r<4;++r)n=0,this._attrs[n++]=t.position,Yrt.x=Qrt[2*r],Yrt.y=Qrt[2*r+1],Yrt.z=i,this._attrs[n++]=Yrt,this._attrs[n++]=t.size,this._attrs[n++]=t.rotation,this._attrs[n++]=t.color._val,this._attrs[n++]=t.ultimateVelocity,this._attrs[n++]=t.ultimateVelocity,this._model.addParticleVertexData(e++,this._attrs)},i._fillNormalData=function(t,e,i){for(var n=0,r=0;r<4;++r)n=0,this._attrs[n++]=t.position,Yrt.x=Qrt[2*r],Yrt.y=Qrt[2*r+1],Yrt.z=i,this._attrs[n++]=Yrt,this._attrs[n++]=t.size,this._attrs[n++]=t.rotation,this._attrs[n++]=t.color._val,this._attrs[n++]=null,this._model.addParticleVertexData(e++,this._attrs)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case o5.StrecthedBillboard:this._vertAttrs=$rt.slice();break;case o5.Mesh:this._vertAttrs=tat.slice();break;default:this._vertAttrs=Jrt.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!=e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1!==i.indexOf("particle")&&-1===i.indexOf("particle-gpu")||t.setMaterial(null,0)}null==t.sharedMaterial&&null==this._defaultMat&&(eat.parent=Zd.get("default-particle-material"),eat.owner=this._particleSystem,eat.subModelIdx=0,this._defaultMat=new cm(eat),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var n=t.getMaterialInstance(0)||this._defaultMat;t._simulationSpace===a5.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var r=n.passes[0];this._uScaleHandle=r.getHandle("scale"),this._uLenHandle=r.getHandle("frameTile_velLenScale");var a=this._renderInfo.renderMode,o=this._frameTile_velLenScale;a===o5.Billboard?this._defines.CC_RENDER_MODE=0:a===o5.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,o.z=this._renderInfo.velocityScale,o.w=this._renderInfo.lengthScale):a===o5.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:a===o5.VerticalBillboard?this._defines.CC_RENDER_MODE=3:a===o5.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+a+" not support.");var s=t._textureAnimationModule;s&&s.enable?(Xi.set(o,s.numTilesX,s.numTilesY),r.setUniform(this._uLenHandle,o)):r.setUniform(this._uLenHandle,o),n.recompileShaders(this._defines),this._model&&this._model.updateMaterial(n)}},i.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,e=t._trailModule;if(e&&e.enable){t.simulationSpace===a5.World||e.space===a5.World?this._trailDefines.CC_USE_WORLD_SPACE=!0:this._trailDefines.CC_USE_WORLD_SPACE=!1;var i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(eat.parent=Zd.get("default-trail-material"),eat.owner=this._particleSystem,eat.subModelIdx=1,this._defaultTrailMat=new cm(eat)),(i=i||this._defaultTrailMat).recompileShaders(this._trailDefines),e.updateMaterial()}}},e}(Xrt),nat=new Vi,rat=new Qi,aat=new Li,oat=[new Xo("a_position_starttime",ka.RGBA32F),new Xo("a_size_uv",ka.RGBA32F),new Xo("a_rotation_uv",ka.RGBA32F),new Xo("a_color",ka.RGBA32F),new Xo("a_dir_life",ka.RGBA32F),new Xo("a_rndSeed",ka.R32F)],sat=[new Xo("a_position_starttime",ka.RGBA32F),new Xo("a_size_uv",ka.RGBA32F),new Xo("a_rotation_uv",ka.RGBA32F),new Xo("a_color",ka.RGBA32F),new Xo("a_dir_life",ka.RGBA32F),new Xo("a_rndSeed",ka.R32F),new Xo(za.ATTR_TEX_COORD,ka.RGB32F),new Xo(za.ATTR_TEX_COORD3,ka.RGB32F),new Xo(za.ATTR_NORMAL,ka.RGB32F),new Xo(za.ATTR_COLOR1,ka.RGBA8,!0)],lat={parent:null,owner:null,subModelIdx:0},cat=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._frameTile_velLenScale=void 0,i._node_scale=void 0,i._vertAttrs=[],i._defaultMat=null,i._particleNum=0,i._tempParticle=null,i._colorTexture=null,i._forceTexture=null,i._velocityTexture=null,i._rotationTexture=null,i._sizeTexture=null,i._animTexture=null,i._uTimeHandle=0,i._uRotHandle=0,i._inited=!1,i._frameTile_velLenScale=new Qi(1,1,0,0),i._node_scale=new Qi,i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},i._tempParticle=new e5(null),i._particleNum=0,i}Y(e,t);var i=e.prototype;return i.onInit=function(e){t.prototype.onInit.call(this,e),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0},i.updateRenderMode=function(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()},i.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},i.clear=function(){t.prototype.clear.call(this),this._particleNum=0,this.updateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy()},i.enableModule=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;t&&(this.initShaderUniform(t),t.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,t))},i.getFreeParticle=function(){return this._particleNum>=this._particleSystem._capacity?null:this._tempParticle},i.setNewParticle=function(t){this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem._time),this._particleNum++},i.updateParticles=function(t){return this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem._time,t),this.updateShaderUniform(t),this._model.enabled=this._particleNum>0,this._particleNum},i.updateRenderData=function(){},i.beforeRender=function(){this._model.updateIA(this._particleNum)},i.updateShaderUniform=function(t){var e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(e){var i=e.passes[0];rat.x=this._particleSystem._time,rat.y=t,i.setUniform(this._uTimeHandle,rat),this._particleSystem.node.getWorldRotation(aat),i.setUniform(this._uRotHandle,aat)}},i.initShaderUniform=function(t){var e=t.passes[0];this._uTimeHandle=e.getHandle("u_timeDelta"),this._uRotHandle=e.getHandle("u_worldRot"),e.setUniform(e.getHandle("scale"),this._node_scale),e.setUniform(e.getHandle("frameTile_velLenScale"),this._frameTile_velLenScale),rat.x=32,rat.y=1/32,e.setUniform(e.getHandle("u_sampleInfo"),rat);var i=!1,n=this._particleSystem._forceOvertimeModule;if(i=n&&n.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=i,i){this._forceTexture&&this._forceTexture.destroy(),this._forceTexture=_4(32,n.x,n.y,n.z);var r=e.getHandle("force_over_time_tex0"),a=ep.getBindingFromHandle(r);e.bindSampler(a,this._forceTexture.getGFXSampler()),e.bindTexture(a,this._forceTexture.getGFXTexture());var o=e.getHandle("u_force_space");e.setUniform(o,n.space);var s=e.getHandle("u_force_mode");e.setUniform(s,this._forceTexture.height)}var l=this._particleSystem._velocityOvertimeModule;if(i=l&&l.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=i,i){this._velocityTexture&&this._velocityTexture.destroy(),this._velocityTexture=function(t,e,i,n,r){for(var a=Math.max(h4(e),h4(i),h4(n),h4(r)),o=new Float32Array(128*a),s=[e,i,n,r],l=0;l<a;l++)for(var c=0;c<4;c++)for(var h=s[c],u=0,_=0,f=0;f<32;f++){var d=c4(h,1/31*f,l);_=(u+=d)/(f+1),o[4*f+c]=_}return u4(o,32,a)}(0,l.x,l.y,l.z,l.speedModifier);var c=e.getHandle("velocity_over_time_tex0"),h=ep.getBindingFromHandle(c);e.bindSampler(h,this._velocityTexture.getGFXSampler()),e.bindTexture(h,this._velocityTexture.getGFXTexture());var u=e.getHandle("u_velocity_space");e.setUniform(u,l.space);var _=e.getHandle("u_velocity_mode");e.setUniform(_,this._velocityTexture.height)}var f=this._particleSystem._colorOverLifetimeModule;if(i=f&&f.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=i,i){this._colorTexture&&this._colorTexture.destroy(),this._colorTexture=function(t,e){for(var i=function(t){switch(t.mode){case p3.TwoColors:case p3.TwoGradients:return 2;default:return 1}}(e),n=new Uint8Array(t*i*4),r=1/(t-1),a=0,o=0;o<i;o++)for(var s=0;s<t;s++){var l=v3(e,r*s,o);n[a]=l.r,n[a+1]=l.g,n[a+2]=l.b,n[a+3]=l.a,a+=4}var c=new yd;return c.create(t,i,D_.RGBA8888),c.setFilters(L_.LINEAR,L_.LINEAR),c.setWrapMode(N_.CLAMP_TO_EDGE,N_.CLAMP_TO_EDGE),c.uploadData(n),c}(32,f.color);var d=e.getHandle("color_over_time_tex0"),p=ep.getBindingFromHandle(d);e.bindSampler(p,this._colorTexture.getGFXSampler()),e.bindTexture(p,this._colorTexture.getGFXTexture());var m=e.getHandle("u_color_mode");e.setUniform(m,this._colorTexture.height)}var v=this._particleSystem._rotationOvertimeModule;if(i=v&&v.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=i,i){this._rotationTexture&&this._rotationTexture.destroy(),v.separateAxes?this._rotationTexture=_4(32,v.x,v.y,v.z):this._rotationTexture=function(t,e){for(var i=h4(e),n=new Float32Array(128*i),r=0,a=0;a<i;a++)for(var o=0;o<32;o++){var s=c4(e,1/31*o,a);n[r+2]=s,r+=4}return u4(n,32,i)}(0,v.z);var g=e.getHandle("rotation_over_time_tex0"),y=ep.getBindingFromHandle(g);e.bindSampler(y,this._rotationTexture.getGFXSampler()),e.bindTexture(y,this._rotationTexture.getGFXTexture());var T=e.getHandle("u_rotation_mode");e.setUniform(T,this._rotationTexture.height)}var S=this._particleSystem._sizeOvertimeModule;if(i=S&&S.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=i,i){this._sizeTexture&&this._sizeTexture.destroy(),S.separateAxes?this._sizeTexture=_4(32,S.x,S.y,S.z,!0):this._sizeTexture=function(t,e){for(var i=h4(e),n=new Float32Array(128*i),r=0,a=0,o=0;o<i;o++){0;for(var s=0;s<32;s++){var l=c4(e,1/31*s,o);r=l,n[a]=r,n[a+1]=r,n[a+2]=r,a+=4}}return u4(n,32,i)}(0,S.size);var E=e.getHandle("size_over_time_tex0"),A=ep.getBindingFromHandle(E);e.bindSampler(A,this._sizeTexture.getGFXSampler()),e.bindTexture(A,this._sizeTexture.getGFXTexture());var b=e.getHandle("u_size_mode");e.setUniform(b,this._sizeTexture.height)}var x=this._particleSystem._textureAnimationModule;if(i=x&&x.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=i,i){this._animTexture&&this._animTexture.destroy(),this._animTexture=function(t,e,i){for(var n=Math.max(h4(e),h4(i)),r=new Float32Array(128*n),a=[e,i],o=0;o<n;o++)for(var s=0;s<2;s++)for(var l=a[s],c=0,h=0,u=0;u<32;u++){var _=c4(l,1/31*u,o);h=(c+=_)/(u+1),r[4*u+s]=h}return u4(r,32,n)}(0,x.startFrame,x.frameOverTime);var C=e.getHandle("texture_animation_tex0"),w=ep.getBindingFromHandle(C);e.bindSampler(w,this._animTexture.getGFXSampler()),e.bindTexture(w,this._animTexture.getGFXTexture());var R=e.getHandle("u_anim_info");rat.x=this._animTexture.height,rat.y=x.numTilesX*x.numTilesY,rat.z=x.cycleCount,e.setUniform(R,rat)}},i.getParticleCount=function(){return this._particleNum},i.onMaterialModified=function(){this._inited&&this.updateMaterialParams()},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case o5.StrecthedBillboard:this._vertAttrs=oat.slice();break;case o5.Mesh:this._vertAttrs=sat.slice();break;default:this._vertAttrs=oat.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!==e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1===i.indexOf("particle-gpu")&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0),this._particleSystem.setMaterial(null,0))}null==t.sharedMaterial&&null==this._defaultMat&&(lat.parent=Zd.get("default-particle-gpu-material"),lat.owner=t,lat.subModelIdx=0,this._defaultMat=new cm(lat),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var n=t.getMaterialInstance(0)||this._defaultMat;switch(t.node.getWorldMatrix(nat),t.scaleSpace){case a5.Local:t.node.getScale(this._node_scale);break;case a5.World:t.node.getWorldScale(this._node_scale)}t._simulationSpace===a5.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var r=this._renderInfo.renderMode;r===o5.Billboard?this._defines.CC_RENDER_MODE=0:r===o5.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):r===o5.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:r===o5.VerticalBillboard?this._defines.CC_RENDER_MODE=3:r===o5.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+r+" not support.");var a=t._textureAnimationModule;a&&a.enable&&Xi.set(this._frameTile_velLenScale,a.numTilesX,a.numTilesY),this.initShaderUniform(n),n.recompileShaders(this._defines),this._model&&this._model.updateMaterial(n)}},e}(Xrt);function hat(){var t=BR.root.device;return!!(t.maxVertexTextureUnits>=8&&t.hasFeature(So.TEXTURE_FLOAT))||(n.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var uat,_at,fat,dat,pat,mat,vat,gat,yat,Tat,Sat,Eat,Aat,bat,xat,Cat,wat,Rat,Iat,Oat,Pat,Mat,Dat,Nat,Lat,Bat,Fat,zat,Uat,kat,Gat,Hat,Vat,Wat,jat,qat,Xat,Yat,Kat,Zat,Qat,Jat,$at,tot,eot,iot,not,rot,aot,oot,sot,lot,cot,hot,uot,_ot,fot,dot,pot,mot,vot,got,yot,Tot,Sot,Eot,Aot,bot,xot,Cot,wot,Rot,Iot,Oot,Pot,Mot,Dot,Not,Lot,Bot,Fot,zot,Uot,kot,Got,Hot,Vot,Wot,jot,qot,Xot,Yot,Kot,Zot,Qot,Jot,$ot,tst,est,ist,nst,rst,ast,ost,sst,lst,cst,hst,ust,_st,fst,dst,pst,mst,vst,gst,yst,Tst,Sst,Est,Ast,bst,xst,Cst,wst,Rst,Ist,Ost,Pst,Mst,Dst,Nst,Lst,Bst,Fst,zst,Ust,kst,Gst,Hst,Vst,Wst,jst,qst,Xst,Yst,Kst,Zst,Qst,Jst,$st,tlt,elt,ilt,nlt,rlt,alt,olt,slt,llt,clt,hlt,ult,_lt,flt,dlt,plt,mlt,vlt,glt,ylt,Tlt,Slt,Elt,Alt,blt,xlt,Clt,wlt,Rlt,Ilt,Olt,Plt,Mlt,Dlt,Nlt,Llt,Blt,Flt,zlt,Ult,klt,Glt,Hlt,Vlt,Wlt,jlt,qlt,Xlt,Ylt,Klt,Zlt=(vrt=ru("cc.ParticleSystemRenderer"),grt=Fu(o5),yrt=Ru(),Trt=Eu(),Srt=Ru(),Ert=Eu(),Art=Ru(),brt=Eu(),xrt=Fu(o5),Crt=Fu(t2),wrt=Ru(),Rrt=Eu(),Irt=Fu(nm),Ort=Ru(),Prt=Eu(),Mrt=Fu(nm),Drt=Ru(),Nrt=Eu(),Lrt=Ru(),Brt=Eu(),vrt(($((zrt=function(){function t(){J(this,"_renderMode",Urt,this),J(this,"_velocityScale",krt,this),J(this,"_lengthScale",Grt,this),J(this,"_mesh",Hrt,this),J(this,"_mainTexture",Vrt,this),J(this,"_useGPU",Wrt,this),this._particleSystem=null}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t;var e=this._useGPU&&hat();this._particleSystem.processor=e?new cat(this):new iat(this),this._particleSystem.processor.onInit(t)},e._switchProcessor=function(){this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null),this._particleSystem.processor=this._useGPU?new cat(this):new iat(this),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule()},q(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem&&this._particleSystem.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._particleSystem&&this._particleSystem.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(0):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,0)}},{key:"trailMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(1):null},set:function(t){this._particleSystem.setMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(hat()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}}]),t}()).prototype,"renderMode",[grt,yrt,Trt],Object.getOwnPropertyDescriptor(zrt.prototype,"renderMode"),zrt.prototype),$(zrt.prototype,"velocityScale",[Srt,Ert],Object.getOwnPropertyDescriptor(zrt.prototype,"velocityScale"),zrt.prototype),$(zrt.prototype,"lengthScale",[Art,brt],Object.getOwnPropertyDescriptor(zrt.prototype,"lengthScale"),zrt.prototype),Urt=$(zrt.prototype,"_renderMode",[xrt,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return o5.Billboard}}),krt=$(zrt.prototype,"_velocityScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Grt=$(zrt.prototype,"_lengthScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Hrt=$(zrt.prototype,"_mesh",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(zrt.prototype,"mesh",[Crt,wrt,Rrt],Object.getOwnPropertyDescriptor(zrt.prototype,"mesh"),zrt.prototype),$(zrt.prototype,"particleMaterial",[Irt,Ort,Prt],Object.getOwnPropertyDescriptor(zrt.prototype,"particleMaterial"),zrt.prototype),$(zrt.prototype,"trailMaterial",[Mrt,Drt,Nrt],Object.getOwnPropertyDescriptor(zrt.prototype,"trailMaterial"),zrt.prototype),Vrt=$(zrt.prototype,"_mainTexture",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wrt=$(zrt.prototype,"_useGPU",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(zrt.prototype,"useGPU",[Lrt,Brt],Object.getOwnPropertyDescriptor(zrt.prototype,"useGPU"),zrt.prototype),Frt=zrt))||Frt),Qlt=Math.cos(_i(100)),Jlt={position:new Ri,velocity:new Ri},$lt=new Li,tct=new Vi,ect=new Ri,ict=new Ri,nct=new Ci,rct=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new Ri,lifetime:0,width:0,velocity:new Ri,direction:0,color:new Ci})}var e=t.prototype;return e.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},e.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new Ri,lifetime:0,width:0,velocity:new Ri,direction:0,color:new Ci}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},e.iterateElement=function(t,e,i,n){for(var r=this.start>=this.end?this.end+this.trailElements.length:this.end,a=this.start;a<r;a++)e(t,this.trailElements[a%this.trailElements.length],i,n)&&(this.start++,this.start%=this.trailElements.length);this.start===r&&(this.start=-1,this.end=-1)},e.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},e.clear=function(){this.start=-1,this.end=-1},t}(),act=(uat=ru("cc.TrailModule"),_at=Ru(),fat=Fu(h5),dat=Ru(),pat=Eu(),mat=Fu(l4),vat=Ru(),gat=Eu(),yat=Ru(),Tat=Eu(),Sat=Fu(a5),Eat=Ru(),Aat=Eu(),bat=Fu(u5),xat=Ru(),Cat=Eu(),wat=Ru(),Rat=Eu(),Iat=Fu(l4),Oat=Ru(),Pat=Eu(),Mat=Ru(),Dat=Eu(),Nat=Fu(m3),Lat=Ru(),Bat=Eu(),Fat=Fu(m3),zat=Ru(),Uat=Eu(),kat=Fu(a5),uat(($((Hat=function(){function t(){J(this,"_enable",Vat,this),J(this,"mode",Wat,this),J(this,"lifeTime",jat,this),J(this,"_minParticleDistance",qat,this),J(this,"existWithParticles",Xat,this),J(this,"textureMode",Yat,this),J(this,"widthFromParticle",Kat,this),J(this,"widthRatio",Zat,this),J(this,"colorFromParticle",Qat,this),J(this,"colorOverTrail",Jat,this),J(this,"colorOvertime",$at,this),J(this,"_space",tot,this),J(this,"_particleSystem",eot,this),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._iaInfo=void 0,this._iaInfoBuffer=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._iaInfo=new Do([new Po]),this._vertAttrs=[new Xo(za.ATTR_POSITION,ka.RGB32F),new Xo(za.ATTR_TEX_COORD,ka.RGBA32F),new Xo(za.ATTR_TEX_COORD1,ka.RGB32F),new Xo(za.ATTR_COLOR,ka.RGBA8,!0)],this._vertSize=0;for(var t,e=Q(this._vertAttrs);!(t=e()).done;){var i=t.value;this._vertSize+=xo[i.format].size}this._particleTrail=new Map}q(t,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor&&this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t;var e=this._particleSystem;e&&e.processor&&e.processor.updateTrailMaterial()}}]);var e=t.prototype;return e.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var e=0,i=t.startLifetime.getMax(),n=t.rateOverTime.getMax(),r=t.duration,a=0,o=t.bursts.length;a<o;a++)e+=t.bursts[a].getMaxCount(t)*Math.ceil(i/r);this._trailNum=Math.ceil(i*this.lifeTime.getMax()*60*(n*r+e)),this._trailSegments=new u_((function(){return new rct(10)}),Math.ceil(n*r)),this._enable&&(this.enable=this._enable)},e.onEnable=function(){this._attachToScene()},e.onDisable=function(){this._particleTrail.clear(),this._detachFromScene()},e._attachToScene=function(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))},e._detachFromScene=function(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)},e.destroy=function(){this.destroySubMeshData(),this._trailModel&&(BR.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy((function(t){t.trailElements.length=0})),this._trailSegments=null)},e.play=function(){this._trailModel&&this._enable&&(this._trailModel.enabled=!0)},e.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData(),this._trailModel&&(this._trailModel.enabled=!1)}},e.updateMaterial=function(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor._defaultTrailMat,this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))},e.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===a5.World&&this._particleSystem._simulationSpace===a5.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(tct),this._particleSystem.node.getWorldRotation($lt)):this._needTransform=!1},e.animate=function(t,e){if(this._trailSegments){var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var n=i.getElement(i.end-1);if(this._needTransform?Ri.transformMat4(ect,t.position,tct):Ri.copy(ect,t.position),!(n&&(i.iterateElement(this,this._updateTrailElement,t,e),Ri.squaredDistance(n.position,ect)<this._minSquaredDistance))&&(n=i.addElement())){Ri.copy(n.position,ect),n.lifetime=0,this.widthFromParticle?n.width=t.size.x*this.widthRatio.evaluate(0,1):n.width=this.widthRatio.evaluate(0,1);var r=i.count();if(2===r){var a=i.getElement(i.end-2);Ri.subtract(a.velocity,n.position,a.position)}else if(r>2){var o=i.getElement(i.end-2),s=i.getElement(i.end-3);Ri.subtract(ect,s.position,o.position),Ri.subtract(ict,n.position,o.position),Ri.subtract(o.velocity,ict,ect),Ri.equals(Ri.ZERO,o.velocity)&&Ri.copy(o.velocity,ect),Ri.normalize(o.velocity,o.velocity),this._checkDirectionReverse(o,s)}this.colorFromParticle?n.color.set(t.color):n.color.set(this.colorOvertime.evaluate(0,1))}}},e.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},e.updateRenderData=function(){this.vbOffset=0,this.ibOffset=0;for(var t,e=Q(this._particleTrail.keys());!(t=e()).done;){var i=t.value,n=this._particleTrail.get(i);if(-1!==n.start){var r=4*this.vbOffset/this._vertSize,a=n.start>=n.end?n.end+n.trailElements.length:n.end,o=a-n.start,s=1/o,l=n.trailElements[n.start];this._fillVertexBuffer(l,this.colorOverTrail.evaluate(1,1),r,1,0,4);for(var c=n.start+1;c<a;c++){var h=n.trailElements[c%n.trailElements.length],u=c-n.start;this._fillVertexBuffer(h,this.colorOverTrail.evaluate(1-u/o,1),r,1-u*s,u,5)}if(this._needTransform?Ri.transformMat4(Jlt.position,i.position,tct):Ri.copy(Jlt.position,i.position),1===o||2===o){var _=n.getElement(n.end-1);Ri.subtract(_.velocity,Jlt.position,_.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=_.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=_.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=_.velocity.z,this._vbF32[this.vbOffset-4]=_.velocity.x,this._vbF32[this.vbOffset-3]=_.velocity.y,this._vbF32[this.vbOffset-2]=_.velocity.z,Ri.subtract(Jlt.velocity,Jlt.position,_.position),this._checkDirectionReverse(Jlt,_)}else if(o>2){var f=n.getElement(n.end-1),d=n.getElement(n.end-2);Ri.subtract(ect,d.position,f.position),Ri.subtract(ict,Jlt.position,f.position),Ri.normalize(ect,ect),Ri.normalize(ict,ict),Ri.subtract(f.velocity,ict,ect),Ri.normalize(f.velocity,f.velocity),this._checkDirectionReverse(f,d),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(f,this.colorOverTrail.evaluate(s,1),r,s,o-1,5),Ri.subtract(Jlt.velocity,Jlt.position,f.position),Ri.normalize(Jlt.velocity,Jlt.velocity),this._checkDirectionReverse(Jlt,f)}this.widthFromParticle?Jlt.width=i.size.x*this.widthRatio.evaluate(0,1):Jlt.width=this.widthRatio.evaluate(0,1),Jlt.color=i.color,Ri.equals(Jlt.velocity,Ri.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(Jlt,this.colorOverTrail.evaluate(0,1),r,0,o,1)}}this._trailModel.enabled=this.ibOffset>0},e.updateIA=function(t){var e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){var i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=t,this._iaInfoBuffer.update(this._iaInfo)}},e.beforeRender=function(){this.updateIA(this.ibOffset)},e._createModel=function(){this._trailModel||(this._trailModel=n.director.root.createModel(Up))},e.rebuild=function(){var t=BR.root.device,e=t.createBuffer(new No(Ga.VERTEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,this._vertSize*(this._trailNum+1)*2,this._vertSize)),i=new ArrayBuffer(this._vertSize*(this._trailNum+1)*2);this._vbF32=new Float32Array(i),this._vbUint32=new Uint32Array(i),e.update(i);var n=t.createBuffer(new No(Ga.INDEX|Ga.TRANSFER_DST,Ha.HOST|Ha.DEVICE,6*this._trailNum*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));this._iBuffer=new Uint16Array(6*this._trailNum),n.update(this._iBuffer),this._iaInfoBuffer=t.createBuffer(new No(Ga.INDIRECT,Ha.HOST|Ha.DEVICE,Mo,Mo)),this._iaInfo.drawInfos[0].vertexCount=2*(this._trailNum+1),this._iaInfo.drawInfos[0].indexCount=6*this._trailNum,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new xx([e],this._vertAttrs,ja.TRIANGLE_LIST,n,this._iaInfoBuffer);var r=this._trailModel;r&&(r.node=r.transform=this._particleSystem.node,r.visFlags=this._particleSystem.visibility,r.initSubModel(0,this._subMeshData,this._material),r.enabled=!0)},e._updateTrailElement=function(t,e,i,n){return e.lifetime+=n,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},e._fillVertexBuffer=function(t,e,i,n,r,a){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=n,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,nct.set(t.color),nct.multiply(e),this._vbUint32[this.vbOffset++]=nct._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=n,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=nct._val,1&a&&(this._iBuffer[this.ibOffset++]=i+2*r,this._iBuffer[this.ibOffset++]=i+2*r-1,this._iBuffer[this.ibOffset++]=i+2*r+1),4&a&&(this._iBuffer[this.ibOffset++]=i+2*r,this._iBuffer[this.ibOffset++]=i+2*r+1,this._iBuffer[this.ibOffset++]=i+2*r+2)},e._checkDirectionReverse=function(t,e){Ri.dot(t.velocity,e.velocity)<Qlt?t.direction=1-e.direction:t.direction=e.direction},e.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},t}()).prototype,"enable",[_at],Object.getOwnPropertyDescriptor(Hat.prototype,"enable"),Hat.prototype),Vat=$(Hat.prototype,"_enable",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wat=$(Hat.prototype,"mode",[fat,cu,dat,pat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h5.Particles}}),jat=$(Hat.prototype,"lifeTime",[mat,cu,vat,gat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),qat=$(Hat.prototype,"_minParticleDistance",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),$(Hat.prototype,"minParticleDistance",[yat,Tat],Object.getOwnPropertyDescriptor(Hat.prototype,"minParticleDistance"),Hat.prototype),$(Hat.prototype,"space",[Sat,Eat,Aat],Object.getOwnPropertyDescriptor(Hat.prototype,"space"),Hat.prototype),Xat=$(Hat.prototype,"existWithParticles",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Yat=$(Hat.prototype,"textureMode",[bat,cu,xat,Cat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u5.Stretch}}),Kat=$(Hat.prototype,"widthFromParticle",[cu,wat,Rat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zat=$(Hat.prototype,"widthRatio",[Iat,cu,Oat,Pat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Qat=$(Hat.prototype,"colorFromParticle",[cu,Mat,Dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jat=$(Hat.prototype,"colorOverTrail",[Nat,cu,Lat,Bat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m3}}),$at=$(Hat.prototype,"colorOvertime",[Fat,cu,zat,Uat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m3}}),tot=$(Hat.prototype,"_space",[kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a5.World}}),eot=$(Hat.prototype,"_particleSystem",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gat=Hat))||Gat),oct=new Vi,sct=new Li,lct=Object.getOwnPropertyDescriptor(YP.prototype,"sharedMaterials"),cct=function(e){return t({ParticleSystem:e,ParticleSystemComponent:e}),e}((iot=ru("cc.ParticleSystem"),not=gu(),rot=du(),aot=ou(99),oot=Ru(),sot=Eu(),lot=Fu(m3),cot=Ru(),hot=Eu(),uot=Fu(a5),_ot=Ru(),fot=Eu(),dot=Ru(),pot=Eu(),mot=hu("startSize"),vot=Fu(l4),got=Ru(),yot=Eu(),Tot=Fu(l4),Sot=Ru(),Eot=Eu(),Aot=Fu(l4),bot=Ru(),xot=Eu(),Cot=Fu(l4),wot=Au(),Rot=Ru(),Iot=Eu(),Oot=Ru(),Pot=Eu(),Mot=Fu(l4),Dot=Au(),Not=Ru(),Lot=Eu(),Bot=Fu(l4),Fot=Au(),zot=Ru(),Uot=Eu(),kot=Fu(l4),Got=hu("startRotation"),Hot=Au(),Vot=Ru(),Wot=Eu(),jot=Fu(l4),qot=Ru(),Xot=Eu(),Yot=Fu(l4),Kot=Ru(),Zot=Eu(),Qot=Ru(),Jot=Eu(),$ot=Ru(),tst=Eu(),est=Ru(),ist=Eu(),nst=Fu(a5),rst=Ru(),ast=Eu(),ost=Ru(),sst=Eu(),lst=Ru(),cst=Eu(),hst=Fu(l4),ust=Au(),_st=Ru(),fst=Eu(),dst=Fu(l4),pst=Ru(),mst=Eu(),vst=Fu(l4),gst=Ru(),yst=Eu(),Tst=Fu([Z9]),Sst=Ru(),Est=Eu(),Ast=Tu(),bst=Fu(nm),xst=Su(),Cst=Fu(_5),wst=Fu(_5),Rst=Ru(),Ist=Eu(),Ost=Fu(ttt),Pst=Fu(ttt),Mst=Ru(),Dst=Eu(),Nst=Fu(W9),Lst=Fu(W9),Bst=Ru(),Fst=Eu(),zst=Fu(K9),Ust=Fu(K9),kst=Ru(),Gst=Eu(),Hst=Fu(R6),Vst=Fu(R6),Wst=Ru(),jst=Eu(),qst=Fu(P6),Xst=Fu(P6),Yst=Ru(),Kst=Eu(),Zst=Fu(V9),Qst=Fu(V9),Jst=Ru(),$st=Eu(),tlt=Fu(X9),elt=Fu(X9),ilt=Ru(),nlt=Eu(),rlt=Fu(act),alt=Fu(act),olt=Ru(),slt=Eu(),llt=Fu(Zlt),clt=Ru(),hlt=Eu(),ult=Ru(),_lt=Eu(),iot(flt=not(flt=rot(flt=aot(flt=fu(($((dlt=function(t){function e(){var e;return J(e=t.call(this)||this,"startColor",plt,K(e)),J(e,"scaleSpace",mlt,K(e)),J(e,"startSize3D",vlt,K(e)),J(e,"startSizeX",glt,K(e)),J(e,"startSizeY",ylt,K(e)),J(e,"startSizeZ",Tlt,K(e)),J(e,"startSpeed",Slt,K(e)),J(e,"startRotation3D",Elt,K(e)),J(e,"startRotationX",Alt,K(e)),J(e,"startRotationY",blt,K(e)),J(e,"startRotationZ",xlt,K(e)),J(e,"startDelay",Clt,K(e)),J(e,"startLifetime",wlt,K(e)),J(e,"duration",Rlt,K(e)),J(e,"loop",Ilt,K(e)),J(e,"simulationSpeed",Olt,K(e)),J(e,"playOnAwake",Plt,K(e)),J(e,"gravityModifier",Mlt,K(e)),J(e,"rateOverTime",Dlt,K(e)),J(e,"rateOverDistance",Nlt,K(e)),J(e,"bursts",Llt,K(e)),J(e,"_colorOverLifetimeModule",Blt,K(e)),J(e,"_shapeModule",Flt,K(e)),J(e,"_sizeOvertimeModule",zlt,K(e)),J(e,"_velocityOvertimeModule",Ult,K(e)),J(e,"_forceOvertimeModule",klt,K(e)),J(e,"_limitVelocityOvertimeModule",Glt,K(e)),J(e,"_rotationOvertimeModule",Hlt,K(e)),J(e,"_textureAnimationModule",Vlt,K(e)),J(e,"_trailModule",Wlt,K(e)),J(e,"renderer",jlt,K(e)),J(e,"enableCulling",qlt,K(e)),e._isPlaying=void 0,e._isPaused=void 0,e._isStopped=void 0,e._isEmitting=void 0,e._time=void 0,e._emitRateTimeCounter=void 0,e._emitRateDistanceCounter=void 0,e._oldWPos=void 0,e._curWPos=void 0,e._customData1=void 0,e._customData2=void 0,e._subEmitters=void 0,J(e,"_prewarm",Xlt,K(e)),J(e,"_capacity",Ylt,K(e)),J(e,"_simulationSpace",Klt,K(e)),e.processor=null,e.rateOverTime.constant=10,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e._isPlaying=!1,e._isPaused=!1,e._isStopped=!0,e._isEmitting=!1,e._time=0,e._emitRateTimeCounter=0,e._emitRateDistanceCounter=0,e._oldWPos=new Ri,e._curWPos=new Ri,e._customData1=new Xi,e._customData2=new Xi,e._subEmitters=[],e}Y(e,t),q(e,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t),this.processor&&this.processor._model&&this.processor._model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"sharedMaterials",get:function(){return lct.get.call(this)},set:function(t){lct.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}}]);var i=e.prototype;return i.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()},i._onMaterialModified=function(t,e){this.processor.onMaterialModified(t,e)},i._onRebuildPSO=function(t,e){this.processor.onRebuildPSO(t,e)},i._collectModels=function(){return this._models.length=0,this._models.push(this.processor._model),this._trailModule&&this._trailModule.enable&&this._trailModule._trailModel&&this._models.push(this._trailModule._trailModel),this._models},i._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},i._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()},i.bindModule=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor)},i.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem(),this._trailModule&&this._trailModule.play()},i.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},i.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0},i.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear())},i.getParticleCount=function(){return this.processor.getParticleCount()},i.setCustomData1=function(t,e){Xi.set(this._customData1,t,e)},i.setCustomData2=function(t,e){Xi.set(this._customData2,t,e)},i.onDestroy=function(){n.director.off(n.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy()},i.onEnable=function(){n.director.on(n.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},i.onDisable=function(){n.director.off(n.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable()},i.update=function(t){var e=t*this.simulationSpeed;this._isPlaying&&(this._time+=e,this._emit(e),0!==this.processor.updateParticles(e)||this._isEmitting||this.stop()),this.processor.updateRenderData(),this._trailModule&&this._trailModule.enable&&this._trailModule.updateRenderData()},i.beforeRender=function(){this._isPlaying&&(this.processor.beforeRender(),this._trailModule&&this._trailModule.enable&&this._trailModule.beforeRender())},i._onVisibilityChange=function(t){this.processor._model&&(this.processor._model.visFlags=t)},i.emit=function(t,e){var i=this._time/this.duration;this._simulationSpace===a5.World&&(this.node.getWorldMatrix(oct),this.node.getWorldRotation(sct));for(var n=0;n<t;++n){var r=this.processor.getFreeParticle();if(null===r)return;var a=vi(mi(0,2147483647));this._shapeModule&&this._shapeModule.enable?this._shapeModule.emit(r):(Ri.set(r.position,0,0,0),Ri.copy(r.velocity,f5)),this._textureAnimationModule&&this._textureAnimationModule.enable&&this._textureAnimationModule.init(r),Ri.multiplyScalar(r.velocity,r.velocity,this.startSpeed.evaluate(i,a)),this._simulationSpace===a5.World&&(Ri.transformMat4(r.position,r.position,oct),Ri.transformQuat(r.velocity,r.velocity,sct)),Ri.copy(r.ultimateVelocity,r.velocity),this.startRotation3D?Ri.set(r.rotation,this.startRotationX.evaluate(i,a),this.startRotationY.evaluate(i,a),this.startRotationZ.evaluate(i,a)):Ri.set(r.rotation,0,0,this.startRotationZ.evaluate(i,a)),this.startSize3D?Ri.set(r.startSize,this.startSizeX.evaluate(i,a),this.startSizeY.evaluate(i,a),this.startSizeZ.evaluate(i,a)):(Ri.set(r.startSize,this.startSizeX.evaluate(i,a),1,1),r.startSize.y=r.startSize.x),Ri.copy(r.size,r.startSize),r.startColor.set(this.startColor.evaluate(i,a)),r.color.set(r.startColor),r.startLifetime=this.startLifetime.evaluate(i,a)+e,r.remainingLifetime=r.startLifetime,r.randomSeed=mi(0,233280),this.processor.setNewParticle(r)}},i._prewarmSystem=function(){this.startDelay.mode=s4.Constant,this.startDelay.constant=0;for(var t=this.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)},i._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e){if(this._time>this.duration+e&&!this.loop)return void(this._isEmitting=!1);if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,this._emitRateTimeCounter>1&&this._isEmitting){var i=Math.floor(this._emitRateTimeCounter);this._emitRateTimeCounter-=i,this.emit(i,t)}this.node.getWorldPosition(this._curWPos);var n=Ri.distance(this._curWPos,this._oldWPos);if(Ri.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=n*this.rateOverDistance.evaluate(this._time/this.duration,1),this._emitRateDistanceCounter>1&&this._isEmitting){var r=Math.floor(this._emitRateDistanceCounter);this._emitRateDistanceCounter-=r,this.emit(r,t)}for(var a,o=Q(this.bursts);!(a=o()).done;)a.value.update(this,t)}},i._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),Ri.copy(this._curWPos,this._oldWPos)},i.addSubEmitter=function(t){this._subEmitters.push(t)},i.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},i.addBurst=function(t){this.bursts.push(t)},i.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},i._onBeforeSerialize=function(t){var e=this;return this.enableCulling?t.filter((function(t){return!n5.includes(t)||e[t]&&e[t].enable})):t},q(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),e}(YP)).prototype,"capacity",[oot,sot],Object.getOwnPropertyDescriptor(dlt.prototype,"capacity"),dlt.prototype),plt=$(dlt.prototype,"startColor",[lot,cu,cot,hot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new m3}}),mlt=$(dlt.prototype,"scaleSpace",[uot,cu,_ot,fot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a5.Local}}),vlt=$(dlt.prototype,"startSize3D",[cu,dot,pot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),glt=$(dlt.prototype,"startSizeX",[mot,vot,got,yot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),ylt=$(dlt.prototype,"startSizeY",[Tot,cu,Sot,Eot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Tlt=$(dlt.prototype,"startSizeZ",[Aot,cu,bot,xot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Slt=$(dlt.prototype,"startSpeed",[Cot,cu,wot,Rot,Iot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Elt=$(dlt.prototype,"startRotation3D",[cu,Oot,Pot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Alt=$(dlt.prototype,"startRotationX",[Mot,cu,Dot,Ou,Not,Lot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),blt=$(dlt.prototype,"startRotationY",[Bot,cu,Fot,Ou,zot,Uot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),xlt=$(dlt.prototype,"startRotationZ",[kot,Got,Hot,Ou,Vot,Wot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Clt=$(dlt.prototype,"startDelay",[jot,cu,qot,Xot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),wlt=$(dlt.prototype,"startLifetime",[Yot,cu,Kot,Zot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Rlt=$(dlt.prototype,"duration",[cu,Qot,Jot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Ilt=$(dlt.prototype,"loop",[cu,$ot,tst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$(dlt.prototype,"prewarm",[est,ist],Object.getOwnPropertyDescriptor(dlt.prototype,"prewarm"),dlt.prototype),$(dlt.prototype,"simulationSpace",[nst,cu,rst,ast],Object.getOwnPropertyDescriptor(dlt.prototype,"simulationSpace"),dlt.prototype),Olt=$(dlt.prototype,"simulationSpeed",[cu,ost,sst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Plt=$(dlt.prototype,"playOnAwake",[cu,lst,cst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mlt=$(dlt.prototype,"gravityModifier",[hst,cu,ust,_st,fst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Dlt=$(dlt.prototype,"rateOverTime",[dst,cu,pst,mst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Nlt=$(dlt.prototype,"rateOverDistance",[vst,cu,gst,yst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l4}}),Llt=$(dlt.prototype,"bursts",[Tst,cu,Sst,Est],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$(dlt.prototype,"sharedMaterials",[zu,Ast,bst,cu,xst],Object.getOwnPropertyDescriptor(dlt.prototype,"sharedMaterials"),dlt.prototype),Blt=$(dlt.prototype,"_colorOverLifetimeModule",[Cst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"colorOverLifetimeModule",[wst,Rst,Ist],Object.getOwnPropertyDescriptor(dlt.prototype,"colorOverLifetimeModule"),dlt.prototype),Flt=$(dlt.prototype,"_shapeModule",[Ost],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"shapeModule",[Pst,Mst,Dst],Object.getOwnPropertyDescriptor(dlt.prototype,"shapeModule"),dlt.prototype),zlt=$(dlt.prototype,"_sizeOvertimeModule",[Nst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"sizeOvertimeModule",[Lst,Bst,Fst],Object.getOwnPropertyDescriptor(dlt.prototype,"sizeOvertimeModule"),dlt.prototype),Ult=$(dlt.prototype,"_velocityOvertimeModule",[zst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"velocityOvertimeModule",[Ust,kst,Gst],Object.getOwnPropertyDescriptor(dlt.prototype,"velocityOvertimeModule"),dlt.prototype),klt=$(dlt.prototype,"_forceOvertimeModule",[Hst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"forceOvertimeModule",[Vst,Wst,jst],Object.getOwnPropertyDescriptor(dlt.prototype,"forceOvertimeModule"),dlt.prototype),Glt=$(dlt.prototype,"_limitVelocityOvertimeModule",[qst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"limitVelocityOvertimeModule",[Xst,Yst,Kst],Object.getOwnPropertyDescriptor(dlt.prototype,"limitVelocityOvertimeModule"),dlt.prototype),Hlt=$(dlt.prototype,"_rotationOvertimeModule",[Zst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"rotationOvertimeModule",[Qst,Jst,$st],Object.getOwnPropertyDescriptor(dlt.prototype,"rotationOvertimeModule"),dlt.prototype),Vlt=$(dlt.prototype,"_textureAnimationModule",[tlt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"textureAnimationModule",[elt,ilt,nlt],Object.getOwnPropertyDescriptor(dlt.prototype,"textureAnimationModule"),dlt.prototype),Wlt=$(dlt.prototype,"_trailModule",[rlt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$(dlt.prototype,"trailModule",[alt,olt,slt],Object.getOwnPropertyDescriptor(dlt.prototype,"trailModule"),dlt.prototype),jlt=$(dlt.prototype,"renderer",[llt,cu,clt,hlt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Zlt}}),qlt=$(dlt.prototype,"enableCulling",[cu,ult,_lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xlt=$(dlt.prototype,"_prewarm",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ylt=$(dlt.prototype,"_capacity",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Klt=$(dlt.prototype,"_simulationSpace",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a5.Local}}),flt=dlt))||flt)||flt)||flt)||flt)||flt)),hct=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){return this.registeredSceneEvent||(BR.on(LR.EVENT_BEFORE_SCENE_LAUNCH,this.onSceneUnload,this),this.registeredSceneEvent=!0),this.particleSystemPool.has(t._uuid)||this.particleSystemPool.set(t._uuid,new u_((function(){return Jb(t)||new wA}),1)),this.particleSystemPool.get(t._uuid).alloc()},t.destroy=function(t){this.particleSystemPool.has(t._prefab.asset._uuid)&&(this.stop(t),this.particleSystemPool.get(t._prefab.asset._uuid).free(t))},t.play=function(t){for(var e,i=Q(t.getComponentsInChildren(cct));!(e=i()).done;)e.value.play()},t.stop=function(t){for(var e,i=Q(t.getComponentsInChildren(cct));!(e=i()).done;)e.value.stop()},t.onSceneUnload=function(){this.particleSystemPool.forEach((function(t){t.destroy((function(t){t.destroy()}))})),this.particleSystemPool.clear()},t}());hct.particleSystemPool=new Map,hct.registeredSceneEvent=!1,ct(Z9.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),n.ParticleSystemComponent=cct,le.setClassAlias(cct,"cc.ParticleSystemComponent"),n.BillboardComponent=i4,le.setClassAlias(i4,"cc.BillboardComponent"),n.LineComponent=t5,le.setClassAlias(t5,"cc.LineComponent"),n.ParticleUtils=hct;var uct,_ct=function(){function t(t,e,i){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=i}q(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]);var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,i=t.isInteger,n=e?this._averageValue:this._value;return i?Math.round(n):Math.round(100*n)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},t}(),fct=ru("cc.PerfCounter")(uct=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this)._time=void 0,r._time=n,r}Y(e,t);var i=e.prototype;return i.start=function(t){void 0===t&&(t=0),this._time=t},i.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},i.tick=function(){this.end(),this.start()},i.frame=function(t){var e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))},e}(_ct))||uct,dct={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},pct={fps:{desc:"Framerate (FPS)",below:30,average:500,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:500},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:500},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},mct=t("Profiler",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new ns,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(pct).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),n.game.off(n.Game.EVENT_RESTART,this.generateNode,this),n.director.off(n.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),n.director.off(n.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),n.director.off(n.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),n.director.off(n.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),n.director.off(n.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),n.director.off(n.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1)},e.showStats=function(){this._showFPS||(this._device||(this._device=n.director.root.device),this.generateCanvas(),this.generateStats(),n.game.once(n.Game.EVENT_ENGINE_INITED,this.generateNode,this),n.game.on(n.Game.EVENT_RESTART,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),n.director.on(n.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),n.director.on(n.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),n.director.on(n.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),n.director.on(n.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),n.director.on(n.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),n.director.on(n.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0)},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new Cs(io.TEX2D,no.SAMPLED|no.TRANSFER_DST,ka.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var i in pct){var n=pct[i];this._ctx.fillText(n.desc,0,e*this._lineHeight),n.counter=new fct(i,n,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var r=0;r<"0123456789. ".length;++r){var a=this._ctx.measureText("0123456789. "[r]).width;this._eachNumWidth=Math.max(this._eachNumWidth,a)}for(var o=0;o<"0123456789. ".length;++o)this._ctx.fillText("0123456789. "[o],o*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=pct,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new wA("PROFILER_NODE"),n.game.addPersistRootNode(this._rootNode);var t=new wA("Profiler_Camera");t.setPosition(0,0,1.5),t.parent=this._rootNode;var e=t.addComponent("cc.Camera");e.projection=zP.ProjectionType.ORTHO,e.orthoHeight=1,e.near=1,e.far=2,e.visibility=Fc.BitMask.PROFILER,e.clearFlags=vo.NONE,e.priority=4294967295;var i=new wA("Profiler_Root");i.parent=this._rootNode;for(var r=.4/this._totalLines,a=.4/this._wordHeight,o=r/23,s=this._eachNumWidth*this._canvas.width*o,l=[0,.4,0,a,.4,0,a,0,0,0,0,0],c=[0,2,1,0,3,2],h=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],u=0,_=0;_<this._totalLines;_++)for(var f=0;f<8;f++){l.push(a+f*s,.4-_*r,0),l.push(a+(f+1)*s,.4-_*r,0),l.push(a+(f+1)*s,.4-(_+1)*r,0),l.push(a+f*s,.4-(_+1)*r,0),u=4*(8*_+f+1),c.push(0+u,2+u,1+u,0+u,3+u,2+u);var d=8*_+f,p=Math.floor(d/4),m=d-4*p;h.push(0,this._wordHeight,p,m),h.push(this._eachNumWidth,this._wordHeight,p,m),h.push(this._eachNumWidth,1,p,m),h.push(0,1,p,m)}var v=i.addComponent(qtt);v.mesh=l2({positions:l,indices:c,colors:h});var g=new nm;g.initialize({effectName:"profiler"});var y=this.pass=g.passes[0],T=y.getBinding("mainTexture"),S=y.getBinding("digits"),E=y.getBinding("offset");y.bindTexture(T,this._texture),this.digitsData=y.blocks[S],this.offsetData=y.blocks[E],this.offsetData[3]=-1,v.material=g,v.node.layer=Fc.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.end(t),this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();n.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats){var t=this._device,e=t.screenSpaceSignY,i=t.surfaceTransform;if(i!==this.offsetData[3]){var n=Hi[i],r=-.9*e;this.offsetData[0]=-.9*n[0]+r*n[2],this.offsetData[1]=-.9*n[1]+r*n[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=i}this.pass._rootBufferDirty=!0;var a=performance.now();this._stats.render.counter.start(a)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<500)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var i=0,n=this.digitsData;for(var r in this._stats){var a=this._stats[r];a.counter.sample(t);for(var o=a.counter.human().toString(),s=7;s>=0;s--){var l=8*i+s,c=o[o.length-(8-s)],h=dct[c];void 0===h&&(h=11),n[l]=h}i++}}}},t}()),vct=t("profiler",new mct);n.profiler=vct;var gct,yct,Tct,Sct,Ect=he({GRAVITY:0,RADIUS:1}),Act=he({FREE:0,RELATIVE:1,GROUPED:2}),bct=new Xi(0,0),xct=new Xi,Cct=new Xi,wct=new Xi,Rct=new Xi,Ict=pU(fU),Oct=function(){this.pos=new Xi(0,0),this.startPos=new Xi(0,0),this.color=new Ci(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Xi(0,0),this.aspectRatio=1,this.dir=new Xi(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},Pct=new(function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.get=function(){return this._get()||new Oct},e}(oe))((function(t){t.pos.set(bct),t.startPos.set(bct),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(bct),t.aspectRatio=1,t.dir.set(bct),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),Mct=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)Pct.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,i=Pct.get();this.particles.push(i),i.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var n=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,i.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var r,a,o,s,l=e.startColor,c=e.startColorVar,h=e.endColor,u=e.endColorVar;i.color.r=r=we(l.r+c.r*(Math.random()-.5)*2,0,255),i.color.g=a=we(l.g+c.g*(Math.random()-.5)*2,0,255),i.color.b=o=we(l.b+c.b*(Math.random()-.5)*2,0,255),i.color.a=s=we(l.a+c.a*(Math.random()-.5)*2,0,255),i.deltaColor.r=(we(h.r+u.r*(Math.random()-.5)*2,0,255)-r)/n,i.deltaColor.g=(we(h.g+u.g*(Math.random()-.5)*2,0,255)-a)/n,i.deltaColor.b=(we(h.b+u.b*(Math.random()-.5)*2,0,255)-o)/n,i.deltaColor.a=(we(h.a+u.a*(Math.random()-.5)*2,0,255)-s)/n;var _=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(_=Math.max(0,_),i.size=_,-1===e.endSize)i.deltaSize=0;else{var f=e.endSize+e.endSizeVar*(Math.random()-.5)*2;f=Math.max(0,f),i.deltaSize=(f-_)/n}var d=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,p=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;i.rotation=d,i.deltaRotation=(p-d)/n,i.startPos.x=t.x,i.startPos.y=t.y,i.aspectRatio=e.aspectRatio||1;var m=Re(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===Ect.GRAVITY){var v=e.speed+e.speedVar*(Math.random()-.5)*2;i.dir.x=Math.cos(m),i.dir.y=Math.sin(m),i.dir.multiplyScalar(v),i.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(i.rotation=-Ie(Math.atan2(i.dir.y,i.dir.x)))}else{var g=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,y=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;i.radius=g,i.deltaRadius=-1===e.endRadius?0:(y-g)/n,i.angle=m,i.degreesPerSecond=Re(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var i=e.vData,n=this.sys._renderSpriteFrame.uv,r=t?0:this.uvFilled,a=this.particles.length,o=r;o<a;o++){var s=o*Ict*4;i[s+3]=n[0],i[s+4]=n[1],i[s+12]=n[2],i[s+13]=n[3],i[s+21]=n[4],i[s+22]=n[5],i[s+30]=n[6],i[s+31]=n[7]}this.uvFilled=a}},e.updateParticleBuffer=function(t,e,i,n){var r=i.vData,a=e.x,o=e.y,s=t.size,l=s,c=t.aspectRatio;c>1?l=s/c:s=l*c;var h=s/2,u=l/2;if(t.rotation){var _=-h,f=-u,d=h,p=u,m=-Re(t.rotation),v=Math.cos(m),g=Math.sin(m);r[n]=_*v-f*g+a,r[n+1]=_*g+f*v+o,r[n+2]=0,r[n+9]=d*v-f*g+a,r[n+10]=d*g+f*v+o,r[n+11]=0,r[n+18]=_*v-p*g+a,r[n+19]=_*g+p*v+o,r[n+20]=0,r[n+27]=d*v-p*g+a,r[n+28]=d*g+p*v+o,r[n+29]=0}else r[n]=a-h,r[n+1]=o-u,r[n+2]=0,r[n+9]=a+h,r[n+10]=o-u,r[n+11]=0,r[n+18]=a-h,r[n+19]=o+u,r[n+20]=0,r[n+27]=a+h,r[n+28]=o+u,r[n+29]=0;Ci.toArray(r,t.color,n+5),Ci.toArray(r,t.color,n+14),Ci.toArray(r,t.color,n+23),Ci.toArray(r,t.color,n+32)},e.step=function(t){var e=this.sys.assembler,i=this.sys,n=i.node,r=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,n.updateWorldTransform(),i.positionType===Act.FREE){this._worldRotation=function(t){for(var e=0,i=t;i;)e+=i.eulerAngles.z,i=i.parent;return e}(n);var a=n.worldMatrix;xct.x=a.m12,xct.y=a.m13}else i.positionType===Act.RELATIVE?(this._worldRotation=n.eulerAngles.z,xct.x=n.position.x,xct.y=n.position.y):this._worldRotation=0;if(this.active&&i.emissionRate){var o=1/i.emissionRate;for(r.length<i.totalParticles&&(this.emitCounter+=t);r.length<i.totalParticles&&this.emitCounter>o;)this.emitParticle(xct),this.emitCounter-=o;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}var s=this.renderData,l=r.length;s.reset(),this.requestData(4*l,6*l),l>this.uvFilled&&this.updateUVs();for(var c=0;c<r.length;){Cct.x=Cct.y=wct.x=wct.y=Rct.x=Rct.y=0;var h=r[c];if(h.timeToLive-=t,h.timeToLive>0){if(i.emitterMode===Ect.GRAVITY){var u=Rct,_=Cct,f=wct;(h.pos.x||h.pos.y)&&(_.set(h.pos),_.normalize()),f.set(_),_.multiplyScalar(h.radialAccel);var d=f.x;f.x=-f.y,f.y=d,f.multiplyScalar(h.tangentialAccel),u.set(_),u.add(f),u.add(i.gravity),u.multiplyScalar(t),h.dir.add(u),u.set(h.dir),u.multiplyScalar(t),h.pos.add(u)}else h.angle+=h.degreesPerSecond*t,h.radius+=h.deltaRadius*t,h.pos.x=-Math.cos(h.angle)*h.radius,h.pos.y=-Math.sin(h.angle)*h.radius;h.color.r+=h.deltaColor.r*t,h.color.g+=h.deltaColor.g*t,h.color.b+=h.deltaColor.b*t,h.color.a+=h.deltaColor.a*t,h.size+=h.deltaSize*t,h.size<0&&(h.size=0),h.rotation+=h.deltaRotation*t;var p=Cct;p.set(h.pos),i.positionType!==Act.GROUPED&&p.add(h.startPos);var m=Ict*c*4;this.updateParticleBuffer(h,p,s,m),++c}else{var v=r[c];c!==r.length-1&&(r[c]=r[r.length-1]),Pct.put(v),r.length--,s.indicesCount-=6,s.vertexCount-=4}}0!==r.length||this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())},e.requestData=function(t,e){var i=this.renderData.indicesCount;this.renderData.request(t,e);for(var n=this.renderData.indicesCount/6,r=this.renderData.iData,a=i;a<n;a++){var o=4*a;r[i++]=o,r[i++]=o+1,r[i++]=o+2,r[i++]=o+1,r[i++]=o+3,r[i++]=o+2}},t}(),Dct=t("ParticleAsset",ru("cc.ParticleAsset")((Sct=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"spriteFrame",Tct,K(e)),e}return Y(e,t),e}(M_),Tct=$((yct=Sct).prototype,"spriteFrame",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gct=yct))||gct);n.ParticleAsset=Dct;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var Nct={};(function(){function t(t){throw t}var e=void 0,i=!0,n=this;function r(t,i){var r,a=t.split("."),o=n;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(r=a.shift());)a.length||i===e?o=o[r]?o[r]:o[r]={}:o[r]=i}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function o(t){if("string"==typeof t){var e,i,n=t.split("");for(e=0,i=n.length;e<i;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;t=n}for(var r,a=1,o=0,s=t.length,l=0;0<s;){s-=r=1024<s?1024:s;do{o+=a+=t[l++]}while(--r);a%=65521,o%=65521}return(o<<16|a)>>>0}function s(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(a?Uint8Array:Array)(i<<1);if(a)n.set(e);else for(t=0;t<i;++t)n[t]=e[t];return this.buffer=n},s.prototype.d=function(t,e,i){var n,r=this.buffer,a=this.index,o=this.i,s=r[a];if(i&&1<e&&(t=8<e?(f[255&t]<<24|f[t>>>8&255]<<16|f[t>>>16&255]<<8|f[t>>>24&255])>>32-e:f[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(n=0;n<e;++n)s=s<<1|t>>e-n-1&1,8==++o&&(o=0,r[a++]=f[s],s=0,a===r.length&&(r=this.f()));r[a]=s,this.buffer=r,this.i=o,this.index=a},s.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=f[e[i]],i++),a?t=e.subarray(0,i):(e.length=i,t=e),t};var l,c=new(a?Uint8Array:Array)(256);for(l=0;256>l;++l){for(var h=_=l,u=7,_=_>>>1;_;_>>>=1)h<<=1,h|=1&_,--u;c[l]=(h<<u&255)>>>0}var f=c;function d(t){this.buffer=new(a?Uint16Array:Array)(2*t),this.length=0}function p(t){var e,i,n,r,o,s,l,c,h,u=t.length,_=0,f=Number.POSITIVE_INFINITY;for(c=0;c<u;++c)t[c]>_&&(_=t[c]),t[c]<f&&(f=t[c]);for(e=1<<_,i=new(a?Uint32Array:Array)(e),n=1,r=0,o=2;n<=_;){for(c=0;c<u;++c)if(t[c]===n){for(s=0,l=r,h=0;h<n;++h)s=s<<1|1&l,l>>=1;for(h=s;h<e;h+=o)i[h]=n<<16|c;++r}++n,r<<=1,o<<=1}return[i,_,f]}function m(t,e){this.h=g,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=a&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}d.prototype.getParent=function(t){return 2*((t-2)/4|0)},d.prototype.push=function(t,e){var i,n,r,a=this.buffer;for(i=this.length,a[this.length++]=e,a[this.length++]=t;0<i&&(n=this.getParent(i),a[i]>a[n]);)r=a[i],a[i]=a[n],a[n]=r,r=a[i+1],a[i+1]=a[n+1],a[n+1]=r,i=n;return this.length},d.prototype.pop=function(){var t,e,i,n,r,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],r=0;!((n=2*r+2)>=this.length)&&(n+2<this.length&&a[n+2]>a[n]&&(n+=2),a[n]>a[r]);)i=a[r],a[r]=a[n],a[n]=i,i=a[r+1],a[r+1]=a[n+1],a[n+1]=i,r=n;return{index:t,value:e,length:this.length}};var v,g=2,y={NONE:0,r:1,j:g,N:3},T=[];for(v=0;288>v;v++)switch(!0){case 143>=v:T.push([v+48,8]);break;case 255>=v:T.push([v-144+400,9]);break;case 279>=v:T.push([v-256+0,7]);break;case 287>=v:T.push([v-280+192,8]);break;default:t("invalid literal: "+v)}function S(t,e){this.length=t,this.G=e}function E(){var e=A;switch(!0){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}m.prototype.n=function(){var n,r,o,l,c=this.input;switch(this.h){case 0:for(o=0,l=c.length;o<l;){var h,u,_,f=r=a?c.subarray(o,o+65535):c.slice(o,o+65535),d=(o+=r.length)===l,p=e,m=e,v=this.a,y=this.b;if(a){for(v=new Uint8Array(this.a.buffer);v.length<=y+f.length+5;)v=new Uint8Array(v.length<<1);v.set(this.a)}if(h=d?1:0,v[y++]=0|h,_=65536+~(u=f.length)&65535,v[y++]=255&u,v[y++]=u>>>8&255,v[y++]=255&_,v[y++]=_>>>8&255,a)v.set(f,y),y+=f.length,v=v.subarray(0,y);else{for(p=0,m=f.length;p<m;++p)v[y++]=f[p];v.length=y}this.b=y,this.a=v}break;case 1:var S=new s(new Uint8Array(this.a.buffer),this.b);S.d(1,1,i),S.d(1,2,i);var E,A,b,x=w(this,c);for(E=0,A=x.length;E<A;E++)if(b=x[E],s.prototype.d.apply(S,T[b]),256<b)S.d(x[++E],x[++E],i),S.d(x[++E],5),S.d(x[++E],x[++E],i);else if(256===b)break;this.a=S.finish(),this.b=this.a.length;break;case g:var C,O,P,M,D,N,L,B,F,z,U,k,G,H,V,W=new s(new Uint8Array(this.a),this.b),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(C=g,W.d(1,1,i),W.d(C,2,i),O=w(this,c),L=I(N=R(this.L,15)),F=I(B=R(this.K,7)),P=286;257<P&&0===N[P-1];P--);for(M=30;1<M&&0===B[M-1];M--);var X,Y,K,Z,Q,J,$=P,tt=M,et=new(a?Uint32Array:Array)($+tt),it=new(a?Uint32Array:Array)(316),nt=new(a?Uint8Array:Array)(19);for(X=Y=0;X<$;X++)et[Y++]=N[X];for(X=0;X<tt;X++)et[Y++]=B[X];if(!a)for(X=0,Z=nt.length;X<Z;++X)nt[X]=0;for(X=Q=0,Z=et.length;X<Z;X+=Y){for(Y=1;X+Y<Z&&et[X+Y]===et[X];++Y);if(K=Y,0===et[X])if(3>K)for(;0<K--;)it[Q++]=0,nt[0]++;else for(;0<K;)(J=138>K?K:138)>K-3&&J<K&&(J=K-3),10>=J?(it[Q++]=17,it[Q++]=J-3,nt[17]++):(it[Q++]=18,it[Q++]=J-11,nt[18]++),K-=J;else if(it[Q++]=et[X],nt[et[X]]++,3>--K)for(;0<K--;)it[Q++]=et[X],nt[et[X]]++;else for(;0<K;)(J=6>K?K:6)>K-3&&J<K&&(J=K-3),it[Q++]=16,it[Q++]=J-3,nt[16]++,K-=J}for(n=a?it.subarray(0,Q):it.slice(0,Q),z=R(nt,7),H=0;19>H;H++)q[H]=z[j[H]];for(D=19;4<D&&0===q[D-1];D--);for(U=I(z),W.d(P-257,5,i),W.d(M-1,5,i),W.d(D-4,4,i),H=0;H<D;H++)W.d(q[H],3,i);for(H=0,V=n.length;H<V;H++)if(k=n[H],W.d(U[k],z[k],i),16<=k){switch(H++,k){case 16:G=2;break;case 17:G=3;break;case 18:G=7;break;default:t("invalid code: "+k)}W.d(n[H],G,i)}var rt,at,ot,st,lt,ct,ht,ut,_t=[L,N],ft=[F,B];for(lt=_t[0],ct=_t[1],ht=ft[0],ut=ft[1],rt=0,at=O.length;rt<at;++rt)if(ot=O[rt],W.d(lt[ot],ct[ot],i),256<ot)W.d(O[++rt],O[++rt],i),st=O[++rt],W.d(ht[st],ut[st],i),W.d(O[++rt],O[++rt],i);else if(256===ot)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var A,b,x=[];for(A=3;258>=A;A++)b=E(),x[A]=b[2]<<24|b[1]<<16|b[0];var C=a?new Uint32Array(x):x;function w(i,n){function r(e,i){var n,r,a,o,s=e.G,l=[],c=0;switch(n=C[e.length],l[c++]=65535&n,l[c++]=n>>16&255,l[c++]=n>>24,!0){case 1===s:r=[0,s-1,0];break;case 2===s:r=[1,s-2,0];break;case 3===s:r=[2,s-3,0];break;case 4===s:r=[3,s-4,0];break;case 6>=s:r=[4,s-5,1];break;case 8>=s:r=[5,s-7,1];break;case 12>=s:r=[6,s-9,2];break;case 16>=s:r=[7,s-13,2];break;case 24>=s:r=[8,s-17,3];break;case 32>=s:r=[9,s-25,3];break;case 48>=s:r=[10,s-33,4];break;case 64>=s:r=[11,s-49,4];break;case 96>=s:r=[12,s-65,5];break;case 128>=s:r=[13,s-97,5];break;case 192>=s:r=[14,s-129,6];break;case 256>=s:r=[15,s-193,6];break;case 384>=s:r=[16,s-257,7];break;case 512>=s:r=[17,s-385,7];break;case 768>=s:r=[18,s-513,8];break;case 1024>=s:r=[19,s-769,8];break;case 1536>=s:r=[20,s-1025,9];break;case 2048>=s:r=[21,s-1537,9];break;case 3072>=s:r=[22,s-2049,10];break;case 4096>=s:r=[23,s-3073,10];break;case 6144>=s:r=[24,s-4097,11];break;case 8192>=s:r=[25,s-6145,11];break;case 12288>=s:r=[26,s-8193,12];break;case 16384>=s:r=[27,s-12289,12];break;case 24576>=s:r=[28,s-16385,13];break;case 32768>=s:r=[29,s-24577,13];break;default:t("invalid distance")}for(n=r,l[c++]=n[0],l[c++]=n[1],l[c++]=n[2],a=0,o=l.length;a<o;++a)m[v++]=l[a];y[l[0]]++,T[l[3]]++,g=e.length+i-1,f=null}var o,s,l,c,h,u,_,f,d,p={},m=a?new Uint16Array(2*n.length):[],v=0,g=0,y=new(a?Uint32Array:Array)(286),T=new(a?Uint32Array:Array)(30),E=i.w;if(!a){for(l=0;285>=l;)y[l++]=0;for(l=0;29>=l;)T[l++]=0}for(y[256]=1,o=0,s=n.length;o<s;++o){for(l=h=0,c=3;l<c&&o+l!==s;++l)h=h<<8|n[o+l];if(p[h]===e&&(p[h]=[]),u=p[h],!(0<g--)){for(;0<u.length&&32768<o-u[0];)u.shift();if(o+3>=s){for(f&&r(f,-1),l=0,c=s-o;l<c;++l)d=n[o+l],m[v++]=d,++y[d];break}if(0<u.length){var A=e,b=e,x=0,w=e,R=e,I=e,O=n.length,P=(R=0,u.length);t:for(;R<P;R++){if(A=u[P-R-1],w=3,3<x){for(I=x;3<I;I--)if(n[A+I-1]!==n[o+I-1])continue t;w=x}for(;258>w&&o+w<O&&n[A+w]===n[o+w];)++w;if(w>x&&(b=A,x=w),258===w)break}_=new S(x,o-b),f?f.length<_.length?(d=n[o-1],m[v++]=d,++y[d],r(_,0)):r(f,-1):_.length<E?f=_:r(_,0)}else f?r(f,-1):(d=n[o],m[v++]=d,++y[d])}u.push(o)}return m[v++]=256,y[256]++,i.L=y,i.K=T,a?m.subarray(0,v):m}function R(t,e){function i(t){var e=A[t][b[t]];e===g?(i(t+1),i(t+1)):--S[e],++b[t]}var n,r,o,s,l,c=t.length,h=new d(572),u=new(a?Uint8Array:Array)(c);if(!a)for(s=0;s<c;s++)u[s]=0;for(s=0;s<c;++s)0<t[s]&&h.push(s,t[s]);if(n=Array(h.length/2),r=new(a?Uint32Array:Array)(h.length/2),1===n.length)return u[h.pop().index]=1,u;for(s=0,l=h.length/2;s<l;++s)n[s]=h.pop(),r[s]=n[s].value;var _,f,p,m,v,g=r.length,y=new(a?Uint16Array:Array)(e),T=new(a?Uint8Array:Array)(e),S=new(a?Uint8Array:Array)(g),E=Array(e),A=Array(e),b=Array(e),x=(1<<e)-g,C=1<<e-1;for(y[e-1]=g,f=0;f<e;++f)x<C?T[f]=0:(T[f]=1,x-=C),x<<=1,y[e-2-f]=(y[e-1-f]/2|0)+g;for(y[0]=T[0],E[0]=Array(y[0]),A[0]=Array(y[0]),f=1;f<e;++f)y[f]>2*y[f-1]+T[f]&&(y[f]=2*y[f-1]+T[f]),E[f]=Array(y[f]),A[f]=Array(y[f]);for(_=0;_<g;++_)S[_]=e;for(p=0;p<y[e-1];++p)E[e-1][p]=r[p],A[e-1][p]=p;for(_=0;_<e;++_)b[_]=0;for(1===T[e-1]&&(--S[0],++b[e-1]),f=e-2;0<=f;--f){for(m=_=0,v=b[f+1],p=0;p<y[f];p++)(m=E[f+1][v]+E[f+1][v+1])>r[_]?(E[f][p]=m,A[f][p]=g,v+=2):(E[f][p]=r[_],A[f][p]=_,++_);b[f]=0,1===T[f]&&i(f)}for(o=S,s=0,l=n.length;s<l;++s)u[n[s].index]=o[s];return u}function I(e){var i,n,r,o,s=new(a?Uint16Array:Array)(e.length),l=[],c=[],h=0;for(i=0,n=e.length;i<n;i++)l[e[i]]=1+(0|l[e[i]]);for(i=1,n=16;i<=n;i++)c[i]=h,(h+=0|l[i])>1<<i&&t("overcommitted"),h<<=1;for(65536>h&&t("undercommitted"),i=0,n=e.length;i<n;i++)for(h=c[e[i]],c[e[i]]+=1,r=s[i]=0,o=e[i];r<o;r++)s[i]=s[i]<<1|1&h,h>>>=1;return s}function O(t,e){this.input=t,this.a=new(a?Uint8Array:Array)(32768),this.h=P.j;var i,n={};for(i in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)n[i]=e[i];n.outputBuffer=this.a,this.z=new m(this.input,n)}var P=y;function M(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=a?new Uint8Array(e):e,this.s=!1,this.m=N,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case D:this.b=32768,this.a=new(a?Uint8Array:Array)(32768+this.l+258);break;case N:this.b=0,this.a=new(a?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}O.prototype.n=function(){var e,i,n,r,s,l,c,h=0;switch(c=this.a,e=ht){case ht:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(n=i<<4|e,c[h++]=n,e){case ht:switch(this.h){case P.NONE:s=0;break;case P.r:s=1;break;case P.j:s=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return r=s<<6|0,c[h++]=r|31-(256*n+r)%31,l=o(this.input),this.z.b=h,h=(c=this.z.n()).length,a&&((c=new Uint8Array(c.buffer)).length<=h+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,h+4)),c[h++]=l>>24&255,c[h++]=l>>16&255,c[h++]=l>>8&255,c[h++]=255&l,c},r("Zlib.Deflate",O),r("Zlib.Deflate.compress",(function(t,e){return new O(t,e).n()})),r("Zlib.Deflate.CompressionType",P),r("Zlib.Deflate.CompressionType.NONE",P.NONE),r("Zlib.Deflate.CompressionType.FIXED",P.r),r("Zlib.Deflate.CompressionType.DYNAMIC",P.j);var D=0,N=1,L={D:D,C:N};M.prototype.p=function(){for(;!this.s;){var n=tt(this,3);switch(1&n&&(this.s=i),n>>>=1){case 0:var r=this.input,o=this.c,s=this.a,l=this.b,c=e,h=e,u=e,_=s.length,f=e;switch(this.e=this.g=0,(c=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),h=c,(c=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),h|=c<<8,(c=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),u=c,(c=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),h===~(u|=c<<8)&&t(Error("invalid uncompressed block header: length verify")),o+h>r.length&&t(Error("input buffer is broken")),this.m){case D:for(;l+h>s.length;){if(h-=f=_-l,a)s.set(r.subarray(o,o+f),l),l+=f,o+=f;else for(;f--;)s[l++]=r[o++];this.b=l,s=this.f(),l=this.b}break;case N:for(;l+h>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(a)s.set(r.subarray(o,o+h),l),l+=h,o+=h;else for(;h--;)s[l++]=r[o++];this.c=o,this.b=l,this.a=s;break;case 1:this.o(Q,$);break;case 2:it(this);break;default:t(Error("unknown BTYPE: "+n))}}return this.t()};var B,F,z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],U=a?new Uint16Array(z):z,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=a?new Uint16Array(k):k,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],V=a?new Uint8Array(H):H,W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=a?new Uint16Array(W):W,q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],X=a?new Uint8Array(q):q,Y=new(a?Uint8Array:Array)(288);for(B=0,F=Y.length;B<F;++B)Y[B]=143>=B?8:255>=B?9:279>=B?7:8;var K,Z,Q=p(Y),J=new(a?Uint8Array:Array)(30);for(K=0,Z=J.length;K<Z;++K)J[K]=5;var $=p(J);function tt(i,n){for(var r,a=i.g,o=i.e,s=i.input,l=i.c;o<n;)(r=s[l++])===e&&t(Error("input buffer is broken")),a|=r<<o,o+=8;return r=a&(1<<n)-1,i.g=a>>>n,i.e=o-n,i.c=l,r}function et(i,n){for(var r,a,o,s=i.g,l=i.e,c=i.input,h=i.c,u=n[0],_=n[1];l<_;)(r=c[h++])===e&&t(Error("input buffer is broken")),s|=r<<l,l+=8;return o=(a=u[s&(1<<_)-1])>>>16,i.g=s>>o,i.e=l-o,i.c=h,65535&a}function it(t){function e(t,e,i){var n,r,a,o;for(o=0;o<t;)switch(n=et(this,e)){case 16:for(a=3+tt(this,2);a--;)i[o++]=r;break;case 17:for(a=3+tt(this,3);a--;)i[o++]=0;r=0;break;case 18:for(a=11+tt(this,7);a--;)i[o++]=0;r=0;break;default:r=i[o++]=n}return i}var i,n,r,o,s=tt(t,5)+257,l=tt(t,5)+1,c=tt(t,4)+4,h=new(a?Uint8Array:Array)(U.length);for(o=0;o<c;++o)h[U[o]]=tt(t,3);i=p(h),n=new(a?Uint8Array:Array)(s),r=new(a?Uint8Array:Array)(l),t.o(p(e.call(t,s,i,n)),p(e.call(t,l,i,r)))}function nt(e,i){var n,r;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),n=e[this.c++],r=e[this.c++],15&n){case ht:this.method=ht;break;default:t(Error("unsupported compression method"))}0!=((n<<8)+r)%31&&t(Error("invalid fcheck flag:"+((n<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new M(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}M.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,a,o,s,l=i.length-258;256!==(r=et(this,t));)if(256>r)n>=l&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(s=G[a=r-257],0<V[a]&&(s+=tt(this,V[a])),r=et(this,e),o=j[r],0<X[r]&&(o+=tt(this,X[r])),n>=l&&(this.b=n,i=this.f(),n=this.b);s--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},M.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,a,o,s,l=i.length;256!==(r=et(this,t));)if(256>r)n>=l&&(l=(i=this.f()).length),i[n++]=r;else for(s=G[a=r-257],0<V[a]&&(s+=tt(this,V[a])),r=et(this,e),o=j[r],0<X[r]&&(o+=tt(this,X[r])),n+s>l&&(l=(i=this.f()).length);s--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},M.prototype.f=function(){var t,e,i=new(a?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(a)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,a)r.set(r.subarray(n,n+32768));else for(t=0;32768>t;++t)r[t]=r[n+t];return this.b=32768,r},M.prototype.J=function(t){var e,i,n,r=this.input.length/this.c+1|0,o=this.input,s=this.a;return t&&("number"==typeof t.v&&(r=t.v),"number"==typeof t.F&&(r+=t.F)),i=2>r?(n=(o.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+n:s.length<<1:s.length*r,a?(e=new Uint8Array(i)).set(s):e=s,this.a=e},M.prototype.t=function(){var t,e,i,n,r,o=0,s=this.a,l=this.k,c=new(a?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return a?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=l.length;e<i;++e)for(n=0,r=(t=l[e]).length;n<r;++n)c[o++]=t[n];for(e=32768,i=this.b;e<i;++e)c[o++]=s[e];return this.k=[],this.buffer=c},M.prototype.H=function(){var t,e=this.b;return a?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},nt.prototype.p=function(){var e,i=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==o(e)&&t(Error("invalid adler-32 checksum")),e},r("Zlib.Inflate",nt),r("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,r("Zlib.Inflate.prototype.decompress",nt.prototype.p);var rt,at,ot=new(a?Uint8Array:Array)(288);for(rt=0,at=ot.length;rt<at;++rt)ot[rt]=143>=rt?8:255>=rt?9:279>=rt?7:8;p(ot);var st,lt,ct=new(a?Uint8Array:Array)(30);for(st=0,lt=ct.length;st<lt;++st)ct[st]=5;p(ct);var ht=8}).call(Nct);var Lct=Nct.Zlib;Lct.Deflate=Lct.Deflate,Lct.Deflate.compress=Lct.Deflate.compress,Lct.Inflate=Lct.Inflate,Lct.Inflate.BufferType=Lct.Inflate.BufferType,Lct.Inflate.prototype.decompress=Lct.Inflate.prototype.decompress;for(var Bct=function(){function t(t){var e,i=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var n=0,r=0,a=0;;){a=this.readUInt32();var o=function(){var t=[];for(n=0;n<4;++n)t.push(String.fromCharCode(i.data[i.pos++]));return t}.call(this).join("");switch(o){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var s=this.readUInt16(),l=this.readUInt16()||100;e.delay=1e3*s/l,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===o&&(this.pos+=4,a-=4),t=(null!=e?e.data:void 0)||this.imgData,n=0;a>=0?n<a:n>a;a>=0?++n:--n)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(a);var c=255-this.transparency.indexed.length;if(c>0)for(r=0;c>=0?r<c:r>c;c>=0?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":var h=this.read(a),u=h.indexOf(0),_=String.fromCharCode.apply(String,h.slice(0,u));this.text[_]=String.fromCharCode.apply(String,h.slice(u+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(i.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var f=this.colorType;this.hasAlphaChannel=4===f||6===f;var d=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*d,this.colorSpace=function(){switch(i.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error(R(6017))}}var e=t.prototype;return e.read=function(t){var e=0,i=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)i.push(this.data[this.pos++]);return i},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new Lct.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,i=e*this.width,n=new Uint8Array(i*this.height),r=t.length,a=0,o=0,s=0,l=0,c=0,h=0,u=0,_=0,f=0,d=0,p=0,m=0,v=0,g=0,y=0,T=0,S=0,E=0,A=0;o<r;){switch(t[o++]){case 0:for(h=u=0;u<i;h=u+=1)n[s++]=t[o++];break;case 1:for(h=_=0;_<i;h=_+=1)l=t[o++],m=h<e?0:n[s-e],n[s++]=(l+m)%256;break;case 2:for(h=f=0;f<i;h=f+=1)l=t[o++],c=(h-h%e)/e,E=a&&n[(a-1)*i+c*e+h%e],n[s++]=(E+l)%256;break;case 3:for(h=d=0;d<i;h=d+=1)l=t[o++],c=(h-h%e)/e,m=h<e?0:n[s-e],E=a&&n[(a-1)*i+c*e+h%e],n[s++]=(l+Math.floor((m+E)/2))%256;break;case 4:for(h=p=0;p<i;h=p+=1)l=t[o++],c=(h-h%e)/e,m=h<e?0:n[s-e],0===a?E=A=0:(E=n[(a-1)*i+c*e+h%e],A=c&&n[(a-1)*i+(c-1)*e+h%e]),v=m+E-A,g=Math.abs(v-m),T=Math.abs(v-E),S=Math.abs(v-A),y=g<=T&&g<=S?m:T<=S?E:A,n[s++]=(l+y)%256;break;default:throw new Error(R(6018,t[o-1]))}a++}return n},e.copyToImageData=function(t,e){var i,n=this.hasAlphaChannel,r=this.colors;this.palette.length&&(i=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),r=4,n=!0);var a=t.data||t,o=a.length,s=i||e,l=0,c=0,h=0,u=0;if(1===r)for(;l<o;)h=i?4*e[l/4]:c,u=s[h++],a[l++]=u,a[l++]=u,a[l++]=u,a[l++]=n?s[h++]:255,c=h;else for(;l<o;)h=i?4*e[l/4]:c,a[l++]=s[h++],a[l++]=s[h++],a[l++]=s[h++],a[l++]=n?s[h++]:255,c=h},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],i=new Uint8Array((e.length||0)+t.length),n=0,r=0,a=0,o=0,s=0,l=t.length;s<l;o=s+=3)i[n++]=t[o],i[n++]=t[o+1],i[n++]=t[o+2],a=e[r++],i[n++]=null!=a?a:255;return i},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),i=e.createImageData(this.width,this.height);return this.copyToImageData(i,this.decodePixels(null)),e.putImageData(i,0,0)},t}(),Fct=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(R(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(R(6020));return!0},e.getFieldTypeName=function(t){return t in Uct?Uct[t]:null},e.getFieldTagName=function(t){return t in zct?zct[t]:(T(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,i,n){var r=[],a=this.getFieldTypeLength(e);if(a*i<=4)!1===this._littleEndian?r.push(n>>>8*(4-a)):r.push(n);else for(var o=0;o<i;o++){var s=a*o;a>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(n+s)),r.push(this.getUint32(n+s+4))):T(8e3):r.push(this.getBytes(a,n+s))}return"ASCII"===e&&r.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),r},e.getBytes=function(t,e){if(t<=0)T(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);T(8002)}return 0},e.getBits=function(t,e,i){i=i||0;var n=e+Math.floor(i/8),r=i+t,a=32-t,o=0,s=0;return r<=0?T(6023):r<=8?(o=24+i,s=this.getUint8(n)):r<=16?(o=16+i,s=this.getUint16(n)):r<=32?(o=i,s=this.getUint32(n)):T(6022),{bits:s<<o>>>a,byteOffset:n+Math.floor(r/8),bitOffset:r%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),i=[],n=0,r=0;for(n=t+2,r=0;r<e;n+=12,r++){var a=this.getUint16(n),o=this.getUint16(n+2),s=this.getUint32(n+4),l=this.getUint32(n+8),c=this.getFieldTagName(a),h=this.getFieldTypeName(o),u=this.getFieldValues(c,h,s,l);i[c]={type:h,values:u}}this._fileDirectories.push(i);var _=this.getUint32(n);0!==_&&this.parseFileDirectory(_)},e.clampColorSample=function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},e.parseTIFF=function(t,e){var i=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var n=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(n);var r=this._fileDirectories[0],a=r.ImageWidth.values[0],o=r.ImageLength.values[0];this._canvas.width=a,this._canvas.height=o;var s=[],l=r.Compression?r.Compression.values[0]:1,c=r.SamplesPerPixel.values[0],h=[],u=0,_=!1;r.BitsPerSample.values.forEach((function(t,e){h[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(h[e].hasBytesPerSample=!0,h[e].bytesPerSample=t/8),u+=t}),this);var f=0;u%8==0&&(_=!0,f=u/8);var d,p=r.StripOffsets.values,m=p.length;if(r.StripByteCounts)d=r.StripByteCounts.values;else{if(T(8003),1!==m)throw Error(R(6024));d=[Math.ceil(a*o*u/8)]}for(var v=1,g=1,y=0;y<m;y++){var S=p[y];s[y]=[];for(var E=d[y],A=0,b=0,x=1,C=!0,w=[],I=0,O=0,P=0;A<E;A+=x)switch(l){case 1:w=[];for(var M=0;M<c;M++){var D=h[M];if(!D.hasBytesPerSample){var N=this.getBits(D.bitsPerSample,S+A,b);throw w.push(N.bits),A=N.byteOffset-S,b=N.bitOffset,RangeError(R(6025))}var L=D.bytesPerSample*M;w.push(this.getBytes(D.bytesPerSample,S+A+L))}if(s[y].push(w),!_)throw x=0,RangeError(R(6026));x=f;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){C=!1;var B=this.getUint8(S+A);B>=0&&B<=127?v=B+1:B>=-127&&B<=-1?g=1-B:C=!0}else{for(var F=this.getUint8(S+A),z=0;z<g;z++){var U=h[O];if(!U.hasBytesPerSample)throw RangeError(R(6025));P=P<<8*I|F,++I===U.bytesPerSample&&(w.push(P),P=I=0,O++),O===c&&(s[y].push(w),w=[],O=0)}0==--v&&(C=!0)}x=1}}if(e.getContext){var k=this._canvas.getContext("2d");k.fillStyle="rgba(255, 255, 255, 0)";var G=r.RowsPerStrip?r.RowsPerStrip.values[0]:o,H=s.length,V=o%G,W=0===V?G:V,j=G,q=0,X=r.PhotometricInterpretation.values[0],Y=[],K=0;r.ExtraSamples&&(K=(Y=r.ExtraSamples.values).length);var Z=[],Q=0;r.ColorMap&&(Z=r.ColorMap.values,Q=Math.pow(2,h[0].bitsPerSample));for(var J=0;J<H;J++){J+1===H&&(j=W);for(var $=s[J].length,tt=q*J,et=0,it=0;et<j&&it<$;et++)for(var nt=0;nt<a;nt++,it++){var rt=s[J][it],at=0,ot=0,st=0,lt=1;if(K>0)for(var ct=0;ct<K;ct++)if(1===Y[ct]||2===Y[ct]){lt=rt[3+ct]/256;break}!function(){switch(X){case 0:var t=0;h[0].hasBytesPerSample&&(t=Math.pow(16,2*h[0].bytesPerSample)),rt.forEach((function(e,i,n){n[i]=t-e}));case 1:at=ot=st=i.clampColorSample(rt[0],h[0].bitsPerSample);break;case 2:at=i.clampColorSample(rt[0],h[0].bitsPerSample),ot=i.clampColorSample(rt[1],h[1].bitsPerSample),st=i.clampColorSample(rt[2],h[2].bitsPerSample);break;case 3:if(void 0===Z)throw Error(R(6027));var e=rt[0];at=i.clampColorSample(Z[e],16),ot=i.clampColorSample(Z[Q+e],16),st=i.clampColorSample(Z[2*Q+e],16);break;default:throw RangeError(R(6028,X))}}(),k.fillStyle="rgba("+at+", "+ot+", "+st+", "+lt+")",k.fillRect(nt,tt+et,1,1)}q=j}}return this._canvas}},t}(),zct={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},Uct={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},kct=new Array(123),Gct=0;Gct<123;++Gct)kct[Gct]=64;for(var Hct=0;Hct<64;++Hct)kct["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Hct)]=Hct;var Vct={name:"Jacob__Codec__Base64",decode:function(t){var e,i,n,r,a,o,s=[],l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)e=kct[t.charCodeAt(l++)]<<2|(r=kct[t.charCodeAt(l++)])>>4,i=(15&r)<<4|(a=kct[t.charCodeAt(l++)])>>2,n=(3&a)<<6|(o=kct[t.charCodeAt(l++)]),s.push(String.fromCharCode(e)),64!==a&&s.push(String.fromCharCode(i)),64!==o&&s.push(String.fromCharCode(n));return s.join("")},decodeAsArray:function(t,e){var i,n,r,a=this.decode(t),o=[];for(i=0,r=a.length/e;i<r;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=a.charCodeAt(i*e+n)<<8*n;return o}},Wct=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(Wct.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};Wct.gunzip=function(t){return t.constructor===Array||t.constructor,new Wct(t).gunzip()[0][0]},Wct.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},Wct.LITERALS=288,Wct.NAMEMAX=256,Wct.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],Wct.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Wct.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],Wct.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Wct.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Wct.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Wct.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},Wct.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},Wct.prototype.byteAlign=function(){this.bb=1},Wct.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},Wct.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=Wct.bitReverse[e]>>8-t),e},Wct.prototype.flushBuffer=function(){this.bIdx=0},Wct.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},Wct.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},Wct.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},Wct.prototype.CreateTree=function(t,e,i){var n;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,n=0;n<17;n++)this.fpos[n]=0;return this.len=0,this.Rec()?-1:0},Wct.prototype.DecodeValue=function(t){for(var e,i,n=0,r=t[n];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,i=0;i<e;i++)if(t[i]===r){n=i;break}}else{if(!(32768&r.b0))return r.b0;r=t[++n]}return-1},Wct.prototype.DeflateLoop=function(){var t,e,i;do{var n,r;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),n=this.readByte(),n|=this.readByte()<<8,r=this.readByte(),65535&(n^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");n--;)a=this.readByte(),this.addBuffer(a);else if(1===e)for(;;)if((o=Wct.bitReverse[this.readBits(7)]>>1)>23?(o=o<<1|this.readBit())>199?o=(o-=128)<<1|this.readBit():(o-=48)>143&&(o+=136):o+=256,o<256)this.addBuffer(o);else{if(256===o)break;for(o-=257,d=this.readBits(Wct.cplext[o])+Wct.cplens[o],o=Wct.bitReverse[this.readBits(5)]>>3,Wct.cpdext[o]>8?(p=this.readBits(8),p|=this.readBits(Wct.cpdext[o]-8)<<8):p=this.readBits(Wct.cpdext[o]),p+=Wct.cpdist[o],o=0;o<d;o++){var a=this.buf32k[this.bIdx-p&32767];this.addBuffer(a)}}else if(2===e){var o,s,l,c,h,u=new Array(320);for(l=257+this.readBits(5),c=1+this.readBits(5),h=4+this.readBits(4),o=0;o<19;o++)u[o]=0;for(o=0;o<h;o++)u[Wct.border[o]]=this.readBits(3);for(d=this.distanceTree.length,i=0;i<d;i++)this.distanceTree[i]=new Wct.HufNode;if(this.CreateTree(this.distanceTree,19,u,0))return this.flushBuffer(),1;for(s=l+c,i=0;i<s;)if((o=this.DecodeValue(this.distanceTree))<16)u[i++]=o;else if(16===o){var _;if(i+(o=3+this.readBits(2))>s)return this.flushBuffer(),1;for(_=i?u[i-1]:0;o--;)u[i++]=_}else{if(i+(o=17===o?3+this.readBits(3):11+this.readBits(7))>s)return this.flushBuffer(),1;for(;o--;)u[i++]=0}for(d=this.literalTree.length,i=0;i<d;i++)this.literalTree[i]=new Wct.HufNode;if(this.CreateTree(this.literalTree,l,u,0))return this.flushBuffer(),1;for(d=this.literalTree.length,i=0;i<d;i++)this.distanceTree[i]=new Wct.HufNode;var f=new Array;for(i=l;i<u.length;i++)f[i-l]=u[i];if(this.CreateTree(this.distanceTree,c,f,0))return this.flushBuffer(),1;for(;;)if((o=this.DecodeValue(this.literalTree))>=256){var d,p;if(0==(o-=256))break;for(o--,d=this.readBits(Wct.cplext[o])+Wct.cplens[o],o=this.DecodeValue(this.distanceTree),Wct.cpdext[o]>8?(p=this.readBits(8),p|=this.readBits(Wct.cpdext[o]-8)<<8):p=this.readBits(Wct.cpdext[o]),p+=Wct.cpdist[o];d--;)a=this.buf32k[this.bIdx-p&32767],this.addBuffer(a)}else this.addBuffer(o)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},Wct.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},Wct.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8;var n=this.readByte();for(n|=this.readByte()<<8,a=0,this.nameBuf=[];i--;){var r=this.readByte();"/"===r|":"===r?a=0:a<Wct.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<n;)r=this.readByte(),a++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},Wct.prototype.skipdir=function(){var t,e,i=[];if(8&this.gpflags&&(i[0]=this.readByte(),i[1]=this.readByte(),i[2]=this.readByte(),i[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),i[0]=this.readByte(),8!==i[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(i[0]=this.readByte(),i[2]=this.readByte(),this.len=i[0]+256*i[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<Wct.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var jct,qct,Xct,Yct,Kct,Zct,Qct,Jct,$ct,tht,eht,iht,nht,rht,aht,oht,sht,lht,cht,hht,uht,_ht,fht,dht,pht,mht,vht,ght,yht,Tht,Sht,Eht,Aht,bht,xht,Cht,wht,Rht,Iht,Oht,Pht,Mht,Dht,Nht,Lht,Bht,Fht,zht,Uht,kht,Ght,Hht,Vht,Wht,jht,qht,Xht,Yht,Kht,Zht,Qht,Jht,$ht,tut,eut,iut,nut,rut,aut,out,sut,lut,cut,hut,uut,_ut,fut,dut,put,mut,vut,gut,yut,Tut,Sut,Eut,Aut,but,xut,Cut,wut,Rut,Iut,Out,Put,Mut,Dut={name:"Jacob__Codec"};function Nut(t){var e=t.parent,i=t.getComponent(Kut);return e&&i?Nut(e):t.getComponentsInChildren(Kut)}Dut.Base64=Vct,Dut.GZip=Wct,Dut.unzip=function(){return Dut.GZip.gunzip.apply(Dut.GZip,arguments)},Dut.unzipBase64=function(){var t=Dut.Base64.decode.apply(Dut.Base64,arguments);try{return Dut.GZip.gunzip.call(Dut.GZip,t)}catch(e){return t.slice(7)}},Dut.unzipBase64AsArray=function(t,e){e=e||1;var i,n,r,a=this.unzipBase64(t),o=[];for(i=0,r=a.length/e;i<r;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=a.charCodeAt(i*e+n)<<8*n;return o},Dut.unzipAsArray=function(t,e){e=e||1;var i,n,r,a=this.unzip(t),o=[];for(i=0,r=a.length/e;i<r;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=a.charCodeAt(i*e+n)<<8*n;return o},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(Mut||(Mut={}));var Lut,But,Fut,zut,Uut,kut,Gut,Hut,Vut,Wut,jut,qut,Xut,Yut,Kut=t("ParticleSystem2D",(jct=ru("cc.ParticleSystem2D"),qct=du(),Xct=Eu(),Yct=Fu(Dct),Kct=Eu(),Zct=Fu(vL),Qct=Eu(),Jct=Eu(),$ct=Eu(),tht=Eu(),eht=Eu(),iht=Eu(),nht=Eu(),rht=Eu(),aht=Eu(),oht=Eu(),sht=Eu(),lht=Eu(),cht=Eu(),hht=Eu(),uht=Eu(),_ht=Eu(),fht=Eu(),dht=Eu(),pht=Eu(),mht=Eu(),vht=Eu(),ght=Fu(Act),yht=Eu(),Tht=Fu(Ect),Sht=Eu(),Eht=Eu(),Aht=Eu(),bht=Eu(),xht=Eu(),Cht=Eu(),wht=Eu(),Rht=Eu(),Iht=Eu(),Oht=Eu(),Pht=Eu(),Mht=Eu(),Dht=Eu(),Nht=Eu(),Lht=Eu(),Bht=Eu(),Fht=Eu(),zht=Eu(),jct(Uht=qct(Uht=pu(Uht=fu((Put=Out=function(t){function e(){var e;return J(e=t.call(this)||this,"duration",Ght,K(e)),J(e,"emissionRate",Hht,K(e)),J(e,"life",Vht,K(e)),J(e,"lifeVar",Wht,K(e)),J(e,"angle",jht,K(e)),J(e,"angleVar",qht,K(e)),J(e,"startSize",Xht,K(e)),J(e,"startSizeVar",Yht,K(e)),J(e,"endSize",Kht,K(e)),J(e,"endSizeVar",Zht,K(e)),J(e,"startSpin",Qht,K(e)),J(e,"startSpinVar",Jht,K(e)),J(e,"endSpin",$ht,K(e)),J(e,"endSpinVar",tut,K(e)),J(e,"sourcePos",eut,K(e)),J(e,"posVar",iut,K(e)),J(e,"emitterMode",nut,K(e)),J(e,"gravity",rut,K(e)),J(e,"speed",aut,K(e)),J(e,"speedVar",out,K(e)),J(e,"tangentialAccel",sut,K(e)),J(e,"tangentialAccelVar",lut,K(e)),J(e,"radialAccel",cut,K(e)),J(e,"radialAccelVar",hut,K(e)),J(e,"rotationIsDir",uut,K(e)),J(e,"startRadius",_ut,K(e)),J(e,"startRadiusVar",fut,K(e)),J(e,"endRadius",dut,K(e)),J(e,"endRadiusVar",put,K(e)),J(e,"rotatePerS",mut,K(e)),J(e,"rotatePerSVar",vut,K(e)),e.aspectRatio=1,J(e,"playOnLoad",gut,K(e)),J(e,"autoRemoveOnFinish",yut,K(e)),J(e,"preview",Tut,K(e)),J(e,"_custom",Sut,K(e)),J(e,"_file",Eut,K(e)),J(e,"_spriteFrame",Aut,K(e)),J(e,"_totalParticles",but,K(e)),J(e,"_startColor",xut,K(e)),J(e,"_startColorVar",Cut,K(e)),J(e,"_endColor",wut,K(e)),J(e,"_endColorVar",Rut,K(e)),J(e,"_positionType",Iut,K(e)),e._stopped=!0,e._deferredloaded=!1,e.initProperties(),e}Y(e,t),q(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0},i.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new Mct(this)},i.onFocusInEditor=function(){this._focused=!0;for(var t=Nut(this.node),e=0;e<t.length;++e)t[e]._startPreview()},i.onLostFocusInEditor=function(){this._focused=!1;for(var t=Nut(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},i._startPreview=function(){this.preview&&this.resetSystem()},i._stopPreview=function(){this.preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},i.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},i.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},i.addParticle=function(){},i.stopSystem=function(){this._stopped=!0,this._simulator.stop()},i.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},i.isFull=function(){return this.particleCount>=this.totalParticles},i._applyFile=function(){var t=this,e=this._file;if(e){var i=function(i){!i&&e?t.isValid&&(t._plistFile=e.nativeUrl,t._custom||(t._spriteFrame!==e.spriteFrame&&(t.spriteFrame=e.spriteFrame),t._initWithDictionary(e._nativeAsset)),t._spriteFrame?!t._renderSpriteFrame&&t._spriteFrame&&t._applySpriteFrame():e.spriteFrame?t.spriteFrame=e.spriteFrame:t._custom&&t._initTextureWithDictionary(e._nativeAsset),t._deferredloaded=!1):b(6029)};e._nativeAsset?i(null):(this._deferredloaded=!0,BI.postLoadNative(e,i))}},i._initTextureWithDictionary=function(t){var e,i=this;if(t.spriteFrameUuid){var n=t.spriteFrameUuid;BI.loadAny(n,(function(e,n){e?(t.spriteFrameUuid=void 0,i._initTextureWithDictionary(t),d(e)):i.spriteFrame=n}))}else{var r=G(this._plistFile,t.textureFileName||"");if(t.textureFileName)BI.loadRemote(r,(function(e,n){e?(t.textureFileName=void 0,i._initTextureWithDictionary(t),d(e)):i.spriteFrame=vL.createWithImage(n)}));else if(t.textureImageData){var a=t.textureImageData;if(!(a&&a.length>0))return!1;var o=BI.assets.get(r);if(!o){var s=Dut.unzipBase64AsArray(a,1);if(!s)return E(6030,this._file.name),!1;var l=(e=s).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?Mut.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?Mut.TIFF:Mut.UNKNOWN;if(l!==Mut.TIFF&&l!==Mut.PNG)return E(6031,this._file.name),!1;var c=document.createElement("canvas");l===Mut.PNG?new Bct(s).render(c):(this._tiffReader||(this._tiffReader=new Fct),this._tiffReader.parseTIFF(s,c)),o=new V_(c),BI.assets.add(r,o)}o||E(6032,this._file.name),this.spriteFrame=vL.createWithImage(o)}}return!0},i._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this.srcBlendFactor=parseInt(t.blendFuncSource||Ja.SRC_ALPHA),this.dstBlendFactor=parseInt(t.blendFuncDestination||Ja.ONE_MINUS_SRC_ALPHA);var i=this._startColor;i.r=255*parseFloat(t.startColorRed||0),i.g=255*parseFloat(t.startColorGreen||0),i.b=255*parseFloat(t.startColorBlue||0),i.a=255*parseFloat(t.startColorAlpha||0);var n=this._startColorVar;n.r=255*parseFloat(t.startColorVarianceRed||0),n.g=255*parseFloat(t.startColorVarianceGreen||0),n.b=255*parseFloat(t.startColorVarianceBlue||0),n.a=255*parseFloat(t.startColorVarianceAlpha||0);var r=this._endColor;r.r=255*parseFloat(t.finishColorRed||0),r.g=255*parseFloat(t.finishColorGreen||0),r.b=255*parseFloat(t.finishColorBlue||0),r.a=255*parseFloat(t.finishColorAlpha||0);var a=this._endColorVar;if(a.r=255*parseFloat(t.finishColorVarianceRed||0),a.g=255*parseFloat(t.finishColorVarianceGreen||0),a.b=255*parseFloat(t.finishColorVarianceBlue||0),a.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:Act.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||Ect.GRAVITY),this.emitterMode===Ect.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var o=t.rotationIsDir||"";null!==o?(o=o.toString().toLowerCase(),this.rotationIsDir="true"===o||"1"===o):this.rotationIsDir=!1}else{if(this.emitterMode!==Ect.RADIUS)return E(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},i._onTextureLoaded=function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()},i._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},i._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.once("load",this._onTextureLoaded,this):this.resetSystem()},i._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},i._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==Act.FREE})},i._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},i._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&!this._deferredloaded&&null!==this._renderSpriteFrame},i._render=function(t){t.commitComp(this,this._renderSpriteFrame,this._assembler,this._positionType===Act.RELATIVE?this.node.parent:null)},e}(bz),Out.EmitterMode=Ect,Out.PositionType=Act,Out.DURATION_INFINITY=-1,Out.START_SIZE_EQUAL_TO_END_SIZE=-1,Out.START_RADIUS_EQUAL_TO_END_RADIUS=-1,$((kht=Put).prototype,"custom",[yu,Xct],Object.getOwnPropertyDescriptor(kht.prototype,"custom"),kht.prototype),$(kht.prototype,"file",[Yct,Kct],Object.getOwnPropertyDescriptor(kht.prototype,"file"),kht.prototype),$(kht.prototype,"spriteFrame",[Zct,Qct],Object.getOwnPropertyDescriptor(kht.prototype,"spriteFrame"),kht.prototype),$(kht.prototype,"totalParticles",[yu,Jct],Object.getOwnPropertyDescriptor(kht.prototype,"totalParticles"),kht.prototype),Ght=$(kht.prototype,"duration",[cu,yu,$ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Hht=$(kht.prototype,"emissionRate",[cu,yu,tht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Vht=$(kht.prototype,"life",[cu,yu,eht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wht=$(kht.prototype,"lifeVar",[cu,yu,iht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$(kht.prototype,"startColor",[yu,nht],Object.getOwnPropertyDescriptor(kht.prototype,"startColor"),kht.prototype),$(kht.prototype,"startColorVar",[yu,rht],Object.getOwnPropertyDescriptor(kht.prototype,"startColorVar"),kht.prototype),$(kht.prototype,"endColor",[yu,aht],Object.getOwnPropertyDescriptor(kht.prototype,"endColor"),kht.prototype),$(kht.prototype,"endColorVar",[yu,oht],Object.getOwnPropertyDescriptor(kht.prototype,"endColorVar"),kht.prototype),jht=$(kht.prototype,"angle",[cu,yu,sht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),qht=$(kht.prototype,"angleVar",[cu,yu,lht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Xht=$(kht.prototype,"startSize",[cu,yu,cht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Yht=$(kht.prototype,"startSizeVar",[cu,yu,hht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kht=$(kht.prototype,"endSize",[cu,yu,uht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zht=$(kht.prototype,"endSizeVar",[cu,yu,_ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qht=$(kht.prototype,"startSpin",[cu,yu,fht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jht=$(kht.prototype,"startSpinVar",[cu,yu,dht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$ht=$(kht.prototype,"endSpin",[cu,yu,pht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tut=$(kht.prototype,"endSpinVar",[cu,yu,mht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eut=$(kht.prototype,"sourcePos",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xi.ZERO.clone()}}),iut=$(kht.prototype,"posVar",[cu,yu,vht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xi.ZERO.clone()}}),$(kht.prototype,"positionType",[ght,yht],Object.getOwnPropertyDescriptor(kht.prototype,"positionType"),kht.prototype),nut=$(kht.prototype,"emitterMode",[cu,yu,Tht,Sht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ect.GRAVITY}}),rut=$(kht.prototype,"gravity",[cu,yu,Eht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xi.ZERO.clone()}}),aut=$(kht.prototype,"speed",[cu,yu,Aht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),out=$(kht.prototype,"speedVar",[cu,yu,bht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),sut=$(kht.prototype,"tangentialAccel",[cu,yu,xht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),lut=$(kht.prototype,"tangentialAccelVar",[cu,yu,Cht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cut=$(kht.prototype,"radialAccel",[cu,yu,wht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hut=$(kht.prototype,"radialAccelVar",[cu,yu,Rht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uut=$(kht.prototype,"rotationIsDir",[cu,yu,Iht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_ut=$(kht.prototype,"startRadius",[cu,yu,Oht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fut=$(kht.prototype,"startRadiusVar",[cu,yu,Pht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dut=$(kht.prototype,"endRadius",[cu,yu,Mht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),put=$(kht.prototype,"endRadiusVar",[cu,yu,Dht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mut=$(kht.prototype,"rotatePerS",[cu,yu,Nht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vut=$(kht.prototype,"rotatePerSVar",[cu,yu,Lht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gut=$(kht.prototype,"playOnLoad",[cu,yu,Bht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yut=$(kht.prototype,"autoRemoveOnFinish",[cu,yu,Fht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tut=$(kht.prototype,"preview",[cu,yu,zht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Sut=$(kht.prototype,"_custom",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Eut=$(kht.prototype,"_file",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Aut=$(kht.prototype,"_spriteFrame",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),but=$(kht.prototype,"_totalParticles",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),xut=$(kht.prototype,"_startColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(255,255,255,255)}}),Cut=$(kht.prototype,"_startColorVar",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(0,0,0,0)}}),wut=$(kht.prototype,"_endColor",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(255,255,255,0)}}),Rut=$(kht.prototype,"_endColorVar",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ci(0,0,0,0)}}),Iut=$(kht.prototype,"_positionType",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Act.FREE}}),Uht=kht))||Uht)||Uht)||Uht)||Uht)),Zut=function(){function t(t,e){this.point=new Xi,this.dir=new Xi,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),Qut=t("MotionStreak",(Lut=ru("cc.MotionStreak"),But=du(),Fut=gu(),zut=Fu(yd),Lut(Uut=fu(Uut=pu(Uut=But(Uut=Fut((Yut=Xut=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_preview",Gut,K(e)),J(e,"_fadeTime",Hut,K(e)),J(e,"_minSeg",Vut,K(e)),J(e,"_stroke",Wut,K(e)),J(e,"_texture",jut,K(e)),J(e,"_fastMode",qut,K(e)),e._points=[],e}Y(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i.onFocusInEditor=function(){this._preview&&this.reset()},i.onLostFocusInEditor=function(){this._preview&&this.reset()},i.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},i.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},q(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(bz),Xut.Point=Zut,$((kut=Yut).prototype,"preview",[yu],Object.getOwnPropertyDescriptor(kut.prototype,"preview"),kut.prototype),$(kut.prototype,"fadeTime",[yu],Object.getOwnPropertyDescriptor(kut.prototype,"fadeTime"),kut.prototype),$(kut.prototype,"minSeg",[yu],Object.getOwnPropertyDescriptor(kut.prototype,"minSeg"),kut.prototype),$(kut.prototype,"stroke",[yu],Object.getOwnPropertyDescriptor(kut.prototype,"stroke"),kut.prototype),$(kut.prototype,"texture",[zut],Object.getOwnPropertyDescriptor(kut.prototype,"texture"),kut.prototype),$(kut.prototype,"fastMode",[yu],Object.getOwnPropertyDescriptor(kut.prototype,"fastMode"),kut.prototype),Gut=$(kut.prototype,"_preview",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hut=$(kut.prototype,"_fadeTime",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Vut=$(kut.prototype,"_minSeg",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wut=$(kut.prototype,"_stroke",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),jut=$(kut.prototype,"_texture",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qut=$(kut.prototype,"_fastMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uut=kut))||Uut)||Uut)||Uut)||Uut)||Uut)),Jut=(new Xi,new Xi),$ut=new Xi;function t_t(t,e){return t.x=-e.y,t.y=e.x,t}var e_t={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=16,e.indicesCount=42,e},update:function(t,e){var i,n=t.stroke/2,r=t.node.worldMatrix,a=r.m12,o=r.m13,s=t.points;if(s.length>1){var l=s[0],c=l.point.x-a,h=l.point.y-o;c*c+h*h<t.minSeg&&(i=l)}i||(i=new Qut.Point,s.splice(0,0,i)),i.setPoint(a,o),i.time=t.fadeTime+e;var u,_=0;if(!(s.length<2)){var f=t.renderData,d=t.color,p=d.r,m=d.g,v=d.b,g=d.a,y=s[1];y.distance=Xi.subtract($ut,i.point,y.point).length(),$ut.normalize(),y.setDir($ut.x,$ut.y),i.setDir($ut.x,$ut.y),f.dataLength=2*s.length;for(var T=f.data,S=t.fadeTime,E=!1,A=s.length-1;A>=0;A--){var b=s[A],x=b.point,C=b.dir;if(b.time-=e,b.time<0)s.splice(A,1);else{var w=b.time/S,R=s[A-1];if(!E){if(!R){s.splice(A,1);continue}x.x=R.point.x-C.x*w,x.y=R.point.y-C.y*w}E=!0,t_t(Jut,C);var I=(w*g<<24>>>0)+(v<<16)+(m<<8)+p,O=_;T[O].x=x.x+Jut.x*n,T[O].y=x.y+Jut.y*n,T[O].u=1,T[O].v=w,T[O].color._val=I,T[O+=1].x=x.x-Jut.x*n,T[O].y=x.y-Jut.y*n,T[O].u=0,T[O].v=w,T[O].color._val=I,_+=2}}u=_<=2?0:3*(_-2),f.vertexCount=_,f.indicesCount=u}},updateRenderData:function(){},fillBuffers:function(t,e){var i=t.renderData,n=i.data,r=(t.node,e.acquireBufferBatch()),a=r.byteOffset>>2,o=r.indicesOffset,s=r.vertexOffset;r.request(i.vertexCount,i.indicesCount)||(r=e.currBufferBatch,o=0,s=0);for(var l=r.vData,c=r.iData,h=i.vertexCount,u=i.indicesCount,_=0;_<h;_++){var f=n[_];l[a++]=f.x,l[a++]=f.y,l[a++]=f.z,l[a++]=f.u,l[a++]=f.v,Ci.toArray(l,f.color,a),a+=4}for(var d=0,p=u;d<p;d+=2){var m=s+d;c[o++]=m,c[o++]=m+2,c[o++]=m+1,c[o++]=m+1,c[o++]=m+2,c[o++]=m+3}}},i_t=t("MotionStreakAssemblerManager",{getAssembler:function(){return e_t}});Qut.Assembler=i_t;var n_t={maxParticleDeltaTime:0,createData:function(){return RB.add()},updateRenderData:function(){},fillBuffers:function(t,e){if(null!==t){var i=t._simulator.renderData;if(0!==i.vertexCount&&0!==i.indicesCount){var n=e.acquireBufferBatch(),r=n.byteOffset>>2,a=n.indicesOffset,o=n.vertexOffset;n.request(i.vertexCount,i.indicesCount)||(n=e.currBufferBatch,a=0,o=0);for(var s=n.vData,l=n.iData,c=i.vData,h=i.iData,u=9*i.vertexCount,_=0;_<u;_++)s[r++]=c[_];for(var f=i.indicesCount,d=0;d<f;d++)l[a++]=h[d]+o}}}},r_t=t("ParticleSystem2DAssembler",{getAssembler:function(){return n_t.maxParticleDeltaTime||(n_t.maxParticleDeltaTime=n.game.frameTime/1e3*2),n_t}});Kut.Assembler=r_t;var a_t={INITIALIZING:0,PLAYING:1,STOPPED:2},o_t=function(){function t(t){var e=this;this._state=a_t.STOPPED,this._duration=0,this._clip=void 0,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._blocking=!1,this._duration=t.duration,this._clip=t.audioClip,this._onHide=function(){e._blocking=!0,e._state===a_t.PLAYING&&(e.pause(),e._interrupted=!0)},this._onShow=function(){e._blocking=!1,e._interrupted&&(e.play(),e._interrupted=!1)},n.game.on(n.Game.EVENT_HIDE,this._onHide),n.game.on(n.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.getState=function(){return this._state},e.getDuration=function(){return this._duration},e.destroy=function(){n.game.off(n.Game.EVENT_HIDE,this._onHide),n.game.off(n.Game.EVENT_SHOW,this._onShow)},t}();function s_t(t){var e=yv.__audioSupport;return new Promise((function(i,n){var r=document.createElement("audio");r.src=t;var a=function(){clearTimeout(o),r.removeEventListener("canplaythrough",s,!1),r.removeEventListener("error",l,!1),e.USE_LOADER_EVENT&&r.removeEventListener(e.USE_LOADER_EVENT,s,!1)},o=setTimeout((function(){0===r.readyState?l():s()}),8e3),s=function(){a(),i(r)},l=function(){a(),n("load audio failure - "+t)};r.addEventListener("canplaythrough",s,!1),r.addEventListener("error",l,!1),e.USE_LOADER_EVENT&&r.addEventListener(e.USE_LOADER_EVENT,s,!1)}))}n.internal.AudioPlayer=o_t;var l_t=function(){function t(){this._playingAudios=void 0,this._playingAudios=[]}var e=t.prototype;return e.addPlaying=function(t){this._playingAudios.includes(t)||this._playingAudios.push(t)},e.removePlaying=function(t){var e=this._playingAudios.indexOf(t);e>-1&&this._playingAudios.splice(e,1)},t}();l_t.maxAudioChannel=24,n.internal.AudioManager=l_t;var c_t=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.discardOnePlayingIfNeeded=function(){if(!(this._playingAudios.length<l_t.maxAudioChannel)){var t,e,i=this._playingAudios.findIndex((function(t){return t instanceof HTMLAudioElement}));i>-1?(t=this._playingAudios[i],this._playingAudios.splice(i,1),t.pause(),t.src=""):null===(e=t=this._playingAudios.shift())||void 0===e||e.stop()}},e}(l_t),h_t=function(t){function e(i){var r;return(r=t.call(this,i)||this)._volume=1,r._loop=!1,r._nativeAudio=void 0,r._cbRegistered=!1,r._remove_cb=void 0,r._post_play=void 0,r._on_gesture=void 0,r._post_gesture=void 0,r._nativeAudio=i.nativeAudio,r._remove_cb=function(){r._cbRegistered&&(n.game.canvas.removeEventListener("touchend",r._on_gesture),n.game.canvas.removeEventListener("mouseup",r._on_gesture),r._cbRegistered=!1)},r._post_play=function(){r._state=a_t.PLAYING,r._clip.emit("started"),r._remove_cb(),e._manager.addPlaying(K(r))},r._post_gesture=function(){r._interrupted?(r._post_play(),r._interrupted=!1):(r._nativeAudio.pause(),r._nativeAudio.currentTime=0)},r._on_gesture=function(){if(r._nativeAudio){var t=r._nativeAudio.play();if(!t)return r._state=a_t.PLAYING,void n.director.once(n.Director.EVENT_AFTER_UPDATE,r._post_gesture);t.then(r._post_gesture),r._remove_cb()}},r._nativeAudio.volume=r._volume,r._nativeAudio.loop=r._loop,r._nativeAudio.addEventListener("ended",(function(){r._state=a_t.STOPPED,r._nativeAudio.currentTime=0,r._clip.emit("ended"),e._manager.removePlaying(K(r))})),n.game.canvas.addEventListener("touchend",r._on_gesture),n.game.canvas.addEventListener("mouseup",r._on_gesture),r._cbRegistered=!0,r}Y(e,t);var i=e.prototype;return i.play=function(){var t=this;if(this._nativeAudio)if(this._blocking)this._interrupted=!0;else{this._state===a_t.PLAYING&&(this.pause(),this.setCurrentTime(0)),e._manager.discardOnePlayingIfNeeded();var i=this._nativeAudio.play();if(!i)return this._state=a_t.PLAYING,void n.director.once(n.Director.EVENT_AFTER_UPDATE,this._post_play);i.then(this._post_play).catch((function(){t._interrupted=!0}))}},i.pause=function(){this._nativeAudio&&(this._interrupted=!1,this._state===a_t.PLAYING&&(this._nativeAudio.pause(),this._state=a_t.STOPPED,e._manager.removePlaying(this)))},i.stop=function(){this._nativeAudio&&(this._nativeAudio.currentTime=0,this._interrupted=!1,this._state===a_t.PLAYING&&(this._nativeAudio.pause(),this._state=a_t.STOPPED,e._manager.removePlaying(this)))},i.playOneShot=function(t){void 0===t&&(t=1),s_t(this._nativeAudio.src).then((function(i){e._manager.discardOnePlayingIfNeeded(),i.volume=t,i.play(),e._manager.addPlaying(i),i.addEventListener("ended",(function(){e._manager.removePlaying(i)}))}),(function(t){console.error(t)}))},i.setCurrentTime=function(t){this._nativeAudio&&(this._nativeAudio.currentTime=ci(t,0,this._duration))},i.getCurrentTime=function(){return this._nativeAudio?this._nativeAudio.currentTime:0},i.setVolume=function(t){this._volume=t,this._nativeAudio&&(this._nativeAudio.volume=t)},i.getVolume=function(){return this._nativeAudio?this._nativeAudio.volume:this._volume},i.setLoop=function(t){this._loop=t,this._nativeAudio&&(this._nativeAudio.loop=t)},i.getLoop=function(){return this._loop},i.destroy=function(){this._nativeAudio&&(this._nativeAudio.src=""),t.prototype.destroy.call(this)},e}(o_t);h_t._manager=new c_t;var u_t,__t,f_t,d_t,p_t,m_t,v_t,g_t,y_t=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.discardOnePlayingIfNeeded=function(){if(!(this._playingAudios.length<l_t.maxAudioChannel)){var t,e=this._playingAudios.findIndex((function(t){return t instanceof AudioBufferSourceNode}));e>-1?(t=this._playingAudios[e],this._playingAudios.splice(e,1)):t=this._playingAudios.shift(),t&&t.stop()}},e}(l_t),T_t=function(t){function e(e){var i;(i=t.call(this,e)||this)._startTime=0,i._offset=0,i._volume=1,i._loop=!1,i._currentTimer=0,i._nativeAudio=void 0,i._context=void 0,i._sourceNode=void 0,i._gainNode=void 0,i._startInvoked=!1,i._onEndedCB=void 0,i._onGestureCB=void 0,i._onGestureProceedCB=void 0;var r=yv.__audioSupport;return i._nativeAudio=e.nativeAudio,i._context=r.context,i._sourceNode=i._context.createBufferSource(),i._gainNode=i._context.createGain(),i._gainNode.connect(i._context.destination),i._onEndedCB=i._onEnded.bind(K(i)),i._onGestureCB=i._onGesture.bind(K(i)),i._onGestureProceedCB=i._onGestureProceed.bind(K(i)),"running"!==i._context.state&&i._context.resume&&(n.game.canvas.addEventListener("touchend",i._onGestureCB),n.game.canvas.addEventListener("mouseup",i._onGestureCB)),i}Y(e,t);var i=e.prototype;return i.play=function(){if(this._nativeAudio){if(this._state===a_t.PLAYING&&(this.pause(),this.setCurrentTime(0)),this._blocking||"running"!==this._context.state)return this._interrupted=!0,void("interrupted"!==this._context.state&&"suspended"!==this._context.state||!this._context.resume||this._onGesture());this._doPlay()}},i.pause=function(){this._interrupted=!1,this._state===a_t.PLAYING&&(this._doStop(),this._offset+=this._context.currentTime-this._startTime,this._state=a_t.STOPPED,clearInterval(this._currentTimer))},i.stop=function(){this._offset=0,this._interrupted=!1,this._state===a_t.PLAYING&&(this._doStop(),this._state=a_t.STOPPED,clearInterval(this._currentTimer))},i.playOneShot=function(t){if(void 0===t&&(t=1),this._nativeAudio){"interrupted"!==this._context.state&&"suspended"!==this._context.state||this._context.resume&&this._context.resume().catch((function(t){console.error(t)})),e._manager.discardOnePlayingIfNeeded();var i=this._context.createGain();i.connect(this._context.destination),i.gain.value=t;var n=this._context.createBufferSource();n.buffer=this._nativeAudio,n.loop=!1,n.connect(i),n.start(),e._manager.addPlaying(n),n.onended=function(){e._manager.removePlaying(n)}}},i.setCurrentTime=function(t){this._offset=ci(t,0,this._nativeAudio&&this._nativeAudio.duration||this._duration),this._state===a_t.PLAYING&&(this._doStop(),this._doPlay())},i.getCurrentTime=function(){return this._state!==a_t.PLAYING?this._offset:this._context.currentTime-this._startTime+this._offset},i.setVolume=function(t,e){if(this._volume=t,!e&&this._gainNode.gain.setTargetAtTime)try{this._gainNode.gain.setTargetAtTime(t,this._context.currentTime,0)}catch(e){this._gainNode.gain.setTargetAtTime(t,this._context.currentTime,.01)}else this._gainNode.gain.value=t},i.getVolume=function(){return this._volume},i.setLoop=function(t){this._loop=t,this._sourceNode.loop=t},i.getLoop=function(){return this._loop},i.destroy=function(){t.prototype.destroy.call(this)},i._doPlay=function(){var t=this;e._manager.discardOnePlayingIfNeeded(),this._state=a_t.PLAYING,this._sourceNode=this._context.createBufferSource(),this._sourceNode.buffer=this._nativeAudio,this._sourceNode.loop=this._loop,this._sourceNode.connect(this._gainNode),this._startTime=this._context.currentTime,this._startInvoked=!1,n.director.once(n.Director.EVENT_AFTER_UPDATE,this._playAndEmit,this),clearInterval(this._currentTimer),this._currentTimer=window.setInterval((function(){t._onEnded(),clearInterval(t._currentTimer),t._sourceNode.loop&&(t._currentTimer=window.setInterval(t._onEndedCB,1e3*t._nativeAudio.duration))}),1e3*(this._nativeAudio.duration-this._offset))},i._doStop=function(){this._startInvoked?this._sourceNode.stop():n.director.off(n.Director.EVENT_AFTER_UPDATE,this._playAndEmit,this),e._manager.removePlaying(this)},i._playAndEmit=function(){this._sourceNode.start(0,this._offset),this._clip.emit("started"),this._startInvoked=!0,e._manager.addPlaying(this)},i._onEnded=function(){this._offset=0,this._startTime=this._context.currentTime,this._sourceNode.loop||(this._clip.emit("ended"),this._state=a_t.STOPPED,e._manager.removePlaying(this))},i._onGestureProceed=function(){this._interrupted&&(this._doPlay(),this._interrupted=!1),n.game.canvas.removeEventListener("touchend",this._onGestureCB),n.game.canvas.removeEventListener("mouseup",this._onGestureCB)},i._onGesture=function(){"running"!==this._context.state?this._context.resume().then(this._onGestureProceedCB).catch((function(t){console.error(t)})):this._onGestureProceed()},e}(o_t);T_t._manager=new y_t;var S_t,E_t,A_t,b_t,x_t,C_t,w_t,R_t,I_t,O_t,P_t,M_t,D_t,N_t,L_t,B_t,F_t,z_t=he({WEB_AUDIO:0,DOM_AUDIO:1,JSB_AUDIO:2,UNKNOWN_AUDIO:3}),U_t=t("AudioClip",(u_t=ru("cc.AudioClip"),__t=Fu(z_t),u_t((g_t=v_t=function(t){function e(){var e;return J(e=t.call(this)||this,"_duration",p_t,K(e)),J(e,"_loadMode",m_t,K(e)),e._nativeAudio=null,e._player=null,e.loaded=!1,e}Y(e,t);var i=e.prototype;return i.destroy=function(){return this._player&&this._player.destroy(),t.prototype.destroy.call(this)},i.play=function(){this._player&&this._player.play()},i.pause=function(){this._player&&this._player.pause()},i.stop=function(){this._player&&this._player.stop()},i.playOneShot=function(t){this._player&&this._player.playOneShot(t)},i.setCurrentTime=function(t){this._player&&this._player.setCurrentTime(t)},i.getCurrentTime=function(){return this._player?this._player.getCurrentTime():0},i.getDuration=function(){return this._player?this._player.getDuration():this._duration},i.setVolume=function(t,e){this._player&&this._player.setVolume(t,e||!1)},i.getVolume=function(){return this._player?this._player.getVolume():1},i.setLoop=function(t){this._player&&this._player.setLoop(t)},i.getLoop=function(){return!!this._player&&this._player.getLoop()},i._getPlayer=function(t){var e;return"undefined"!=typeof AudioBuffer&&t instanceof AudioBuffer?(e=T_t,this._loadMode=z_t.WEB_AUDIO):(e=h_t,this._loadMode=z_t.DOM_AUDIO),e},q(e,[{key:"_nativeAsset",set:function(t){if(this._nativeAudio=t,t){var e=this._getPlayer(t);this._player=new e({nativeAudio:t,duration:this._duration,audioClip:this}),this.loaded=!0,this.emit("load")}else this._player=null,this._loadMode=z_t.UNKNOWN_AUDIO,this._duration=0,this.loaded=!1},get:function(){return this._nativeAudio}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.getState():a_t.INITIALIZING}}]),e}(M_),v_t.PlayingState=a_t,v_t.AudioType=z_t,v_t.preventDeferredLoadDependents=!0,p_t=$((d_t=g_t).prototype,"_duration",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m_t=$(d_t.prototype,"_loadMode",[__t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return z_t.UNKNOWN_AUDIO}}),$(d_t.prototype,"_nativeDep",[zu],Object.getOwnPropertyDescriptor(d_t.prototype,"_nativeDep"),d_t.prototype),f_t=d_t))||f_t));function k_t(t,e,i){s_t(t).then((function(t){i(null,t)}),(function(t){_(t),i(new Error(t),null)}))}function G_t(t,e,i){e.xhrResponseType="arraybuffer",iI(t,e,e.onFileProgress,i)}function H_t(t,e,i){var n=yv.__audioSupport;0!==n.format.length?(n.WEB_AUDIO&&e.audioLoadMode!==z_t.DOM_AUDIO?G_t:k_t)(t,e,i):i(new Error(R(4927)))}function V_t(t,e,i,n){var r=new U_t;r._nativeUrl=t,r._nativeAsset=e,r._duration=e.duration,n(null,r)}n.AudioClip=U_t,_I.register({".mp3":H_t,".ogg":H_t,".wav":H_t,".m4a":H_t}),_I.downloadDomAudio=k_t,yI.register({".mp3":V_t,".ogg":V_t,".wav":V_t,".m4a":V_t});var W_t,j_t,q_t,X_t,Y_t=function(e){return t({AudioSource:e,AudioSourceComponent:e}),e}((S_t=ru("cc.AudioSource"),E_t=gu(),A_t=du(),b_t=Fu(U_t),x_t=Fu(U_t),C_t=Eu(),w_t=Eu(),R_t=Eu(),I_t=Au(),O_t=Eu(),S_t(P_t=E_t(P_t=A_t((F_t=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_clip",D_t,K(e)),J(e,"_loop",N_t,K(e)),J(e,"_playOnAwake",L_t,K(e)),J(e,"_volume",B_t,K(e)),e._cachedCurrentTime=0,e}Y(e,t);var i=e.prototype;return i.onLoad=function(){this._syncStates()},i.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},i.onDisable=function(){this.pause()},i.onDestroy=function(){this.stop()},i.play=function(){this._clip&&this._clip.play()},i.pause=function(){this._clip&&this._clip.pause()},i.stop=function(){this._clip&&this._clip.stop()},i.playOneShot=function(t,e){void 0===e&&(e=1),t.playOneShot(this._volume*e)},i._syncStates=function(){this._clip&&(this._clip.setCurrentTime(this._cachedCurrentTime),this._clip.setLoop(this._loop),this._clip.setVolume(this._volume,!0),this._volume=this._clip.getVolume())},q(e,[{key:"clip",set:function(t){this._clip=t,this._syncStates()},get:function(){return this._clip}},{key:"loop",set:function(t){this._loop=t,this._clip&&this._clip.setLoop(t)},get:function(){return this._loop}},{key:"playOnAwake",set:function(t){this._playOnAwake=t},get:function(){return this._playOnAwake}},{key:"volume",set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=ci(t,0,1),this._clip?(this._clip.setVolume(t),this._volume=this._clip.getVolume()):this._volume=t)},get:function(){return this._volume}},{key:"currentTime",set:function(t){Number.isNaN(t)?console.warn("illegal audio time!"):(t=ci(t,0,this.duration),this._cachedCurrentTime=t,this._clip&&this._clip.setCurrentTime(this._cachedCurrentTime))},get:function(){return this._clip?this._clip.getCurrentTime():this._cachedCurrentTime}},{key:"duration",get:function(){return this._clip?this._clip.getDuration():0}},{key:"state",get:function(){return this._clip?this._clip.state:U_t.PlayingState.INITIALIZING}},{key:"playing",get:function(){return this.state===U_t.PlayingState.PLAYING}}]),e}(Jf),D_t=$((M_t=F_t).prototype,"_clip",[b_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N_t=$(M_t.prototype,"_loop",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L_t=$(M_t.prototype,"_playOnAwake",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),B_t=$(M_t.prototype,"_volume",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$(M_t.prototype,"clip",[x_t,C_t],Object.getOwnPropertyDescriptor(M_t.prototype,"clip"),M_t.prototype),$(M_t.prototype,"loop",[w_t],Object.getOwnPropertyDescriptor(M_t.prototype,"loop"),M_t.prototype),$(M_t.prototype,"playOnAwake",[R_t],Object.getOwnPropertyDescriptor(M_t.prototype,"playOnAwake"),M_t.prototype),$(M_t.prototype,"volume",[I_t,O_t],Object.getOwnPropertyDescriptor(M_t.prototype,"volume"),M_t.prototype),P_t=M_t))||P_t)||P_t)||P_t));n.AudioSourceComponent=Y_t,le.setClassAlias(Y_t,"cc.AudioSourceComponent");var K_t=t("VideoClip",ru("cc.VideoClip")((X_t=function(t){function e(){var e;return J(e=t.call(this)||this,"_duration",q_t,K(e)),e._video=null,e.loaded=!1,e}return Y(e,t),q(e,[{key:"_nativeAsset",set:function(t){this._video=t,t?(this._duration=t.duration,this.loaded=!0):(this._duration=0,this.loaded=!1)},get:function(){return this._video}}]),e}(M_),q_t=$((j_t=X_t).prototype,"_duration",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W_t=j_t))||W_t);function Z_t(t,e,i){var n=yv.__videoSupport,r=n&&n.format;if(!r||0===r.length)return i(new Error(R(7703)));var a=document.createElement("video"),o=document.createElement("source");a.appendChild(o);var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(){200===this.status||0===this.status?(o.src=URL.createObjectURL(this.response),i(null,a)):i(new Error(s.status+"(no response)"))},s.onerror=function(){var e="load video failure - "+t;_(e),i(new Error(e))},s.send()}function Q_t(t,e,i,n){var r=new K_t;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}_I.register({".mp4":Z_t,".avi":Z_t,".mov":Z_t,".mpg":Z_t,".mpeg":Z_t,".rm":Z_t,".rmvb":Z_t}),yI.register({".mp4":Q_t,".avi":Q_t,".mov":Q_t,".mpg":Q_t,".mpeg":Q_t,".rm":Q_t,".rmvb":Q_t});var J_t,$_t,tft=he({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(J_t||(J_t={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}($_t||($_t={}));var eft=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=J_t.NONE,this._video=null,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(UB),this._onHide=function(){e.video&&e._state===J_t.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onShow=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},n.game.on(n.Game.EVENT_HIDE,this._onHide),n.game.on(n.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(J_t.META_LOADED);var e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(J_t.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(J_t.PLAYING)},e.onPlaying=function(){this.dispatchEvent(J_t.PLAYING)},e.onPause=function(){this._ignorePause?this._ignorePause=!1:(this._playing=!1,this.dispatchEvent(J_t.PAUSED))},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(J_t.STOPPED)},e.onEnded=function(){this.dispatchEvent(J_t.COMPLETED)},e.onClick=function(){this.dispatchEvent(J_t.CLICKED)},e.onError=function(t){this.dispatchEvent(J_t.ERROR);var e=t.target;e&&e.error&&d("Error "+e.error.code+"; details: "+e.error.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){this._uiTrans&&(this._uiTrans.width=t,this._uiTrans.height=e)},e.syncCurrentTime=function(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),n.game.off(n.Game.EVENT_HIDE,this._onHide),n.game.off(n.Game.EVENT_SHOW,this._onShow)},q(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"isPlaying",get:function(){return this._playing}},{key:"UICamera",get:function(){return BR.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();n.internal.VideoPlayerImpl=eft;var ift,nft,rft,aft,oft,sft,lft,cft,hft,uft,_ft,fft,dft,pft,mft,vft,gft,yft,Tft,Sft,Eft,Aft,bft,xft,Cft,wft,Rft,Ift,Oft,Pft,Mft,Dft,Nft,Lft,Bft,Fft,zft,Uft,kft,Gft=-Math.pow(2,15),Hft=qi(),Vft=function(t){function e(e){var i;return(i=t.call(this,e)||this)._eventList=new Map,i._clearColorA=-1,i._clearFlag=void 0,i}Y(e,t);var i=e.prototype;return i.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},i.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,i){t._video&&t._video.removeEventListener(i,e)})),this._eventList.clear()},i.canPlay=function(){var t=this;if(this.video){var e=this.video.play();window.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},i.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},i.resume=function(){this.play()},i.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(J_t.STOPPED)}),0))},i.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},i.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},i.syncPlaybackRate=function(t){yv.browserType!==yv.BROWSER_TYPE_UC?this.video&&(this.video.playbackRate=t):f("playbackRate is not supported by the uc mobile browser.")},i.syncVolume=function(t){this.video&&(this.video.volume=t)},i.syncMute=function(t){this.video&&(this.video.muted=t)},i.syncLoop=function(t){this.video&&(this.video.loop=t)},i.getDuration=function(){return this.video?this.video.duration:0},i.getCurrentTime=function(){return this.video?this.video.currentTime:-1},i.seekTo=function(t){this.video&&(this.video.currentTime=t)},i.canFullScreen=function(t){var e=this,i=this._video;if(i&&i.readyState===$_t.HAVE_ENOUGH_DATA)return yv.os===yv.OS_IOS&&yv.isBrowser?(t?i.webkitEnterFullscreen&&i.webkitEnterFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen(),void(this._fullScreenOnAwake=i.webkitDisplayingFullscreen)):xb.supportsFullScreen?void(t?(yv.browserType===yv.BROWSER_TYPE_IE&&(i.style.transform=""),i.setAttribute("x5-video-player-fullscreen","true"),xb.requestFullScreen(i,(function(t){var n=yv.browserType===yv.BROWSER_TYPE_IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=n===i}),(function(){e._fullScreenOnAwake=!1}))):(i.removeAttribute("x5-video-player-fullscreen"),xb.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},i.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?Gft:0,this._stayOnBottom=t),this._dirty=!0},i.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},i.removeVideoPlayer=function(){var t=this._video;t&&Ae(ub.container,t)&&(ub.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},i.createVideoPlayer=function(t){var e=this._video=document.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),ub.container.appendChild(e);var i=document.createElement("source");e.appendChild(i),i.src=t},i._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},i.onCanPlay=function(e){var i=e.target;if(!this._loaded||!i)switch(i.readyState){case $_t.HAVE_METADATA:case $_t.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},i.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},i.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},i.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICamera;if(t&&!xb.fullScreen()){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=vo.ALL):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(Hft),t.update(!0),t.worldMatrixToScreen(Hft,Hft,ub.canvas.width,ub.canvas.height);var e=0,i=0;if(this._fullScreenOnAwake?(e=_b.width,i=_b.height):(e=this._uiTrans.contentSize.width,i=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==Hft.m00||this._m01!==Hft.m01||this._m04!==Hft.m04||this._m05!==Hft.m05||this._m12!==Hft.m12||this._m13!==Hft.m13||this._w!==e||this._h!==i){this._m00=Hft.m00,this._m01=Hft.m01,this._m04=Hft.m04,this._m05=Hft.m05,this._m12=Hft.m12,this._m13=Hft.m13,this._w=e,this._h=i;var n=gb.getDevicePixelRatio(),r=1/n,a=1/n,o=ub.container,s=Hft.m00*r,l=Hft.m01,c=Hft.m04,h=Hft.m05*a;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",yv.browserType!==yv.BROWSER_TYPE_MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":f("keepAspectRatio is not supported by the qq mobile browser.");var u=this._w*r,_=this._h*a,d=this._uiTrans.anchorPoint,p=d.x,m=d.y,v=u*Hft.m00*p,g=_*Hft.m05*m,y=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,T=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,S="matrix("+s+","+-l+","+-c+","+h+","+(Hft.m12*r-v+y)+","+-(Hft.m13*a-g+T)+")";this._video.style.transform=S,this._video.style["-webkit-transform"]=S,yv.browserType!==yv.BROWSER_TYPE_IE&&(this._forceUpdate=!1)}}}},e}(eft),Wft=function(){function t(){}return t.getImpl=function(t){return new Vft(t)},t}();n.internal.VideoPlayerImplManager=Wft;var jft,qft=t("VideoPlayer",(ift=ru("cc.VideoPlayer"),nft=gu(),rft=du(),aft=au(UB),oft=Fu(K_t),sft=Fu(tft),lft=Eu(),cft=Eu(),hft=Fu(K_t),uft=Eu(),_ft=Eu(),fft=Au(),dft=Eu(),pft=Au(),mft=Eu(),vft=Eu(),gft=Eu(),yft=Eu(),Tft=Eu(),Sft=Eu(),Eft=Fu([yP]),Aft=Ru(),bft=Eu(),ift(xft=nft(xft=rft(xft=aft(xft=fu((kft=Uft=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_resourceType",wft,K(e)),J(e,"_remoteURL",Rft,K(e)),J(e,"_clip",Ift,K(e)),J(e,"_playOnAwake",Oft,K(e)),J(e,"_volume",Pft,K(e)),J(e,"_mute",Mft,K(e)),J(e,"_playbackRate",Dft,K(e)),J(e,"_loop",Nft,K(e)),J(e,"_fullScreenOnAwake",Lft,K(e)),J(e,"_stayOnBottom",Bft,K(e)),J(e,"_keepAspectRatio",Fft,K(e)),e._impl=null,e._cachedCurrentTime=0,J(e,"videoPlayerEvent",zft,K(e)),e}Y(e,t);var i=e.prototype;return i.syncSource=function(){this._impl&&(this._resourceType===tft.REMOTE?this._impl.syncURL(this._remoteURL):this._impl.syncClip(this._clip))},i.__preload=function(){this._impl=Wft.getImpl(this),this.syncSource(),this._impl.syncLoop(this._loop),this._impl.syncVolume(this._volume),this._impl.syncMute(this._mute),this._impl.seekTo(this._cachedCurrentTime),this._impl.syncPlaybackRate(this._playbackRate),this._impl.syncStayOnBottom(this._stayOnBottom),this._impl.syncKeepAspectRatio(this._keepAspectRatio),this._impl.syncFullScreenOnAwake(this._fullScreenOnAwake),this._impl.componentEventList.set(J_t.META_LOADED,this.onMetaLoaded.bind(this)),this._impl.componentEventList.set(J_t.READY_TO_PLAY,this.onReadyToPlay.bind(this)),this._impl.componentEventList.set(J_t.PLAYING,this.onPlaying.bind(this)),this._impl.componentEventList.set(J_t.PAUSED,this.onPasued.bind(this)),this._impl.componentEventList.set(J_t.STOPPED,this.onStopped.bind(this)),this._impl.componentEventList.set(J_t.COMPLETED,this.onCompleted.bind(this)),this._impl.componentEventList.set(J_t.ERROR,this.onError.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},i.onEnable=function(){this._impl&&this._impl.enable()},i.onDisable=function(){this._impl&&this._impl.disable()},i.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},i.update=function(){this._impl&&this._impl.syncMatrix()},i.onMetaLoaded=function(){yP.emitEvents(this.videoPlayerEvent,this,J_t.META_LOADED),this.node.emit("meta-loaded",this)},i.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),yP.emitEvents(this.videoPlayerEvent,this,J_t.READY_TO_PLAY),this.node.emit(J_t.READY_TO_PLAY,this)},i.onPlaying=function(){yP.emitEvents(this.videoPlayerEvent,this,J_t.PLAYING),this.node.emit(J_t.PLAYING,this)},i.onPasued=function(){yP.emitEvents(this.videoPlayerEvent,this,J_t.PAUSED),this.node.emit(J_t.PAUSED,this)},i.onStopped=function(){yP.emitEvents(this.videoPlayerEvent,this,J_t.STOPPED),this.node.emit(J_t.STOPPED,this)},i.onCompleted=function(){yP.emitEvents(this.videoPlayerEvent,this,J_t.COMPLETED),this.node.emit(J_t.COMPLETED,this)},i.onError=function(){yP.emitEvents(this.videoPlayerEvent,this,J_t.ERROR),this.node.emit(J_t.ERROR,this)},i.play=function(){this._impl&&this._impl.play()},i.resume=function(){this._impl&&this._impl.resume()},i.pause=function(){this._impl&&this._impl.pause()},i.stop=function(){this._impl&&this._impl.stop()},q(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){Number.isNaN(t)?f("illegal video time! value:"+t):(t=ci(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:J_t.NONE}},{key:"isPlaying",get:function(){return!!this._impl&&this._impl.isPlaying}}]),e}(Jf),Uft.EventType=J_t,Uft.ResourceType=tft,wft=$((Cft=kft).prototype,"_resourceType",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tft.LOCAL}}),Rft=$(Cft.prototype,"_remoteURL",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ift=$(Cft.prototype,"_clip",[oft,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oft=$(Cft.prototype,"_playOnAwake",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Pft=$(Cft.prototype,"_volume",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Mft=$(Cft.prototype,"_mute",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Dft=$(Cft.prototype,"_playbackRate",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Nft=$(Cft.prototype,"_loop",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Lft=$(Cft.prototype,"_fullScreenOnAwake",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bft=$(Cft.prototype,"_stayOnBottom",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fft=$(Cft.prototype,"_keepAspectRatio",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$(Cft.prototype,"resourceType",[sft,lft],Object.getOwnPropertyDescriptor(Cft.prototype,"resourceType"),Cft.prototype),$(Cft.prototype,"remoteURL",[cft],Object.getOwnPropertyDescriptor(Cft.prototype,"remoteURL"),Cft.prototype),$(Cft.prototype,"clip",[hft,uft],Object.getOwnPropertyDescriptor(Cft.prototype,"clip"),Cft.prototype),$(Cft.prototype,"playOnAwake",[_ft],Object.getOwnPropertyDescriptor(Cft.prototype,"playOnAwake"),Cft.prototype),$(Cft.prototype,"playbackRate",[wu,fft,dft],Object.getOwnPropertyDescriptor(Cft.prototype,"playbackRate"),Cft.prototype),$(Cft.prototype,"volume",[wu,pft,mft],Object.getOwnPropertyDescriptor(Cft.prototype,"volume"),Cft.prototype),$(Cft.prototype,"mute",[vft],Object.getOwnPropertyDescriptor(Cft.prototype,"mute"),Cft.prototype),$(Cft.prototype,"loop",[gft],Object.getOwnPropertyDescriptor(Cft.prototype,"loop"),Cft.prototype),$(Cft.prototype,"keepAspectRatio",[yft],Object.getOwnPropertyDescriptor(Cft.prototype,"keepAspectRatio"),Cft.prototype),$(Cft.prototype,"fullScreenOnAwake",[Tft],Object.getOwnPropertyDescriptor(Cft.prototype,"fullScreenOnAwake"),Cft.prototype),$(Cft.prototype,"stayOnBottom",[Sft],Object.getOwnPropertyDescriptor(Cft.prototype,"stayOnBottom"),Cft.prototype),zft=$(Cft.prototype,"videoPlayerEvent",[cu,Eft,Aft,bft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xft=Cft))||xft)||xft)||xft)||xft)||xft));n.internal.VideoPlayer=qft,function(t){t.NONE="none",t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"}(jft||(jft={}));var Xft=function(){function t(t){this._componentEventList=new Map,this._state=jft.NONE,this._warpper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(UB),this.reset(),this.createWebView()}var e=t.prototype;return e.reset=function(){this._warpper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state=jft.NONE,this._forceUpdate=!1},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);if(e){this._state=t;for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e.call(this,n)}},e.destroy=function(){this.removeWebView(),this._warpper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()},q(t,[{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"webview",get:function(){return this._webview}},{key:"state",get:function(){return this._state}},{key:"UICamera",get:function(){return BR.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();n.internal.WebViewImpl=Xft;var Yft,Kft,Zft,Qft,Jft,$ft,tdt,edt,idt,ndt,rdt,adt,odt,sdt,ldt=qi(),cdt=function(t){function e(e){return t.call(this,e)||this}Y(e,t);var i=e.prototype;return i._bindDomEvent=function(){var t=this;this.webview&&this.webview.addEventListener("load",(function(e){t._forceUpdate=!0,t.dispatchEvent(jft.LOADED);var i=e.target,n=i.contentDocument&&i.contentDocument.body;n&&n.innerHTML.includes("404")&&t.dispatchEvent(jft.ERROR,n.innerHTML)}))},i.loadURL=function(t){this.webview&&(this.webview.src=t,this.dispatchEvent(jft.LOADING))},i.createWebView=function(){var t=document.createElement("div");this._warpper=t,t.id="webview-wrapper",t.style["-webkit-overflow"]="auto",t.style["-webkit-overflow-scrolling"]="touch",t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.style.transformOrigin="0px 100% 0px",t.style["-webkit-transform-origin"]="0px 100% 0px",ub.container.appendChild(t);var e=document.createElement("iframe");this._webview=e,e.id="webview",e.style.border="none",e.style.width="100%",e.style.height="100%",t.appendChild(e),this._bindDomEvent()},i.removeWebView=function(){var t=this._warpper;Ae(ub.container,t)&&ub.container.removeChild(t),this.reset()},i.enable=function(){this._warpper&&(this._warpper.style.visibility="visible")},i.disable=function(){this._warpper&&(this._warpper.style.visibility="hidden")},i.evaluateJS=function(t){if(this.webview){var e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent(jft.ERROR,t),d(t)}}},i.setOnJSCallback=function(){f("The platform does not support")},i.setJavascriptInterfaceScheme=function(){f("The platform does not support")},i.syncMatrix=function(){if(this._warpper&&this._uiTrans&&this._component&&"hidden"!==this._warpper.style.visibility){var t=this.UICamera;if(t){this._component.node.getWorldMatrix(ldt),t.update(!0),t.worldMatrixToScreen(ldt,ldt,ub.canvas.width,ub.canvas.height);var e=this._uiTrans.contentSize,i=e.width,n=e.height;if(this._forceUpdate||this._m00!==ldt.m00||this._m01!==ldt.m01||this._m04!==ldt.m04||this._m05!==ldt.m05||this._m12!==ldt.m12||this._m13!==ldt.m13||this._w!==i||this._h!==n){this._m00=ldt.m00,this._m01=ldt.m01,this._m04=ldt.m04,this._m05=ldt.m05,this._m12=ldt.m12,this._m13=ldt.m13,this._w=i,this._h=n;var r=gb.getDevicePixelRatio(),a=1/r,o=1/r,s=ub.container,l=ldt.m00*a,c=ldt.m01,h=ldt.m04,u=ldt.m05*o;this._warpper.style.width=i+"px",this._warpper.style.height=n+"px";var _=this._w*a,f=this._h*o,d=_*ldt.m00*this._uiTrans.anchorX,p=f*ldt.m05*this._uiTrans.anchorY,m=s&&s.style.paddingLeft?parseInt(s.style.paddingLeft):0,v=s&&s.style.paddingBottom?parseInt(s.style.paddingBottom):0,g="matrix("+l+","+-c+","+-h+","+u+","+(ldt.m12*a-d+m)+","+-(ldt.m13*o-p+v)+")";this._warpper.style.transform=g,this._warpper.style["-webkit-transform"]=g,this._forceUpdate=!1}}}},e}(Xft),hdt=function(){function t(){}return t.getImpl=function(t){return new cdt(t)},t}();n.internal.WebViewImplManager=hdt;var udt=t("WebView",(Yft=ru("cc.WebView"),Kft=gu(),Zft=du(),Qft=au(UB),Jft=Eu(),$ft=Fu([yP]),tdt=Ru(),edt=Eu(),Yft(idt=Kft(idt=Zft(idt=Qft(idt=fu((sdt=odt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return J(e=t.call.apply(t,[this].concat(n))||this,"_url",rdt,K(e)),e._impl=null,J(e,"webviewEvents",adt,K(e)),e}Y(e,t);var i=e.prototype;return i.setJavascriptInterfaceScheme=function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},i.setOnJSCallback=function(t){this._impl&&this._impl.setOnJSCallback(t)},i.evaluateJS=function(t){this._impl&&this._impl.evaluateJS(t)},i.__preload=function(){this._impl=hdt.getImpl(this),this._impl.componentEventList.set(jft.LOADING,this.onLoading.bind(this)),this._impl.componentEventList.set(jft.LOADED,this.onLoaded.bind(this)),this._impl.componentEventList.set(jft.ERROR,this.onError.bind(this)),this._impl.loadURL(this._url)},i.onLoading=function(){yP.emitEvents(this.webviewEvents,this,jft.LOADING),this.node.emit(jft.LOADING,this)},i.onLoaded=function(){yP.emitEvents(this.webviewEvents,this,jft.LOADED),this.node.emit(jft.LOADED,this)},i.onError=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];yP.emitEvents(this.webviewEvents,this,jft.ERROR,e),this.node.emit(jft.ERROR,this,e)},i.onEnable=function(){this._impl&&this._impl.enable()},i.onDisable=function(){this._impl&&this._impl.disable()},i.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},i.update=function(){this._impl&&this._impl.syncMatrix()},q(e,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this._impl&&this._impl.loadURL(t)}},{key:"nativeWebView",get:function(){return this._impl&&this._impl.webview||null}},{key:"state",get:function(){return this._impl?this._impl.state:jft.NONE}}]),e}(Jf),odt.EventType=jft,rdt=$((ndt=sdt).prototype,"_url",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://cocos.com"}}),$(ndt.prototype,"url",[Jft],Object.getOwnPropertyDescriptor(ndt.prototype,"url"),ndt.prototype),adt=$(ndt.prototype,"webviewEvents",[cu,$ft,tdt,edt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),idt=ndt))||idt)||idt)||idt)||idt)||idt));n.internal.WebView=udt;var _dt=0,fdt=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},ddt=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},e._getElement=function(t,e){var i=this._elementPool.pop();return i||(i=new fdt),i.target=t,i.paused=!!e,i},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,i){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+_dt++);var n=this._hashTargets.get(e);n?n.actions||(n.actions=[]):(n=this._getElement(e,i),this._hashTargets.set(e,n),this._arrayTargets.push(n)),n.target=e,n.actions.push(t),t.startWithTarget(e)}else b(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets.get(e);if(i)for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1),i.actionIndex>=n&&i.actionIndex--;break}}},e._removeActionByTag=function(t,e,i){for(var n=0,r=e.actions.length;n<r;++n){var a=e.actions[n];if(a&&a.getTag()===t){if(i&&a.getOriginalTarget()!==i)continue;this._removeActionAtIndex(n,e);break}}},e.removeActionByTag=function(t,e){var i=this;t===n.Action.TAG_INVALID&&T(1002);var r=this._hashTargets;if(e){var a=r.get(e);a&&this._removeActionByTag(t,a,e)}else r.forEach((function(e){i._removeActionByTag(t,e)}))},e.getActionByTag=function(t,e){t===n.Action.TAG_INVALID&&T(1004);var i=this._hashTargets.get(e);if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var a=i.actions[r];if(a&&a.getTag()===t)return a}T(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){n.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var i=this._arrayTargets,n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){this._currentTarget=i[n];var r=(e=this._currentTarget).target;if(r instanceof p_&&!r.isValid)this.removeAllActionsFromTarget(r),n--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var a=e.currentAction;e.currentAction=null,this.removeAction(a)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&n--}}},t}(),pdt=t("TweenSystem",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).actionMgr=new ddt,e}return Y(e,t),e.prototype.update=function(t){this.actionMgr.update(t)},q(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(wb));pdt.ID="TWEEN",pdt.instance=void 0,BR.on(LR.EVENT_INIT,(function(){var t=new pdt;pdt.instance=t,BR.registerSystem(pdt.ID,t,100)}));var mdt=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){T(1006)},e.update=function(){T(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return T(1008),null},e.retain=function(){},e.release=function(){},t}();mdt.TAG_INVALID=-1;var vdt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._duration=0,e._timesForRepeat=1,e}Y(e,t);var i=e.prototype;return i.getDuration=function(){return this._duration*(this._timesForRepeat||1)},i.setDuration=function(t){this._duration=t},i.clone=function(){return new e},e}(mdt),gdt=(function(t){function e(e,i){var n;return void 0===i&&(i=1),(n=t.call(this)||this)._speed=0,n._innerAction=null,e&&n.initWithAction(e,i),n}Y(e,t);var i=e.prototype;i.getSpeed=function(){return this._speed},i.setSpeed=function(t){this._speed=t},i.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(b(1021),!1)},i.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},i.startWithTarget=function(t){mdt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),mdt.prototype.stop.call(this)},i.step=function(t){this._innerAction.step(t*this._speed)},i.isDone=function(){return this._innerAction.isDone()},i.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction}}(mdt),function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.isDone=function(){return!0},i.step=function(){this.update(1)},i.update=function(){},i.reverse=function(){return this.clone()},i.clone=function(){return new e},e}(vdt)),ydt=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(YP),e=0;e<t.length;++e)t[e].enabled=!0},i.reverse=function(){return new Tdt},i.clone=function(){return new e},e}(gdt),Tdt=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(YP),e=0;e<t.length;++e)t[e].enabled=!1},i.reverse=function(){return new ydt},i.clone=function(){return new e},e}(gdt);!function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;i.update=function(){for(var t=this.target.getComponentsInChildren(YP),e=0;e<t.length;++e){var i=t[e];i.enabled=!i.enabled}},i.reverse=function(){return new e},i.clone=function(){return new e}}(gdt);var Sdt=function(t){function e(e){var i;return(i=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&i.init(e),i}Y(e,t);var i=e.prototype;return i.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},i.init=function(t){return this._isNeedCleanUp=t,!0},i.reverse=function(){return new e(this._isNeedCleanUp)},i.clone=function(){return new e(this._isNeedCleanUp)},e}(gdt),Edt=function(t){function e(e,i,n){var r;return(r=t.call(this)||this)._selectorTarget=null,r._function=null,r._data=null,r.initWithFunction(e,i,n),r}Y(e,t);var i=e.prototype;return i.initWithFunction=function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},i.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},i.update=function(){this.execute()},i.getTargetCallback=function(){return this._selectorTarget},i.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},i.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(gdt),Adt=function(t){function e(e){var i;return(i=t.call(this)||this).MAX_VALUE=2,i._elapsed=0,i._firstTick=!1,i._easeList=[],i._speed=1,i._repeatForever=!1,i._repeatMethod=!1,i._speedMethod=!1,void 0===e||isNaN(e)||i.initWithDuration(e),i}Y(e,t);var i=e.prototype;return i.getElapsed=function(){return this._elapsed},i.initWithDuration=function(t){return this._duration=0===t?pe.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},i.isDone=function(){return this._elapsed>=this._duration},i._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},i._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},i.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},i.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},i._computeEaseTime=function(t){return t},i.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},i.startWithTarget=function(t){mdt.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},i.reverse=function(){return T(1010),this},i.setAmplitudeRate=function(){T(1011)},i.getAmplitudeRate=function(){return T(1012),0},i.speed=function(t){return t<=0?(T(1013),this):(this._speedMethod=!0,this._speed*=t,this)},i.getSpeed=function(){return this._speed},i.setSpeed=function(t){return this._speed=t,this},i.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(T(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},i.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(vdt),bdt=function(t){function e(i){var n;(n=t.call(this)||this)._actions=[],n._split=0,n._last=0,n._reversed=!1;var r=i instanceof Array?i:arguments;if(1===r.length)return b(1019),K(n);var a=r.length-1;if(a>=0&&null==r[a]&&T(1015),a>=0){for(var o,s=r[0],l=1;l<a;l++)r[l]&&(o=s,s=e._actionOneTwo(o,r[l]));n.initWithTwoActions(s,r[a])}return n}Y(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return b(1025),!1;var i=t._duration,n=e._duration,r=(i*=t._repeatMethod?t._timesForRepeat:1)+(n*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},i.startWithTarget=function(t){Adt.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},i.stop=function(){-1!==this._last&&this._actions[this._last].stop(),mdt.prototype.stop.call(this)},i.update=function(t){var e,i,n=0,r=this._split,a=this._actions,o=this._last;(t=this._computeEaseTime(t))<r?(e=0!==r?t/r:1,0===n&&1===o&&this._reversed&&(a[1].update(0),a[1].stop())):(n=1,e=1===r?1:(t-r)/(1-r),-1===o&&(a[0].startWithTarget(this.target),a[0].update(1),a[0].stop()),0===o&&(a[0].update(1),a[0].stop())),i=a[n],o===n&&i.isDone()||(o!==n&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=n)},i.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(Adt);function xdt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return b(1019),null;var i=e.length-1;i>=0&&null==e[i]&&T(1015);var n=null;if(i>=0){n=e[0];for(var r=1;r<=i;r++)e[r]&&(n=bdt._actionOneTwo(n,e[r]))}return n}bdt._actionOneTwo=function(t,e){var i=new bdt;return i.initWithTwoActions(t,e),i};var Cdt=function(t){function e(e,i){var n;return(n=t.call(this)||this)._times=0,n._total=0,n._nextDt=0,n._actionInstant=!1,n._innerAction=null,void 0!==i&&n.initWithAction(e,i),n}Y(e,t);var i=e.prototype;return i.initWithAction=function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof gdt&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},i.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,Adt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),mdt.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r>1?1:r;t>=1&&this._total<n&&(e.update(1),this._total++),this._actionInstant||(this._total===n?e.stop():e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},i.isDone=function(){return this._total===this._times},i.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(Adt),wdt=function(t){function e(e){var i;return(i=t.call(this)||this)._innerAction=null,e&&i.initWithAction(e),i}Y(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?(this._innerAction=t,!0):(b(1026),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},i.startWithTarget=function(t){Adt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},i.isDone=function(){return!1},i.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(Adt),Rdt=function(t){function e(i){var n;(n=t.call(this)||this)._one=null,n._two=null;var r=i instanceof Array?i:arguments;if(1===r.length)return b(1020),K(n);var a=r.length-1;if(a>=0&&null==r[a]&&T(1015),a>=0){for(var o,s=r[0],l=1;l<a;l++)r[l]&&(o=s,s=e._actionOneTwo(o,r[l]));n.initWithTwoActions(s,r[a])}return n}Y(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return b(1027),!1;var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,n>r?this._two=bdt._actionOneTwo(e,Pdt(n-r)):n<r&&(this._one=bdt._actionOneTwo(t,Pdt(r-n))),i=!0),i},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},i.startWithTarget=function(t){Adt.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},i.stop=function(){this._one.stop(),this._two.stop(),mdt.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},i.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(Adt);function Idt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return b(1020),null;e.length>0&&null==e[e.length-1]&&T(1015);for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=Rdt._actionOneTwo(i,e[n]));return i}Rdt._actionOneTwo=function(t,e){var i=new Rdt;return i.initWithTwoActions(t,e),i};var Odt=function(t){function e(){return t.apply(this,arguments)||this}Y(e,t);var i=e.prototype;return i.update=function(){},i.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(Adt);function Pdt(t){return new Odt(t)}var Mdt=function(t){function e(e){var i;return(i=t.call(this)||this)._other=null,e&&i.initWithAction(e),i}Y(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?t===this._other?(b(1029),!1):!!Adt.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(b(1028),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},i.startWithTarget=function(t){Adt.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},i.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},i.reverse=function(){return this._other.clone()},i.stop=function(){this._other.stop(),mdt.prototype.stop.call(this)},e}(Adt),Ddt=function(t){function e(e,i,n){var a;if((a=t.call(this)||this)._opts=void 0,a._props=void 0,a._originProps=void 0,null==n)n=Object.create(null);else if(function(t){var e=" [Tween:] ",i=" option is not support in v + "+r,n=t;n.delay&&f(e+"delay"+i),n.repeat&&f(e+"repeat"+i),n.repeatDelay&&f(e+"repeatDelay"+i),n.interpolation&&f(e+"interpolation"+i),n.onStop&&f(e+"onStop"+i)}(n),n.easing&&"string"==typeof n.easing&&(n.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var i=(t=t.replace(e,e.toLowerCase())).split("-");if(2===i.length){var n=i[0];if("linear"===n)t="linear";else{var r=i[1];switch(n){case"quadratic":t="quad"+r;break;case"quartic":t="quart"+r;break;case"quintic":t="quint"+r;break;case"sinusoidal":t="sine"+r;break;case"exponential":t="expo"+r;break;case"circular":t="circ"+r;break;default:t=n+r}}}}return t}(n.easing)),n.progress||(n.progress=a.progress),n.easing&&"string"==typeof n.easing){var o=n.easing;n.easing=sv[o],n.easing||E(1031,o)}for(var s in a._opts=n,a._props=Object.create(null),i)if(i.hasOwnProperty(s)){var l=i[s];if(null!=l&&"string"!=typeof l&&"function"!=typeof l){var c=void 0,h=void 0;void 0!==l.value&&(l.easing||l.progress)&&("string"==typeof l.easing?(c=sv[l.easing])||E(1031,l.easing):c=l.easing,h=l.progress,l=l.value);var u=Object.create(null);u.value=l,u.easing=c,u.progress=h,a._props[s]=u}}return a._originProps=i,a.initWithDuration(e),a}Y(e,t);var i=e.prototype;return i.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},i.startWithTarget=function(t){Adt.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,i=this._props;for(var n in i){var r=t[n];if(void 0!==r){var a=i[n],o=a.value;if("number"==typeof r)a.start=r,a.current=r,a.end=e?r+o:o;else if("object"==typeof r)for(var s in null==a.start&&(a.start={},a.current={},a.end={}),o)isNaN(r[s])||(a.start[s]=r[s],a.current[s]=r[s],a.end[s]=e?r[s]+o[s]:o[s])}}this._opts.onStart&&this._opts.onStart(this.target)},i.update=function(t){var e=this.target;if(e){var i=this._props,n=this._opts,r=t;n.easing&&(r=n.easing(t));var a=n.progress;for(var o in i){var s=i[o],l=s.easing?s.easing(t):r,c=s.progress?s.progress:a,h=s.start,u=s.end;if("number"==typeof h)s.current=c(h,u,s.current,l);else if("object"==typeof h)for(var _ in h)s.current[_]=c(h[_],u[_],s.current[_],l);e[o]=s.current}n.onUpdate&&n.onUpdate(this.target,t),1===t&&n.onComplete&&n.onComplete(this.target)}},i.progress=function(t,e,i,n){return t+(e-t)*n},e}(Adt),Ndt=function(t){function e(e){var i;return(i=t.call(this)||this)._props=void 0,i._props={},void 0!==e&&i.init(e),i}Y(e,t);var i=e.prototype;return i.init=function(t){for(var e in t)this._props[e]=t[e];return!0},i.update=function(){var t=this._props,e=this.target;for(var i in t)e[i]=t[i]},i.clone=function(){var t=new e;return t.init(this._props),t},e}(gdt),Ldt=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=mdt.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof mdt?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&pdt.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),pdt.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(f("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&pdt.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return Bdt(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,i){(i=i||Object.create(null)).relative=!1;var n=new Ddt(t,e,i);return this._actions.push(n),this},e.by=function(t,e,i){(i=i||Object.create(null)).relative=!0;var n=new Ddt(t,e,i);return this._actions.push(n),this},e.set=function(t){var e=new Ndt(t);return this._actions.push(e),this},e.delay=function(t){var e=Pdt(t);return this._actions.push(e),this},e.call=function(t){var e=new Edt(t,void 0,void 0);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,i){if(e==1/0)return this.repeatForever(i);var n,r=this._actions;return n=i instanceof t?i._union():r.pop(),r.push(function(t,e){return new Cdt(t,e)}(n,e)),this},e.repeatForever=function(e){var i,n=this._actions;return i=e instanceof t?e._union():n.pop(),n.push(function(t){return new wdt(t)}(i)),this},e.reverseTime=function(e){var i,n=this._actions;return i=e instanceof t?e._union():n.pop(),n.push(function(t){return new Mdt(t)}(i)),this},e.hide=function(){var t=new Tdt;return this._actions.push(t),this},e.show=function(){var t=new ydt;return this._actions.push(t),this},e.removeSelf=function(){var t=new Sdt(!1);return this._actions.push(t),this},t.stopAll=function(){pdt.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){pdt.instance.ActionManager.removeActionByTag(t,e)},t.stopAllByTarget=function(t){pdt.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:xdt(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,n=0;n<i;n++){var r=e[n]=n<0||arguments.length<=n?void 0:arguments[n];r instanceof t&&(e[n]=r._union())}return xdt.apply(xdt,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,n=0;n<i;n++){var r=e[n]=n<0||arguments.length<=n?void 0:arguments[n];r instanceof t&&(e[n]=r._union())}return Idt.apply(Idt,e)},t}());function Bdt(t){return new Ldt(t)}function Fdt(t){return f("tweenUtil' is deprecated, please use 'tween' instead "),new Ldt(t)}Ldt._tmp_args=[],n.Tween=Ldt,n.tween=Bdt,n.tweenUtil=Fdt;var zdt,Udt,kdt=(zdt=function(t,e){return(zdt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}zdt(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});!function(t){var e,i,n,r=function(){function t(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var n=0;n<e.length;n++)this.timelineIds[e[n].getPropertyId()]=!0;this.duration=i}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,i,n,r,a,o,s){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(i%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,c=0,h=l.length;c<h;c++)l[c].apply(t,e,i,r,a,o,s)},t.binarySearch=function(t,e,i){void 0===i&&(i=1);var n=0,r=t.length/i-2;if(0==r)return i;for(var a=r>>>1;;){if(t[(a+1)*i]<=e?n=a+1:r=a,n==r)return(n+1)*i;a=n+r>>>1}},t.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1},t}();t.Animation=r,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(i=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(n=t.TimelineType||(t.TimelineType={}));var a=function(){function e(i){if(i<=0)throw new Error("frameCount must be > 0: "+i);this.curves=t.Utils.newFloatArray((i-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var i=t*e.BEZIER_SIZE;if(i==this.curves.length)return e.LINEAR;var n=this.curves[i];return n==e.LINEAR?e.LINEAR:n==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,i,n,r,a){var o=.03*(2*-i+r),s=.03*(2*-n+a),l=.006*(3*(i-r)+1),c=.006*(3*(n-a)+1),h=2*o+l,u=2*s+c,_=.3*i+o+.16666667*l,f=.3*n+s+.16666667*c,d=t*e.BEZIER_SIZE,p=this.curves;p[d++]=e.BEZIER;for(var m=_,v=f,g=d+e.BEZIER_SIZE-1;d<g;d+=2)p[d]=m,p[d+1]=v,_+=h,f+=u,h+=l,u+=c,m+=_,v+=f},e.prototype.getCurvePercent=function(i,n){n=t.MathUtils.clamp(n,0,1);var r=this.curves,a=i*e.BEZIER_SIZE,o=r[a];if(o==e.LINEAR)return n;if(o==e.STEPPED)return 0;for(var s=0,l=++a,c=a+e.BEZIER_SIZE-1;a<c;a+=2)if((s=r[a])>=n){var h=void 0,u=void 0;return a==l?(h=0,u=0):(h=r[a-2],u=r[a-1]),u+(r[a+1]-u)*(n-h)/(s-h)}var _=r[a-1];return _+(1-_)*(n-s)/(1-s)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=a;var o=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e<<1),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.rotate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+a.ROTATION]=i},a.prototype.apply=function(t,i,n,o,s,l){var c=this.frames,h=t.bones[this.boneIndex];if(h.active)if(n<c[0])switch(l){case e.setup:return void(h.rotation=h.data.rotation);case e.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*s}else if(n>=c[c.length-a.ENTRIES]){var _=c[c.length+a.PREV_ROTATION];switch(l){case e.setup:h.rotation=h.data.rotation+_*s;break;case e.first:case e.replace:_+=h.data.rotation-h.rotation,_-=360*(16384-(16384.499999999996-_/360|0));case e.add:h.rotation+=_*s}}else{var f=r.binarySearch(c,n,a.ENTRIES),d=c[f+a.PREV_ROTATION],p=c[f],m=this.getCurvePercent((f>>1)-1,1-(n-p)/(c[f+a.PREV_TIME]-p)),v=c[f+a.ROTATION]-d;switch(v=d+(v-360*(16384-(16384.499999999996-v/360|0)))*m,l){case e.setup:h.rotation=h.data.rotation+(v-360*(16384-(16384.499999999996-v/360|0)))*s;break;case e.first:case e.replace:v+=h.data.rotation-h.rotation;case e.add:h.rotation+=(v-360*(16384-(16384.499999999996-v/360|0)))*s}}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_ROTATION=-1,a.ROTATION=1,a}(a);t.RotateTimeline=o;var s=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*a.ENTRIES),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.translate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,i,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.X]=i,this.frames[t+a.Y]=n},a.prototype.apply=function(t,i,n,o,s,l){var c=this.frames,h=t.bones[this.boneIndex];if(h.active)if(n<c[0])switch(l){case e.setup:return h.x=h.data.x,void(h.y=h.data.y);case e.first:h.x+=(h.data.x-h.x)*s,h.y+=(h.data.y-h.y)*s}else{var u=0,_=0;if(n>=c[c.length-a.ENTRIES])u=c[c.length+a.PREV_X],_=c[c.length+a.PREV_Y];else{var f=r.binarySearch(c,n,a.ENTRIES);u=c[f+a.PREV_X],_=c[f+a.PREV_Y];var d=c[f],p=this.getCurvePercent(f/a.ENTRIES-1,1-(n-d)/(c[f+a.PREV_TIME]-d));u+=(c[f+a.X]-u)*p,_+=(c[f+a.Y]-_)*p}switch(l){case e.setup:h.x=h.data.x+u*s,h.y=h.data.y+_*s;break;case e.first:case e.replace:h.x+=(h.data.x+u-h.x)*s,h.y+=(h.data.y+_-h.y)*s;break;case e.add:h.x+=u*s,h.y+=_*s}}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_X=-2,a.PREV_Y=-1,a.X=1,a.Y=2,a}(a);t.TranslateTimeline=s;var l=function(a){function o(t){return a.call(this,t)||this}return kdt(o,a),o.prototype.getPropertyId=function(){return(n.scale<<24)+this.boneIndex},o.prototype.apply=function(n,a,s,l,c,h,u){var _=this.frames,f=n.bones[this.boneIndex];if(f.active)if(s<_[0])switch(h){case e.setup:return f.scaleX=f.data.scaleX,void(f.scaleY=f.data.scaleY);case e.first:f.scaleX+=(f.data.scaleX-f.scaleX)*c,f.scaleY+=(f.data.scaleY-f.scaleY)*c}else{var d=0,p=0;if(s>=_[_.length-o.ENTRIES])d=_[_.length+o.PREV_X]*f.data.scaleX,p=_[_.length+o.PREV_Y]*f.data.scaleY;else{var m=r.binarySearch(_,s,o.ENTRIES);d=_[m+o.PREV_X],p=_[m+o.PREV_Y];var v=_[m],g=this.getCurvePercent(m/o.ENTRIES-1,1-(s-v)/(_[m+o.PREV_TIME]-v));d=(d+(_[m+o.X]-d)*g)*f.data.scaleX,p=(p+(_[m+o.Y]-p)*g)*f.data.scaleY}if(1==c)h==e.add?(f.scaleX+=d-f.data.scaleX,f.scaleY+=p-f.data.scaleY):(f.scaleX=d,f.scaleY=p);else{var y=0,T=0;if(u==i.mixOut)switch(h){case e.setup:y=f.data.scaleX,T=f.data.scaleY,f.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-y)*c,f.scaleY=T+(Math.abs(p)*t.MathUtils.signum(T)-T)*c;break;case e.first:case e.replace:y=f.scaleX,T=f.scaleY,f.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-y)*c,f.scaleY=T+(Math.abs(p)*t.MathUtils.signum(T)-T)*c;break;case e.add:y=f.scaleX,T=f.scaleY,f.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-f.data.scaleX)*c,f.scaleY=T+(Math.abs(p)*t.MathUtils.signum(T)-f.data.scaleY)*c}else switch(h){case e.setup:y=Math.abs(f.data.scaleX)*t.MathUtils.signum(d),T=Math.abs(f.data.scaleY)*t.MathUtils.signum(p),f.scaleX=y+(d-y)*c,f.scaleY=T+(p-T)*c;break;case e.first:case e.replace:y=Math.abs(f.scaleX)*t.MathUtils.signum(d),T=Math.abs(f.scaleY)*t.MathUtils.signum(p),f.scaleX=y+(d-y)*c,f.scaleY=T+(p-T)*c;break;case e.add:y=t.MathUtils.signum(d),T=t.MathUtils.signum(p),f.scaleX=Math.abs(f.scaleX)*y+(d-Math.abs(f.data.scaleX)*y)*c,f.scaleY=Math.abs(f.scaleY)*T+(p-Math.abs(f.data.scaleY)*T)*c}}}},o}(s);t.ScaleTimeline=l;var c=function(t){function i(e){return t.call(this,e)||this}return kdt(i,t),i.prototype.getPropertyId=function(){return(n.shear<<24)+this.boneIndex},i.prototype.apply=function(t,n,a,o,s,l){var c=this.frames,h=t.bones[this.boneIndex];if(h.active)if(a<c[0])switch(l){case e.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case e.first:h.shearX+=(h.data.shearX-h.shearX)*s,h.shearY+=(h.data.shearY-h.shearY)*s}else{var u=0,_=0;if(a>=c[c.length-i.ENTRIES])u=c[c.length+i.PREV_X],_=c[c.length+i.PREV_Y];else{var f=r.binarySearch(c,a,i.ENTRIES);u=c[f+i.PREV_X],_=c[f+i.PREV_Y];var d=c[f],p=this.getCurvePercent(f/i.ENTRIES-1,1-(a-d)/(c[f+i.PREV_TIME]-d));u+=(c[f+i.X]-u)*p,_+=(c[f+i.Y]-_)*p}switch(l){case e.setup:h.shearX=h.data.shearX+u*s,h.shearY=h.data.shearY+_*s;break;case e.first:case e.replace:h.shearX+=(h.data.shearX+u-h.shearX)*s,h.shearY+=(h.data.shearY+_-h.shearY)*s;break;case e.add:h.shearX+=u*s,h.shearY+=_*s}}},i}(s);t.ShearTimeline=c;var h=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*a.ENTRIES),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.color<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,i,n,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=i,this.frames[t+a.G]=n,this.frames[t+a.B]=r,this.frames[t+a.A]=o},a.prototype.apply=function(t,i,n,o,s,l){var c=t.slots[this.slotIndex];if(c.bone.active){var h=this.frames;if(n<h[0])switch(l){case e.setup:return void c.color.setFromColor(c.data.color);case e.first:var u=c.color,_=c.data.color;u.add((_.r-u.r)*s,(_.g-u.g)*s,(_.b-u.b)*s,(_.a-u.a)*s)}else{var f=0,d=0,p=0,m=0;if(n>=h[h.length-a.ENTRIES]){var v=h.length;f=h[v+a.PREV_R],d=h[v+a.PREV_G],p=h[v+a.PREV_B],m=h[v+a.PREV_A]}else{var g=r.binarySearch(h,n,a.ENTRIES);f=h[g+a.PREV_R],d=h[g+a.PREV_G],p=h[g+a.PREV_B],m=h[g+a.PREV_A];var y=h[g],T=this.getCurvePercent(g/a.ENTRIES-1,1-(n-y)/(h[g+a.PREV_TIME]-y));f+=(h[g+a.R]-f)*T,d+=(h[g+a.G]-d)*T,p+=(h[g+a.B]-p)*T,m+=(h[g+a.A]-m)*T}1==s?c.color.set(f,d,p,m):(u=c.color,l==e.setup&&u.setFromColor(c.data.color),u.add((f-u.r)*s,(d-u.g)*s,(p-u.b)*s,(m-u.a)*s))}}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_R=-4,a.PREV_G=-3,a.PREV_B=-2,a.PREV_A=-1,a.R=1,a.G=2,a.B=3,a.A=4,a}(a);t.ColorTimeline=h;var u=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*a.ENTRIES),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.twoColor<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,i,n,r,o,s,l,c){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=i,this.frames[t+a.G]=n,this.frames[t+a.B]=r,this.frames[t+a.A]=o,this.frames[t+a.R2]=s,this.frames[t+a.G2]=l,this.frames[t+a.B2]=c},a.prototype.apply=function(t,i,n,o,s,l){var c=t.slots[this.slotIndex];if(c.bone.active){var h=this.frames;if(n<h[0])switch(l){case e.setup:return c.color.setFromColor(c.data.color),void c.darkColor.setFromColor(c.data.darkColor);case e.first:var u=c.color,_=c.darkColor,f=c.data.color,d=c.data.darkColor;u.add((f.r-u.r)*s,(f.g-u.g)*s,(f.b-u.b)*s,(f.a-u.a)*s),_.add((d.r-_.r)*s,(d.g-_.g)*s,(d.b-_.b)*s,0)}else{var p=0,m=0,v=0,g=0,y=0,T=0,S=0;if(n>=h[h.length-a.ENTRIES]){var E=h.length;p=h[E+a.PREV_R],m=h[E+a.PREV_G],v=h[E+a.PREV_B],g=h[E+a.PREV_A],y=h[E+a.PREV_R2],T=h[E+a.PREV_G2],S=h[E+a.PREV_B2]}else{var A=r.binarySearch(h,n,a.ENTRIES);p=h[A+a.PREV_R],m=h[A+a.PREV_G],v=h[A+a.PREV_B],g=h[A+a.PREV_A],y=h[A+a.PREV_R2],T=h[A+a.PREV_G2],S=h[A+a.PREV_B2];var b=h[A],x=this.getCurvePercent(A/a.ENTRIES-1,1-(n-b)/(h[A+a.PREV_TIME]-b));p+=(h[A+a.R]-p)*x,m+=(h[A+a.G]-m)*x,v+=(h[A+a.B]-v)*x,g+=(h[A+a.A]-g)*x,y+=(h[A+a.R2]-y)*x,T+=(h[A+a.G2]-T)*x,S+=(h[A+a.B2]-S)*x}1==s?(c.color.set(p,m,v,g),c.darkColor.set(y,T,S,1)):(u=c.color,_=c.darkColor,l==e.setup&&(u.setFromColor(c.data.color),_.setFromColor(c.data.darkColor)),u.add((p-u.r)*s,(m-u.g)*s,(v-u.b)*s,(g-u.a)*s),_.add((y-_.r)*s,(T-_.g)*s,(S-_.b)*s,0))}}},a.ENTRIES=8,a.PREV_TIME=-8,a.PREV_R=-7,a.PREV_G=-6,a.PREV_B=-5,a.PREV_A=-4,a.PREV_R2=-3,a.PREV_G2=-2,a.PREV_B2=-1,a.R=1,a.G=2,a.B=3,a.A=4,a.R2=5,a.G2=6,a.B2=7,a}(a);t.TwoColorTimeline=u;var _=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return a.prototype.getPropertyId=function(){return(n.attachment<<24)+this.slotIndex},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},a.prototype.apply=function(t,n,a,o,s,l,c){var h=t.slots[this.slotIndex];if(h.bone.active)if(c!=i.mixOut||l!=e.setup){var u=this.frames;if(a<u[0]){if(l==e.setup||l==e.first){var _=h.data.attachmentName;h.setAttachment(null==_?null:t.getAttachment(this.slotIndex,_))}}else{var f;f=a>=u[u.length-1]?u.length-1:r.binarySearch(u,a,1)-1;var d=this.attachmentNames[f];t.slots[this.slotIndex].setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}}else{var p=h.data.attachmentName;h.setAttachment(null==p?null:t.getAttachment(this.slotIndex,p))}},a}();t.AttachmentTimeline=_;var f=null,d=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e),n.frameVertices=new Array(e),null==f&&(f=t.Utils.newFloatArray(64)),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.deform<<27)+ +this.attachment.id+this.slotIndex},a.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},a.prototype.apply=function(i,n,a,o,s,l){var c=i.slots[this.slotIndex];if(c.bone.active){var h=c.getAttachment();if(h instanceof t.VertexAttachment&&h.deformAttachment==this.attachment){var u=c.deform;0==u.length&&(l=e.setup);var _=this.frameVertices,f=_[0].length,d=this.frames;if(a<d[0]){var p=h;switch(l){case e.setup:return void(u.length=0);case e.first:if(1==s){u.length=0;break}var m=t.Utils.setArraySize(u,f);if(null==p.bones)for(var v=p.vertices,g=0;g<f;g++)m[g]+=(v[g]-m[g])*s;else for(s=1-s,g=0;g<f;g++)m[g]*=s}}else{var y=t.Utils.setArraySize(u,f);if(a>=d[d.length-1]){var T=_[d.length-1];if(1==s)if(l==e.add)if(null==(p=h).bones){v=p.vertices;for(var S=0;S<f;S++)y[S]+=T[S]-v[S]}else for(var E=0;E<f;E++)y[E]+=T[E];else t.Utils.arrayCopy(T,0,y,0,f);else switch(l){case e.setup:var A=h;if(null==A.bones){v=A.vertices;for(var b=0;b<f;b++){var x=v[b];y[b]=x+(T[b]-x)*s}}else for(var C=0;C<f;C++)y[C]=T[C]*s;break;case e.first:case e.replace:for(var w=0;w<f;w++)y[w]+=(T[w]-y[w])*s;case e.add:if(null==(p=h).bones){v=p.vertices;for(var R=0;R<f;R++)y[R]+=(T[R]-v[R])*s}else for(var I=0;I<f;I++)y[I]+=T[I]*s}}else{var O=r.binarySearch(d,a),P=_[O-1],M=_[O],D=d[O],N=this.getCurvePercent(O-1,1-(a-D)/(d[O-1]-D));if(1==s)if(l==e.add)if(null==(p=h).bones){v=p.vertices;for(var L=0;L<f;L++){var B=P[L];y[L]+=B+(M[L]-B)*N-v[L]}}else for(var F=0;F<f;F++)B=P[F],y[F]+=B+(M[F]-B)*N;else for(var z=0;z<f;z++)B=P[z],y[z]=B+(M[z]-B)*N;else switch(l){case e.setup:var U=h;if(null==U.bones){v=U.vertices;for(var k=0;k<f;k++)B=P[k],x=v[k],y[k]=x+(B+(M[k]-B)*N-x)*s}else for(var G=0;G<f;G++)B=P[G],y[G]=(B+(M[G]-B)*N)*s;break;case e.first:case e.replace:for(var H=0;H<f;H++)B=P[H],y[H]+=(B+(M[H]-B)*N-y[H])*s;break;case e.add:if(null==(p=h).bones){v=p.vertices;for(var V=0;V<f;V++)B=P[V],y[V]+=(B+(M[V]-B)*N-v[V])*s}else for(var W=0;W<f;W++)B=P[W],y[W]+=(B+(M[W]-B)*N)*s}}}}}},a}(a);t.DeformTimeline=d;var p=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return n.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,i,n,a,o,s){if(null!=n){var l=this.frames,c=this.frames.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,n,a,o,s),e=-1;else if(e>=l[c-1])return;if(!(i<l[0])){var h=0;if(e<l[0])h=0;else for(var u=l[h=r.binarySearch(l,e)];h>0&&l[h-1]==u;)h--;for(;h<c&&i>=l[h];h++)n.push(this.events[h])}}},e}();t.EventTimeline=p;var m=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return a.prototype.getPropertyId=function(){return n.drawOrder<<24},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},a.prototype.apply=function(n,a,o,s,l,c,h){var u=n.drawOrder,_=n.slots;if(h!=i.mixOut||c!=e.setup){var f=this.frames;if(o<f[0])c!=e.setup&&c!=e.first||t.Utils.arrayCopy(n.slots,0,n.drawOrder,0,n.slots.length);else{var d;d=o>=f[f.length-1]?f.length-1:r.binarySearch(f,o)-1;var p=this.drawOrders[d];if(null==p)t.Utils.arrayCopy(_,0,u,0,_.length);else for(var m=0,v=p.length;m<v;m++)u[m]=_[p[m]]}}else t.Utils.arrayCopy(n.slots,0,n.drawOrder,0,n.slots.length)},a}();t.DrawOrderTimeline=m;var v=function(a){function o(e){var i=a.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*o.ENTRIES),i}return kdt(o,a),o.prototype.getPropertyId=function(){return(n.ikConstraint<<24)+this.ikConstraintIndex},o.prototype.setFrame=function(t,e,i,n,r,a,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.MIX]=i,this.frames[t+o.SOFTNESS]=n,this.frames[t+o.BEND_DIRECTION]=r,this.frames[t+o.COMPRESS]=a?1:0,this.frames[t+o.STRETCH]=s?1:0},o.prototype.apply=function(t,n,a,s,l,c,h){var u=this.frames,_=t.ikConstraints[this.ikConstraintIndex];if(_.active)if(a<u[0])switch(c){case e.setup:return _.mix=_.data.mix,_.softness=_.data.softness,_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,void(_.stretch=_.data.stretch);case e.first:_.mix+=(_.data.mix-_.mix)*l,_.softness+=(_.data.softness-_.softness)*l,_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,_.stretch=_.data.stretch}else if(a>=u[u.length-o.ENTRIES])c==e.setup?(_.mix=_.data.mix+(u[u.length+o.PREV_MIX]-_.data.mix)*l,_.softness=_.data.softness+(u[u.length+o.PREV_SOFTNESS]-_.data.softness)*l,h==i.mixOut?(_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,_.stretch=_.data.stretch):(_.bendDirection=u[u.length+o.PREV_BEND_DIRECTION],_.compress=0!=u[u.length+o.PREV_COMPRESS],_.stretch=0!=u[u.length+o.PREV_STRETCH])):(_.mix+=(u[u.length+o.PREV_MIX]-_.mix)*l,_.softness+=(u[u.length+o.PREV_SOFTNESS]-_.softness)*l,h==i.mixIn&&(_.bendDirection=u[u.length+o.PREV_BEND_DIRECTION],_.compress=0!=u[u.length+o.PREV_COMPRESS],_.stretch=0!=u[u.length+o.PREV_STRETCH]));else{var f=r.binarySearch(u,a,o.ENTRIES),d=u[f+o.PREV_MIX],p=u[f+o.PREV_SOFTNESS],m=u[f],v=this.getCurvePercent(f/o.ENTRIES-1,1-(a-m)/(u[f+o.PREV_TIME]-m));c==e.setup?(_.mix=_.data.mix+(d+(u[f+o.MIX]-d)*v-_.data.mix)*l,_.softness=_.data.softness+(p+(u[f+o.SOFTNESS]-p)*v-_.data.softness)*l,h==i.mixOut?(_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,_.stretch=_.data.stretch):(_.bendDirection=u[f+o.PREV_BEND_DIRECTION],_.compress=0!=u[f+o.PREV_COMPRESS],_.stretch=0!=u[f+o.PREV_STRETCH])):(_.mix+=(d+(u[f+o.MIX]-d)*v-_.mix)*l,_.softness+=(p+(u[f+o.SOFTNESS]-p)*v-_.softness)*l,h==i.mixIn&&(_.bendDirection=u[f+o.PREV_BEND_DIRECTION],_.compress=0!=u[f+o.PREV_COMPRESS],_.stretch=0!=u[f+o.PREV_STRETCH]))}},o.ENTRIES=6,o.PREV_TIME=-6,o.PREV_MIX=-5,o.PREV_SOFTNESS=-4,o.PREV_BEND_DIRECTION=-3,o.PREV_COMPRESS=-2,o.PREV_STRETCH=-1,o.MIX=1,o.SOFTNESS=2,o.BEND_DIRECTION=3,o.COMPRESS=4,o.STRETCH=5,o}(a);t.IkConstraintTimeline=v;var g=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*a.ENTRIES),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.transformConstraint<<24)+this.transformConstraintIndex},a.prototype.setFrame=function(t,e,i,n,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=i,this.frames[t+a.TRANSLATE]=n,this.frames[t+a.SCALE]=r,this.frames[t+a.SHEAR]=o},a.prototype.apply=function(t,i,n,o,s,l){var c=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(h.active)if(n<c[0]){var u=h.data;switch(l){case e.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case e.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*s,h.translateMix+=(u.translateMix-h.translateMix)*s,h.scaleMix+=(u.scaleMix-h.scaleMix)*s,h.shearMix+=(u.shearMix-h.shearMix)*s}}else{var _=0,f=0,d=0,p=0;if(n>=c[c.length-a.ENTRIES]){var m=c.length;_=c[m+a.PREV_ROTATE],f=c[m+a.PREV_TRANSLATE],d=c[m+a.PREV_SCALE],p=c[m+a.PREV_SHEAR]}else{var v=r.binarySearch(c,n,a.ENTRIES);_=c[v+a.PREV_ROTATE],f=c[v+a.PREV_TRANSLATE],d=c[v+a.PREV_SCALE],p=c[v+a.PREV_SHEAR];var g=c[v],y=this.getCurvePercent(v/a.ENTRIES-1,1-(n-g)/(c[v+a.PREV_TIME]-g));_+=(c[v+a.ROTATE]-_)*y,f+=(c[v+a.TRANSLATE]-f)*y,d+=(c[v+a.SCALE]-d)*y,p+=(c[v+a.SHEAR]-p)*y}l==e.setup?(u=h.data,h.rotateMix=u.rotateMix+(_-u.rotateMix)*s,h.translateMix=u.translateMix+(f-u.translateMix)*s,h.scaleMix=u.scaleMix+(d-u.scaleMix)*s,h.shearMix=u.shearMix+(p-u.shearMix)*s):(h.rotateMix+=(_-h.rotateMix)*s,h.translateMix+=(f-h.translateMix)*s,h.scaleMix+=(d-h.scaleMix)*s,h.shearMix+=(p-h.shearMix)*s)}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_ROTATE=-4,a.PREV_TRANSLATE=-3,a.PREV_SCALE=-2,a.PREV_SHEAR=-1,a.ROTATE=1,a.TRANSLATE=2,a.SCALE=3,a.SHEAR=4,a}(a);t.TransformConstraintTimeline=g;var y=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*a.ENTRIES),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.pathConstraintPosition<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.VALUE]=i},a.prototype.apply=function(t,i,n,o,s,l){var c=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(n<c[0])switch(l){case e.setup:return void(h.position=h.data.position);case e.first:h.position+=(h.data.position-h.position)*s}else{var u=0;if(n>=c[c.length-a.ENTRIES])u=c[c.length+a.PREV_VALUE];else{var _=r.binarySearch(c,n,a.ENTRIES);u=c[_+a.PREV_VALUE];var f=c[_],d=this.getCurvePercent(_/a.ENTRIES-1,1-(n-f)/(c[_+a.PREV_TIME]-f));u+=(c[_+a.VALUE]-u)*d}l==e.setup?h.position=h.data.position+(u-h.data.position)*s:h.position+=(u-h.position)*s}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_VALUE=-1,a.VALUE=1,a}(a);t.PathConstraintPositionTimeline=y;var T=function(t){function i(e){return t.call(this,e)||this}return kdt(i,t),i.prototype.getPropertyId=function(){return(n.pathConstraintSpacing<<24)+this.pathConstraintIndex},i.prototype.apply=function(t,n,a,o,s,l){var c=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(a<c[0])switch(l){case e.setup:return void(h.spacing=h.data.spacing);case e.first:h.spacing+=(h.data.spacing-h.spacing)*s}else{var u=0;if(a>=c[c.length-i.ENTRIES])u=c[c.length+i.PREV_VALUE];else{var _=r.binarySearch(c,a,i.ENTRIES);u=c[_+i.PREV_VALUE];var f=c[_],d=this.getCurvePercent(_/i.ENTRIES-1,1-(a-f)/(c[_+i.PREV_TIME]-f));u+=(c[_+i.VALUE]-u)*d}l==e.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*s:h.spacing+=(u-h.spacing)*s}},i}(y);t.PathConstraintSpacingTimeline=T;var S=function(i){function a(e){var n=i.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*a.ENTRIES),n}return kdt(a,i),a.prototype.getPropertyId=function(){return(n.pathConstraintMix<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,i,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=i,this.frames[t+a.TRANSLATE]=n},a.prototype.apply=function(t,i,n,o,s,l){var c=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(n<c[0])switch(l){case e.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case e.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*s,h.translateMix+=(h.data.translateMix-h.translateMix)*s}else{var u=0,_=0;if(n>=c[c.length-a.ENTRIES])u=c[c.length+a.PREV_ROTATE],_=c[c.length+a.PREV_TRANSLATE];else{var f=r.binarySearch(c,n,a.ENTRIES);u=c[f+a.PREV_ROTATE],_=c[f+a.PREV_TRANSLATE];var d=c[f],p=this.getCurvePercent(f/a.ENTRIES-1,1-(n-d)/(c[f+a.PREV_TIME]-d));u+=(c[f+a.ROTATE]-u)*p,_+=(c[f+a.TRANSLATE]-_)*p}l==e.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*s,h.translateMix=h.data.translateMix+(_-h.data.translateMix)*s):(h.rotateMix+=(u-h.rotateMix)*s,h.translateMix+=(_-h.translateMix)*s)}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_ROTATE=-2,a.PREV_TRANSLATE=-1,a.ROTATE=1,a.TRANSLATE=2,a}(a);t.PathConstraintMixTimeline=S}(Udt||(Udt={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new r(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new i})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,n=e.length;i<n;i++){var r=e[i];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var a=t*r.timeScale;if(r.delay>0){if(r.delay-=a,r.delay>0)continue;a=-r.delay,r.delay=0}var o=r.next;if(null!=o){var s=r.trackLast-o.delay;if(s>=0){for(o.delay=0,o.trackTime+=0==r.timeScale?0:(s/r.timeScale+t)*o.timeScale,r.trackTime+=a,this.setCurrent(i,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[i]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var l=r.mixingFrom;for(r.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}r.trackTime+=a}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var n=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),n):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(i){if(null==i)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var n=this.events,r=this.tracks,a=!1,o=0,s=r.length;o<s;o++){var l=r[o];if(!(null==l||l.delay>0)){a=!0;var c=0==o?t.MixBlend.first:l.mixBlend,h=l.alpha;null!=l.mixingFrom?h*=this.applyMixingFrom(l,i,c):l.trackTime>=l.trackEnd&&null==l.next&&(h=0);var u=l.animationLast,_=l.getAnimationTime(),f=l.animation.timelines.length,d=l.animation.timelines;if(0==o&&1==h||c==t.MixBlend.add)for(var p=0;p<f;p++)t.Utils.webkit602BugfixHelper(h,c),d[p].apply(i,u,_,n,h,c,t.MixDirection.mixIn);else{var m=l.timelineMode,v=0==l.timelinesRotation.length;v&&t.Utils.setArraySize(l.timelinesRotation,f<<1,null);var g=l.timelinesRotation;for(p=0;p<f;p++){var y=d[p],T=(m[p]&e.NOT_LAST-1)==e.SUBSEQUENT?c:t.MixBlend.setup;y instanceof t.RotateTimeline?this.applyRotateTimeline(y,i,_,h,T,g,p<<1,v):(t.Utils.webkit602BugfixHelper(h,c),y.apply(i,u,_,n,h,T,t.MixDirection.mixIn))}}this.queueEvents(l,_),n.length=0,l.nextAnimationLast=_,l.nextTrackLast=l.trackTime}}return this.queue.drain(),a},e.prototype.applyMixingFrom=function(i,n,r){var a=i.mixingFrom;null!=a.mixingFrom&&this.applyMixingFrom(a,n,r);var o=0;0==i.mixDuration?(o=1,r==t.MixBlend.first&&(r=t.MixBlend.setup)):((o=i.mixTime/i.mixDuration)>1&&(o=1),r!=t.MixBlend.first&&(r=a.mixBlend));var s=o<a.eventThreshold?this.events:null,l=o<a.attachmentThreshold,c=o<a.drawOrderThreshold,h=a.animationLast,u=a.getAnimationTime(),_=a.animation.timelines.length,f=a.animation.timelines,d=a.alpha*i.interruptAlpha,p=d*(1-o);if(r==t.MixBlend.add)for(var m=0;m<_;m++)f[m].apply(n,h,u,s,p,r,t.MixDirection.mixOut);else{var v=a.timelineMode,g=a.timelineHoldMix,y=0==a.timelinesRotation.length;y&&t.Utils.setArraySize(a.timelinesRotation,_<<1,null);var T=a.timelinesRotation;for(a.totalAlpha=0,m=0;m<_;m++){var S=f[m],E=t.MixDirection.mixOut,A=void 0,b=0;switch(v[m]&e.NOT_LAST-1){case e.SUBSEQUENT:if(A=r,!l&&S instanceof t.AttachmentTimeline){if((v[m]&e.NOT_LAST)==e.NOT_LAST)continue;A=t.MixBlend.setup}if(!c&&S instanceof t.DrawOrderTimeline)continue;b=p;break;case e.FIRST:A=t.MixBlend.setup,b=p;break;case e.HOLD:A=t.MixBlend.setup,b=d;break;default:A=t.MixBlend.setup;var x=g[m];b=d*Math.max(0,1-x.mixTime/x.mixDuration)}a.totalAlpha+=b,S instanceof t.RotateTimeline?this.applyRotateTimeline(S,n,u,b,A,T,m<<1,y):(t.Utils.webkit602BugfixHelper(b,r),A==t.MixBlend.setup&&(S instanceof t.AttachmentTimeline?(l||(v[m]&e.NOT_LAST)==e.NOT_LAST)&&(E=t.MixDirection.mixIn):S instanceof t.DrawOrderTimeline&&c&&(E=t.MixDirection.mixIn)),S.apply(n,h,u,s,b,A,E))}}return i.mixDuration>0&&this.queueEvents(a,u),this.events.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime,o},e.prototype.applyRotateTimeline=function(e,i,n,r,a,o,s,l){if(l&&(o[s]=0),1!=r){var c=e,h=c.frames,u=i.bones[c.boneIndex];if(u.active){var _=0,f=0;if(n<h[0])switch(a){case t.MixBlend.setup:u.rotation=u.data.rotation;default:return;case t.MixBlend.first:_=u.rotation,f=u.data.rotation}else if(_=a==t.MixBlend.setup?u.data.rotation:u.rotation,n>=h[h.length-t.RotateTimeline.ENTRIES])f=u.data.rotation+h[h.length+t.RotateTimeline.PREV_ROTATION];else{var d=t.Animation.binarySearch(h,n,t.RotateTimeline.ENTRIES),p=h[d+t.RotateTimeline.PREV_ROTATION],m=h[d],v=c.getCurvePercent((d>>1)-1,1-(n-m)/(h[d+t.RotateTimeline.PREV_TIME]-m));f=h[d+t.RotateTimeline.ROTATION]-p,f=p+(f-=360*(16384-(16384.499999999996-f/360|0)))*v+u.data.rotation,f-=360*(16384-(16384.499999999996-f/360|0))}var g=0,y=f-_;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))g=o[s];else{var T=0,S=0;l?(T=0,S=y):(T=o[s],S=o[s+1]);var E=y>0,A=T>=0;t.MathUtils.signum(S)!=t.MathUtils.signum(y)&&Math.abs(S)<=90&&(Math.abs(T)>180&&(T+=360*t.MathUtils.signum(T)),A=E),g=y+T-T%360,A!=E&&(g+=360*t.MathUtils.signum(T)),o[s]=g}o[s+1]=y,_+=g*r,u.rotation=_-360*(16384-(16384.499999999996-_/360|0))}}else e.apply(i,0,n,null,1,a,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var i=t.animationStart,n=t.animationEnd,r=n-i,a=t.trackLast%r,o=this.events,s=0,l=o.length;s<l;s++){var c=o[s];if(c.time<a)break;c.time>n||this.queue.event(t,c)}for((t.loop?0==r||a>t.trackTime%r:e>=n&&t.animationLast<n)&&this.queue.complete(t);s<l;s++)o[s].time<i||this.queue.event(t,o[s])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var i=e;;){var n=i.mixingFrom;if(null==n)break;this.queue.end(n),i.mixingFrom=null,i.mixingTo=null,i=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,i){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(i&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,i)},e.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var n=!0,r=this.expandToIndex(t);null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,n=!1):this.disposeNext(r));var a=this.trackEntry(t,e,i,r);return this.setCurrent(t,a,n),this.queue.drain(),a},e.prototype.addAnimation=function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,i,n)},e.prototype.addAnimationWith=function(t,e,i,n){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;var a=this.trackEntry(t,e,i,r);if(null==r)this.setCurrent(t,a,!0),this.queue.drain();else if(r.next=a,n<=0){var o=r.animationEnd-r.animationStart;0!=o?(r.loop?n+=o*(1+(r.trackTime/o|0)):n+=Math.max(o,r.trackTime),n-=this.data.getMix(r.animation,e)):n=r.trackTime}return a.delay=n,a},e.prototype.setEmptyAnimation=function(t,i){var n=this.setAnimationWith(t,e.emptyAnimation,!1);return n.mixDuration=i,n.trackEnd=i,n},e.prototype.addEmptyAnimation=function(t,i,n){n<=0&&(n-=i);var r=this.addAnimationWith(t,e.emptyAnimation,!1,n);return r.mixDuration=i,r.trackEnd=i,r},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,n=this.tracks.length;i<n;i++){var r=this.tracks[i];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,i,n){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=i,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==n?0:this.data.getMix(n.animation,e),r},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,i=this.tracks.length;e<i;e++)if(null!=(n=this.tracks[e])){for(;null!=n.mixingFrom;)n=n.mixingFrom;do{null!=n.mixingFrom&&n.mixBlend==t.MixBlend.add||this.computeHold(n),n=n.mixingTo}while(null!=n)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var n=this.tracks[e];null!=n;)this.computeNotLast(n),n=n.mixingFrom},e.prototype.computeHold=function(i){var n=i.mixingTo,r=i.animation.timelines,a=i.animation.timelines.length,o=t.Utils.setArraySize(i.timelineMode,a);i.timelineHoldMix.length=0;var s=t.Utils.setArraySize(i.timelineHoldMix,a),l=this.propertyIDs;if(null!=n&&n.holdPrevious)for(var c=0;c<a;c++)l.add(r[c].getPropertyId()),o[c]=e.HOLD;else t:for(c=0;c<a;c++){var h=r[c],u=h.getPropertyId();if(l.add(u))if(null==n||h instanceof t.AttachmentTimeline||h instanceof t.DrawOrderTimeline||h instanceof t.EventTimeline||!n.animation.hasTimeline(u))o[c]=e.FIRST;else{for(var _=n.mixingTo;null!=_;_=_.mixingTo)if(!_.animation.hasTimeline(u)){if(i.mixDuration>0){o[c]=e.HOLD_MIX,s[c]=_;continue t}break}o[c]=e.HOLD}else o[c]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(i){for(var n=i.animation.timelines,r=i.animation.timelines.length,a=i.timelineMode,o=this.propertyIDs,s=0;s<r;s++)if(n[s]instanceof t.AttachmentTimeline){var l=n[s];o.add(l.slotIndex)||(a[s]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var i=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=i;var n,r=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(n.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(n.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(n.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(n.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(n.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(n.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var r=t[i],a=t[i+1];switch(r){case n.start:null!=a.listener&&a.listener.start&&a.listener.start(a);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(a);break;case n.interrupt:for(null!=a.listener&&a.listener.interrupt&&a.listener.interrupt(a),o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(a);break;case n.end:for(null!=a.listener&&a.listener.end&&a.listener.end(a),o=0;o<e.length;o++)e[o].end&&e[o].end(a);case n.dispose:for(null!=a.listener&&a.listener.dispose&&a.listener.dispose(a),o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(a);this.animState.trackEntryPool.free(a);break;case n.complete:for(null!=a.listener&&a.listener.complete&&a.listener.complete(a),o=0;o<e.length;o++)e[o].complete&&e[o].complete(a);break;case n.event:var s=t[2+i++];for(null!=a.listener&&a.listener.event&&a.listener.event(a,s),o=0;o<e.length;o++)e[o].event&&e[o].event(a,s)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=r,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(n=t.EventType||(t.EventType={}));var a=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=a}(Udt||(Udt={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,i){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);this.setMixWith(n,r,i)},t.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var n=t.name+"."+e.name;this.animationToMixTime[n]=i},t.prototype.getMix=function(t,e){var i=t.name+"."+e.name,n=this.animationToMixTime[i];return void 0===n?this.defaultMix:n},t}();t.AnimationStateData=e}(Udt||(Udt={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){200==n.status?e(n.responseText):i(n.status,n.responseText)},n.onerror=function(){i(n.status,n.responseText)},n.send()},e.downloadBinary=function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status?e(new Uint8Array(n.response)):i(n.status,n.responseText)},n.onerror=function(){i(n.status,n.responseText)},n.send()},e.prototype.loadBinary=function(t,i,n){var r=this;void 0===i&&(i=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){r.assets[t]=e,i&&i(t,e),r.toLoad--,r.loaded++}),(function(e,i){r.errors[t]="Couldn't load binary "+t+": status "+status+", "+i,n&&n(t,"Couldn't load binary "+t+": status "+status+", "+i),r.toLoad--,r.loaded++}))},e.prototype.loadText=function(t,i,n){var r=this;void 0===i&&(i=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){r.assets[t]=e,i&&i(t,e),r.toLoad--,r.loaded++}),(function(e,i){r.errors[t]="Couldn't load text "+t+": status "+status+", "+i,n&&n(t,"Couldn't load text "+t+": status "+status+", "+i),r.toLoad--,r.loaded++}))},e.prototype.loadTexture=function(t,e,i){var n=this;void 0===e&&(e=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var i=n.textureLoader(r);n.assets[t]=i,n.toLoad--,n.loaded++,e&&e(t,r)},r.onerror=function(){n.errors[t]="Couldn't load image "+t,n.toLoad--,n.loaded++,i&&i(t,"Couldn't load image "+t)},r.src=t},e.prototype.loadTextureData=function(t,e,i,n){var r=this;void 0===i&&(i=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++;var a=new Image;a.onload=function(){var e=r.textureLoader(a);r.assets[t]=e,r.toLoad--,r.loaded++,i&&i(t,a)},a.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,n&&n(t,"Couldn't load image "+t)},a.src=e},e.prototype.loadTextureAtlas=function(i,n,r){var a=this;void 0===n&&(n=null),void 0===r&&(r=null);var o=i.lastIndexOf("/")>=0?i.substring(0,i.lastIndexOf("/")):"";i=this.pathPrefix+i,this.toLoad++,e.downloadText(i,(function(e){var s={count:0},l=new Array;try{new t.TextureAtlas(e,(function(e){l.push(o+"/"+e);var i=document.createElement("img");return i.width=16,i.height=16,new t.FakeTexture(i)}))}catch(t){var c=t;return a.errors[i]="Couldn't load texture atlas "+i+": "+c.message,r&&r(i,"Couldn't load texture atlas "+i+": "+c.message),a.toLoad--,void a.loaded++}for(var h=function(c){var h=!1;a.loadTexture(c,(function(c){if(s.count++,s.count==l.length)if(h)a.errors[i]="Couldn't load texture atlas page "+c+"} of atlas "+i,r&&r(i,"Couldn't load texture atlas page "+c+" of atlas "+i),a.toLoad--,a.loaded++;else try{var u=new t.TextureAtlas(e,(function(t){return a.get(o+"/"+t)}));a.assets[i]=u,n&&n(i,u),a.toLoad--,a.loaded++}catch(t){var _=t;a.errors[i]="Couldn't load texture atlas "+i+": "+_.message,r&&r(i,"Couldn't load texture atlas "+i+": "+_.message),a.toLoad--,a.loaded++}}),(function(t){h=!0,s.count++,s.count==l.length&&(a.errors[i]="Couldn't load texture atlas page "+t+"} of atlas "+i,r&&r(i,"Couldn't load texture atlas page "+t+" of atlas "+i),a.toLoad--,a.loaded++)}))},u=0,_=l;u<_.length;u++)h(_[u])}),(function(t,e){a.errors[i]="Couldn't load texture atlas "+i+": status "+status+", "+e,r&&r(i,"Couldn't load texture atlas "+i+": status "+status+", "+e),a.toLoad--,a.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(Udt||(Udt={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,i,n){var r=this.atlas.findRegion(n);if(null==r)return null;r.renderObject=r;var a=new t.RegionAttachment(i);return a.setRegion(r),a},e.prototype.newMeshAttachment=function(e,i,n){var r=this.atlas.findRegion(n);if(null==r)return null;r.renderObject=r;var a=new t.MeshAttachment(i);return a.region=r,a},e.prototype.newBoundingBoxAttachment=function(e,i){return new t.BoundingBoxAttachment(i)},e.prototype.newPathAttachment=function(e,i){return new t.PathAttachment(i)},e.prototype.newPointAttachment=function(e,i){return new t.PointAttachment(i)},e.prototype.newClippingAttachment=function(e,i){return new t.ClippingAttachment(i)},e}();t.AtlasAttachmentLoader=e}(Udt||(Udt={})),function(t){var e;(e=t.BlendMode||(t.BlendMode={}))[e.Normal=0]="Normal",e[e.Additive=1]="Additive",e[e.Multiply=2]="Multiply",e[e.Screen=3]="Screen"}(Udt||(Udt={})),function(t){var e=function(){function e(t,e,i){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,i,n,r,a,o,s){this.ax=e,this.ay=i,this.arotation=n,this.ascaleX=r,this.ascaleY=a,this.ashearX=o,this.ashearY=s,this.appliedValid=!0;var l=this.parent;if(null==l){var c=this.skeleton,h=n+90+s,u=c.scaleX,_=c.scaleY;return this.a=t.MathUtils.cosDeg(n+o)*r*u,this.b=t.MathUtils.cosDeg(h)*a*u,this.c=t.MathUtils.sinDeg(n+o)*r*_,this.d=t.MathUtils.sinDeg(h)*a*_,this.worldX=e*u+c.x,void(this.worldY=i*_+c.y)}var f=l.a,d=l.b,p=l.c,m=l.d;switch(this.worldX=f*e+d*i+l.worldX,this.worldY=p*e+m*i+l.worldY,this.data.transformMode){case t.TransformMode.Normal:h=n+90+s;var v=t.MathUtils.cosDeg(n+o)*r,g=t.MathUtils.cosDeg(h)*a,y=t.MathUtils.sinDeg(n+o)*r,T=t.MathUtils.sinDeg(h)*a;return this.a=f*v+d*y,this.b=f*g+d*T,this.c=p*v+m*y,void(this.d=p*g+m*T);case t.TransformMode.OnlyTranslation:h=n+90+s,this.a=t.MathUtils.cosDeg(n+o)*r,this.b=t.MathUtils.cosDeg(h)*a,this.c=t.MathUtils.sinDeg(n+o)*r,this.d=t.MathUtils.sinDeg(h)*a;break;case t.TransformMode.NoRotationOrReflection:var S=0;(b=f*f+p*p)>1e-4?(d=p*(b=Math.abs(f*m-d*p)/b),m=f*b,S=Math.atan2(p,f)*t.MathUtils.radDeg):(f=0,p=0,S=90-Math.atan2(m,d)*t.MathUtils.radDeg);var E=n+o-S,A=n+s-S+90;v=t.MathUtils.cosDeg(E)*r,g=t.MathUtils.cosDeg(A)*a,y=t.MathUtils.sinDeg(E)*r,T=t.MathUtils.sinDeg(A)*a,this.a=f*v-d*y,this.b=f*g-d*T,this.c=p*v+m*y,this.d=p*g+m*T;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var b,x=t.MathUtils.cosDeg(n),C=t.MathUtils.sinDeg(n),w=(f*x+d*C)/this.skeleton.scaleX,R=(p*x+m*C)/this.skeleton.scaleY;(b=Math.sqrt(w*w+R*R))>1e-5&&(b=1/b),w*=b,R*=b,b=Math.sqrt(w*w+R*R),this.data.transformMode==t.TransformMode.NoScale&&f*m-d*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(b=-b);var I=Math.PI/2+Math.atan2(R,w),O=Math.cos(I)*b,P=Math.sin(I)*b;v=t.MathUtils.cosDeg(o)*r,g=t.MathUtils.cosDeg(90+s)*a,y=t.MathUtils.sinDeg(o)*r,T=t.MathUtils.sinDeg(90+s)*a,this.a=w*v+O*y,this.b=w*g+O*T,this.c=R*v+P*y,this.d=R*g+P*T}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var i=e.a,n=e.b,r=e.c,a=e.d,o=1/(i*a-n*r),s=this.worldX-e.worldX,l=this.worldY-e.worldY;this.ax=s*a*o-l*n*o,this.ay=l*i*o-s*r*o;var c=o*a,h=o*i,u=o*n,_=o*r,f=c*this.a-u*this.c,d=c*this.b-u*this.d,p=h*this.c-_*this.a,m=h*this.d-_*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(f*f+p*p),this.ascaleX>1e-4){var v=f*m-d*p;this.ascaleY=v/this.ascaleX,this.ashearY=Math.atan2(f*d+p*m,v)*t.MathUtils.radDeg,this.arotation=Math.atan2(p,f)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(d*d+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,d)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,a=1/(e*r-i*n),o=t.x-this.worldX,s=t.y-this.worldY;return t.x=o*r*a-s*i*a,t.y=s*e*a-o*n*a,t},e.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var i=t.MathUtils.sinDeg(e),n=t.MathUtils.cosDeg(e);return Math.atan2(this.a*i-this.c*n,this.d*n-this.b*i)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var i=t.MathUtils.sinDeg(e),n=t.MathUtils.cosDeg(e);return Math.atan2(n*this.c+i*this.d,n*this.a+i*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var i=this.a,n=this.b,r=this.c,a=this.d,o=t.MathUtils.cosDeg(e),s=t.MathUtils.sinDeg(e);this.a=o*i-s*r,this.b=o*n-s*a,this.c=s*i+o*r,this.d=s*n+o*a,this.appliedValid=!1},e}();t.Bone=e}(Udt||(Udt={})),function(t){var e;t.BoneData=function(i,n,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,i<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");this.index=i,this.name=n,this.parent=r},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(Udt||(Udt={})),function(t){t.ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i}}(Udt||(Udt={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(Udt||(Udt={})),function(t){t.EventData=function(t){this.name=t}}(Udt||(Udt={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,i,n,r,a,o,s){e.appliedValid||e.updateAppliedTransform();var l=e.parent,c=1/(l.a*l.d-l.b*l.c),h=i-l.worldX,u=n-l.worldY,_=(h*l.d-u*l.b)*c-e.ax,f=(u*l.a-h*l.c)*c-e.ay,d=Math.atan2(f,_)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var p=e.ascaleX,m=e.ascaleY;if(r||a){var v=e.data.length*p,g=Math.sqrt(_*_+f*f);if(r&&g<v||a&&g>v&&v>1e-4){var y=(g/v-1)*s+1;p*=y,o&&(m*=y)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+d*s,p,m,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,i,n,r,a,o,s,l){if(0!=l){e.appliedValid||e.updateAppliedTransform(),i.appliedValid||i.updateAppliedTransform();var c=e.ax,h=e.ay,u=e.ascaleX,_=u,f=e.ascaleY,d=i.ascaleX,p=0,m=0,v=0;u<0?(u=-u,p=180,v=-1):(p=0,v=1),f<0&&(f=-f,v=-v),d<0?(d=-d,m=180):m=0;var g=i.ax,y=0,T=0,S=0,E=e.a,A=e.b,b=e.c,x=e.d,C=Math.abs(u-f)<=1e-4;C?(T=E*g+A*(y=i.ay)+e.worldX,S=b*g+x*y+e.worldY):(y=0,T=E*g+e.worldX,S=b*g+e.worldY);var w=e.parent;E=w.a,A=w.b,b=w.c;var R,I,O=1/(E*(x=w.d)-A*b),P=T-w.worldX,M=S-w.worldY,D=(P*x-M*A)*O-c,N=(M*E-P*b)*O-h,L=Math.sqrt(D*D+N*N),B=i.data.length*d;if(L<1e-4)return this.apply1(e,n,r,!1,o,!1,l),void i.updateWorldTransformWith(g,y,0,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY);var F=((P=n-w.worldX)*x-(M=r-w.worldY)*A)*O-c,z=(M*E-P*b)*O-h,U=F*F+z*z;if(0!=s){s*=u*(d+1)/2;var k=Math.sqrt(U),G=k-L-B*u+s;if(G>0){var H=Math.min(1,G/(2*s))-1;U=(F-=(H=(G-s*(1-H*H))/k)*F)*F+(z-=H*z)*z}}t:if(C){var V=(U-L*L-(B*=u)*B)/(2*L*B);V<-1?V=-1:V>1&&(V=1,o&&(_*=(Math.sqrt(U)/(L+B)-1)*l+1)),I=Math.acos(V)*a,E=L+B*V,A=B*Math.sin(I),R=Math.atan2(z*E-F*A,F*E+z*A)}else{var W=(E=u*B)*E,j=(A=f*B)*A,q=Math.atan2(z,F),X=-2*j*L,Y=j-W;if((x=X*X-4*Y*(b=j*L*L+W*U-W*j))>=0){var K=Math.sqrt(x);X<0&&(K=-K);var Z=(K=-(X+K)/2)/Y,Q=b/K,J=Math.abs(Z)<Math.abs(Q)?Z:Q;if(J*J<=U){M=Math.sqrt(U-J*J)*a,R=q-Math.atan2(M,J),I=Math.atan2(M/f,(J-L)/u);break t}}var $=t.MathUtils.PI,tt=L-E,et=tt*tt,it=0,nt=0,rt=L+E,at=rt*rt,ot=0;(b=-E*L/(W-j))>=-1&&b<=1&&(b=Math.acos(b),(x=(P=E*Math.cos(b)+L)*P+(M=A*Math.sin(b))*M)<et&&($=b,et=x,tt=P,it=M),x>at&&(nt=b,at=x,rt=P,ot=M)),U<=(et+at)/2?(R=q-Math.atan2(it*a,tt),I=$*a):(R=q-Math.atan2(ot*a,rt),I=nt*a)}var st=Math.atan2(y,g)*v,lt=e.arotation;(R=(R-st)*t.MathUtils.radDeg+p-lt)>180?R-=360:R<-180&&(R+=360),e.updateWorldTransformWith(c,h,lt+R*l,_,e.ascaleY,0,0),lt=i.arotation,(I=((I+st)*t.MathUtils.radDeg-i.ashearX)*v+m-lt)>180?I-=360:I<-180&&(I+=360),i.updateWorldTransformWith(g,y,lt+I*l,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)}else i.updateWorldTransform()},e}();t.IkConstraint=e}(Udt||(Udt={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.bendDirection=1,i.compress=!1,i.stretch=!1,i.uniform=!1,i.mix=1,i.softness=0,i}return kdt(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(Udt||(Udt={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var i=this.target.getAttachment();if(i instanceof t.PathAttachment){var n=this.rotateMix,r=this.translateMix,a=n>0;if(r>0||a){var o=this.data,s=o.spacingMode==t.SpacingMode.Percent,l=o.rotateMode,c=l==t.RotateMode.Tangent,h=l==t.RotateMode.ChainScale,u=this.bones.length,_=c?u:u+1,f=this.bones,d=t.Utils.setArraySize(this.spaces,_),p=null,m=this.spacing;if(h||!s){h&&(p=t.Utils.setArraySize(this.lengths,u));for(var v=o.spacingMode==t.SpacingMode.Length,g=0,y=_-1;g<y;){var T=(P=f[g]).data.length;if(T<e.epsilon)h&&(p[g]=0),d[++g]=0;else if(s){if(h){var S=T*P.a,E=T*P.c,A=Math.sqrt(S*S+E*E);p[g]=A}d[++g]=m}else{S=T*P.a,E=T*P.c;var b=Math.sqrt(S*S+E*E);h&&(p[g]=b),d[++g]=(v?T+m:m)*b/T}}}else for(g=1;g<_;g++)d[g]=m;var x=this.computeWorldPositions(i,_,c,o.positionMode==t.PositionMode.Percent,s),C=x[0],w=x[1],R=o.offsetRotation,I=!1;0==R?I=l==t.RotateMode.Chain:(I=!1,R*=(O=this.target.bone).a*O.d-O.b*O.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),g=0;for(var O=3;g<u;g++,O+=3){var P;(P=f[g]).worldX+=(C-P.worldX)*r,P.worldY+=(w-P.worldY)*r;var M=(S=x[O])-C,D=(E=x[O+1])-w;if(h){var N=p[g];if(0!=N){var L=(Math.sqrt(M*M+D*D)/N-1)*n+1;P.a*=L,P.c*=L}}if(C=S,w=E,a){var B=P.a,F=P.b,z=P.c,U=P.d,k=0,G=0,H=0;if(k=c?x[O-1]:0==d[g+1]?x[O+2]:Math.atan2(D,M),k-=Math.atan2(z,B),I){G=Math.cos(k),H=Math.sin(k);var V=P.data.length;C+=(V*(G*B-H*z)-M)*n,w+=(V*(H*B+G*z)-D)*n}else k+=R;k>t.MathUtils.PI?k-=t.MathUtils.PI2:k<-t.MathUtils.PI&&(k+=t.MathUtils.PI2),k*=n,G=Math.cos(k),H=Math.sin(k),P.a=G*B-H*z,P.b=G*F-H*U,P.c=H*B+G*z,P.d=H*F+G*U}P.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(i,n,r,a,o){var s=this.target,l=this.position,c=this.spaces,h=t.Utils.setArraySize(this.positions,3*n+2),u=null,_=i.closed,f=i.worldVerticesLength,d=f/6,p=e.NONE;if(!i.constantSpeed){var m=i.lengths,v=m[d-=_?1:2];if(a&&(l*=v),o)for(var g=1;g<n;g++)c[g]*=v;u=t.Utils.setArraySize(this.world,8),g=0;for(var y=0,T=0;g<n;g++,y+=3){var S=l+=j=c[g];if(_)(S%=v)<0&&(S+=v),T=0;else{if(S<0){p!=e.BEFORE&&(p=e.BEFORE,i.computeWorldVertices(s,2,4,u,0,2)),this.addBeforePosition(S,u,0,h,y);continue}if(S>v){p!=e.AFTER&&(p=e.AFTER,i.computeWorldVertices(s,f-6,4,u,0,2)),this.addAfterPosition(S-v,u,0,h,y);continue}}for(;;T++){var E=m[T];if(!(S>E)){0==T?S/=E:S=(S-(K=m[T-1]))/(E-K);break}}T!=p&&(p=T,_&&T==d?(i.computeWorldVertices(s,f-4,4,u,0,2),i.computeWorldVertices(s,0,4,u,4,2)):i.computeWorldVertices(s,6*T+2,8,u,0,2)),this.addCurvePosition(S,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,y,r||g>0&&0==j)}return h}_?(f+=2,u=t.Utils.setArraySize(this.world,f),i.computeWorldVertices(s,2,f-4,u,0,2),i.computeWorldVertices(s,0,2,u,f-4,2),u[f-2]=u[0],u[f-1]=u[1]):(d--,f-=4,u=t.Utils.setArraySize(this.world,f),i.computeWorldVertices(s,2,f,u,0,2));for(var A=t.Utils.setArraySize(this.curves,d),b=0,x=u[0],C=u[1],w=0,R=0,I=0,O=0,P=0,M=0,D=0,N=0,L=0,B=0,F=0,z=0,U=0,k=0,G=(g=0,2);g<d;g++,G+=6)w=u[G],R=u[G+1],I=u[G+2],O=u[G+3],F=2*(D=.1875*(x-2*w+I))+(L=.09375*(3*(w-I)-x+(P=u[G+4]))),z=2*(N=.1875*(C-2*R+O))+(B=.09375*(3*(R-O)-C+(M=u[G+5]))),U=.75*(w-x)+D+.16666667*L,k=.75*(R-C)+N+.16666667*B,b+=Math.sqrt(U*U+k*k),U+=F,k+=z,F+=L,z+=B,b+=Math.sqrt(U*U+k*k),U+=F,k+=z,b+=Math.sqrt(U*U+k*k),U+=F+L,k+=z+B,b+=Math.sqrt(U*U+k*k),A[g]=b,x=P,C=M;if(l*=a?b:b/i.lengths[d-1],o)for(g=1;g<n;g++)c[g]*=b;for(var H=this.segments,V=0,W=(g=0,y=0,T=0,0);g<n;g++,y+=3){var j;if(S=l+=j=c[g],_)(S%=b)<0&&(S+=b),T=0;else{if(S<0){this.addBeforePosition(S,u,0,h,y);continue}if(S>b){this.addAfterPosition(S-b,u,f-4,h,y);continue}}for(;;T++){var q=A[T];if(!(S>q)){0==T?S/=q:S=(S-(K=A[T-1]))/(q-K);break}}if(T!=p){p=T;var X=6*T;for(x=u[X],C=u[X+1],w=u[X+2],R=u[X+3],I=u[X+4],O=u[X+5],F=2*(D=.03*(x-2*w+I))+(L=.006*(3*(w-I)-x+(P=u[X+6]))),z=2*(N=.03*(C-2*R+O))+(B=.006*(3*(R-O)-C+(M=u[X+7]))),U=.3*(w-x)+D+.16666667*L,k=.3*(R-C)+N+.16666667*B,V=Math.sqrt(U*U+k*k),H[0]=V,X=1;X<8;X++)U+=F,k+=z,F+=L,z+=B,V+=Math.sqrt(U*U+k*k),H[X]=V;U+=F,k+=z,V+=Math.sqrt(U*U+k*k),H[8]=V,U+=F+L,k+=z+B,V+=Math.sqrt(U*U+k*k),H[9]=V,W=0}for(S*=V;;W++){var Y=H[W];if(!(S>Y)){var K;0==W?S/=Y:S=W+(S-(K=H[W-1]))/(Y-K);break}}this.addCurvePosition(.1*S,x,C,w,R,I,O,P,M,h,y,r||g>0&&0==j)}return h},e.prototype.addBeforePosition=function(t,e,i,n,r){var a=e[i],o=e[i+1],s=e[i+2]-a,l=e[i+3]-o,c=Math.atan2(l,s);n[r]=a+t*Math.cos(c),n[r+1]=o+t*Math.sin(c),n[r+2]=c},e.prototype.addAfterPosition=function(t,e,i,n,r){var a=e[i+2],o=e[i+3],s=a-e[i],l=o-e[i+1],c=Math.atan2(l,s);n[r]=a+t*Math.cos(c),n[r+1]=o+t*Math.sin(c),n[r+2]=c},e.prototype.addCurvePosition=function(t,e,i,n,r,a,o,s,l,c,h,u){if(0==t||isNaN(t))return c[h]=e,c[h+1]=i,void(c[h+2]=Math.atan2(r-i,n-e));var _=t*t,f=_*t,d=1-t,p=d*d,m=p*d,v=d*t,g=3*v,y=d*g,T=g*t,S=e*m+n*y+a*T+s*f,E=i*m+r*y+o*T+l*f;c[h]=S,c[h+1]=E,u&&(c[h+2]=t<.001?Math.atan2(r-i,n-e):Math.atan2(E-(i*p+r*v*2+o*_),S-(e*p+n*v*2+a*_)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(Udt||(Udt={})),function(t){var e,i,n,r=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i}return kdt(e,t),e}(t.ConstraintData);t.PathConstraintData=r,(n=t.PositionMode||(t.PositionMode={}))[n.Fixed=0]="Fixed",n[n.Percent=1]="Percent",(i=t.SpacingMode||(t.SpacingMode={}))[i.Length=0]="Length",i[i.Fixed=1]="Fixed",i[i.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(Udt||(Udt={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),i=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,i,n){var r=this.clientAssets[t];return null==r&&(r=new e(t),this.clientAssets[t]=r),null!==i&&(r.textureLoader=i),r.toLoad.push(n),this.queuedAssets[n]!==n&&(this.queuedAssets[n]=n,!0)},t.prototype.loadText=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(n.status>=200&&n.status<300?i.rawAssets[e]=n.responseText:i.errors[e]="Couldn't load text "+e+": status "+n.status+", "+n.responseText)},n.open("GET",e,!0),n.send()}},t.prototype.loadJson=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(n.status>=200&&n.status<300?i.rawAssets[e]=JSON.parse(n.responseText):i.errors[e]="Couldn't load text "+e+": status "+n.status+", "+n.responseText)},n.open("GET",e,!0),n.send()}},t.prototype.loadTexture=function(t,e,i){var n=this;if(i=this.pathPrefix+i,this.queueAsset(t,e,i)){var r=new Image;r.src=i,r.crossOrigin="anonymous",r.onload=function(){n.rawAssets[i]=r},r.onerror=function(){n.errors[i]="Couldn't load image "+i}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var i=this.clientAssets[t];return null==i||i.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e];if(null==t.assets[i]){var n=this.rawAssets[i];if(null==n)continue;n instanceof HTMLImageElement?t.assets[i]=t.textureLoader(n):t.assets[i]=n}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=i}(Udt||(Udt={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var i=0;i<e.bones.length;i++){var n=e.bones[i],r=void 0;if(null==n.parent)r=new t.Bone(n,this,null);else{var a=this.bones[n.parent.index];r=new t.Bone(n,this,a),a.children.push(r)}this.bones.push(r)}for(this.slots=new Array,this.drawOrder=new Array,i=0;i<e.slots.length;i++){var o=e.slots[i],s=(r=this.bones[o.boneData.index],new t.Slot(o,r));this.slots.push(s),this.drawOrder.push(s)}for(this.ikConstraints=new Array,i=0;i<e.ikConstraints.length;i++){var l=e.ikConstraints[i];this.ikConstraints.push(new t.IkConstraint(l,this))}for(this.transformConstraints=new Array,i=0;i<e.transformConstraints.length;i++){var c=e.transformConstraints[i];this.transformConstraints.push(new t.TransformConstraint(c,this))}for(this.pathConstraints=new Array,i=0;i<e.pathConstraints.length;i++){var h=e.pathConstraints[i];this.pathConstraints.push(new t.PathConstraint(h,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)(r=t[e]).sorted=r.data.skinRequired,r.active=!r.sorted;if(null!=this.skin){var n=this.skin.bones;for(e=0,i=this.skin.bones.length;e<i;e++){var r=this.bones[n[e].index];do{r.sorted=!1,r.active=!0,r=r.parent}while(null!=r)}}var a=this.ikConstraints,o=this.transformConstraints,s=this.pathConstraints,l=a.length,c=o.length,h=s.length,u=l+c+h;t:for(e=0;e<u;e++){for(var _=0;_<l;_++)if((f=a[_]).data.order==e){this.sortIkConstraint(f);continue t}for(_=0;_<c;_++)if((f=o[_]).data.order==e){this.sortTransformConstraint(f);continue t}for(_=0;_<h;_++){var f;if((f=s[_]).data.order==e){this.sortPathConstraint(f);continue t}}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target;this.sortBone(i);var n=e.bones,r=n[0];if(this.sortBone(r),n.length>1){var a=n[n.length-1];this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}this._updateCache.push(e),this.sortReset(r.children),n[n.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target,n=i.data.index,r=i.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(var a=0,o=this.data.skins.length;a<o;a++)this.sortPathConstraintAttachment(this.data.skins[a],n,r);var s=i.getAttachment();s instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(s,r);var l=e.bones,c=l.length;for(a=0;a<c;a++)this.sortBone(l[a]);for(this._updateCache.push(e),a=0;a<c;a++)this.sortReset(l[a].children);for(a=0;a<c;a++)l[a].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var i=e.bones,n=i.length;if(e.data.local)for(var r=0;r<n;r++){var a=i[r];this.sortBone(a.parent),this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}else for(r=0;r<n;r++)this.sortBone(i[r]);this._updateCache.push(e);for(var o=0;o<n;o++)this.sortReset(i[o].children);for(o=0;o<n;o++)i[o].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,i){var n=t.attachments[e];if(n)for(var r in n)this.sortPathConstraintAttachmentWith(n[r],i)},e.prototype.sortPathConstraintAttachmentWith=function(e,i){if(e instanceof t.PathAttachment){var n=e.bones;if(null==n)this.sortBone(i);else for(var r=this.bones,a=0;a<n.length;)for(var o=n[a++],s=a+o;a<s;a++){var l=n[a];this.sortBone(r[l])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}var r=this._updateCache;for(e=0,i=r.length;e<i;e++)r[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var n=this.ikConstraints;for(e=0,i=n.length;e<i;e++)(s=n[e]).mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;var r=this.transformConstraints;for(e=0,i=r.length;e<i;e++){var a=(s=r[e]).data;s.rotateMix=a.rotateMix,s.translateMix=a.translateMix,s.scaleMix=a.scaleMix,s.shearMix=a.shearMix}var o=this.pathConstraints;for(e=0,i=o.length;e<i;e++){var s;a=(s=o[e]).data,s.position=a.position,s.spacing=a.spacing,s.rotateMix=a.rotateMix,s.translateMix=a.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var i=0,n=e.length;i<n;i++)e[i].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],a=r.data.attachmentName;if(null!=a){var o=t.getAttachment(i,a);null!=o&&r.setAttachment(o)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,n=0,r=i.length;n<r;n++){var a=i[n];if(a.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void a.setAttachment(o)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.data.name==t)return r}return null},e.prototype.getBounds=function(e,i,n){if(void 0===n&&(n=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==i)throw new Error("size cannot be null.");for(var r=this.drawOrder,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=0,h=r.length;c<h;c++){var u=r[c];if(u.bone.active){var _=0,f=null,d=u.getAttachment();if(d instanceof t.RegionAttachment)_=8,f=t.Utils.setArraySize(n,_,0),d.computeWorldVertices(u.bone,f,0,2);else if(d instanceof t.MeshAttachment){var p=d;_=p.worldVerticesLength,f=t.Utils.setArraySize(n,_,0),p.computeWorldVertices(u,0,_,f,0,2)}if(null!=f)for(var m=0,v=f.length;m<v;m+=2){var g=f[m],y=f[m+1];a=Math.min(a,g),o=Math.min(o,y),s=Math.max(s,g),l=Math.max(l,y)}}}e.set(a,o),i.set(s-a,l-o)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(Udt||(Udt={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(n){var r=this.scale,a=new t.SkeletonData;a.name="";var o=new i(n);a.hash=o.readString(),a.version=o.readString(),a.x=o.readFloat(),a.y=o.readFloat(),a.width=o.readFloat(),a.height=o.readFloat();var s=o.readBoolean();s&&(a.fps=o.readFloat(),a.imagesPath=o.readString(),a.audioPath=o.readString());var l=0;l=o.readInt(!0);for(var c=0;c<l;c++)o.strings.push(o.readString());for(l=o.readInt(!0),c=0;c<l;c++){var h=o.readString(),u=0==c?null:a.bones[o.readInt(!0)];(d=new t.BoneData(c,h,u)).rotation=o.readFloat(),d.x=o.readFloat()*r,d.y=o.readFloat()*r,d.scaleX=o.readFloat(),d.scaleY=o.readFloat(),d.shearX=o.readFloat(),d.shearY=o.readFloat(),d.length=o.readFloat()*r,d.transformMode=e.TransformModeValues[o.readInt(!0)],d.skinRequired=o.readBoolean(),s&&t.Color.rgba8888ToColor(d.color,o.readInt32()),a.bones.push(d)}for(l=o.readInt(!0),c=0;c<l;c++){var _=o.readString(),f=a.bones[o.readInt(!0)],d=new t.SlotData(c,_,f);t.Color.rgba8888ToColor(d.color,o.readInt32());var p=o.readInt32();-1!=p&&t.Color.rgb888ToColor(d.darkColor=new t.Color,p),d.attachmentName=o.readStringRef(),d.blendMode=e.BlendModeValues[o.readInt(!0)],a.slots.push(d)}l=o.readInt(!0),c=0;for(var m=void 0;c<l;c++){(d=new t.IkConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0);for(var v=0;v<m;v++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.bones[o.readInt(!0)],d.mix=o.readFloat(),d.softness=o.readFloat()*r,d.bendDirection=o.readByte(),d.compress=o.readBoolean(),d.stretch=o.readBoolean(),d.uniform=o.readBoolean(),a.ikConstraints.push(d)}for(l=o.readInt(!0),c=0,m=void 0;c<l;c++){for((d=new t.TransformConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0),v=0;v<m;v++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.bones[o.readInt(!0)],d.local=o.readBoolean(),d.relative=o.readBoolean(),d.offsetRotation=o.readFloat(),d.offsetX=o.readFloat()*r,d.offsetY=o.readFloat()*r,d.offsetScaleX=o.readFloat(),d.offsetScaleY=o.readFloat(),d.offsetShearY=o.readFloat(),d.rotateMix=o.readFloat(),d.translateMix=o.readFloat(),d.scaleMix=o.readFloat(),d.shearMix=o.readFloat(),a.transformConstraints.push(d)}for(l=o.readInt(!0),c=0,m=void 0;c<l;c++){for((d=new t.PathConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0),v=0;v<m;v++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.slots[o.readInt(!0)],d.positionMode=e.PositionModeValues[o.readInt(!0)],d.spacingMode=e.SpacingModeValues[o.readInt(!0)],d.rotateMode=e.RotateModeValues[o.readInt(!0)],d.offsetRotation=o.readFloat(),d.position=o.readFloat(),d.positionMode==t.PositionMode.Fixed&&(d.position*=r),d.spacing=o.readFloat(),d.spacingMode!=t.SpacingMode.Length&&d.spacingMode!=t.SpacingMode.Fixed||(d.spacing*=r),d.rotateMix=o.readFloat(),d.translateMix=o.readFloat(),a.pathConstraints.push(d)}var g=this.readSkin(o,a,!0,s);for(null!=g&&(a.defaultSkin=g,a.skins.push(g)),c=a.skins.length,t.Utils.setArraySize(a.skins,l=c+o.readInt(!0));c<l;c++)a.skins[c]=this.readSkin(o,a,!1,s);for(l=this.linkedMeshes.length,c=0;c<l;c++){var y=this.linkedMeshes[c],T=null==y.skin?a.defaultSkin:a.findSkin(y.skin);if(null==T)throw new Error("Skin not found: "+y.skin);var S=T.getAttachment(y.slotIndex,y.parent);if(null==S)throw new Error("Parent mesh not found: "+y.parent);y.mesh.deformAttachment=y.inheritDeform?S:y.mesh,y.mesh.setParentMesh(S),y.mesh.updateUVs()}for(this.linkedMeshes.length=0,l=o.readInt(!0),c=0;c<l;c++)(d=new t.EventData(o.readStringRef())).intValue=o.readInt(!1),d.floatValue=o.readFloat(),d.stringValue=o.readString(),d.audioPath=o.readString(),null!=d.audioPath&&(d.volume=o.readFloat(),d.balance=o.readFloat()),a.events.push(d);for(l=o.readInt(!0),c=0;c<l;c++)a.animations.push(this.readAnimation(o,o.readString(),a));return a},e.prototype.readSkin=function(e,i,n,r){var a=null,o=0;if(n){if(0==(o=e.readInt(!0)))return null;a=new t.Skin("default")}else{(a=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var s=0,l=a.bones.length;s<l;s++)a.bones[s]=i.bones[e.readInt(!0)];for(s=0,l=e.readInt(!0);s<l;s++)a.constraints.push(i.ikConstraints[e.readInt(!0)]);for(s=0,l=e.readInt(!0);s<l;s++)a.constraints.push(i.transformConstraints[e.readInt(!0)]);for(s=0,l=e.readInt(!0);s<l;s++)a.constraints.push(i.pathConstraints[e.readInt(!0)]);o=e.readInt(!0)}for(s=0;s<o;s++)for(var c=e.readInt(!0),h=0,u=e.readInt(!0);h<u;h++){var _=e.readStringRef(),f=this.readAttachment(e,i,a,c,_,r);null!=f&&a.setAttachment(c,_,f)}return a},e.prototype.readAttachment=function(i,r,a,o,s,l){var c=this.scale,h=i.readStringRef();null==h&&(h=s);var u=i.readByte();switch(e.AttachmentTypeValues[u]){case t.AttachmentType.Region:var _=i.readStringRef(),f=i.readFloat(),d=i.readFloat(),p=i.readFloat(),m=i.readFloat(),v=i.readFloat(),g=i.readFloat(),y=i.readFloat(),T=i.readInt32();null==_&&(_=h);var S=this.attachmentLoader.newRegionAttachment(a,h,_);return null==S?null:(S.path=_,S.x=d*c,S.y=p*c,S.scaleX=m,S.scaleY=v,S.rotation=f,S.width=g*c,S.height=y*c,t.Color.rgba8888ToColor(S.color,T),S.updateOffset(),S);case t.AttachmentType.BoundingBox:var E=i.readInt(!0),A=this.readVertices(i,E),b=(T=l?i.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(a,h));return null==b?null:(b.worldVerticesLength=E<<1,b.vertices=A.vertices,b.bones=A.bones,l&&t.Color.rgba8888ToColor(b.color,T),b);case t.AttachmentType.Mesh:_=i.readStringRef(),T=i.readInt32(),E=i.readInt(!0);var x=this.readFloatArray(i,E<<1,1),C=this.readShortArray(i),w=(A=this.readVertices(i,E),i.readInt(!0)),R=null;return g=0,y=0,l&&(R=this.readShortArray(i),g=i.readFloat(),y=i.readFloat()),null==_&&(_=h),null==(I=this.attachmentLoader.newMeshAttachment(a,h,_))?null:(I.path=_,t.Color.rgba8888ToColor(I.color,T),I.bones=A.bones,I.vertices=A.vertices,I.worldVerticesLength=E<<1,I.triangles=C,I.regionUVs=x,I.updateUVs(),I.hullLength=w<<1,l&&(I.edges=R,I.width=g*c,I.height=y*c),I);case t.AttachmentType.LinkedMesh:_=i.readStringRef(),T=i.readInt32();var I,O=i.readStringRef(),P=i.readStringRef(),M=i.readBoolean();return g=0,y=0,l&&(g=i.readFloat(),y=i.readFloat()),null==_&&(_=h),null==(I=this.attachmentLoader.newMeshAttachment(a,h,_))?null:(I.path=_,t.Color.rgba8888ToColor(I.color,T),l&&(I.width=g*c,I.height=y*c),this.linkedMeshes.push(new n(I,O,o,P,M)),I);case t.AttachmentType.Path:for(var D=i.readBoolean(),N=i.readBoolean(),L=(E=i.readInt(!0),A=this.readVertices(i,E),t.Utils.newArray(E/3,0)),B=0,F=L.length;B<F;B++)L[B]=i.readFloat()*c;return T=l?i.readInt32():0,null==(_=this.attachmentLoader.newPathAttachment(a,h))?null:(_.closed=D,_.constantSpeed=N,_.worldVerticesLength=E<<1,_.vertices=A.vertices,_.bones=A.bones,_.lengths=L,l&&t.Color.rgba8888ToColor(_.color,T),_);case t.AttachmentType.Point:f=i.readFloat(),d=i.readFloat(),p=i.readFloat(),T=l?i.readInt32():0;var z=this.attachmentLoader.newPointAttachment(a,h);return null==z?null:(z.x=d*c,z.y=p*c,z.rotation=f,l&&t.Color.rgba8888ToColor(z.color,T),z);case t.AttachmentType.Clipping:var U=i.readInt(!0),k=(E=i.readInt(!0),A=this.readVertices(i,E),T=l?i.readInt32():0,this.attachmentLoader.newClippingAttachment(a,h));return null==k?null:(k.endSlot=r.slots[U],k.worldVerticesLength=E<<1,k.vertices=A.vertices,k.bones=A.bones,l&&t.Color.rgba8888ToColor(k.color,T),k)}return null},e.prototype.readVertices=function(e,i){var n=i<<1,a=new r,o=this.scale;if(!e.readBoolean())return a.vertices=this.readFloatArray(e,n,o),a;for(var s=new Array,l=new Array,c=0;c<i;c++){var h=e.readInt(!0);l.push(h);for(var u=0;u<h;u++)l.push(e.readInt(!0)),s.push(e.readFloat()*o),s.push(e.readFloat()*o),s.push(e.readFloat())}return a.vertices=t.Utils.toFloatArray(s),a.bones=l,a},e.prototype.readFloatArray=function(t,e,i){var n=new Array(e);if(1==i)for(var r=0;r<e;r++)n[r]=t.readFloat();else for(r=0;r<e;r++)n[r]=t.readFloat()*i;return n},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),i=new Array(e),n=0;n<e;n++)i[n]=t.readShort();return i},e.prototype.readAnimation=function(i,n,r){for(var a=new Array,o=this.scale,s=0,l=new t.Color,c=new t.Color,h=0,u=i.readInt(!0);h<u;h++)for(var _=i.readInt(!0),f=0,d=i.readInt(!0);f<d;f++){var p=i.readByte(),m=i.readInt(!0);switch(p){case e.SLOT_ATTACHMENT:(T=new t.AttachmentTimeline(m)).slotIndex=_;for(var v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readStringRef());a.push(T),s=Math.max(s,T.frames[m-1]);break;case e.SLOT_COLOR:for((T=new t.ColorTimeline(m)).slotIndex=_,v=0;v<m;v++){var g=i.readFloat();t.Color.rgba8888ToColor(l,i.readInt32()),T.setFrame(v,g,l.r,l.g,l.b,l.a),v<m-1&&this.readCurve(i,v,T)}a.push(T),s=Math.max(s,T.frames[(m-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((T=new t.TwoColorTimeline(m)).slotIndex=_,v=0;v<m;v++)g=i.readFloat(),t.Color.rgba8888ToColor(l,i.readInt32()),t.Color.rgb888ToColor(c,i.readInt32()),T.setFrame(v,g,l.r,l.g,l.b,l.a,c.r,c.g,c.b),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.TwoColorTimeline.ENTRIES])}}for(h=0,u=i.readInt(!0);h<u;h++){var y=i.readInt(!0);for(f=0,d=i.readInt(!0);f<d;f++)switch(p=i.readByte(),m=i.readInt(!0),p){case e.BONE_ROTATE:for((T=new t.RotateTimeline(m)).boneIndex=y,v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readFloat()),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var T=void 0,S=1;for(p==e.BONE_SCALE?T=new t.ScaleTimeline(m):p==e.BONE_SHEAR?T=new t.ShearTimeline(m):(T=new t.TranslateTimeline(m),S=o),T.boneIndex=y,v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readFloat()*S,i.readFloat()*S),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.TranslateTimeline.ENTRIES])}}for(h=0,u=i.readInt(!0);h<u;h++){var E=i.readInt(!0);for(m=i.readInt(!0),(T=new t.IkConstraintTimeline(m)).ikConstraintIndex=E,v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readFloat(),i.readFloat()*o,i.readByte(),i.readBoolean(),i.readBoolean()),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.IkConstraintTimeline.ENTRIES])}for(h=0,u=i.readInt(!0);h<u;h++){for(E=i.readInt(!0),m=i.readInt(!0),(T=new t.TransformConstraintTimeline(m)).transformConstraintIndex=E,v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat()),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.TransformConstraintTimeline.ENTRIES])}for(h=0,u=i.readInt(!0);h<u;h++){E=i.readInt(!0);var A=r.pathConstraints[E];for(f=0,d=i.readInt(!0);f<d;f++)switch(p=i.readByte(),m=i.readInt(!0),p){case e.PATH_POSITION:case e.PATH_SPACING:for(T=void 0,S=1,p==e.PATH_SPACING?(T=new t.PathConstraintSpacingTimeline(m),A.spacingMode!=t.SpacingMode.Length&&A.spacingMode!=t.SpacingMode.Fixed||(S=o)):(T=new t.PathConstraintPositionTimeline(m),A.positionMode==t.PositionMode.Fixed&&(S=o)),T.pathConstraintIndex=E,v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readFloat()*S),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((T=new t.PathConstraintMixTimeline(m)).pathConstraintIndex=E,v=0;v<m;v++)T.setFrame(v,i.readFloat(),i.readFloat(),i.readFloat()),v<m-1&&this.readCurve(i,v,T);a.push(T),s=Math.max(s,T.frames[(m-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(h=0,u=i.readInt(!0);h<u;h++){var b=r.skins[i.readInt(!0)];for(f=0,d=i.readInt(!0);f<d;f++){_=i.readInt(!0);for(var x=0,C=i.readInt(!0);x<C;x++){var w=b.getAttachment(_,i.readStringRef()),R=null!=w.bones,I=w.vertices,O=R?I.length/3*2:I.length;for(m=i.readInt(!0),(T=new t.DeformTimeline(m)).slotIndex=_,T.attachment=w,v=0;v<m;v++){g=i.readFloat();var P=void 0,M=i.readInt(!0);if(0==M)P=R?t.Utils.newFloatArray(O):I;else{P=t.Utils.newFloatArray(O);var D=i.readInt(!0);if(M+=D,1==o)for(var N=D;N<M;N++)P[N]=i.readFloat();else for(N=D;N<M;N++)P[N]=i.readFloat()*o;if(!R){N=0;for(var L=P.length;N<L;N++)P[N]+=I[N]}}T.setFrame(v,g,P),v<m-1&&this.readCurve(i,v,T)}a.push(T),s=Math.max(s,T.frames[m-1])}}}var B=i.readInt(!0);if(B>0){T=new t.DrawOrderTimeline(B);var F=r.slots.length;for(h=0;h<B;h++){g=i.readFloat();var z=i.readInt(!0),U=t.Utils.newArray(F,0);for(f=F-1;f>=0;f--)U[f]=-1;var k=t.Utils.newArray(F-z,0),G=0,H=0;for(f=0;f<z;f++){for(_=i.readInt(!0);G!=_;)k[H++]=G++;U[G+i.readInt(!0)]=G++}for(;G<F;)k[H++]=G++;for(f=F-1;f>=0;f--)-1==U[f]&&(U[f]=k[--H]);T.setFrame(h,g,U)}a.push(T),s=Math.max(s,T.frames[B-1])}var V=i.readInt(!0);if(V>0){for(T=new t.EventTimeline(V),h=0;h<V;h++){g=i.readFloat();var W=r.events[i.readInt(!0)],j=new t.Event(g,W);j.intValue=i.readInt(!1),j.floatValue=i.readFloat(),j.stringValue=i.readBoolean()?i.readString():W.stringValue,null!=j.data.audioPath&&(j.volume=i.readFloat(),j.balance=i.readFloat()),T.setFrame(h,j)}a.push(T),s=Math.max(s,T.frames[V-1])}return new t.Animation(n,a,s)},e.prototype.readCurve=function(t,i,n){switch(t.readByte()){case e.CURVE_STEPPED:n.setStepped(i);break;case e.CURVE_BEZIER:this.setCurve(n,i,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,i,n,r,a){t.setCurve(e,i,n,r,a)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var i=function(){function t(t,e,i,n){void 0===e&&(e=new Array),void 0===i&&(i=0),void 0===n&&(n=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=n}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),i=127&e;return 0!=(128&e)&&(i|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<28)))),t?i:i>>>1^-(1&i)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",i=0;i<t;){var n=this.readByte();switch(n>>4){case 12:case 13:e+=String.fromCharCode((31&n)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&n)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(n),i++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),n=function(t,e,i,n,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n,this.inheritDeform=r},r=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(Udt||(Udt={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,i){if(null==e)throw new Error("skeleton cannot be null.");var n=this.boundingBoxes,r=this.polygons,a=this.polygonPool,o=e.slots,s=o.length;n.length=0,a.freeAll(r),r.length=0;for(var l=0;l<s;l++){var c=o[l];if(c.bone.active){var h=c.getAttachment();if(h instanceof t.BoundingBoxAttachment){var u=h;n.push(u);var _=a.obtain();_.length!=u.worldVerticesLength&&(_=t.Utils.newFloatArray(u.worldVerticesLength)),r.push(_),u.computeWorldVertices(c,0,u.worldVerticesLength,_,0,2)}}}i?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=this.polygons,a=0,o=r.length;a<o;a++)for(var s=r[a],l=s,c=0,h=s.length;c<h;c+=2){var u=l[c],_=l[c+1];t=Math.min(t,u),e=Math.min(e,_),i=Math.max(i,u),n=Math.max(n,_)}this.minX=t,this.minY=e,this.maxX=i,this.maxY=n},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,i,n){var r=this.minX,a=this.minY,o=this.maxX,s=this.maxY;if(t<=r&&i<=r||e<=a&&n<=a||t>=o&&i>=o||e>=s&&n>=s)return!1;var l=(n-e)/(i-t),c=l*(r-t)+e;if(c>a&&c<s)return!0;if((c=l*(o-t)+e)>a&&c<s)return!0;var h=(a-e)/l+t;return h>r&&h<o||(h=(s-e)/l+t)>r&&h<o},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.containsPointPolygon(i[n],t,e))return this.boundingBoxes[n];return null},e.prototype.containsPointPolygon=function(t,e,i){for(var n=t,r=t.length,a=r-2,o=!1,s=0;s<r;s+=2){var l=n[s+1],c=n[a+1];if(l<i&&c>=i||c<i&&l>=i){var h=n[s];h+(i-l)/(c-l)*(n[a]-h)<e&&(o=!o)}a=s}return o},e.prototype.intersectsSegment=function(t,e,i,n){for(var r=this.polygons,a=0,o=r.length;a<o;a++)if(this.intersectsSegmentPolygon(r[a],t,e,i,n))return this.boundingBoxes[a];return null},e.prototype.intersectsSegmentPolygon=function(t,e,i,n,r){for(var a=t,o=t.length,s=e-n,l=i-r,c=e*r-i*n,h=a[o-2],u=a[o-1],_=0;_<o;_+=2){var f=a[_],d=a[_+1],p=h*d-u*f,m=h-f,v=u-d,g=s*v-l*m,y=(c*m-s*p)/g;if((y>=h&&y<=f||y>=f&&y<=h)&&(y>=e&&y<=n||y>=n&&y<=e)){var T=(c*v-l*p)/g;if((T>=u&&T<=d||T>=d&&T<=u)&&(T>=i&&T<=r||T>=r&&T<=i))return!0}h=f,u=d}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(Udt||(Udt={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(i,n){if(null!=this.clipAttachment)return 0;this.clipAttachment=n;var r=n.worldVerticesLength,a=t.Utils.setArraySize(this.clippingPolygon,r);n.computeWorldVertices(i,0,r,a,0,2);var o=this.clippingPolygon;e.makeClockwise(o);for(var s=this.clippingPolygons=this.triangulator.decompose(o,this.triangulator.triangulate(o)),l=0,c=s.length;l<c;l++){var h=s[l];e.makeClockwise(h),h.push(h[0]),h.push(h[1])}return s.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,i,n,r,a,o,s,l,c,h,u){void 0===c&&(c=2),void 0===h&&(h=0),void 0===u&&(u=0);var _=this.clipOutput,f=this.clippedVertices,d=this.clippedTriangles,p=this.clippingPolygons,m=this.clippingPolygons.length,v=l?12:8,g=0;f.length=0,d.length=0;t:for(var y=0;y<r;y+=3)for(var T=n[y]*c,S=e[T+h],E=e[T+h+1],A=a[T+u],b=a[T+u+1],x=e[(T=n[y+1]*c)+h],C=e[T+h+1],w=a[T+u],R=a[T+u+1],I=e[(T=n[y+2]*c)+h],O=e[T+h+1],P=a[T+u],M=a[T+u+1],D=0;D<m;D++){var N=f.length;if(!this.clip(S,E,x,C,I,O,p[D],_)){(V=t.Utils.setArraySize(f,N+3*v))[N]=S,V[N+1]=E,V[N+2]=o.r,V[N+3]=o.g,V[N+4]=o.b,V[N+5]=o.a,l?(V[N+6]=A,V[N+7]=b,V[N+8]=s.r,V[N+9]=s.g,V[N+10]=s.b,V[N+11]=s.a,V[N+12]=x,V[N+13]=C,V[N+14]=o.r,V[N+15]=o.g,V[N+16]=o.b,V[N+17]=o.a,V[N+18]=w,V[N+19]=R,V[N+20]=s.r,V[N+21]=s.g,V[N+22]=s.b,V[N+23]=s.a,V[N+24]=I,V[N+25]=O,V[N+26]=o.r,V[N+27]=o.g,V[N+28]=o.b,V[N+29]=o.a,V[N+30]=P,V[N+31]=M,V[N+32]=s.r,V[N+33]=s.g,V[N+34]=s.b,V[N+35]=s.a):(V[N+6]=A,V[N+7]=b,V[N+8]=x,V[N+9]=C,V[N+10]=o.r,V[N+11]=o.g,V[N+12]=o.b,V[N+13]=o.a,V[N+14]=w,V[N+15]=R,V[N+16]=I,V[N+17]=O,V[N+18]=o.r,V[N+19]=o.g,V[N+20]=o.b,V[N+21]=o.a,V[N+22]=P,V[N+23]=M),N=d.length,(J=t.Utils.setArraySize(d,N+3))[N]=g,J[N+1]=g+1,J[N+2]=g+2,g+=3;continue t}var L=_.length;if(0!=L){for(var B=C-O,F=I-x,z=S-I,U=O-E,k=1/(B*z+F*(E-O)),G=L>>1,H=this.clipOutput,V=t.Utils.setArraySize(f,N+G*v),W=0;W<L;W+=2){var j=H[W],q=H[W+1];V[N]=j,V[N+1]=q,V[N+2]=o.r,V[N+3]=o.g,V[N+4]=o.b,V[N+5]=o.a;var X=j-I,Y=q-O,K=(B*X+F*Y)*k,Z=(U*X+z*Y)*k,Q=1-K-Z;V[N+6]=A*K+w*Z+P*Q,V[N+7]=b*K+R*Z+M*Q,l&&(V[N+8]=s.r,V[N+9]=s.g,V[N+10]=s.b,V[N+11]=s.a),N+=v}N=d.length;var J=t.Utils.setArraySize(d,N+3*(G-2));for(G--,W=1;W<G;W++)J[N]=g,J[N+1]=g+W,J[N+2]=g+W+1,N+=3;g+=G+1}}},e.prototype.clip=function(t,e,i,n,r,a,o,s){var l=s,c=!1,h=null;o.length%4>=2?(h=s,s=this.scratch):h=this.scratch,h.length=0,h.push(t),h.push(e),h.push(i),h.push(n),h.push(r),h.push(a),h.push(t),h.push(e),s.length=0;for(var u=o,_=o.length-4,f=0;;f+=2){for(var d=u[f],p=u[f+1],m=u[f+2],v=u[f+3],g=d-m,y=p-v,T=h,S=h.length-2,E=s.length,A=0;A<S;A+=2){var b=T[A],x=T[A+1],C=T[A+2],w=T[A+3],R=g*(w-v)-y*(C-m)>0;if(g*(x-v)-y*(b-m)>0){if(R){s.push(C),s.push(w);continue}var I=(P=w-x)*(m-d)-(M=C-b)*(v-p);if(Math.abs(I)>1e-6){var O=(M*(p-x)-P*(d-b))/I;s.push(d+(m-d)*O),s.push(p+(v-p)*O)}else s.push(d),s.push(p)}else if(R){var P,M;I=(P=w-x)*(m-d)-(M=C-b)*(v-p),Math.abs(I)>1e-6?(O=(M*(p-x)-P*(d-b))/I,s.push(d+(m-d)*O),s.push(p+(v-p)*O)):(s.push(d),s.push(p)),s.push(C),s.push(w)}c=!0}if(E==s.length)return l.length=0,!0;if(s.push(s[0]),s.push(s[1]),f==_)break;var D=s;(s=h).length=0,h=D}if(l!=s){l.length=0,f=0;for(var N=s.length-2;f<N;f++)l[f]=s[f]}else l.length=l.length-2;return c},e.makeClockwise=function(t){for(var e=t,i=t.length,n=e[i-2]*e[1]-e[0]*e[i-1],r=0,a=0,o=0,s=0,l=i-3;s<l;s+=2)r=e[s],a=e[s+1],o=e[s+2],n+=r*e[s+3]-o*a;if(!(n<0)){s=0;var c=i-2;for(l=i>>1;s<l;s+=2){var h=e[s],u=e[s+1],_=c-s;e[s]=e[_],e[s+1]=e[_+1],e[_]=h,e[_+1]=u}}},e}();t.SkeletonClipping=e}(Udt||(Udt={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++){var r=e[i];if(r.name==t)return r}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},t}();t.SkeletonData=e}(Udt||(Udt={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var n=this.scale,r=new t.SkeletonData,a="string"==typeof i?JSON.parse(i):i,o=a.skeleton;if(null!=o&&(r.hash=o.hash,r.version=o.spine,r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height,r.fps=o.fps,r.imagesPath=o.images),a.bones)for(var s=0;s<a.bones.length;s++){var l=a.bones[s],c=null,h=this.getValue(l,"parent",null);if(null!=h&&null==(c=r.findBone(h)))throw new Error("Parent bone not found: "+h);(d=new t.BoneData(r.bones.length,l.name,c)).length=this.getValue(l,"length",0)*n,d.x=this.getValue(l,"x",0)*n,d.y=this.getValue(l,"y",0)*n,d.rotation=this.getValue(l,"rotation",0),d.scaleX=this.getValue(l,"scaleX",1),d.scaleY=this.getValue(l,"scaleY",1),d.shearX=this.getValue(l,"shearX",0),d.shearY=this.getValue(l,"shearY",0),d.transformMode=e.transformModeFromString(this.getValue(l,"transform","normal")),d.skinRequired=this.getValue(l,"skin",!1),r.bones.push(d)}if(a.slots)for(s=0;s<a.slots.length;s++){var u=(I=a.slots[s]).name,_=I.bone,f=r.findBone(_);if(null==f)throw new Error("Slot bone not found: "+_);var d=new t.SlotData(r.slots.length,u,f),p=this.getValue(I,"color",null);null!=p&&d.color.setFromString(p);var m=this.getValue(I,"dark",null);null!=m&&(d.darkColor=new t.Color(1,1,1,1),d.darkColor.setFromString(m)),d.attachmentName=this.getValue(I,"attachment",null),d.blendMode=e.blendModeFromString(this.getValue(I,"blend","normal")),r.slots.push(d)}if(a.ik)for(s=0;s<a.ik.length;s++){var v=a.ik[s];(d=new t.IkConstraintData(v.name)).order=this.getValue(v,"order",0),d.skinRequired=this.getValue(v,"skin",!1);for(var g=0;g<v.bones.length;g++){if(_=v.bones[g],null==(C=r.findBone(_)))throw new Error("IK bone not found: "+_);d.bones.push(C)}var y=v.target;if(d.target=r.findBone(y),null==d.target)throw new Error("IK target bone not found: "+y);d.mix=this.getValue(v,"mix",1),d.softness=this.getValue(v,"softness",0)*n,d.bendDirection=this.getValue(v,"bendPositive",!0)?1:-1,d.compress=this.getValue(v,"compress",!1),d.stretch=this.getValue(v,"stretch",!1),d.uniform=this.getValue(v,"uniform",!1),r.ikConstraints.push(d)}if(a.transform)for(s=0;s<a.transform.length;s++){for(v=a.transform[s],(d=new t.TransformConstraintData(v.name)).order=this.getValue(v,"order",0),d.skinRequired=this.getValue(v,"skin",!1),g=0;g<v.bones.length;g++){if(_=v.bones[g],null==(C=r.findBone(_)))throw new Error("Transform constraint bone not found: "+_);d.bones.push(C)}if(y=v.target,d.target=r.findBone(y),null==d.target)throw new Error("Transform constraint target bone not found: "+y);d.local=this.getValue(v,"local",!1),d.relative=this.getValue(v,"relative",!1),d.offsetRotation=this.getValue(v,"rotation",0),d.offsetX=this.getValue(v,"x",0)*n,d.offsetY=this.getValue(v,"y",0)*n,d.offsetScaleX=this.getValue(v,"scaleX",0),d.offsetScaleY=this.getValue(v,"scaleY",0),d.offsetShearY=this.getValue(v,"shearY",0),d.rotateMix=this.getValue(v,"rotateMix",1),d.translateMix=this.getValue(v,"translateMix",1),d.scaleMix=this.getValue(v,"scaleMix",1),d.shearMix=this.getValue(v,"shearMix",1),r.transformConstraints.push(d)}if(a.path)for(s=0;s<a.path.length;s++){for(v=a.path[s],(d=new t.PathConstraintData(v.name)).order=this.getValue(v,"order",0),d.skinRequired=this.getValue(v,"skin",!1),g=0;g<v.bones.length;g++){if(_=v.bones[g],null==(C=r.findBone(_)))throw new Error("Transform constraint bone not found: "+_);d.bones.push(C)}if(y=v.target,d.target=r.findSlot(y),null==d.target)throw new Error("Path target slot not found: "+y);d.positionMode=e.positionModeFromString(this.getValue(v,"positionMode","percent")),d.spacingMode=e.spacingModeFromString(this.getValue(v,"spacingMode","length")),d.rotateMode=e.rotateModeFromString(this.getValue(v,"rotateMode","tangent")),d.offsetRotation=this.getValue(v,"rotation",0),d.position=this.getValue(v,"position",0),d.positionMode==t.PositionMode.Fixed&&(d.position*=n),d.spacing=this.getValue(v,"spacing",0),d.spacingMode!=t.SpacingMode.Length&&d.spacingMode!=t.SpacingMode.Fixed||(d.spacing*=n),d.rotateMix=this.getValue(v,"rotateMix",1),d.translateMix=this.getValue(v,"translateMix",1),r.pathConstraints.push(d)}if(a.skins){var T=a.skins;if(!(T instanceof Array)){var S=[];for(var E in T)S.push({name:E,attachments:T[E]});T=S}for(s=0;s<T.length;s++){var A=T[s],b=new t.Skin(A.name);if(A.bones)for(var x=0;x<A.bones.length;x++){var C;if(null==(C=r.findBone(A.bones[x])))throw new Error("Skin bone not found: "+A.bones[s]);b.bones.push(C)}if(A.ik)for(x=0;x<A.ik.length;x++){if(null==(w=r.findIkConstraint(A.ik[x])))throw new Error("Skin IK constraint not found: "+A.ik[s]);b.constraints.push(w)}if(A.transform)for(x=0;x<A.transform.length;x++){if(null==(w=r.findTransformConstraint(A.transform[x])))throw new Error("Skin transform constraint not found: "+A.transform[s]);b.constraints.push(w)}if(A.path)for(x=0;x<A.path.length;x++){var w;if(null==(w=r.findPathConstraint(A.path[x])))throw new Error("Skin path constraint not found: "+A.path[s]);b.constraints.push(w)}for(var u in A.attachments){var R=r.findSlot(u);if(null==R)throw new Error("Slot not found: "+u);var I=A.attachments[u];for(var O in I){var P=this.readAttachment(I[O],b,R.index,O,r);null!=P&&b.setAttachment(R.index,O,P)}}r.skins.push(b),"default"==b.name&&(r.defaultSkin=b)}}s=0;for(var M=this.linkedMeshes.length;s<M;s++){var D=this.linkedMeshes[s];if(null==(b=null==D.skin?r.defaultSkin:r.findSkin(D.skin)))throw new Error("Skin not found: "+D.skin);var N=b.getAttachment(D.slotIndex,D.parent);if(null==N)throw new Error("Parent mesh not found: "+D.parent);D.mesh.deformAttachment=D.inheritDeform?N:D.mesh,D.mesh.setParentMesh(N),D.mesh.updateUVs()}if(this.linkedMeshes.length=0,a.events)for(var L in a.events){var B=a.events[L];(d=new t.EventData(L)).intValue=this.getValue(B,"int",0),d.floatValue=this.getValue(B,"float",0),d.stringValue=this.getValue(B,"string",""),d.audioPath=this.getValue(B,"audio",null),null!=d.audioPath&&(d.volume=this.getValue(B,"volume",1),d.balance=this.getValue(B,"balance",0)),r.events.push(d)}if(a.animations)for(var F in a.animations){var z=a.animations[F];this.readAnimation(z,F,r)}return r},e.prototype.readAttachment=function(e,n,r,a,o){var s=this.scale;switch(a=this.getValue(e,"name",a),this.getValue(e,"type","region")){case"region":var l=this.getValue(e,"path",a),c=this.attachmentLoader.newRegionAttachment(n,a,l);return null==c?null:(c.path=l,c.x=this.getValue(e,"x",0)*s,c.y=this.getValue(e,"y",0)*s,c.scaleX=this.getValue(e,"scaleX",1),c.scaleY=this.getValue(e,"scaleY",1),c.rotation=this.getValue(e,"rotation",0),c.width=e.width*s,c.height=e.height*s,null!=(y=this.getValue(e,"color",null))&&c.color.setFromString(y),c.updateOffset(),c);case"boundingbox":var h=this.attachmentLoader.newBoundingBoxAttachment(n,a);return null==h?null:(this.readVertices(e,h,e.vertexCount<<1),null!=(y=this.getValue(e,"color",null))&&h.color.setFromString(y),h);case"mesh":case"linkedmesh":l=this.getValue(e,"path",a);var u=this.attachmentLoader.newMeshAttachment(n,a,l);if(null==u)return null;u.path=l,null!=(y=this.getValue(e,"color",null))&&u.color.setFromString(y),u.width=this.getValue(e,"width",0)*s,u.height=this.getValue(e,"height",0)*s;var _=this.getValue(e,"parent",null);if(null!=_)return this.linkedMeshes.push(new i(u,this.getValue(e,"skin",null),r,_,this.getValue(e,"deform",!0))),u;var f=e.uvs;return this.readVertices(e,u,f.length),u.triangles=e.triangles,u.regionUVs=f,u.updateUVs(),u.edges=this.getValue(e,"edges",null),u.hullLength=2*this.getValue(e,"hull",0),u;case"path":if(null==(l=this.attachmentLoader.newPathAttachment(n,a)))return null;l.closed=this.getValue(e,"closed",!1),l.constantSpeed=this.getValue(e,"constantSpeed",!0);var d=e.vertexCount;this.readVertices(e,l,d<<1);for(var p=t.Utils.newArray(d/3,0),m=0;m<e.lengths.length;m++)p[m]=e.lengths[m]*s;return l.lengths=p,null!=(y=this.getValue(e,"color",null))&&l.color.setFromString(y),l;case"point":var v=this.attachmentLoader.newPointAttachment(n,a);return null==v?null:(v.x=this.getValue(e,"x",0)*s,v.y=this.getValue(e,"y",0)*s,v.rotation=this.getValue(e,"rotation",0),null!=(y=this.getValue(e,"color",null))&&v.color.setFromString(y),v);case"clipping":var g=this.attachmentLoader.newClippingAttachment(n,a);if(null==g)return null;var y,T=this.getValue(e,"end",null);if(null!=T){var S=o.findSlot(T);if(null==S)throw new Error("Clipping end slot not found: "+T);g.endSlot=S}return d=e.vertexCount,this.readVertices(e,g,d<<1),null!=(y=this.getValue(e,"color",null))&&g.color.setFromString(y),g}return null},e.prototype.readVertices=function(e,i,n){var r=this.scale;i.worldVerticesLength=n;var a=e.vertices;if(n!=a.length){var o=new Array,s=new Array;for(u=0,_=a.length;u<_;){var l=a[u++];s.push(l);for(var c=u+4*l;u<c;u+=4)s.push(a[u]),o.push(a[u+1]*r),o.push(a[u+2]*r),o.push(a[u+3])}i.bones=s,i.vertices=t.Utils.toFloatArray(o)}else{var h=t.Utils.toFloatArray(a);if(1!=r)for(var u=0,_=a.length;u<_;u++)h[u]*=r;i.vertices=h}},e.prototype.readAnimation=function(e,i,n){var r=this.scale,a=new Array,o=0;if(e.slots)for(var s in e.slots){var l=e.slots[s];if(-1==(Q=n.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(var c in l){var h=l[c];if("attachment"==c){(T=new t.AttachmentTimeline(h.length)).slotIndex=Q;for(var u=0,_=0;_<h.length;_++){var f=h[_];T.setFrame(u++,this.getValue(f,"time",0),f.name)}a.push(T),o=Math.max(o,T.frames[T.getFrameCount()-1])}else if("color"==c){for((T=new t.ColorTimeline(h.length)).slotIndex=Q,u=0,_=0;_<h.length;_++){f=h[_];var d=new t.Color;d.setFromString(f.color),T.setFrame(u,this.getValue(f,"time",0),d.r,d.g,d.b,d.a),this.readCurve(f,T,u),u++}a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=c)throw new Error("Invalid timeline type for a slot: "+c+" ("+s+")");for((T=new t.TwoColorTimeline(h.length)).slotIndex=Q,u=0,_=0;_<h.length;_++){f=h[_];var p=new t.Color,m=new t.Color;p.setFromString(f.light),m.setFromString(f.dark),T.setFrame(u,this.getValue(f,"time",0),p.r,p.g,p.b,p.a,m.r,m.g,m.b),this.readCurve(f,T,u),u++}a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var v in e.bones){var g=e.bones[v],y=n.findBoneIndex(v);if(-1==y)throw new Error("Bone not found: "+v);for(var c in g)if(h=g[c],"rotate"===c){for((T=new t.RotateTimeline(h.length)).boneIndex=y,u=0,_=0;_<h.length;_++)f=h[_],T.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"angle",0)),this.readCurve(f,T,u),u++;a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==c&&"scale"!==c&&"shear"!==c)throw new Error("Invalid timeline type for a bone: "+c+" ("+v+")");var T=null,S=1,E=0;for("scale"===c?(T=new t.ScaleTimeline(h.length),E=1):"shear"===c?T=new t.ShearTimeline(h.length):(T=new t.TranslateTimeline(h.length),S=r),T.boneIndex=y,u=0,_=0;_<h.length;_++){f=h[_];var A=this.getValue(f,"x",E),b=this.getValue(f,"y",E);T.setFrame(u,this.getValue(f,"time",0),A*S,b*S),this.readCurve(f,T,u),u++}a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var x in e.ik){var C=e.ik[x],w=n.findIkConstraint(x);for((T=new t.IkConstraintTimeline(C.length)).ikConstraintIndex=n.ikConstraints.indexOf(w),u=0,_=0;_<C.length;_++)f=C[_],T.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"mix",1),this.getValue(f,"softness",0)*r,this.getValue(f,"bendPositive",!0)?1:-1,this.getValue(f,"compress",!1),this.getValue(f,"stretch",!1)),this.readCurve(f,T,u),u++;a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var x in e.transform){for(C=e.transform[x],w=n.findTransformConstraint(x),(T=new t.TransformConstraintTimeline(C.length)).transformConstraintIndex=n.transformConstraints.indexOf(w),u=0,_=0;_<C.length;_++)f=C[_],T.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"rotateMix",1),this.getValue(f,"translateMix",1),this.getValue(f,"scaleMix",1),this.getValue(f,"shearMix",1)),this.readCurve(f,T,u),u++;a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var R=e.path||e.paths;if(R)for(var x in R){C=R[x];var I=n.findPathConstraintIndex(x);if(-1==I)throw new Error("Path constraint not found: "+x);var O=n.pathConstraints[I];for(var c in C)if(h=C[c],"position"===c||"spacing"===c){for(T=null,S=1,"spacing"===c?(T=new t.PathConstraintSpacingTimeline(h.length),O.spacingMode!=t.SpacingMode.Length&&O.spacingMode!=t.SpacingMode.Fixed||(S=r)):(T=new t.PathConstraintPositionTimeline(h.length),O.positionMode==t.PositionMode.Fixed&&(S=r)),T.pathConstraintIndex=I,u=0,_=0;_<h.length;_++)f=h[_],T.setFrame(u,this.getValue(f,"time",0),this.getValue(f,c,0)*S),this.readCurve(f,T,u),u++;a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===c){for((T=new t.PathConstraintMixTimeline(h.length)).pathConstraintIndex=I,u=0,_=0;_<h.length;_++)f=h[_],T.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"rotateMix",1),this.getValue(f,"translateMix",1)),this.readCurve(f,T,u),u++;a.push(T),o=Math.max(o,T.frames[(T.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var P in e.deform){var M=e.deform[P],D=n.findSkin(P);if(null==D)throw new Error("Skin not found: "+P);for(var s in M){if(l=M[s],-1==(Q=n.findSlotIndex(s)))throw new Error("Slot not found: "+l.name);for(var c in l){h=l[c];var N=D.getAttachment(Q,c);if(null!=N){var L=null!=N.bones,B=N.vertices,F=L?B.length/3*2:B.length;(T=new t.DeformTimeline(h.length)).slotIndex=Q,T.attachment=N,u=0;for(var z=0;z<h.length;z++){f=h[z];var U=void 0,k=this.getValue(f,"vertices",null);if(null==k)U=L?t.Utils.newFloatArray(F):B;else{U=t.Utils.newFloatArray(F);var G=this.getValue(f,"offset",0);if(t.Utils.arrayCopy(k,0,U,G,k.length),1!=r)for(var H=(_=G)+k.length;_<H;_++)U[_]*=r;if(!L)for(_=0;_<F;_++)U[_]+=B[_]}T.setFrame(u,this.getValue(f,"time",0),U),this.readCurve(f,T,u),u++}a.push(T),o=Math.max(o,T.frames[T.getFrameCount()-1])}}}}var V=e.drawOrder;if(null==V&&(V=e.draworder),null!=V){T=new t.DrawOrderTimeline(V.length);var W=n.slots.length;for(u=0,z=0;z<V.length;z++){var j=V[z],q=null,X=this.getValue(j,"offsets",null);if(null!=X){q=t.Utils.newArray(W,-1);var Y=t.Utils.newArray(W-X.length,0),K=0,Z=0;for(_=0;_<X.length;_++){var Q,J=X[_];if(-1==(Q=n.findSlotIndex(J.slot)))throw new Error("Slot not found: "+J.slot);for(;K!=Q;)Y[Z++]=K++;q[K+J.offset]=K++}for(;K<W;)Y[Z++]=K++;for(_=W-1;_>=0;_--)-1==q[_]&&(q[_]=Y[--Z])}T.setFrame(u++,this.getValue(j,"time",0),q)}a.push(T),o=Math.max(o,T.frames[T.getFrameCount()-1])}if(e.events){for(T=new t.EventTimeline(e.events.length),u=0,_=0;_<e.events.length;_++){var $=e.events[_],tt=n.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),T.setFrame(u++,et)}a.push(T),o=Math.max(o,T.frames[T.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new t.Animation(i,a,o))},e.prototype.readCurve=function(t,e,i){var n=t.curve;n&&("stepped"==n?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(n)?e.setCurve(i,n[0],n[1],n[2],n[3]):e.setCurve(i,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var i=function(t,e,i,n,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=n,this.inheritDeform=r}}(Udt||(Udt={})),function(t){var e=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i};t.SkinEntry=e;var i=function(){function i(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return i.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=i},i.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==i){n=!0;break}n||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){var a=t.constraints[e];for(n=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==a){n=!0;break}n||this.constraints.push(a)}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];this.setAttachment(s.slotIndex,s.name,s.attachment)}},i.prototype.copySkin=function(e){for(var i=0;i<e.bones.length;i++){for(var n=e.bones[i],r=!1,a=0;a<this.bones.length;a++)if(this.bones[a]==n){r=!0;break}r||this.bones.push(n)}for(i=0;i<e.constraints.length;i++){var o=e.constraints[i];for(r=!1,a=0;a<this.constraints.length;a++)if(this.constraints[a]==o){r=!0;break}r||this.constraints.push(o)}var s=e.getAttachments();for(i=0;i<s.length;i++){var l=s[i];null!=l.attachment&&(l.attachment instanceof t.MeshAttachment?(l.attachment=l.attachment.newLinkedMesh(),this.setAttachment(l.slotIndex,l.name,l.attachment)):(l.attachment=l.attachment.copy(),this.setAttachment(l.slotIndex,l.name,l.attachment)))}},i.prototype.getAttachment=function(t,e){var i=this.attachments[t];return i?i[e]:null},i.prototype.removeAttachment=function(t,e){var i=this.attachments[t];i&&(i[e]=null)},i.prototype.getAttachments=function(){for(var t=new Array,i=0;i<this.attachments.length;i++){var n=this.attachments[i];if(n)for(var r in n){var a=n[r];a&&t.push(new e(i,r,a))}}return t},i.prototype.getAttachmentsForSlot=function(t,i){var n=this.attachments[t];if(n)for(var r in n){var a=n[r];a&&i.push(new e(t,r,a))}},i.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},i.prototype.attachAll=function(t,e){for(var i=0,n=0;n<t.slots.length;n++){var r=t.slots[n],a=r.getAttachment();if(a&&i<e.attachments.length){var o=e.attachments[i];for(var s in o)if(a==o[s]){var l=this.getAttachment(i,s);null!=l&&r.setAttachment(l);break}}i++}},i}();t.Skin=i}(Udt||(Udt={})),function(t){var e=function(){function e(e,i){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("bone cannot be null.");this.data=e,this.bone=i,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(Udt||(Udt={})),function(t){t.SlotData=function(e,i,n){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=e,this.name=i,this.boneData=n}}(Udt||(Udt={})),function(t){var e,i,n=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return i.MirroredRepeat;case"clamptoedge":return i.ClampToEdge;case"repeat":return i.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=n,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(i=t.TextureWrap||(t.TextureWrap={}));t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return kdt(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(n);t.FakeTexture=r}(Udt||(Udt={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,a){if(null==a)throw new Error("textureLoader cannot be null.");for(var o=new i(e),s=new Array(4),l=null;;){var c=o.readLine();if(null==c)break;if(0==(c=c.trim()).length)l=null;else if(l){var h=new r;h.name=c,h.page=l;var u=o.readValue();"true"==u.toLocaleLowerCase()?h.degrees=90:"false"==u.toLocaleLowerCase()?h.degrees=0:h.degrees=parseFloat(u),h.rotate=90==h.degrees,o.readTuple(s);var _=parseInt(s[0]),f=parseInt(s[1]);o.readTuple(s);var d=parseInt(s[0]),p=parseInt(s[1]);h.u=_/l.width,h.v=f/l.height,h.rotate?(h.u2=(_+p)/l.width,h.v2=(f+d)/l.height):(h.u2=(_+d)/l.width,h.v2=(f+p)/l.height),h.x=_,h.y=f,h.width=Math.abs(d),h.height=Math.abs(p),4==o.readTuple(s)&&4==o.readTuple(s)&&o.readTuple(s),h.originalWidth=parseInt(s[0]),h.originalHeight=parseInt(s[1]),o.readTuple(s),h.offsetX=parseInt(s[0]),h.offsetY=parseInt(s[1]),h.index=parseInt(o.readValue()),h.texture=l.texture,this.regions.push(h)}else{(l=new n).name=c,2==o.readTuple(s)&&(l.width=parseInt(s[0]),l.height=parseInt(s[1]),o.readTuple(s)),o.readTuple(s),l.minFilter=t.Texture.filterFromString(s[0]),l.magFilter=t.Texture.filterFromString(s[1]);var m=o.readValue();l.uWrap=t.TextureWrap.ClampToEdge,l.vWrap=t.TextureWrap.ClampToEdge,"x"==m?l.uWrap=t.TextureWrap.Repeat:"y"==m?l.vWrap=t.TextureWrap.Repeat:"xy"==m&&(l.uWrap=l.vWrap=t.TextureWrap.Repeat),l.texture=a(c),l.texture.setFilters(l.minFilter,l.magFilter),l.texture.setWraps(l.uWrap,l.vWrap),l.width=l.texture.getImage().width,l.height=l.texture.getImage().height,this.pages.push(l)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var i=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var n=0,r=i+1;n<3;n++){var a=e.indexOf(",",r);if(-1==a)break;t[n]=e.substr(r,a-r).trim(),r=a+1}return t[n]=e.substring(r).trim(),n+1},t}(),n=function(){};t.TextureAtlasPage=n;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return kdt(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=r}(Udt||(Udt={})),function(t){var e=function(){function e(e,i){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var n=0;n<e.bones.length;n++)this.bones.push(i.findBone(e.bones[n].name));this.target=i.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,i=this.translateMix,n=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,l=a.c,c=a.d,h=o*c-s*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,u=this.data.offsetRotation*h,_=this.data.offsetShearY*h,f=this.bones,d=0,p=f.length;d<p;d++){var m=f[d],v=!1;if(0!=e){var g=m.a,y=m.b,T=m.c,S=m.d;(w=Math.atan2(l,o)-Math.atan2(T,g)+u)>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w*=e;var E=Math.cos(w),A=Math.sin(w);m.a=E*g-A*T,m.b=E*y-A*S,m.c=A*g+E*T,m.d=A*y+E*S,v=!0}if(0!=i){var b=this.temp;a.localToWorld(b.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(b.x-m.worldX)*i,m.worldY+=(b.y-m.worldY)*i,v=!0}if(n>0){var x=Math.sqrt(m.a*m.a+m.c*m.c),C=Math.sqrt(o*o+l*l);x>1e-5&&(x=(x+(C-x+this.data.offsetScaleX)*n)/x),m.a*=x,m.c*=x,x=Math.sqrt(m.b*m.b+m.d*m.d),C=Math.sqrt(s*s+c*c),x>1e-5&&(x=(x+(C-x+this.data.offsetScaleY)*n)/x),m.b*=x,m.d*=x,v=!0}if(r>0){y=m.b,S=m.d;var w,R=Math.atan2(S,y);(w=Math.atan2(c,s)-Math.atan2(l,o)-(R-Math.atan2(m.c,m.a)))>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w=R+(w+_)*r,x=Math.sqrt(y*y+S*S),m.b=Math.cos(w)*x,m.d=Math.sin(w)*x,v=!0}v&&(m.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,i=this.translateMix,n=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,l=a.c,c=a.d,h=o*c-s*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,u=this.data.offsetRotation*h,_=this.data.offsetShearY*h,f=this.bones,d=0,p=f.length;d<p;d++){var m,v=f[d],g=!1;if(0!=e){var y=v.a,T=v.b,S=v.c,E=v.d;(m=Math.atan2(l,o)+u)>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),m*=e;var A=Math.cos(m),b=Math.sin(m);v.a=A*y-b*S,v.b=A*T-b*E,v.c=b*y+A*S,v.d=b*T+A*E,g=!0}if(0!=i){var x=this.temp;a.localToWorld(x.set(this.data.offsetX,this.data.offsetY)),v.worldX+=x.x*i,v.worldY+=x.y*i,g=!0}if(n>0){var C=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleX)*n+1;v.a*=C,v.c*=C,C=(Math.sqrt(s*s+c*c)-1+this.data.offsetScaleY)*n+1,v.b*=C,v.d*=C,g=!0}if(r>0)(m=Math.atan2(c,s)-Math.atan2(l,o))>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),T=v.b,E=v.d,m=Math.atan2(E,T)+(m-t.MathUtils.PI/2+_)*r,C=Math.sqrt(T*T+E*E),v.b=Math.cos(m)*C,v.d=Math.sin(m)*C,g=!0;g&&(v.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var l=a[o];l.appliedValid||l.updateAppliedTransform();var c=l.arotation;if(0!=t){var h=r.arotation-c+this.data.offsetRotation;c+=(h-=360*(16384-(16384.499999999996-h/360|0)))*t}var u=l.ax,_=l.ay;0!=e&&(u+=(r.ax-u+this.data.offsetX)*e,_+=(r.ay-_+this.data.offsetY)*e);var f=l.ascaleX,d=l.ascaleY;0!=i&&(f>1e-5&&(f=(f+(r.ascaleX-f+this.data.offsetScaleX)*i)/f),d>1e-5&&(d=(d+(r.ascaleY-d+this.data.offsetScaleY)*i)/d));var p=l.ashearY;0!=n&&(h=r.ashearY-p+this.data.offsetShearY,h-=360*(16384-(16384.499999999996-h/360|0)),l.shearY+=h*n),l.updateWorldTransformWith(u,_,c,f,d,l.ashearX,p)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var l=a[o];l.appliedValid||l.updateAppliedTransform();var c=l.arotation;0!=t&&(c+=(r.arotation+this.data.offsetRotation)*t);var h=l.ax,u=l.ay;0!=e&&(h+=(r.ax+this.data.offsetX)*e,u+=(r.ay+this.data.offsetY)*e);var _=l.ascaleX,f=l.ascaleY;0!=i&&(_>1e-5&&(_*=(r.ascaleX-1+this.data.offsetScaleX)*i+1),f>1e-5&&(f*=(r.ascaleY-1+this.data.offsetScaleY)*i+1));var d=l.ashearY;0!=n&&(d+=(r.ashearY+this.data.offsetShearY)*n),l.updateWorldTransformWith(h,u,c,_,f,l.ashearX,d)}},e}();t.TransformConstraint=e}(Udt||(Udt={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.rotateMix=0,i.translateMix=0,i.scaleMix=0,i.shearMix=0,i.offsetRotation=0,i.offsetX=0,i.offsetY=0,i.offsetScaleX=0,i.offsetScaleY=0,i.offsetShearY=0,i.relative=!1,i.local=!1,i}return kdt(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(Udt||(Udt={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var i=t,n=t.length>>1,r=this.indicesArray;r.length=0;for(var a=0;a<n;a++)r[a]=a;var o=this.isConcaveArray;o.length=0,a=0;for(var s=n;a<s;++a)o[a]=e.isConcave(a,n,i,r);var l=this.triangles;for(l.length=0;n>3;){for(var c=n-1,h=(a=0,1);;){t:if(!o[a]){for(var u=r[c]<<1,_=r[a]<<1,f=r[h]<<1,d=i[u],p=i[u+1],m=i[_],v=i[_+1],g=i[f],y=i[f+1],T=(h+1)%n;T!=c;T=(T+1)%n)if(o[T]){var S=r[T]<<1,E=i[S],A=i[S+1];if(e.positiveArea(g,y,d,p,E,A)&&e.positiveArea(d,p,m,v,E,A)&&e.positiveArea(m,v,g,y,E,A))break t}break}if(0==h){do{if(!o[a])break;a--}while(a>0);break}c=a,a=h,h=(h+1)%n}l.push(r[(n+a-1)%n]),l.push(r[a]),l.push(r[(a+1)%n]),r.splice(a,1),o.splice(a,1);var b=(--n+a-1)%n,x=a==n?0:a;o[b]=e.isConcave(b,n,i,r),o[x]=e.isConcave(x,n,i,r)}return 3==n&&(l.push(r[2]),l.push(r[0]),l.push(r[1])),l},e.prototype.decompose=function(t,i){var n=t,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;var a=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(a),a.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var s=this.polygonPool.obtain();s.length=0;for(var l=-1,c=0,h=0,u=i.length;h<u;h+=3){var _=i[h]<<1,f=i[h+1]<<1,d=i[h+2]<<1,p=n[_],m=n[_+1],v=n[f],g=n[f+1],y=n[d],T=n[d+1],S=!1;if(l==_){var E=s.length-4,A=e.winding(s[E],s[E+1],s[E+2],s[E+3],y,T),b=e.winding(y,T,s[0],s[1],s[2],s[3]);A==c&&b==c&&(s.push(y),s.push(T),o.push(d),S=!0)}S||(s.length>0?(r.push(s),a.push(o)):(this.polygonPool.free(s),this.polygonIndicesPool.free(o)),(s=this.polygonPool.obtain()).length=0,s.push(p),s.push(m),s.push(v),s.push(g),s.push(y),s.push(T),(o=this.polygonIndicesPool.obtain()).length=0,o.push(_),o.push(f),o.push(d),c=e.winding(p,m,v,g,y,T),l=_)}for(s.length>0&&(r.push(s),a.push(o)),h=0,u=r.length;h<u;h++)if(0!=(o=a[h]).length)for(var x=o[0],C=o[o.length-1],w=(s=r[h])[E=s.length-4],R=s[E+1],I=s[E+2],O=s[E+3],P=s[0],M=s[1],D=s[2],N=s[3],L=e.winding(w,R,I,O,P,M),B=0;B<u;B++)if(B!=h){var F=a[B];if(3==F.length){var z=F[0],U=F[1],k=F[2],G=r[B];y=G[G.length-2],T=G[G.length-1],z==x&&U==C&&(A=e.winding(w,R,I,O,y,T),b=e.winding(y,T,P,M,D,N),A==L&&b==L&&(G.length=0,F.length=0,s.push(y),s.push(T),o.push(k),w=I,R=O,I=y,O=T,B=0))}}for(h=r.length-1;h>=0;h--)0==(s=r[h]).length&&(r.splice(h,1),this.polygonPool.free(s),o=a[h],a.splice(h,1),this.polygonIndicesPool.free(o));return r},e.isConcave=function(t,e,i,n){var r=n[(e+t-1)%e]<<1,a=n[t]<<1,o=n[(t+1)%e]<<1;return!this.positiveArea(i[r],i[r+1],i[a],i[a+1],i[o],i[o+1])},e.positiveArea=function(t,e,i,n,r,a){return t*(a-n)+i*(e-a)+r*(n-e)>=0},e.winding=function(t,e,i,n,r,a){var o=i-t,s=n-e;return r*s-a*o+o*e-t*s>=0?1:-1},e}();t.Triangulator=e}(Udt||(Udt={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var i=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=e,this.b=i,this.a=n}return t.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=i;var n=function(){function t(){}return t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))},t.randomTriangularWith=function(t,e,i){var n=Math.random(),r=e-t;return n<=(i-t)/r?t+Math.sqrt(n*r*(i-t)):e-Math.sqrt((1-n)*r*(e-i))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=n;var r=function(){function t(){}return t.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)},t}();t.Interpolation=r;var a=function(t){function e(e){var i=t.call(this)||this;return i.power=2,i.power=e,i}return kdt(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(r);t.Pow=a;var o=function(t){function e(e){return t.call(this,e)||this}return kdt(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(a);t.PowOut=o;var s=function(){function t(){}return t.arrayCopy=function(t,e,i,n,r){for(var a=e,o=n;a<e+r;a++,o++)i[o]=t[a]},t.setArraySize=function(t,e,i){void 0===i&&(i=0);var n=t.length;if(n==e)return t;if(t.length=e,n<e)for(var r=n;r<e;r++)t[r]=i;return t},t.ensureArrayCapacity=function(e,i,n){return void 0===n&&(n=0),e.length>=i?e:t.setArraySize(e,i,n)},t.newArray=function(t,e){for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var i=new Array(e),n=0;n<i.length;n++)i[n]=0;return i},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var i=new Array(e),n=0;n<i.length;n++)i[n]=0;return i},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=s;var l=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t}();t.DebugUtils=l;var c=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=c;var h=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=h;var u=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=u;var _=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=_}(Udt||(Udt={})),Math.fround||(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1))),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var i=function(e){function i(t){var n=e.call(this,t)||this;return n.id=(65535&i.nextID++)<<11,n.worldVerticesLength=0,n.deformAttachment=n,n}return kdt(i,e),i.prototype.computeWorldVertices=function(t,e,i,n,r,a){i=r+(i>>1)*a;var o=t.bone.skeleton,s=t.deform,l=this.vertices,c=this.bones;if(null!=c){for(var h=0,u=0,_=0;_<e;_+=2)h+=(m=c[h])+1,u+=m;var f=o.bones;if(0==s.length)for(R=r,b=3*u;R<i;R+=a){var d=0,p=0,m=c[h++];for(m+=h;h<m;h++,b+=3){T=f[c[h]],I=l[b],O=l[b+1];var v=l[b+2];d+=(I*T.a+O*T.b+T.worldX)*v,p+=(I*T.c+O*T.d+T.worldY)*v}n[R]=d,n[R+1]=p}else for(var g=s,y=(R=r,b=3*u,u<<1);R<i;R+=a){for(d=0,p=0,m=c[h++],m+=h;h<m;h++,b+=3,y+=2)T=f[c[h]],I=l[b]+g[y],O=l[b+1]+g[y+1],v=l[b+2],d+=(I*T.a+O*T.b+T.worldX)*v,p+=(I*T.c+O*T.d+T.worldY)*v;n[R]=d,n[R+1]=p}}else{s.length>0&&(l=s);for(var T,S=(T=t.bone).worldX,E=T.worldY,A=T.a,b=T.b,x=T.c,C=T.d,w=e,R=r;R<i;w+=2,R+=a){var I=l[w],O=l[w+1];n[R]=I*A+O*b+S,n[R+1]=I*x+O*C+E}}},i.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},i.nextID=0,i}(e);t.VertexAttachment=i}(Udt||(Udt={})),function(t){var e;(e=t.AttachmentType||(t.AttachmentType={}))[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(Udt||(Udt={})),function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n.color=new t.Color(1,1,1,1),n}return kdt(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.BoundingBoxAttachment=e}(Udt||(Udt={})),function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n.color=new t.Color(.2275,.2275,.8078,1),n}return kdt(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.ClippingAttachment=e}(Udt||(Udt={})),function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n.color=new t.Color(1,1,1,1),n.tempColor=new t.Color(0,0,0,0),n}return kdt(i,e),i.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var i=this.uvs,n=this.uvs.length,r=this.region.u,a=this.region.v,o=0,s=0;if(this.region instanceof t.TextureAtlasRegion){var l=this.region,c=l.texture.getImage().width,h=l.texture.getImage().height;switch(l.degrees){case 90:r-=(l.originalHeight-l.offsetY-l.height)/c,a-=(l.originalWidth-l.offsetX-l.width)/h,o=l.originalHeight/c,s=l.originalWidth/h;for(var u=0;u<n;u+=2)i[u]=r+e[u+1]*o,i[u+1]=a+(1-e[u])*s;return;case 180:for(r-=(l.originalWidth-l.offsetX-l.width)/c,a-=l.offsetY/h,o=l.originalWidth/c,s=l.originalHeight/h,u=0;u<n;u+=2)i[u]=r+(1-e[u])*o,i[u+1]=a+(1-e[u+1])*s;return;case 270:for(r-=l.offsetY/c,a-=l.offsetX/h,o=l.originalHeight/c,s=l.originalWidth/h,u=0;u<n;u+=2)i[u]=r+(1-e[u+1])*o,i[u+1]=a+e[u]*s;return}r-=l.offsetX/c,a-=(l.originalHeight-l.offsetY-l.height)/h,o=l.originalWidth/c,s=l.originalHeight/h}else null==this.region?(r=a=0,o=s=1):(o=this.region.u2-r,s=this.region.v2-a);for(u=0;u<n;u+=2)i[u]=r+e[u]*o,i[u+1]=a+e[u+1]*s},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},i.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new i(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},i.prototype.newLinkedMesh=function(){var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},i}(t.VertexAttachment);t.MeshAttachment=e}(Udt||(Udt={})),function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n.closed=!1,n.constantSpeed=!1,n.color=new t.Color(1,1,1,1),n}return kdt(i,e),i.prototype.copy=function(){var e=new i(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},i}(t.VertexAttachment);t.PathAttachment=e}(Udt||(Udt={})),function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n.color=new t.Color(.38,.94,0,1),n}return kdt(i,e),i.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},i.prototype.computeWorldRotation=function(e){var i=t.MathUtils.cosDeg(this.rotation),n=t.MathUtils.sinDeg(this.rotation),r=i*e.a+n*e.b,a=i*e.c+n*e.d;return Math.atan2(a,r)*t.MathUtils.radDeg},i.prototype.copy=function(){var t=new i(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.PointAttachment=e}(Udt||(Udt={})),function(t){var e=function(e){function i(i){var n=e.call(this,i)||this;return n.x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new t.Color(1,1,1,1),n.offset=t.Utils.newFloatArray(8),n.uvs=t.Utils.newFloatArray(8),n.tempColor=new t.Color(1,1,1,1),n}return kdt(i,e),i.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,a=n+this.region.width*t,o=r+this.region.height*e,s=this.rotation*Math.PI/180,l=Math.cos(s),c=Math.sin(s),h=n*l+this.x,u=n*c,_=r*l+this.y,f=r*c,d=a*l+this.x,p=a*c,m=o*l+this.y,v=o*c,g=this.offset;g[i.OX1]=h-f,g[i.OY1]=_+u,g[i.OX2]=h-v,g[i.OY2]=m+u,g[i.OX3]=d-v,g[i.OY3]=m+p,g[i.OX4]=d-f,g[i.OY4]=_+p},i.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},i.prototype.computeWorldVertices=function(t,e,n,r){var a=this.offset,o=t.worldX,s=t.worldY,l=t.a,c=t.b,h=t.c,u=t.d,_=0,f=0;_=a[i.OX1],f=a[i.OY1],e[n]=_*l+f*c+o,e[n+1]=_*h+f*u+s,n+=r,_=a[i.OX2],f=a[i.OY2],e[n]=_*l+f*c+o,e[n+1]=_*h+f*u+s,n+=r,_=a[i.OX3],f=a[i.OY3],e[n]=_*l+f*c+o,e[n+1]=_*h+f*u+s,n+=r,_=a[i.OX4],f=a[i.OY4],e[n]=_*l+f*c+o,e[n+1]=_*h+f*u+s},i.prototype.copy=function(){var e=new i(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},i.OX1=0,i.OY1=1,i.OX2=2,i.OY2=3,i.OX3=4,i.OY3=5,i.OX4=6,i.OY4=7,i.X1=0,i.Y1=1,i.C1R=2,i.C1G=3,i.C1B=4,i.C1A=5,i.U1=6,i.V1=7,i.X2=8,i.Y2=9,i.C2R=10,i.C2G=11,i.C2B=12,i.C2A=13,i.U2=14,i.V2=15,i.X3=16,i.Y3=17,i.C3R=18,i.C3G=19,i.C3B=20,i.C3A=21,i.U3=22,i.V3=23,i.X4=24,i.Y4=25,i.C4R=26,i.C4G=27,i.C4B=28,i.C4A=29,i.U4=30,i.V4=31,i}(t.Attachment);t.RegionAttachment=e}(Udt||(Udt={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(Udt||(Udt={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var i=this.angle*t.MathUtils.degreesToRadians,n=e.x-this.worldX,r=e.y-this.worldY,a=Math.sqrt(n*n+r*r);if(a<this.radius){var o=this.interpolation.apply(0,i,(this.radius-a)/this.radius),s=Math.cos(o),l=Math.sin(o);e.x=s*n-l*r+this.worldX,e.y=l*n+s*r+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(Udt||(Udt={}));var Gdt,Hdt,Vdt,Wdt,jdt,qdt,Xdt=Udt,Ydt=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e){return e.listener||(e.listener=new t),e.listener},t}(),Kdt=[],Zdt=[],Qdt=0,Jdt=0,$dt=0,tpt=null,ept=null,ipt=0,npt=0,rpt=0,apt=0,opt=null,spt=null,lpt=0,cpt=0,hpt=new Xdt.Color(1,1,1,1),upt=new Xdt.Color(1,1,1,1),_pt=[0,1,2,2,3,0],fpt=function(){function t(){this.frames=[],this.totalTime=0,this.isCompleted=!1,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._frameIdx=-1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var i=null==t?void 0:t.skeleton,n=null==t?void 0:t.listener,r=null==t?void 0:t.state,a=null==i?void 0:i.data.findAnimation(this._animationName);null==r||r.setAnimationWith(0,a,!1),this.bind(n),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t))){var e=this._skeletonInfo,i=null==e?void 0:e.skeleton,n=null==e?void 0:e.clipper,r=null==e?void 0:e.state;do{null==i||i.update(1/60),null==r||r.update(1/60),null==r||r.apply(i),null==i||i.updateWorldTransform(),this._frameIdx++,this.updateFrame(i,n,this._frameIdx),this.totalTime+=1/60}while(this.needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.fillVertices=function(t,e,i,n,r){if(Wdt=i.a*e.a*t.a*255,Gdt=e.r*t.r*255,Hdt=e.g*t.g*255,Vdt=e.b*t.b*255,hpt.r=Gdt*i.r,hpt.g=Hdt*i.g,hpt.b=Vdt*i.b,hpt.a=Wdt,null==r.darkColor?upt.set(0,0,0,1):(upt.r=r.darkColor.r*Gdt,upt.g=r.darkColor.g*Hdt,upt.b=r.darkColor.b*Vdt),upt.a=0,jdt=(hpt.a<<24>>>0)+(hpt.b<<16)+(hpt.g<<8)+hpt.r,qdt=(upt.a<<24>>>0)+(upt.b<<16)+(upt.g<<8)+upt.r,opt!==jdt||spt!==qdt){var a=this._tempColors;opt=jdt,spt=qdt,apt>0&&(a[apt-1].vfOffset=$dt),a[apt++]={fr:hpt.r,fg:hpt.g,fb:hpt.b,fa:hpt.a,dr:upt.r,dg:upt.g,db:upt.b,da:upt.a,vfOffset:0}}if(n.isClipping()){n.clipTriangles(Kdt,lpt,Zdt,cpt,Kdt,hpt,upt,!0,6,$dt,$dt+2);var o=n.clippedVertices,s=n.clippedTriangles;cpt=s.length,lpt=o.length/12*6;for(var l=0,c=Jdt,h=s.length;l<h;)Zdt[c++]=s[l++];for(var u=0,_=o.length,f=$dt;u<_;u+=12,f+=6)Kdt[f]=o[u],Kdt[f+1]=o[u+1],Kdt[f+2]=o[u+6],Kdt[f+3]=o[u+7],Kdt[f+4]=jdt,Kdt[f+5]=qdt}else for(var d=$dt,p=$dt+lpt;d<p;d+=6)Kdt[d+4]=jdt,Kdt[d+5]=qdt},e.updateFrame=function(t,e,i){$dt=0,Qdt=0,Jdt=0,tpt=null,ept=null,ipt=0,npt=0,rpt=0,apt=0,opt=null,spt=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var n=this.frames[i],r=this._tempSegments=n.segments,a=this._tempColors=n.colors,o=this._tempBoneInfos=n.boneInfos;this.traverseSkeleton(t,e),apt>0&&(a[apt-1].vfOffset=$dt),a.length=apt,o.length=Qdt;var s=rpt-1;if(s>=0)if(npt>0){var l=r[s];l.indexCount=npt,l.vfCount=13*ipt,l.vertexCount=ipt,r.length=rpt}else r.length=rpt-1;if(0!==r.length){var c=n.vertices,h=$dt/6*13;(!c||c.length<h)&&(c=n.vertices=new Float32Array(h));for(var u=0,_=0;u<h;)c[u]=Kdt[_++],c[u+1]=Kdt[_++],c[u+3]=Kdt[_++],c[u+4]=Kdt[_++],this._setVerticeColor(Kdt[_++],c,u+5),this._setVerticeColor(Kdt[_++],c,u+9),u+=13;var f=n.indices;(!f||f.length<Jdt)&&(f=n.indices=new Uint16Array(Jdt));for(var d=0;d<Jdt;d++)f[d]=Zdt[d];n.vertices=c,n.indices=f}},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.traverseSkeleton=function(t,e){var i,n,r,a,o,s,l,c,h,u,_,f,d=this._tempSegments,p=this._tempBoneInfos,m=t.color,v=t.bones;if(this._enableCacheAttachedInfo)for(var g=0,y=v.length;g<y;g++,Qdt++){var T=v[g],S=p[Qdt];S||(S=p[Qdt]={}),S.a=T.a,S.b=T.b,S.c=T.c,S.d=T.d,S.worldX=T.worldX,S.worldY=T.worldY}for(var E=0,A=t.drawOrder.length;E<A;E++)if(f=t.drawOrder[E],lpt=0,cpt=0,i=f.getAttachment())if(s=i instanceof Xdt.RegionAttachment,l=i instanceof Xdt.MeshAttachment,i instanceof Xdt.ClippingAttachment)e.clipStart(f,i);else if(s||l)if(c=i.region.texture.getRealTexture()){if(_=f.data.blendMode,tpt===c.nativeUrl&&ept===_||(tpt=c.nativeUrl,ept=_,(h=rpt-1)>=0&&(npt>0?((u=d[h]).indexCount=npt,u.vertexCount=ipt,u.vfCount=13*ipt):rpt--),d[rpt]={tex:c,blendMode:_,indexCount:0,vertexCount:0,vfCount:0},rpt++,npt=0,ipt=0),s)o=_pt,lpt=24,cpt=6,i.computeWorldVertices(f.bone,Kdt,$dt,6);else if(l){var b=i;o=b.triangles,lpt=6*(b.worldVerticesLength>>1),cpt=o.length,b.computeWorldVertices(f,0,b.worldVerticesLength,Kdt,$dt,6)}if(0!==lpt&&0!==cpt){for(var x=0,C=Jdt,w=o.length;x<w;)Zdt[C++]=o[x++];a=i.uvs;for(var R=$dt,I=$dt+lpt,O=0;R<I;R+=6,O+=2)Kdt[R+2]=a[O],Kdt[R+3]=a[O+1];if(n=i.color,r=f.color,this.fillVertices(m,n,r,e,f),cpt>0){for(var P=Jdt,M=Jdt+cpt;P<M;P++)Zdt[P]+=ipt;Jdt+=cpt,$dt+=lpt,npt+=cpt,ipt+=lpt/6}e.clipEndWithSlot(f)}else e.clipEndWithSlot(f)}else e.clipEndWithSlot(f);else e.clipEndWithSlot(f);else e.clipEndWithSlot(f);e.clipEnd()},e._setVerticeColor=function(t,e,i){e[i]=(255&t)/255,e[i+1]=(t>>8&255)/255,e[i+2]=(t>>16&255)/255,e[i+3]=(t>>24&255)/255},t}(),dpt=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.removeSkeleton=function(t){var e=this._skeletonCache[t];if(e){var i=e.animationsCache;for(var n in i){var r=i[n];r&&(this._animationPool[t+"#"+n]=r,r.clear())}delete this._skeletonCache[t]}},e.getSkeletonCache=function(t,e){var i=this._skeletonCache[t];if(!i){var n=new Xdt.Skeleton(e),r=new Xdt.SkeletonClipping,a=new Xdt.AnimationStateData(n.data),o=new Xdt.AnimationState(a),s=new Ydt;o.addListener(s),this._skeletonCache[t]=i={skeleton:n,clipper:r,state:o,listener:s,animationsCache:{},curAnimationCache:null}}return i},e.getAnimationCache=function(t,e){var i=this._skeletonCache[t];return i?i.animationsCache[e]:null},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var i=e.animationsCache;for(var n in i)i[n].invalidAllFrame()}},e.initAnimationCache=function(t,e){if(!e)return null;var i=this._skeletonCache[t],n=i&&i.skeleton;if(!n)return null;if(!n.data.findAnimation(e))return null;var r=i.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new fpt)._privateMode=this._privateMode,a.init(i,e),r[e]=a}return a},e.updateAnimationCache=function(t,e){if(e){var i=this.initAnimationCache(t,e);if(!i)return null;i.updateAllFrame()}else{var n=this._skeletonCache[t];if(!n||!n.skeleton)return;var r=n.animationsCache;for(var a in r)r[a].updateAllFrame()}},t}();dpt.FrameTime=1/60,dpt.sharedCache=new dpt;var ppt,mpt,vpt,gpt,ypt,Tpt,Spt,Ept,Apt,bpt,xpt,Cpt,wpt=new Vi,Rpt=function(){function t(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},e.reset=function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},e._syncAttachedNode=function(){var t=this;if(this._inited){var e=this._skeletonComp.socketNodes;if(0!==e.size){var i;if(i=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones)for(var n,r=function(e,i){var n=wpt;n.m00=i.a,n.m01=i.c,n.m04=i.b,n.m05=i.d,n.m12=i.worldX,n.m13=i.worldY,e.matrix=wpt,e.scale=t._skeletonNode.scale},a=Q(e.keys());!(n=a()).done;){var o=n.value,s=e.get(o);if(s&&s.isValid){var l=i[o];l?r(s,l):(s.removeFromParent(),s.destroy(),e.delete(o))}else e.delete(o)}}}},t}(),Ipt=function(t){function e(e){var i;return(i=t.call(this,e)||this).name="sp.SkeletonTexture",i._texture=null,i._material=null,i}Y(e,t);var i=e.prototype;return i.setRealTexture=function(t){this._texture=t},i.getRealTexture=function(){return this._texture?this._texture instanceof V_?this._texture._texture:this._texture:null},i.setFilters=function(t,e){this._texture&&this.getRealTexture().setFilters(Opt(t),Opt(e))},i.setWraps=function(t,e){this._texture&&this.getRealTexture().setWrapMode(Ppt(t),Ppt(e))},i.dispose=function(){},e}(Xdt.Texture);function Opt(t){switch(t){case Xdt.TextureFilter.Nearest:case Xdt.TextureFilter.MipMapNearestNearest:case Xdt.TextureFilter.MipMapLinearNearest:return L_.NEAREST;case Xdt.TextureFilter.MipMap:case Xdt.TextureFilter.MipMapNearestLinear:case Xdt.TextureFilter.MipMapLinearLinear:case Xdt.TextureFilter.Linear:default:return L_.LINEAR}}function Ppt(t){switch(t){case Xdt.TextureWrap.MirroredRepeat:return N_.MIRRORED_REPEAT;case Xdt.TextureWrap.ClampToEdge:return N_.CLAMP_TO_EDGE;case Xdt.TextureWrap.Repeat:default:return N_.REPEAT}}var Mpt,Dpt,Npt,Lpt,Bpt,Fpt,zpt,Upt,kpt,Gpt,Hpt,Vpt,Wpt,jpt,qpt,Xpt,Ypt,Kpt,Zpt,Qpt,Jpt,$pt,tmt,emt,imt,nmt,rmt,amt,omt,smt,lmt,cmt,hmt,umt,_mt,fmt,dmt,pmt,mmt,vmt,gmt,ymt,Tmt,Smt,Emt,Amt,bmt,xmt,Cmt,wmt,Rmt,Imt,Omt,Pmt,Mmt,Dmt,Nmt,Lmt,Bmt,Fmt=(ppt=ru("sp.SkeletonData"),mpt=Fu([yd]),vpt=Fu([Ue]),ppt((Cpt=xpt=function(t){function e(){var e;return J(e=t.call(this)||this,"_skeletonJson",Tpt,K(e)),J(e,"textures",Spt,K(e)),J(e,"textureNames",Ept,K(e)),J(e,"scale",Apt,K(e)),J(e,"_atlasText",bpt,K(e)),e._buffer=void 0,e._skeletonCache=null,e._atlasCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}Y(e,t),q(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]);var i=e.prototype;return i.createNode=function(t){var e=new wA(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},i.reset=function(){this._skeletonCache=null,this._atlasCache=null},i.resetEnums=function(){},i.ensureTexturesLoaded=function(t,e){var i=this.textures,n=i.length;if(0!==n)for(var r=0,a=function(){++r>=n&&(t&&t.call(e,!0),t=null)},o=0;o<n;o++){var s=i[o];s.loaded?a():s.once("load",a)}else t&&t.call(e,!1)},i.isTexturesLoaded=function(){for(var t=this.textures,e=t.length,i=0;i<e;i++)if(!t[i].loaded)return!1;return!0},i.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||console.error(this.name+" no textures found!"),null;var e=this._getAtlas(t);if(!e)return null;var i=new Xdt.AtlasAttachmentLoader(e),n=null,r=null;return this.skeletonJson?(r=new Xdt.SkeletonJson(i),n=this.skeletonJson):(r=new Xdt.SkeletonBinary(i),n=new Uint8Array(this._nativeAsset)),r.scale=this.scale,this._skeletonCache=r.readSkeletonData(n),e.dispose(),this._skeletonCache},i.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,i={},n=0;n<e.length;n++)i[e[n].name]=n;return this._skinsEnum=he(i)}return null},i.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},i=t.animations,n=0;n<i.length;n++)e[i[n].name]=n+1;return this._animsEnum=he(e)}return null},i.destroy=function(){return dpt.sharedCache.removeSkeleton(this._uuid),t.prototype.destroy.call(this)},i._getTexture=function(t){for(var e=this.textureNames,i=0;i<e.length;i++)if(e[i]===t){var n=this.textures[i],r=new Ipt({width:n.width,height:n.height});return r.setRealTexture(n),r}return console.error(this.name+" no textures found!"),null},i._getAtlas=function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new Xdt.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||console.error(this.name+" no atlas found!"),null)},e}(M_),xpt.preventDeferredLoadDependents=!0,Tpt=$((ypt=Cpt).prototype,"_skeletonJson",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Spt=$(ypt.prototype,"textures",[cu,mpt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ept=$(ypt.prototype,"textureNames",[cu,vpt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Apt=$(ypt.prototype,"scale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bpt=$(ypt.prototype,"_atlasText",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),gpt=ypt))||gpt);function zmt(t,e,i){ei.Attr.setClassAttr(t,e,"type","Enum"),ei.Attr.setClassAttr(t,e,"enumList",he.getList(i))}n.internal.SpineSkeletonData=Fmt,function(t){t[t.default=0]="default"}(Dmt||(Dmt={})),fe(Dmt),function(t){t[t["<None>"]=0]="<None>"}(Nmt||(Nmt={})),fe(Nmt),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(Lmt||(Lmt={})),fe(Lmt),function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(Bmt||(Bmt={}));var Umt=(Mpt=ru("sp.Skeleton.SpineSocket"),Dpt=Fu(wA),Mpt((Bpt=$((Lpt=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),J(this,"path",Bpt,this),J(this,"target",Fpt,this),this.path=t,this.target=e}).prototype,"path",[cu,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Fpt=$(Lpt.prototype,"target",[Dpt,yu,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Npt=Lpt))||Npt);le.setClassAlias(Umt,"sp.Skeleton.SpineSocket");var kmt=(zpt=ru("sp.Skeleton"),Upt=gu(),kpt=du(),Gpt=Fu(nm),Hpt=Ru(),Vpt=Su(),Wpt=Tu(),jpt=Tu(),qpt=Tu(),Xpt=Fu(Fmt),Ypt=Su(),Kpt=Fu(Dmt),Zpt=Eu(),Qpt=Su(),Jpt=Fu(Nmt),$pt=Eu(),tmt=Su(),emt=Eu(),imt=Fu(Lmt),nmt=Eu(),rmt=Eu(),amt=Eu(),omt=Eu(),smt=Eu(),lmt=Eu(),cmt=Eu(),hmt=Fu([Umt]),umt=Eu(),_mt=Tu(),fmt=Tu(),zpt(dmt=Upt(dmt=kpt(dmt=fu((Mmt=Pmt=function(t){function e(){var e;return J(e=t.call(this)||this,"paused",mmt,K(e)),J(e,"loop",vmt,K(e)),J(e,"_premultipliedAlpha",gmt,K(e)),J(e,"_timeScale",ymt,K(e)),e.enableBatch=!1,e._frameCache=null,e._curFrame=null,e._effectDelegate=null,e._skeleton=void 0,e._clipper=void 0,e._debugRenderer=void 0,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._startEntry=void 0,e._endEntry=void 0,e.attachUtil=void 0,e._materialCache={},e._enumSkins=he({}),e._enumAnimations=he({}),e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animationName="",e._animationQueue=[],e._headAniInfo=null,e._playTimes=0,e._isAniComplete=!0,J(e,"_useTint",Tmt,K(e)),J(e,"_preCacheMode",Smt,K(e)),J(e,"_cacheMode",Emt,K(e)),J(e,"_defaultCacheMode",Amt,K(e)),J(e,"_debugBones",bmt,K(e)),J(e,"_debugSlots",xmt,K(e)),J(e,"_skeletonData",Cmt,K(e)),J(e,"defaultSkin",wmt,K(e)),J(e,"defaultAnimation",Rmt,K(e)),J(e,"_sockets",Imt,K(e)),e._meshRenderDataArray=[],J(e,"_debugMesh",Omt,K(e)),e._rootBone=void 0,e._state=void 0,e._listener=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._meshRenderDataArrayIdx=0,e._effectDelegate=null,e._skeleton=null,e._rootBone=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=-1,e._endSlotIndex=-1,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e.attachUtil=new Rpt,zmt(K(e),"_defaultSkinIndex",e._enumSkins),zmt(K(e),"_animationIndex",e._enumAnimations),e}Y(e,t),q(e,[{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this._cleanMaterialCache()}},{key:"srcBlendFactor",get:function(){return t.prototype.srcBlendFactor},set:function(t){this.srcBlendFactor=t}},{key:"dstBlendFactor",get:function(){return t.prototype.dstBlendFactor},set:function(t){this.dstBlendFactor=t}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!=t&&(this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData())}},{key:"animation",get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){t?(this.setAnimation(0,t,this.loop),this.destroyRenderData(),this.markForUpdateRenderData()):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),e){var i=e[t];void 0!==i?(this.defaultSkin=i,this.setSkin(this.defaultSkin)):console.error(this.name+" skin enums are invalid")}else console.error(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(this.skeletonData)if(t){var e=this.skeletonData.getAnimsEnum();if(e){var i=e[t];if(void 0!==i)return i}}else this._refreshInspector();return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),e){var i=e[t];void 0!==i?(this.animation=i,this.animation=i):console.error(this.name+" animation enums are invalid")}else console.error(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._defaultCacheMode},set:function(t){this._defaultCacheMode=t,this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint(),this.markForUpdateRenderData())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil._syncAttachedNode()}},{key:"socketNodes",get:function(){return this._socketNodes}}]);var i=e.prototype;return i.disableRender=function(){this.destroyRenderData()},i.setBlendHash=function(){-1!==this._blendHash&&(this._blendHash=-1)},i.setSkeletonData=function(t){var e=this.node._uiProps.uiTransformComp;if(null!=t.width&&null!=t.height&&e.setContentSize(t.width,t.height),this._cacheMode===Lmt.SHARED_CACHE?this._skeletonCache=dpt.sharedCache:this._cacheMode===Lmt.PRIVATE_CACHE&&(this._skeletonCache=new dpt,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&f("Debug bones or slots is invalid in cached mode");var i=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=i.skeleton,this._clipper=i.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new Xdt.Skeleton(t),this._clipper=new Xdt.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this.markForUpdateRenderData()},i.setSlotsRange=function(t,e){this.isAnimationCached()?f("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},i.setAnimationStateData=function(t){if(this.isAnimationCached())f("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new Xdt.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},i.__preload=function(){t.prototype.__preload.call(this);for(var e=this.node.children,i=0,n=e.length;i<n;i++){var r=e[i];r&&"DEBUG_DRAW_NODE"===r.name&&r.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings()},i.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint(),this._updateSocketBindings(),this.markForUpdateRenderData())},i.isAnimationCached=function(){return this._cacheMode!==Lmt.REALTIME},i.update=function(t){if(!this.paused)if(t*=1*this._timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var i=e.frames;this._curFrame=i[i.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var n=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,n.animationName,n.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},i.setVertexEffectDelegate=function(t){this._effectDelegate=t},i.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},i.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},i.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},i.updateAnimationCache=function(t){if(this.isAnimationCached()){var e=this._skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},i.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData._uuid)},i.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},i.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},i.setSkin=function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},i.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},i.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},i.getTextureAtlas=function(t){return t.region},i.setMix=function(t,e,i){this._state&&this._state.data.setMix(t,e,i)},i.setAnimation=function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&f("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var n=this._skeletonCache.getAnimationCache(this._skeletonData._uuid,e);n||(n=this._skeletonCache.initAnimationCache(this._skeletonData._uuid,e)),n&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=n,this._socketNodes.size>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var r=this._skeleton.data.findAnimation(e);if(!r)return T(7509,e),null;var a=this._state.setAnimationWith(t,r,i);return this._state.apply(this._skeleton),a}return null},i.addAnimation=function(t,e,i,n){if(n=n||0,this.isAnimationCached())0!==t&&f("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:n});else if(this._skeleton){var r,a=this._skeleton.data.findAnimation(e);return a?null===(r=this._state)||void 0===r?void 0:r.addAnimationWith(t,a,i,n):(T(7510,e),null)}return null},i.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},i.getCurrent=function(t){if(this.isAnimationCached())f("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},i.clearTracks=function(){this.isAnimationCached()?f("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks()},i.clearTrack=function(t){this.isAnimationCached()?f("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},i.setStartListener=function(t){this._ensureListener(),this._listener.start=t},i.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},i.setEndListener=function(t){this._ensureListener(),this._listener.end=t},i.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},i.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},i.setEventListener=function(t){this._ensureListener(),this._listener.event=t},i.setTrackStartListener=function(t,e){Ydt.getListeners(t).start=e},i.setTrackInterruptListener=function(t,e){Ydt.getListeners(t).interrupt=e},i.setTrackEndListener=function(t,e){Ydt.getListeners(t).end=e},i.setTrackDisposeListener=function(t,e){Ydt.getListeners(t).dispose=e},i.setTrackCompleteListener=function(t,e){Ydt.getListeners(t).complete=function(t){var i=Math.floor(t.trackTime/t.animationEnd);e(t,i)}},i.setTrackEventListener=function(t,e){Ydt.getListeners(t).event=e},i.getState=function(){return this._state},i.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler()},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){this._cleanMaterialCache(),this.destroyRenderData(),t.prototype.onDestroy.call(this)},i.requestMeshRenderData=function(t){if(this._meshRenderDataArray.length>0&&0===this._meshRenderDataArray[this._meshRenderDataArray.length-1].renderData.vertexCount)return this._meshRenderDataArray[this._meshRenderDataArray.length-1];var e=new RB(t),i={renderData:e};return e.material=null,this._meshRenderDataArray.push(i),i},i.destroyRenderData=function(){this._meshRenderDataArray.length>0&&(this._meshRenderDataArray.forEach((function(t){t.renderData.reset()})),this._meshRenderDataArray.length=0)},i.getMaterialForBlendAndTint=function(t,e,i){var n=i+"/"+t+"/"+e,r=this._materialCache[n];if(r)return r;var a=this.customMaterial;null===a&&(a=Zd.get("default-spine-material"));var o=!1;switch(i){case Bmt.TWO_COLORED:o=!0;break;case Bmt.COLORED_TEXTURED:}return r=new cm({parent:a,subModelIdx:0,owner:this}),this._materialCache[n]=r,r.overridePipelineStates({blendState:{blendColor:Ci.WHITE,targets:[{blendEq:Qa.ADD,blendAlphaEq:Qa.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}}),r.recompileShaders({TWO_COLORED:o}),r},i.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},i._render=function(t){if(this._meshRenderDataArray)for(var e=0;e<this._meshRenderDataArray.length;e++){var i=this.material;this._meshRenderDataArrayIdx=e;var n=this._meshRenderDataArray[e];n.renderData.material&&(this.material=n.renderData.material),n.texture&&t.commitComp(this,n.texture,this._assembler,null),this.material=i}},i.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},i._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},i._updateCache=function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames,n=dpt.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var r=Math.floor(this._accTime/n);if(e.isCompleted||e.updateToFrame(r),e.isCompleted&&r>=i.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,this._emitCacheCompleteEvent(),void this.markForUpdateRenderData();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=i[r],this.markForUpdateRenderData()}},i._updateRealtime=function(t){var e=this._skeleton,i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)),this.markForUpdateRenderData())},i._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(i){return null==i.parent?i.data.name||"<Unamed>":e(t[i.parent.data.index])+"/"+i.data.name},i=0,n=t.length;i<n;i++){var r=t[i].data,a=e(t[i]);this._cachedSockets.set(a,r.index)}}},i._updateUseTint=function(){this.destroyRenderData()},i._updateBatch=function(){this.markForUpdateRenderData()},i._validateRender=function(){var t=this.skeletonData;t&&t.isTexturesLoaded()||this.disableRender()},i._updateAnimEnum=function(){var t;t=this.skeletonData?this.skeletonData.getAnimsEnum():Nmt,this._enumAnimations=he({}),Object.assign(this._enumAnimations,t),he.update(this._enumAnimations),zmt(this,"_animationIndex",this._enumAnimations)},i._updateSkinEnum=function(){var t;t=this.skeletonData?this.skeletonData.getSkinsEnum():Dmt,this._enumSkins=he({}),Object.assign(this._enumSkins,t),he.update(this._enumSkins),zmt(this,"_defaultSkinIndex",this._enumSkins)},i._ensureListener=function(){this._listener||(this._listener=new Ydt,this._state&&this._state.addListener(this._listener))},i._updateSkeletonData=function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new Xdt.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){f(t)}this.attachUtil.init(this),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},i._refreshInspector=function(){this._updateAnimEnum(),this._updateSkinEnum()},i._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new cR("DEBUG_DRAW_NODE"),e=t.addComponent(YU);e.lineWidth=1,e.strokeColor=new Ci(255,0,0,255),this._debugRenderer=e,t.parent=this.node}this.isAnimationCached()&&f("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.destroy(),this._debugRenderer=null)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),0===this._meshRenderDataArray.length&&this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},i._updateColor=function(){},i._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var i=this._sockets[t];if(i.path&&i.target){var n=this._cachedSockets.get(i.path);if(!n){console.error("Skeleton data does not contain path "+i.path);continue}this._socketNodes.set(n,i.target)}}}},i._verifySockets=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e].target;!n||n.parent&&n.parent==this.node||console.error("Target node "+n.name+" is expected to be a direct child of "+this.node.name)}var r=new Map;t.forEach((function(t){t.target&&(r.get(t.target)?console.error("Target node "+t.target.name+" has existed."):r.set(t.target,!0))}))},i._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},e}(bz),Pmt.SpineSocket=Umt,Pmt.AnimationCacheMode=Lmt,$((pmt=Mmt).prototype,"customMaterial",[zu,Gpt,Hpt,Vpt],Object.getOwnPropertyDescriptor(pmt.prototype,"customMaterial"),pmt.prototype),$(pmt.prototype,"srcBlendFactor",[zu,Wpt],Object.getOwnPropertyDescriptor(pmt.prototype,"srcBlendFactor"),pmt.prototype),$(pmt.prototype,"dstBlendFactor",[zu,jpt],Object.getOwnPropertyDescriptor(pmt.prototype,"dstBlendFactor"),pmt.prototype),mmt=$(pmt.prototype,"paused",[qpt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$(pmt.prototype,"skeletonData",[yu,Xpt],Object.getOwnPropertyDescriptor(pmt.prototype,"skeletonData"),pmt.prototype),$(pmt.prototype,"_defaultSkinIndex",[Ypt,Kpt,Zpt],Object.getOwnPropertyDescriptor(pmt.prototype,"_defaultSkinIndex"),pmt.prototype),$(pmt.prototype,"_animationIndex",[Qpt,Jpt,$pt],Object.getOwnPropertyDescriptor(pmt.prototype,"_animationIndex"),pmt.prototype),$(pmt.prototype,"defaultCacheMode",[tmt,emt,yu,imt],Object.getOwnPropertyDescriptor(pmt.prototype,"defaultCacheMode"),pmt.prototype),vmt=$(pmt.prototype,"loop",[cu,nmt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gmt=$(pmt.prototype,"_premultipliedAlpha",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$(pmt.prototype,"premultipliedAlpha",[yu,rmt],Object.getOwnPropertyDescriptor(pmt.prototype,"premultipliedAlpha"),pmt.prototype),ymt=$(pmt.prototype,"_timeScale",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$(pmt.prototype,"timeScale",[amt,yu],Object.getOwnPropertyDescriptor(pmt.prototype,"timeScale"),pmt.prototype),$(pmt.prototype,"debugSlots",[yu,omt],Object.getOwnPropertyDescriptor(pmt.prototype,"debugSlots"),pmt.prototype),$(pmt.prototype,"debugBones",[yu,smt],Object.getOwnPropertyDescriptor(pmt.prototype,"debugBones"),pmt.prototype),$(pmt.prototype,"debugMesh",[yu,lmt],Object.getOwnPropertyDescriptor(pmt.prototype,"debugMesh"),pmt.prototype),$(pmt.prototype,"useTint",[yu,cmt],Object.getOwnPropertyDescriptor(pmt.prototype,"useTint"),pmt.prototype),$(pmt.prototype,"sockets",[hmt,umt],Object.getOwnPropertyDescriptor(pmt.prototype,"sockets"),pmt.prototype),Tmt=$(pmt.prototype,"_useTint",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Smt=$(pmt.prototype,"_preCacheMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Emt=$(pmt.prototype,"_cacheMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Lmt.REALTIME}}),Amt=$(pmt.prototype,"_defaultCacheMode",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Lmt.REALTIME}}),bmt=$(pmt.prototype,"_debugBones",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xmt=$(pmt.prototype,"_debugSlots",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Cmt=$(pmt.prototype,"_skeletonData",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wmt=$(pmt.prototype,"defaultSkin",[cu,_mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Rmt=$(pmt.prototype,"defaultAnimation",[fmt,cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Imt=$(pmt.prototype,"_sockets",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Omt=$(pmt.prototype,"_debugMesh",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dmt=pmt))||dmt)||dmt)||dmt)||dmt);n.internal.SpineSkeleton=kmt;var Gmt,Hmt,Vmt,Wmt,jmt,qmt,Xmt,Ymt,Kmt,Zmt,Qmt,Jmt,$mt,tvt,evt,ivt,nvt,rvt,avt,ovt,svt,lvt,cvt,hvt,uvt,_vt,fvt,dvt,pvt,mvt,vvt,gvt,yvt,Tvt,Svt,Evt,Avt,bvt,xvt,Cvt,wvt,Rvt,Ivt=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=null,this._interpolation=null,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new Xdt.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._interpolation=new Xdt.Pow(e),this._vertexEffect=new Xdt.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._interpolation=new Xdt.PowOut(e),this._vertexEffect=new Xdt.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),Ovt=0,Pvt=[0,1,2,2,3,0],Mvt=new Ci(0,0,255,255),Dvt=new Ci(255,0,0,255),Nvt=new Ci(0,255,0,255),Lvt=new Ci(255,255,0,255),Bvt=new Xdt.Color(1,1,1,1),Fvt=new Xdt.Color(1,1,1,1),zvt=new Xdt.Vector2,Uvt=new Xdt.Vector2,kvt=new Float32Array(4),Gvt=new Float32Array(4),Hvt=new Ri,Vvt=0,Wvt=0,jvt=0,qvt=0,Xvt=0,Yvt=0,Kvt=0,Zvt=null,Qvt=null,Jvt=null;function $vt(t){var e,i;switch(t){case Xdt.BlendMode.Additive:e=Gmt?Ja.ONE:Ja.SRC_ALPHA,i=Ja.ONE;break;case Xdt.BlendMode.Multiply:e=Ja.DST_COLOR,i=Ja.ONE_MINUS_SRC_ALPHA;break;case Xdt.BlendMode.Screen:e=Ja.ONE,i=Ja.ONE_MINUS_SRC_COLOR;break;case Xdt.BlendMode.Normal:default:e=Gmt?Ja.ONE:Ja.SRC_ALPHA,i=Ja.ONE_MINUS_SRC_ALPHA}return xvt.setBlendHash(),xvt.getMaterialForBlendAndTint(e,i,jmt?Bmt.TWO_COLORED:Bmt.COLORED_TEXTURED)}function tgt(t){Tvt=t.fa*Jmt,dvt=Kmt*(Hmt=Gmt?Tvt/255:1),pvt=Zmt*Hmt,mvt=Qmt*Hmt,vvt=t.fr*dvt,gvt=t.fg*pvt,yvt=t.fb*mvt,kvt[0]=vvt/255,kvt[1]=gvt/255,kvt[2]=yvt/255,kvt[3]=Tvt/255,Svt=t.dr*dvt,Evt=t.dg*pvt,Avt=t.db*mvt,bvt=Gmt?255:0,Gvt[0]=Svt/255,Gvt[1]=Evt/255,Gvt[2]=Avt/255,Gvt[3]=bvt/255}var egt=new Float32Array(4);function igt(t){return egt[0]=t.r/255,egt[1]=t.g/255,egt[2]=t.b/255,egt[3]=t.a/255,egt}function ngt(t){return t?13:9}var rgt={createData:function(){},updateRenderData:function(t){xvt=t;var e=t._skeleton;!t.isAnimationCached()&&e&&e.updateWorldTransform(),e&&function(t){if(t._skeleton){var e,i=t.color;Kmt=i.r/255,Zmt=i.g/255,Qmt=i.b/255,Jmt=i.a/255,jmt=t.useTint||t.isAnimationCached(),$mt=ngt(jmt),wvt=t.node,t.destroyRenderData(),Cvt=t.requestMeshRenderData($mt),xvt=t,Qvt=null,avt=!0,Gmt=t.premultipliedAlpha,Hmt=1,Ovt=0,Rvt=!1,Zvt=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==i._val||Gmt)&&(Rvt=!0),jmt&&(Ovt|=1),xvt.enableBatch&&(e=wvt.worldMatrix,avt=!1,Ovt|=16),t.isAnimationCached()?function(t){var e=xvt._curFrame;if(e){var i,n,r=e.segments;if(0!==r.length){tvt=12;var a=null,o=e.vertices,s=e.indices,l=0,c=0,h=0;t&&(lvt=t.m00,uvt=t.m01,cvt=t.m04,_vt=t.m05,hvt=t.m12,fvt=t.m13);var u=16&Ovt,_=u&&(1===lvt&&0===uvt&&0===cvt&&1===_vt),f=0,d=e.colors,p=d[f++],m=p.vfOffset;tgt(p);for(var v=0,g=r.length;v<g;v++){var y=r[v];if(a=$vt(y.blendMode)){Qvt||(Qvt=a),Jvt||(Jvt=y.tex),Cvt.renderData.material&&(Cvt.renderData.material=Qvt),(avt||a.hash!==Qvt.hash||y.tex&&y.tex!==Jvt)&&(avt=!1,Cvt.texture||(Cvt.texture=y.tex),Cvt=xvt.requestMeshRenderData(ngt(jmt)),Qvt=a,Jvt=y.tex,Cvt.texture=y.tex,Cvt.renderData.material=Qvt),Wvt=y.vertexCount,Xvt=y.indexCount,Cvt.renderData.reserve(Wvt,Xvt),Yvt=Cvt.renderData.indicesCount,jvt=Cvt.renderData.vertexCount,Kvt=Cvt.renderData.vDataOffset,i=Cvt.renderData.vData,n=Cvt.renderData.iData;for(var T=Yvt,S=Yvt+Xvt;T<S;T++)n[T]=jvt+s[c++];h=y.vfCount;var E=o.subarray(l,l+h);l+=h;var A=Kvt;$mt=ngt(jmt);for(var b=0;b<E.length;)i[A+0]=E[b+0],i[A+1]=E[b+1],i[A+3]=E[b+3],i[A+4]=E[b+4],i[A+5]=E[b+5],i[A+6]=E[b+6],i[A+7]=E[b+7],i[A+8]=E[b+8],jmt&&(i[A+9]=E[b+9],i[A+10]=E[b+10],i[A+11]=E[b+11],i[A+12]=E[b+12]),A+=$mt,b+=13;if(_)for(var x=Kvt,C=Kvt+h;x<C;x+=$mt)i[x]+=hvt,i[x+1]+=fvt;else if(u)for(var w=Kvt,R=Kvt+h;w<R;w+=$mt)ovt=i[w],svt=i[w+1],i[w]=ovt*lvt+svt*cvt+hvt,i[w+1]=ovt*uvt+svt*_vt+fvt;if(Cvt.renderData.advance(Wvt,Xvt),Rvt)for(var I=l-h,O=Kvt,P=Kvt+h;O<P;O+=$mt,I+=6)I>=m&&(tgt(p=d[f++]),m=p.vfOffset),i.set(kvt,O+5),i.set(Gvt,O+9)}}}}}(e):(Zvt&&Zvt.begin(t._skeleton),function(t){var e,i,n,r,a,o,s,l,c=xvt._skeleton,h=c.color,u=xvt._debugRenderer,_=xvt._clipper,f=null;Vmt=xvt._startSlotIndex,Wmt=xvt._endSlotIndex,rvt=!1,-1===Vmt&&(rvt=!0),qmt=xvt.debugSlots,Xmt=xvt.debugBones,Ymt=xvt.debugMesh,u&&(Xmt||qmt||Ymt)&&(u.clear(),u.lineWidth=5),tvt=12,Vvt=0,jvt=0,qvt=0,Xvt=0,Yvt=0;for(var d=0,p=c.drawOrder.length;d<p;d++){var m;if(void 0!==(l=c.drawOrder[d]))if(Vmt>=0&&Vmt===l.data.index&&(rvt=!0),rvt)if(Wmt>=0&&Wmt===l.data.index&&(rvt=!1),Vvt=0,Xvt=0,n=l.getAttachment())if(o=n instanceof Xdt.RegionAttachment,s=n instanceof Xdt.MeshAttachment,n instanceof Xdt.ClippingAttachment)_.clipStart(l,n);else if(o||s){var v=n.region.texture.getRealTexture();if(f=$vt(l.data.blendMode)){if(Qvt||(Qvt=f),(null===(m=Cvt)||void 0===m?void 0:m.renderData.material)||(Cvt.renderData.material=Qvt),(avt||f.hash!==Qvt.hash||v&&Jvt!==v)&&(avt=!1,Cvt=xvt.requestMeshRenderData($mt),Qvt=f,Jvt=v,Cvt.texture=v,Cvt.renderData.material=Qvt),o){if(a=Pvt,Vvt=4*$mt,Xvt=6,Cvt.renderData.reserve(4,6),Yvt=Cvt.renderData.indicesCount,jvt=Cvt.renderData.vertexCount,qvt=Cvt.renderData.vDataOffset,e=Cvt.renderData.vData,i=Cvt.renderData.iData,n.computeWorldVertices(l.bone,e,qvt,$mt),u&&qmt){u.strokeColor=Mvt,u.moveTo(e[qvt],e[qvt+1]);for(var g=qvt+$mt,y=qvt+Vvt;g<y;g+=$mt)u.lineTo(e[g],e[g+1]);u.close(),u.stroke()}}else if(s){var T=n;if(a=T.triangles,Vvt=(T.worldVerticesLength>>1)*$mt,Xvt=a.length,Cvt.renderData.reserve(T.worldVerticesLength>>1,Xvt),Yvt=Cvt.renderData.indicesCount,jvt=Cvt.renderData.vertexCount,qvt=Cvt.renderData.vDataOffset,e=Cvt.renderData.vData,i=Cvt.renderData.iData,T.computeWorldVertices(l,0,T.worldVerticesLength,e,qvt,$mt),u&&Ymt){u.strokeColor=Lvt;for(var S=0,E=a.length;S<E;S+=3){var A=a[S]*$mt+qvt,b=a[S+1]*$mt+qvt,x=a[S+2]*$mt+qvt;u.moveTo(e[A],e[A+1]),u.lineTo(e[b],e[b+1]),u.lineTo(e[x],e[x+1]),u.close(),u.stroke()}}}if(0!==Vvt&&0!==Xvt){var C=n;i.set(a,Yvt),r=C.uvs;for(var w=qvt,R=qvt+Vvt,I=0;w<R;w+=$mt,I+=2)e[w+3]=r[I],e[w+4]=r[I+1];if(agt(h,C.color,l.color,_,l),e=Cvt.renderData.vData,i=Cvt.renderData.iData,Xvt>0){for(var O=Yvt,P=Yvt+Xvt;O<P;O++)i[O]+=jvt;if(t){lvt=t.m00,cvt=t.m04,hvt=t.m12,uvt=t.m01,_vt=t.m05,fvt=t.m13;for(var M=qvt,D=qvt+Vvt;M<D;M+=$mt)ovt=e[M],svt=e[M+1],e[M]=ovt*lvt+svt*cvt+hvt,e[M+1]=ovt*uvt+svt*_vt+fvt}Cvt.renderData.advance(Vvt/$mt,Xvt)}_.clipEndWithSlot(l)}else _.clipEndWithSlot(l)}else _.clipEndWithSlot(l)}else _.clipEndWithSlot(l);else _.clipEndWithSlot(l);else _.clipEndWithSlot(l)}if(_.clipEnd(),u&&Xmt){var N;u.strokeColor=Dvt,u.fillColor=Mvt;for(var L=0,B=c.bones.length;L<B;L++){var F=(N=c.bones[L]).data.length*N.a+N.worldX,z=N.data.length*N.c+N.worldY;u.moveTo(N.worldX,N.worldY),u.lineTo(F,z),u.stroke(),u.circle(N.worldX,N.worldY,1.5*Math.PI),u.fill(),0===L&&(u.fillColor=Nvt)}}}(e),Zvt&&Zvt.end()),t.attachUtil._syncAttachedNode(),wvt=void 0,Cvt=void 0,xvt=void 0,Zvt=null}}(t)},updateColor:function(t){xvt=t},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){xvt=t;var i=t.meshRenderDataArray,n=t.node,r=i[t._meshRenderDataArrayIdx].renderData,a=e.acquireBufferBatch(9===r.floatStride?fU:dU),o=a.byteOffset>>2,s=a.indicesOffset,l=a.vertexOffset;a.request(r.vertexCount,r.indicesCount)||(a=e.currBufferBatch,o=0,s=0,l=0);var c=a.vData,h=a.iData,u=n.worldMatrix,_=r.vData,f=r.vertexStart,d=r.iData,p=r.floatStride;c.set(_.subarray(f,f+r.vertexCount*p),o);for(var m=0;m<r.vertexCount;m++){var v=o+m*p;Hvt.set(c[v],c[v+1],c[v+2]),Hvt.transformMat4(u),c[v]=Hvt.x,c[v+1]=Hvt.y,c[v+2]=Hvt.z}for(var g=r.indicesStart,y=0;y<r.indicesCount;y+=1)h[y+s]=d[y+g]+l}}};function agt(t,e,i,n,r){var a=Cvt.renderData.vData,o=Cvt.renderData.iData;if(Bvt.a=i.a*e.a*t.a*Jmt*255,Hmt=Gmt?Bvt.a:255,evt=Kmt*e.r*t.r*Hmt,ivt=Zmt*e.g*t.g*Hmt,nvt=Qmt*e.b*t.b*Hmt,Bvt.r=evt*i.r,Bvt.g=ivt*i.g,Bvt.b=nvt*i.b,null==r.darkColor?Fvt.set(0,0,0,1):(Fvt.r=r.darkColor.r*evt,Fvt.g=r.darkColor.g*ivt,Fvt.b=r.darkColor.b*nvt),Fvt.a=Gmt?255:0,n.isClipping()){tvt=jmt?12:8;var s=a.subarray(qvt),l=a.subarray(qvt+3);n.clipTriangles(s,Vvt,o.subarray(Yvt),Xvt,l,Bvt,Fvt,jmt,$mt);var c=new Float32Array(n.clippedVertices),h=n.clippedTriangles;if(Xvt=h.length,Vvt=c.length/tvt*$mt,Cvt.renderData.reserve(Vvt/$mt,Xvt),Yvt=Cvt.renderData.indicesCount,jvt=Cvt.renderData.vertexCount,qvt=Cvt.renderData.vDataOffset,a=Cvt.renderData.vData,o=Cvt.renderData.iData,h.length>0&&o.set(h,Yvt),Zvt)for(var u=0,_=c.length,f=qvt;u<_;u+=tvt,f+=$mt)zvt.x=c[u],zvt.y=c[u+1],Bvt.set(c[u+2],c[u+3],c[u+4],c[u+5]),Uvt.x=c[u+6],Uvt.y=c[u+7],jmt?Fvt.set(c[u+8],c[u+9],c[u+10],c[u+11]):Fvt.set(0,0,0,0),Zvt.transform(zvt,Uvt,Bvt,Fvt),a[f]=zvt.x,a[f+1]=zvt.y,a[f+3]=Uvt.x,a[f+4]=Uvt.y,a.set(igt(Bvt),f+5),jmt&&a.set(igt(Fvt),f+9);else for(var d=0,p=c.length,m=qvt;d<p;d+=tvt,m+=$mt)a[m]=c[d],a[m+1]=c[d+1],a[m+3]=c[d+6],a[m+4]=c[d+7],a[m+5]=c[d+2]/255,a[m+6]=c[d+3]/255,a[m+7]=c[d+4]/255,a[m+8]=c[d+5]/255,jmt&&(a[m+9]=c[d+8]/255,a[m+10]=c[d+9]/255,a[m+11]=c[d+10]/255,a[m+12]=c[d+11]/255)}else if(Zvt)for(var v=qvt,g=qvt+Vvt;v<g;v+=$mt)zvt.x=a[v],zvt.y=a[v+1],Uvt.x=a[v+3],Uvt.y=a[v+4],Zvt.transform(zvt,Uvt,Bvt,Fvt),a[v]=zvt.x,a[v+1]=zvt.y,a[v+3]=Uvt.x,a[v+4]=Uvt.y,a.set(igt(Bvt),v+5),jmt&&a.set(igt(Fvt),v+9);else{kvt.set(igt(Bvt)),Gvt.set(igt(Fvt));for(var y=qvt,T=qvt+Vvt;y<T;y+=$mt)a.set(kvt,y+5),jmt&&a.set(Gvt,y+9)}}n.internal.SpineAssembler=rgt;var ogt,sgt,lgt={getAssembler:function(){return rgt}};kmt.Assembler=lgt,function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(ogt||(ogt={})),fe(ogt),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.DISPOSE=3]="DISPOSE",t[t.COMPLETE=4]="COMPLETE",t[t.EVENT=5]="EVENT"}(sgt||(sgt={})),fe(sgt),t("sp",Object.freeze({__proto__:null,spine:Xdt,get ATTACHMENT_TYPE(){return ogt},get AnimationEventType(){return sgt},timeScale:1,get DefaultSkinsEnum(){return Dmt},get DefaultAnimsEnum(){return Nmt},get AnimationCacheMode(){return Lmt},get SpineMaterialType(){return Bmt},SpineSocket:Umt,Skeleton:kmt,SkeletonData:Fmt,SkeletonTexture:Ipt,convertFilter:Opt,convertWraps:Ppt,VertexEffectDelegate:Ivt,simpleSpineAssembler:lgt}))}}}));
